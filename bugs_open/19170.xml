<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "http://defect.opensolaris.org/bz/bugzilla.dtd">

<bugzilla version="3.6.5"
          urlbase="http://defect.opensolaris.org/bz/"
          
          maintainer="website-admin@opensolaris.org"
>

    <bug>
          <bug_id>19170</bug_id>
          
          <creation_ts>2012-02-13 06:44:00 +0000</creation_ts>
          <short_desc>logging consolidation</short_desc>
          <delta_ts>2012-02-16 06:05:56 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Development</classification>
          <product>opengrok</product>
          <component>misc</component>
          <version>unspecified</version>
          <rep_platform>ANY/Generic</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>NEW</bug_status>
          
          
          
          
          
          
          <priority>P3</priority>
          <bug_severity>minor</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Jens Elkner">jel+osbugs</reporter>
          <assigned_to name="Trond Norbye">trond.norbye</assigned_to>
          <cc>opengrok-dev</cc>
          

      

      

      

          <long_desc isprivate="0">
            <commentid>86182</commentid>
              <attachid>4625</attachid>
            <who name="Jens Elkner">jel+osbugs</who>
            <bug_when>2012-02-13 06:44:16 +0000</bug_when>
            <thetext>Created attachment 4625
patch

patch provides:
- stack traces are never logged at a level &gt;= CONFIG to avoid user annoyance
  with one exception: the UncaughtExceptionHandler ;-)
- each class logs to its own logger (FQCN) to allow a more fine grained, selective logging;
  OpenGrokLogger is just used as very simple Logging Configurator
- file and path names are usually enclosed in single quotes
- commands and contents of a line in brackets ([])
- warnings+ are usually always logged: no need to use formatter for those msgs</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <commentid>86192</commentid>
            <who name="Trond Norbye">trond.norbye</who>
            <bug_when>2012-02-14 20:44:23 +0000</bug_when>
            <thetext>Can you split the patch into  multiple patches that fix one thing? The current patch fix some formatting, some bugfixing etc..</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <commentid>86193</commentid>
            <who name="Jens Elkner">jel+osbugs</who>
            <bug_when>2012-02-14 23:51:10 +0000</bug_when>
            <thetext>(In reply to comment #1)
&gt; Can you split the patch into  multiple patches that fix one thing? The current
&gt; patch fix some formatting, some bugfixing etc..

Hmmm, doesn&apos;t make sense to me.</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <commentid>86207</commentid>
            <who name="Trond Norbye">trond.norbye</who>
            <bug_when>2012-02-16 06:05:56 +0000</bug_when>
            <thetext>What doesn&apos;t make any senese? To have a patch only fix related stuff?? Patches that fix completely unrelated stuff makes it way harder to back it out again if there is some problems with the patch. Last time we did push one of these patches through, and it pretty much blocked the release process for a long period of time since we couldn&apos;t back out the thing we had a regression in. 

As a rule of thumb one should consider splitting up a patch into multiple patches whenever you start typing the word &quot;and&quot; or start listing stuff in the commit when one is writing the commit message.</thetext>
          </long_desc>
      
          <attachment
              isobsolete="0"
              ispatch="1"
              isprivate="0"
              isurl="0"
          >
            <attachid>4625</attachid>
            <date>2012-02-13 06:44:00 +0000</date>
            <delta_ts>2012-02-13 06:44:33 +0000</delta_ts>
            <desc>patch</desc>
            <filename>logging.patch</filename>
            <type>text/plain</type>
            <size>205437</size>
            <attacher>jel+osbugs</attacher>
            
              <data encoding="base64">IyBIRyBjaGFuZ2VzZXQgcGF0Y2gKIyBVc2VyIGplbCtvcGVuZ3Jva0Bjcy51bmktbWFnZGVidXJn
LmRlCiMgRGF0ZSAxMzI5MTA5OTY3IC0zNjAwCiMgTm9kZSBJRCAyNjExMTY1MDdjN2FlN2U2NDBh
NjNjZDQzMjcxOTg4OTA4ZDkyYzRmCiMgUGFyZW50ICA2MTU0OTAyNmFhZmVmOTE2OTkzMDdjYTAw
NzNlODAwMzNiZDZlNGQwCmxvZ2dpbmcgY29uc29saWRhdGlvbjoKLSBzdGFjayB0cmFjZXMgYXJl
IG5ldmVyIGxvZ2dlZCBhdCBhIGxldmVsID49IENPTkZJRyB0byBhdm9pZCB1c2VyIGFubm95YW5j
ZQogIHdpdGggb25lIGV4Y2VwdGlvbjogdGhlIFVuY2F1Z2h0RXhjZXB0aW9uSGFuZGxlciA7LSkK
LSBlYWNoIGNsYXNzIGxvZ3MgdG8gaXRzIG93biBsb2dnZXIgKEZRQ04pIHRvIGFsbG93IGEgbW9y
ZSBmaW5lIGdyYWluZWQsIHNlbGVjdGl2ZSBsb2dnaW5nOwogIE9wZW5Hcm9rTG9nZ2VyIGlzIGp1
c3QgdXNlZCBhcyB2ZXJ5IHNpbXBsZSBMb2dnaW5nIENvbmZpZ3VyYXRvcgotIGZpbGUgYW5kIHBh
dGggbmFtZXMgYXJlIHVzdWFsbHkgZW5jbG9zZWQgaW4gc2luZ2xlIHF1b3RlcwotIGNvbW1hbmRz
IGFuZCBjb250ZW50cyBvZiBhIGxpbmUgaW4gYnJhY2tldHMgKFtdKQotIHdhcm5pbmdzKyBhcmUg
dXN1YWxseSBhbHdheXMgbG9nZ2VkOiBubyBuZWVkIHRvIHVzZSBmb3JtYXR0ZXIgZm9yIHRob3Nl
IG1zZ3MKCmRpZmYgLXIgNjE1NDkwMjZhYWZlIC1yIDI2MTExNjUwN2M3YSBzcmMvb3JnL29wZW5z
b2xhcmlzL29wZW5ncm9rL09wZW5Hcm9rTG9nZ2VyLmphdmEKLS0tIGEvc3JjL29yZy9vcGVuc29s
YXJpcy9vcGVuZ3Jvay9PcGVuR3Jva0xvZ2dlci5qYXZhCVN1biBGZWIgMTIgMDQ6Mzc6MzYgMjAx
MiArMDEwMAorKysgYi9zcmMvb3JnL29wZW5zb2xhcmlzL29wZW5ncm9rL09wZW5Hcm9rTG9nZ2Vy
LmphdmEJTW9uIEZlYiAxMyAwNjoxMjo0NyAyMDEyICswMTAwCkBAIC0xODMsOCArMTgzLDcgQEAK
ICAgICAgICAgICAgIGxvZy5hZGRIYW5kbGVyKGNoKTsKIAogICAgICAgICB9IGNhdGNoIChFeGNl
cHRpb24gZXgxKSB7Ci0gICAgICAgICAgICBTeXN0ZW0uZXJyLnByaW50bG4oIkV4Y2VwdGlvbiBs
b2dnaW5nICIgKyBleDEpOwotICAgICAgICAgICAgdGhyb3cgbmV3IElPRXhjZXB0aW9uKCJFeGNl
cHRpb24gc2V0dGluZyB1cCBsb2dnaW5nICIgKyBleDEpOworICAgICAgICAgICAgdGhyb3cgbmV3
IElPRXhjZXB0aW9uKCJFeGNlcHRpb24gc2V0dGluZyB1cCBsb2dnaW5nICIgKyBleDEuZ2V0TWVz
c2FnZSgpKTsKICAgICAgICAgfQogICAgICAgICBsb2cuc2V0TGV2ZWwoZmlsZWxldmVsKTsKICAg
ICAgICAgcmV0dXJuIGxvZ3BhdGg7CmRpZmYgLXIgNjE1NDkwMjZhYWZlIC1yIDI2MTExNjUwN2M3
YSBzcmMvb3JnL29wZW5zb2xhcmlzL29wZW5ncm9rL2FuYWx5c2lzL0FuYWx5emVyR3VydS5qYXZh
Ci0tLSBhL3NyYy9vcmcvb3BlbnNvbGFyaXMvb3Blbmdyb2svYW5hbHlzaXMvQW5hbHl6ZXJHdXJ1
LmphdmEJU3VuIEZlYiAxMiAwNDozNzozNiAyMDEyICswMTAwCisrKyBiL3NyYy9vcmcvb3BlbnNv
bGFyaXMvb3Blbmdyb2svYW5hbHlzaXMvQW5hbHl6ZXJHdXJ1LmphdmEJTW9uIEZlYiAxMyAwNjox
Mjo0NyAyMDEyICswMTAwCkBAIC0zNSwxMCArMzUsMTEgQEAKIGltcG9ydCBqYXZhLnV0aWwuU29y
dGVkTWFwOwogaW1wb3J0IGphdmEudXRpbC5UcmVlTWFwOwogaW1wb3J0IGphdmEudXRpbC5sb2dn
aW5nLkxldmVsOworaW1wb3J0IGphdmEudXRpbC5sb2dnaW5nLkxvZ2dlcjsKKwogaW1wb3J0IG9y
Zy5hcGFjaGUubHVjZW5lLmRvY3VtZW50LkRhdGVUb29sczsKIGltcG9ydCBvcmcuYXBhY2hlLmx1
Y2VuZS5kb2N1bWVudC5Eb2N1bWVudDsKIGltcG9ydCBvcmcuYXBhY2hlLmx1Y2VuZS5kb2N1bWVu
dC5GaWVsZDsKLWltcG9ydCBvcmcub3BlbnNvbGFyaXMub3Blbmdyb2suT3Blbkdyb2tMb2dnZXI7
CiBpbXBvcnQgb3JnLm9wZW5zb2xhcmlzLm9wZW5ncm9rLmFuYWx5c2lzLkZpbGVBbmFseXplci5H
ZW5yZTsKIGltcG9ydCBvcmcub3BlbnNvbGFyaXMub3Blbmdyb2suYW5hbHlzaXMuYXJjaGl2ZS5C
WmlwMkFuYWx5emVyRmFjdG9yeTsKIGltcG9ydCBvcmcub3BlbnNvbGFyaXMub3Blbmdyb2suYW5h
bHlzaXMuYXJjaGl2ZS5HWklQQW5hbHl6ZXJGYWN0b3J5OwpAQCAtNDYsNiArNDcsNyBAQAogaW1w
b3J0IG9yZy5vcGVuc29sYXJpcy5vcGVuZ3Jvay5hbmFseXNpcy5hcmNoaXZlLlppcEFuYWx5emVy
RmFjdG9yeTsKIGltcG9ydCBvcmcub3BlbnNvbGFyaXMub3Blbmdyb2suYW5hbHlzaXMuYy5DQW5h
bHl6ZXJGYWN0b3J5OwogaW1wb3J0IG9yZy5vcGVuc29sYXJpcy5vcGVuZ3Jvay5hbmFseXNpcy5j
LkN4eEFuYWx5emVyRmFjdG9yeTsKK2ltcG9ydCBvcmcub3BlbnNvbGFyaXMub3Blbmdyb2suYW5h
bHlzaXMuY3NoYXJwLkNTaGFycEFuYWx5emVyRmFjdG9yeTsKIGltcG9ydCBvcmcub3BlbnNvbGFy
aXMub3Blbmdyb2suYW5hbHlzaXMuZGF0YS5JZ25vcmFudEFuYWx5emVyRmFjdG9yeTsKIGltcG9y
dCBvcmcub3BlbnNvbGFyaXMub3Blbmdyb2suYW5hbHlzaXMuZGF0YS5JbWFnZUFuYWx5emVyRmFj
dG9yeTsKIGltcG9ydCBvcmcub3BlbnNvbGFyaXMub3Blbmdyb2suYW5hbHlzaXMuZG9jdW1lbnQu
VHJvZmZBbmFseXplckZhY3Rvcnk7CkBAIC02NCw3ICs2Niw2IEBACiBpbXBvcnQgb3JnLm9wZW5z
b2xhcmlzLm9wZW5ncm9rLmFuYWx5c2lzLnNoLlNoQW5hbHl6ZXJGYWN0b3J5OwogaW1wb3J0IG9y
Zy5vcGVuc29sYXJpcy5vcGVuZ3Jvay5hbmFseXNpcy5zcWwuU1FMQW5hbHl6ZXJGYWN0b3J5Owog
aW1wb3J0IG9yZy5vcGVuc29sYXJpcy5vcGVuZ3Jvay5hbmFseXNpcy50Y2wuVGNsQW5hbHl6ZXJG
YWN0b3J5OwotaW1wb3J0IG9yZy5vcGVuc29sYXJpcy5vcGVuZ3Jvay5hbmFseXNpcy5jc2hhcnAu
Q1NoYXJwQW5hbHl6ZXJGYWN0b3J5OwogaW1wb3J0IG9yZy5vcGVuc29sYXJpcy5vcGVuZ3Jvay5h
bmFseXNpcy52Yi5WQkFuYWx5emVyRmFjdG9yeTsKIGltcG9ydCBvcmcub3BlbnNvbGFyaXMub3Bl
bmdyb2suY29uZmlndXJhdGlvbi5Qcm9qZWN0OwogaW1wb3J0IG9yZy5vcGVuc29sYXJpcy5vcGVu
Z3Jvay5oaXN0b3J5LkFubm90YXRpb247CkBAIC04Miw3ICs4Myw3IEBACiAgKiBAYXV0aG9yIENo
YW5kYW4KICAqLwogcHVibGljIGNsYXNzIEFuYWx5emVyR3VydSB7Ci0KKyAgICBwcml2YXRlIHN0
YXRpYyBmaW5hbCBMb2dnZXIgbG9nZ2VyID0gTG9nZ2VyLmdldExvZ2dlcihBbmFseXplckd1cnUu
Y2xhc3MuZ2V0TmFtZSgpKTsKICAgICAvKiogVGhlIGRlZmF1bHQge0Bjb2RlIEZpbGVBbmFseXpl
ckZhY3Rvcnl9IGluc3RhbmNlLiAqLwogICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIEZpbGVBbmFs
eXplckZhY3RvcnkKICAgICAgICAgREVGQVVMVF9BTkFMWVpFUl9GQUNUT1JZID0gbmV3IEZpbGVB
bmFseXplckZhY3RvcnkoKTsKQEAgLTI0Miw3ICsyNDMsOCBAQAogICAgICAgICAgICAgICAgIC8v
IGRhdGUgPSBoci5nZXRMYXN0Q29tbWVudERhdGUoKSAvL1JGRQogICAgICAgICAgICAgfQogICAg
ICAgICB9IGNhdGNoIChIaXN0b3J5RXhjZXB0aW9uIGUpIHsKLSAgICAgICAgICAgIE9wZW5Hcm9r
TG9nZ2VyLmdldExvZ2dlcigpLmxvZyhMZXZlbC5XQVJOSU5HLCAiQW4gZXJyb3Igb2NjdXJyZWQg
d2hpbGUgcmVhZGluZyBoaXN0b3J5OiAiLCBlKTsKKyAgICAgICAgICAgIGxvZ2dlci53YXJuaW5n
KCJBbiBlcnJvciBvY2N1cnJlZCB3aGlsZSByZWFkaW5nIGhpc3Rvcnk6ICIgKyAgZS5nZXRNZXNz
YWdlKCkpOworICAgICAgICAgICAgbG9nZ2VyLmxvZyhMZXZlbC5GSU5FLCAiZ2V0RG9jdW1lbnQi
LCBlKTsKICAgICAgICAgfQogICAgICAgICBkb2MuYWRkKG5ldyBGaWVsZCgiZGF0ZSIsIGRhdGUs
IEZpZWxkLlN0b3JlLllFUywgRmllbGQuSW5kZXguTk9UX0FOQUxZWkVEKSk7CiAgICAgICAgIGlm
IChwYXRoICE9IG51bGwpIHsKZGlmZiAtciA2MTU0OTAyNmFhZmUgLXIgMjYxMTE2NTA3YzdhIHNy
Yy9vcmcvb3BlbnNvbGFyaXMvb3Blbmdyb2svYW5hbHlzaXMvQ3RhZ3MuamF2YQotLS0gYS9zcmMv
b3JnL29wZW5zb2xhcmlzL29wZW5ncm9rL2FuYWx5c2lzL0N0YWdzLmphdmEJU3VuIEZlYiAxMiAw
NDozNzozNiAyMDEyICswMTAwCisrKyBiL3NyYy9vcmcvb3BlbnNvbGFyaXMvb3Blbmdyb2svYW5h
bHlzaXMvQ3RhZ3MuamF2YQlNb24gRmViIDEzIDA2OjEyOjQ3IDIwMTIgKzAxMDAKQEAgLTUzLDcg
KzUzLDcgQEAKICAgICAgICAgdGhpcy5iaW5hcnkgPSBiaW5hcnk7CiAgICAgfQogCi0gICAgcHVi
bGljIHZvaWQgY2xvc2UoKSB0aHJvd3MgSU9FeGNlcHRpb24geworICAgIHB1YmxpYyB2b2lkIGNs
b3NlKCkgewogICAgICAgICBJT1V0aWxzLmNsb3NlKGN0YWdzSW4pOwogICAgICAgICBpZiAoY3Rh
Z3MgIT0gbnVsbCkgewogICAgICAgICAgICAgY3RhZ3MuZGVzdHJveSgpOwpAQCAtOTEsMjEgKzkx
LDI1IEBACiAKICAgICAgICAgVGhyZWFkIGVyclRocmVhZCA9IG5ldyBUaHJlYWQobmV3IFJ1bm5h
YmxlKCkgewogCisgICAgICAgICAgICBAU3VwcHJlc3NXYXJuaW5ncygic3ludGhldGljLWFjY2Vz
cyIpCisgICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgIHB1YmxpYyB2b2lkIHJ1bigp
IHsKICAgICAgICAgICAgICAgICBTdHJpbmdCdWlsZGVyIHNiID0gbmV3IFN0cmluZ0J1aWxkZXIo
KTsKICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICBTdHJpbmcgczsK
ICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKChzID0gZXJyb3IucmVhZExpbmUoKSkgIT0gbnVs
bCkgeworICAgICAgICAgICAgICAgICAgICAgICAgc2IuYXBwZW5kKCJcblx0Iik7CiAgICAgICAg
ICAgICAgICAgICAgICAgICBzYi5hcHBlbmQocyk7Ci0gICAgICAgICAgICAgICAgICAgICAgICBz
Yi5hcHBlbmQoJ1xuJyk7CiAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICB9
IGNhdGNoIChJT0V4Y2VwdGlvbiBleHApIHsKLSAgICAgICAgICAgICAgICAgICAgIGxvZy5sb2co
TGV2ZWwuV0FSTklORywgIkdvdCBhbiBleGNlcHRpb24gcmVhZGluZyBjdGFncyBlcnJvciBzdHJl
YW06ICIsIGV4cCk7CisgICAgICAgICAgICAgICAgICAgICBsb2cud2FybmluZygiR290IGFuIGV4
Y2VwdGlvbiByZWFkaW5nIGN0YWdzIGVycm9yIHN0cmVhbTogIgorICAgICAgICAgICAgICAgICAg
ICAgICAgICsgZXhwLmdldE1lc3NhZ2UoKSk7CisgICAgICAgICAgICAgICAgICAgICBsb2cubG9n
KExldmVsLkZJTkUsICJydW4iLCBleHApOwogICAgICAgICAgICAgICAgIH0gZmluYWxseSB7CiAg
ICAgICAgICAgICAgICAgICAgIElPVXRpbHMuY2xvc2UoZXJyb3IpOwogICAgICAgICAgICAgICAg
IH0KICAgICAgICAgICAgICAgICBpZiAoc2IubGVuZ3RoKCkgPiAwKSB7Ci0gICAgICAgICAgICAg
ICAgICAgICBsb2cud2FybmluZygiRXJyb3IgZnJvbSBjdGFnczogIiArIHNiLnRvU3RyaW5nKCkp
OworICAgICAgICAgICAgICAgICAgICAgbG9nLndhcm5pbmcoImN0YWdzIHByb2JsZW1zOiIgKyBz
Yi50b1N0cmluZygpKTsKICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICB9CiAgICAgICAg
IH0pOwpAQCAtMTUxLDkgKzE1NSwxMCBAQAogICAgICAgICAgICAgICAgICAgICBsb2cud2Fybmlu
ZygiVW5leHBlY3RlZCBlbmQgb2YgZmlsZSEiKTsKICAgICAgICAgICAgICAgICAgICAgdHJ5IHsK
ICAgICAgICAgICAgICAgICAgICAgICAgIGludCB2YWwgPSBjdGFncy5leGl0VmFsdWUoKTsKLSAg
ICAgICAgICAgICAgICAgICAgICAgIGxvZy53YXJuaW5nKCJjdGFncyBleGl0ZWQgd2l0aCBjb2Rl
OiAiICsgdmFsKTsKKyAgICAgICAgICAgICAgICAgICAgICAgIGxvZy53YXJuaW5nKCJjdGFncyBl
eGl0ZWQgd2l0aCBjb2RlICIgKyB2YWwpOwogICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChF
eGNlcHRpb24gZSkgewotICAgICAgICAgICAgICAgICAgICAgICAgbG9nLmxvZyhMZXZlbC5XQVJO
SU5HLCAiQ3RhZ3MgcHJvYmxlbTogIiwgZSk7CisgICAgICAgICAgICAgICAgICAgICAgICBsb2cu
d2FybmluZygiQ3RhZ3MgcHJvYmxlbTogIiArIGUuZ2V0TWVzc2FnZSgpKTsKKyAgICAgICAgICAg
ICAgICAgICAgICAgIGxvZy5sb2coTGV2ZWwuRklORSwgInJlYWRUYWdzIiwgZSk7CiAgICAgICAg
ICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgbG9nLmZpbmUoIkN0YWcgcmVhZCIp
OwogICAgICAgICAgICAgICAgICAgICByZXR1cm47CkBAIC0xNjUsNyArMTcwLDcgQEAKIAogICAg
ICAgICAgICAgICAgIC8vZml4IGZvciBidWcgIzE2MzM0CiAgICAgICAgICAgICAgICAgaWYgKHRh
Z0xpbmUuZW5kc1dpdGgoQ1RBR1NfRklMVEVSX1RFUk1JTkFUT1IpKSB7Ci0gICAgICAgICAgICAg
ICAgICAgIGxvZy5sb2coTGV2ZWwuV0FSTklORywgImN0YWdzIGVuY291bnRlcmVkIGEgcHJvYmxl
bSB3aGlsZSBnZW5lcmF0aW5nIHRhZ3MgZm9yIHRoZSBmaWxlLiBUaGUgaW5kZXggd2lsbCBiZSBp
bmNvbXBsZXRlLiIpOworICAgICAgICAgICAgICAgICAgICBsb2cud2FybmluZygiY3RhZ3MgZW5j
b3VudGVyZWQgYSBwcm9ibGVtIHdoaWxlIGdlbmVyYXRpbmcgdGFncyBmb3IgdGhlIGZpbGUuIFRo
ZSBpbmRleCB3aWxsIGJlIGluY29tcGxldGUuIik7CiAgICAgICAgICAgICAgICAgICAgIHJldHVy
bjsKICAgICAgICAgICAgICAgICB9CiAKQEAgLTIzNiw3ICsyNDEsOCBAQAogICAgICAgICAgICAg
Ly9sb2cuZmluZSgiUmVhZCA9ICIgKyBkZWYgKyAiIDogIiArIGxudW0gKyAiID0gIiArIGtpbmQg
KyAiIElTICIgKyBpbmhlciArICIgTSAiICsgbWF0Y2gpOwogICAgICAgICAgICAgfSB3aGlsZSAo
dHJ1ZSk7CiAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7Ci0gICAgICAgICAgICBsb2cu
bG9nKExldmVsLldBUk5JTkcsICJDVGFncyBwYXJzaW5nIHByb2JsZW06ICIsIGUpOworICAgICAg
ICAgICAgbG9nLndhcm5pbmcoIkNUYWdzIHBhcnNpbmcgcHJvYmxlbTogIiArIGUuZ2V0TWVzc2Fn
ZSgpKTsKKyAgICAgICAgICAgIGxvZy5sb2coTGV2ZWwuRklORSwgInJlYWRUYWdzIiwgZSk7CiAg
ICAgICAgIH0KICAgICAgICAgbG9nLnNldmVyZSgiQ1RhZyByZWFkZXIgY3ljbGUgd2FzIGludGVy
cnVwdGVkISIpOwogICAgIH0KZGlmZiAtciA2MTU0OTAyNmFhZmUgLXIgMjYxMTE2NTA3YzdhIHNy
Yy9vcmcvb3BlbnNvbGFyaXMvb3Blbmdyb2svYW5hbHlzaXMvRXhwYW5kVGFic1JlYWRlci5qYXZh
Ci0tLSBhL3NyYy9vcmcvb3BlbnNvbGFyaXMvb3Blbmdyb2svYW5hbHlzaXMvRXhwYW5kVGFic1Jl
YWRlci5qYXZhCVN1biBGZWIgMTIgMDQ6Mzc6MzYgMjAxMiArMDEwMAorKysgYi9zcmMvb3JnL29w
ZW5zb2xhcmlzL29wZW5ncm9rL2FuYWx5c2lzL0V4cGFuZFRhYnNSZWFkZXIuamF2YQlNb24gRmVi
IDEzIDA2OjEyOjQ3IDIwMTIgKzAxMDAKQEAgLTcwLDExICs3MCw5IEBACiAgICAgICogdGFicyBh
cyBkZWZpbmVkIGJ5IHRoZSBwcm9qZWN0J3Mgc2V0dGluZ3MKICAgICAgKi8KICAgICBwdWJsaWMg
c3RhdGljIFJlYWRlciB3cmFwKFJlYWRlciBpbiwgUHJvamVjdCBwKSB7Ci0gICAgICAgIGlmIChw
ICE9IG51bGwgJiYgcC5oYXNUYWJTaXplU2V0dGluZygpKSB7Ci0gICAgICAgICAgICByZXR1cm4g
bmV3IEV4cGFuZFRhYnNSZWFkZXIoaW4sIHAuZ2V0VGFiU2l6ZSgpKTsKLSAgICAgICAgfSBlbHNl
IHsKLSAgICAgICAgICAgIHJldHVybiBpbjsKLSAgICAgICAgfQorICAgICAgICByZXR1cm4gKHAg
IT0gbnVsbCAmJiBwLmhhc1RhYlNpemVTZXR0aW5nKCkpCisgICAgICAgICAgICA/IG5ldyBFeHBh
bmRUYWJzUmVhZGVyKGluLCBwLmdldFRhYlNpemUoKSkKKyAgICAgICAgICAgIDogaW47CiAgICAg
fQogCiAgICAgQE92ZXJyaWRlCmRpZmYgLXIgNjE1NDkwMjZhYWZlIC1yIDI2MTExNjUwN2M3YSBz
cmMvb3JnL29wZW5zb2xhcmlzL29wZW5ncm9rL2FuYWx5c2lzL0ZpbGVBbmFseXplci5qYXZhCi0t
LSBhL3NyYy9vcmcvb3BlbnNvbGFyaXMvb3Blbmdyb2svYW5hbHlzaXMvRmlsZUFuYWx5emVyLmph
dmEJU3VuIEZlYiAxMiAwNDozNzozNiAyMDEyICswMTAwCisrKyBiL3NyYy9vcmcvb3BlbnNvbGFy
aXMvb3Blbmdyb2svYW5hbHlzaXMvRmlsZUFuYWx5emVyLmphdmEJTW9uIEZlYiAxMyAwNjoxMjo0
NyAyMDEyICswMTAwCkBAIC0zMiwxMiArMzIsMTIgQEAKIGltcG9ydCBqYXZhLmlvLk91dHB1dFN0
cmVhbVdyaXRlcjsKIGltcG9ydCBqYXZhLmlvLlJlYWRlcjsKIGltcG9ydCBqYXZhLmlvLldyaXRl
cjsKLWltcG9ydCBqYXZhLnV0aWwubG9nZ2luZy5MZXZlbDsKK2ltcG9ydCBqYXZhLnV0aWwubG9n
Z2luZy5Mb2dnZXI7CiBpbXBvcnQgamF2YS51dGlsLnppcC5HWklQT3V0cHV0U3RyZWFtOworCiBp
bXBvcnQgb3JnLmFwYWNoZS5sdWNlbmUuYW5hbHlzaXMuQW5hbHl6ZXI7CiBpbXBvcnQgb3JnLmFw
YWNoZS5sdWNlbmUuYW5hbHlzaXMuVG9rZW5TdHJlYW07CiBpbXBvcnQgb3JnLmFwYWNoZS5sdWNl
bmUuZG9jdW1lbnQuRG9jdW1lbnQ7Ci1pbXBvcnQgb3JnLm9wZW5zb2xhcmlzLm9wZW5ncm9rLk9w
ZW5Hcm9rTG9nZ2VyOwogaW1wb3J0IG9yZy5vcGVuc29sYXJpcy5vcGVuZ3Jvay5jb25maWd1cmF0
aW9uLlByb2plY3Q7CiBpbXBvcnQgb3JnLm9wZW5zb2xhcmlzLm9wZW5ncm9rLmNvbmZpZ3VyYXRp
b24uUnVudGltZUVudmlyb25tZW50OwogaW1wb3J0IG9yZy5vcGVuc29sYXJpcy5vcGVuZ3Jvay51
dGlsLklPVXRpbHM7CkBAIC01OSw3ICs1OSw3IEBACiAgKiBAYXV0aG9yIENoYW5kYW4KICAqLwog
cHVibGljIGNsYXNzIEZpbGVBbmFseXplciBleHRlbmRzIEFuYWx5emVyIHsKLQorICAgIHByaXZh
dGUgc3RhdGljIGZpbmFsIExvZ2dlciBsb2dnZXIgPSBMb2dnZXIuZ2V0TG9nZ2VyKEZpbGVBbmFs
eXplci5jbGFzcy5nZXROYW1lKCkpOwogICAgIHByb3RlY3RlZCBQcm9qZWN0IHByb2plY3Q7CiAg
ICAgcHJpdmF0ZSBmaW5hbCBGaWxlQW5hbHl6ZXJGYWN0b3J5IGZhY3Rvcnk7CiAKQEAgLTE0OSw3
ICsxNDksNyBAQAogICAgICAgICB9IGVsc2UgaWYgKCJoaXN0Ii5lcXVhbHMoZmllbGROYW1lKSkg
ewogICAgICAgICAgICAgcmV0dXJuIGhpc3RhLnRva2VuU3RyZWFtKGZpZWxkTmFtZSwgcmVhZGVy
KTsKICAgICAgICAgfQotICAgICAgICBPcGVuR3Jva0xvZ2dlci5nZXRMb2dnZXIoKS5sb2coTGV2
ZWwuV0FSTklORywgIkhhdmUgbm8gYW5hbHl6ZXIgZm9yOiB7MH0iLCBmaWVsZE5hbWUpOworICAg
ICAgICBsb2dnZXIud2FybmluZygiSGF2ZSBubyBhbmFseXplciBmb3IgJyIgKyBmaWVsZE5hbWUg
KyAiJyIpOwogICAgICAgICByZXR1cm4gbnVsbDsKICAgICB9CiAKZGlmZiAtciA2MTU0OTAyNmFh
ZmUgLXIgMjYxMTE2NTA3YzdhIHNyYy9vcmcvb3BlbnNvbGFyaXMvb3Blbmdyb2svYW5hbHlzaXMv
YXJjaGl2ZS9HWklQQW5hbHl6ZXIuamF2YQotLS0gYS9zcmMvb3JnL29wZW5zb2xhcmlzL29wZW5n
cm9rL2FuYWx5c2lzL2FyY2hpdmUvR1pJUEFuYWx5emVyLmphdmEJU3VuIEZlYiAxMiAwNDozNzoz
NiAyMDEyICswMTAwCisrKyBiL3NyYy9vcmcvb3BlbnNvbGFyaXMvb3Blbmdyb2svYW5hbHlzaXMv
YXJjaGl2ZS9HWklQQW5hbHl6ZXIuamF2YQlNb24gRmViIDEzIDA2OjEyOjQ3IDIwMTIgKzAxMDAK
QEAgLTI3LDE1ICsyNywxNCBAQAogaW1wb3J0IGphdmEuaW8uSW5wdXRTdHJlYW07CiBpbXBvcnQg
amF2YS5pby5SZWFkZXI7CiBpbXBvcnQgamF2YS5pby5Xcml0ZXI7Ci1pbXBvcnQgamF2YS51dGls
LmxvZ2dpbmcuTGV2ZWw7CitpbXBvcnQgamF2YS51dGlsLmxvZ2dpbmcuTG9nZ2VyOwogaW1wb3J0
IGphdmEudXRpbC56aXAuR1pJUElucHV0U3RyZWFtOworCiBpbXBvcnQgb3JnLmFwYWNoZS5sdWNl
bmUuYW5hbHlzaXMuVG9rZW5TdHJlYW07CiBpbXBvcnQgb3JnLmFwYWNoZS5sdWNlbmUuZG9jdW1l
bnQuRG9jdW1lbnQ7CiBpbXBvcnQgb3JnLmFwYWNoZS5sdWNlbmUuZG9jdW1lbnQuRmllbGQ7Ci1p
bXBvcnQgb3JnLm9wZW5zb2xhcmlzLm9wZW5ncm9rLk9wZW5Hcm9rTG9nZ2VyOwogaW1wb3J0IG9y
Zy5vcGVuc29sYXJpcy5vcGVuZ3Jvay5hbmFseXNpcy5BbmFseXplckd1cnU7CiBpbXBvcnQgb3Jn
Lm9wZW5zb2xhcmlzLm9wZW5ncm9rLmFuYWx5c2lzLkZpbGVBbmFseXplcjsKLWltcG9ydCBvcmcu
b3BlbnNvbGFyaXMub3Blbmdyb2suYW5hbHlzaXMuRmlsZUFuYWx5emVyLkdlbnJlOwogaW1wb3J0
IG9yZy5vcGVuc29sYXJpcy5vcGVuZ3Jvay5hbmFseXNpcy5GaWxlQW5hbHl6ZXJGYWN0b3J5Owog
CiAvKioKQEAgLTQ1LDYgKzQ0LDcgQEAKICAqIEBhdXRob3IgQ2hhbmRhbgogICovCiBwdWJsaWMg
Y2xhc3MgR1pJUEFuYWx5emVyIGV4dGVuZHMgRmlsZUFuYWx5emVyIHsKKyAgICBwcml2YXRlIHN0
YXRpYyBmaW5hbCBMb2dnZXIgbG9nZ2VyID0gTG9nZ2VyLmdldExvZ2dlcihHWklQQW5hbHl6ZXIu
Y2xhc3MuZ2V0TmFtZSgpKTsKICAgICBwcml2YXRlIEdlbnJlIGc7CiAgICAgQE92ZXJyaWRlCiAg
ICAgcHVibGljIEdlbnJlIGdldEdlbnJlKCkgewpAQCAtNzEsNyArNzEsNyBAQAogICAgICAgICAg
ICAgZmEgPSBBbmFseXplckd1cnUuZ2V0QW5hbHl6ZXIoZ3ppcywgbmV3bmFtZSk7CiAgICAgICAg
ICAgICBpZiAoZmEgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgIHRoaXMuZyA9IEdlbnJlLkRB
VEE7Ci0gICAgICAgICAgICAgICAgT3Blbkdyb2tMb2dnZXIuZ2V0TG9nZ2VyKCkubG9nKExldmVs
LldBUk5JTkcsICJEaWQgbm90IGFuYWx5emUgezB9LCBkZXRlY3RlZCBhcyBkYXRhLiIsIG5ld25h
bWUpOworICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKCJEaWQgbm90IGFuYWx5emUgJyIg
KyBuZXduYW1lICsiJywgZGV0ZWN0ZWQgYXMgZGF0YS4iKTsKICAgICAgICAgICAgIH0gZWxzZSB7
IC8vIGNhbnQgcmVjdXJzZSEKICAgICAgICAgICAgICAgICBpZiAoZmEuZ2V0R2VucmUoKSA9PSBH
ZW5yZS5QTEFJTiB8fCBmYS5nZXRHZW5yZSgpID09IEdlbnJlLlhSRUZBQkxFKSB7CiAgICAgICAg
ICAgICAgICAgICAgIHRoaXMuZyA9IEdlbnJlLlhSRUZBQkxFOwpkaWZmIC1yIDYxNTQ5MDI2YWFm
ZSAtciAyNjExMTY1MDdjN2Egc3JjL29yZy9vcGVuc29sYXJpcy9vcGVuZ3Jvay9hbmFseXNpcy9w
bGFpbi9QbGFpbkFuYWx5emVyRmFjdG9yeS5qYXZhCi0tLSBhL3NyYy9vcmcvb3BlbnNvbGFyaXMv
b3Blbmdyb2svYW5hbHlzaXMvcGxhaW4vUGxhaW5BbmFseXplckZhY3RvcnkuamF2YQlTdW4gRmVi
IDEyIDA0OjM3OjM2IDIwMTIgKzAxMDAKKysrIGIvc3JjL29yZy9vcGVuc29sYXJpcy9vcGVuZ3Jv
ay9hbmFseXNpcy9wbGFpbi9QbGFpbkFuYWx5emVyRmFjdG9yeS5qYXZhCU1vbiBGZWIgMTMgMDY6
MTI6NDcgMjAxMiArMDEwMApAQCAtMzgsMTMgKzM4LDEwIEBACiBwdWJsaWMgZmluYWwgY2xhc3Mg
UGxhaW5BbmFseXplckZhY3RvcnkgZXh0ZW5kcyBGaWxlQW5hbHl6ZXJGYWN0b3J5IHsKIAogICAg
IHByaXZhdGUgc3RhdGljIGZpbmFsIE1hdGNoZXIgTUFUQ0hFUiA9IG5ldyBNYXRjaGVyKCkgewor
ICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgICBwdWJsaWMgRmlsZUFuYWx5emVyRmFj
dG9yeSBpc01hZ2ljKGJ5dGVbXSBjb250ZW50LCBJbnB1dFN0cmVhbSBpbikKICAgICAgICAgICAg
ICAgICAgICAgdGhyb3dzIElPRXhjZXB0aW9uIHsKLSAgICAgICAgICAgICAgICBpZiAoaXNQbGFp
blRleHQoY29udGVudCkpIHsKLSAgICAgICAgICAgICAgICAgICAgcmV0dXJuIERFRkFVTFRfSU5T
VEFOQ0U7Ci0gICAgICAgICAgICAgICAgfSBlbHNlIHsKLSAgICAgICAgICAgICAgICAgICAgcmV0
dXJuIG51bGw7Ci0gICAgICAgICAgICAgICAgfQorICAgICAgICAgICAgICAgIHJldHVybiBpc1Bs
YWluVGV4dChjb250ZW50KSA/IERFRkFVTFRfSU5TVEFOQ0UgOiBudWxsOwogICAgICAgICAgICAg
fQogCiAgICAgICAgICAgICAvKioKQEAgLTc1LDExICs3MiwxMCBAQAogICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIChiID09IDEzKSkgeyAgICAgICAgLy8gY2FycmlhZ2UgcmV0dXJuCiAgICAg
ICAgICAgICAgICAgICAgICAgICAvLyBpcyBwbGFpbiB0ZXh0IHNvIGZhciwgZ28gdG8gbmV4dCBi
eXRlCiAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKLSAgICAgICAgICAgICAgICAg
ICAgfSBlbHNlIHsKLSAgICAgICAgICAgICAgICAgICAgICAgIC8vIDgtYml0IHZhbHVlcyBvciB1
bnByaW50YWJsZSBjb250cm9sIGNoYXJhY3RlcnMsCi0gICAgICAgICAgICAgICAgICAgICAgICAv
LyBwcm9iYWJseSBub3QgcGxhaW4gdGV4dAotICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJu
IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICB9CisgICAgICAgICAgICAgICAgICAgIC8vIDgt
Yml0IHZhbHVlcyBvciB1bnByaW50YWJsZSBjb250cm9sIGNoYXJhY3RlcnMsCisgICAgICAgICAg
ICAgICAgICAgIC8vIHByb2JhYmx5IG5vdCBwbGFpbiB0ZXh0CisgICAgICAgICAgICAgICAgICAg
IHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgcmV0dXJu
IHRydWU7CiAgICAgICAgICAgICB9CmRpZmYgLXIgNjE1NDkwMjZhYWZlIC1yIDI2MTExNjUwN2M3
YSBzcmMvb3JnL29wZW5zb2xhcmlzL29wZW5ncm9rL2NvbmZpZ3VyYXRpb24vQ29uZmlndXJhdGlv
bi5qYXZhCi0tLSBhL3NyYy9vcmcvb3BlbnNvbGFyaXMvb3Blbmdyb2svY29uZmlndXJhdGlvbi9D
b25maWd1cmF0aW9uLmphdmEJU3VuIEZlYiAxMiAwNDozNzozNiAyMDEyICswMTAwCisrKyBiL3Ny
Yy9vcmcvb3BlbnNvbGFyaXMvb3Blbmdyb2svY29uZmlndXJhdGlvbi9Db25maWd1cmF0aW9uLmph
dmEJTW9uIEZlYiAxMyAwNjoxMjo0NyAyMDEyICswMTAwCkBAIC01OCw2ICs1OCwxMiBAQAogICog
cGFja2FnZSBzY29wZSwgYnV0IHRoYXQgZGlkbid0IHdvcmsgd2l0aCB0aGUgWE1MRGVjb2Rlci9Y
TUxFbmNvZGVyLgogICovCiBwdWJsaWMgZmluYWwgY2xhc3MgQ29uZmlndXJhdGlvbiB7CisgICAg
LyoqIFRoZSBwcm9wZXJ0eSBuYW1lIHVzZWQgdG8gb2J0YWluIHRoZSBjdGFncyBjb21tYW5kIHRv
IHVzZS4gKi8KKyAgICBwdWJsaWMgc3RhdGljIGZpbmFsIFN0cmluZyBDVEFHU19DTURfUFJPUEVS
VFlfS0VZID0gCisgICAgICAgICJvcmcub3BlbnNvbGFyaXMub3Blbmdyb2suYW5hbHlzaXMuQ3Rh
Z3MiOworICAgIC8qKiBUaGUgY29tbWFuZCB0byB1c2UgaWYgbm8gY3RhZ3MgY29tbWFuZCB3YXMg
Z2l2ZW4gZXhwbGljaXRseSAqLworICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgU3RyaW5nIENUQUdT
X0NNRF9GQUxMQkFDSyA9ICJjdGFncyI7CisKICAgICBwcml2YXRlIFN0cmluZyBjdGFnczsKIAog
ICAgIC8qKiBTaG91bGQgdGhlIGhpc3RvcnkgbG9nIGJlIGNhY2hlZD8gKi8KQEAgLTE1MCw3ICsx
NTYsNyBAQAogICAgICAgICBzZXRSZXBvc2l0b3JpZXMobmV3IEFycmF5TGlzdDxSZXBvc2l0b3J5
SW5mbz4oKSk7CiAgICAgICAgIHNldFVybFByZWZpeCgiL3NvdXJjZS9zPyIpOwogICAgICAgICAv
L3NldFVybFByZWZpeCgiLi4vcz8iKTsgLy8gVE9ETyBnZW5lcmF0ZSByZWxhdGl2ZSBzZWFyY2gg
cGF0aHMsIGdldCByaWQgb2YgLXcgPHdlYmFwcD4gb3B0aW9uIHRvIGluZGV4ZXIgIQotICAgICAg
ICBzZXRDdGFncyhTeXN0ZW0uZ2V0UHJvcGVydHkoIm9yZy5vcGVuc29sYXJpcy5vcGVuZ3Jvay5h
bmFseXNpcy5DdGFncyIsICJjdGFncyIpKTsKKyAgICAgICAgc2V0Q3RhZ3MoU3lzdGVtLmdldFBy
b3BlcnR5KENUQUdTX0NNRF9QUk9QRVJUWV9LRVksIENUQUdTX0NNRF9GQUxMQkFDSykpOwogICAg
ICAgICAvL2JlbG93IGNhbiBjYXVzZSBhbiBvdXRvZm1lbW9yeSBlcnJvciwgc2luY2UgaXQgaXMg
ZGVmYXVsdGluZyB0byBOTyBMSU1JVAogICAgICAgICBzZXRJbmRleFdvcmRMaW1pdChJbnRlZ2Vy
Lk1BWF9WQUxVRSk7CiAgICAgICAgIHNldFZlcmJvc2UoZmFsc2UpOwpAQCAtNTQwLDcgKzU0Niw4
IEBACiAgICAgICAgIH0gY2F0Y2ggKGphdmEuaW8uRmlsZU5vdEZvdW5kRXhjZXB0aW9uIGUpIHsK
ICAgICAgICAgICAgIC8qIHNob3VsZCB1c3VhbGx5IG5vdCBoYXBwZW4gKi8KICAgICAgICAgfSBj
YXRjaCAoamF2YS5pby5JT0V4Y2VwdGlvbiBlKSB7Ci0gICAgICAgICAgICBsb2dnZXIud2Fybmlu
ZygiZmFpbGVkIHRvIHJlYWQgaGVhZGVyIGluY2x1ZGUgZmlsZTogIiArIGUuZ2V0TWVzc2FnZSgp
KTsKKyAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKCJmYWlsZWQgdG8gcmVhZCBpbmNsdWRlIGZp
bGUgJyIgKyBmaWxlLmdldE5hbWUoKSAKKyAgICAgICAgICAgICAgICArICInOiAiICsgZS5nZXRN
ZXNzYWdlKCkpOwogICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAJaWYgKGlucHV0ICE9IG51
bGwpIHsKIAkgICAgICAgICAgICB0cnkgeyBpbnB1dC5jbG9zZSgpOyB9IApkaWZmIC1yIDYxNTQ5
MDI2YWFmZSAtciAyNjExMTY1MDdjN2Egc3JjL29yZy9vcGVuc29sYXJpcy9vcGVuZ3Jvay9jb25m
aWd1cmF0aW9uL1Byb2plY3QuamF2YQotLS0gYS9zcmMvb3JnL29wZW5zb2xhcmlzL29wZW5ncm9r
L2NvbmZpZ3VyYXRpb24vUHJvamVjdC5qYXZhCVN1biBGZWIgMTIgMDQ6Mzc6MzYgMjAxMiArMDEw
MAorKysgYi9zcmMvb3JnL29wZW5zb2xhcmlzL29wZW5ncm9rL2NvbmZpZ3VyYXRpb24vUHJvamVj
dC5qYXZhCU1vbiBGZWIgMTMgMDY6MTI6NDcgMjAxMiArMDEwMApAQCAtNzgsNyArNzgsOCBAQAog
ICAgIH0KIAogICAgIC8qKgotICAgICAqIFNldCBhIHRleHR1YWwgZGVzY3JpcHRpb24gb2YgdGhp
cyBwcm9qZWN0LCBwcmVmZmVyYWJseSBkb24ndCB1c2UgIiAsICIgaW4gdGhlIG5hbWUsIHNpbmNl
IGl0J3MgdXNlZCBhcyBkZWxpbWl0ZXIgZm9yIG1vcmUgcHJvamVjdHMKKyAgICAgKiBTZXQgYSB0
ZXh0dWFsIGRlc2NyaXB0aW9uIG9mIHRoaXMgcHJvamVjdCwgcHJlZmZlcmFibHkgZG9uJ3QgdXNl
ICIgLCAiIAorICAgICAqIGluIHRoZSBuYW1lLCBzaW5jZSBpdCdzIHVzZWQgYXMgZGVsaW1pdGVy
IGZvciBtb3JlIHByb2plY3RzCiAgICAgICogQHBhcmFtIGRlc2NyaXB0aW9uIGEgdGV4dHVhbCBk
ZXNjcmlwdGlvbiBvZiB0aGUgcHJvamVjdAogICAgICAqLwogICAgIHB1YmxpYyB2b2lkIHNldERl
c2NyaXB0aW9uKFN0cmluZyBkZXNjcmlwdGlvbikgewpAQCAtODcsNyArODgsOCBAQAogCiAgICAg
LyoqCiAgICAgICogU2V0IHRoZSBwYXRoIChyZWxhdGl2ZSBmcm9tIHNvdXJjZSByb290KSB0aGlz
IHByb2plY3QgaXMgbG9jYXRlZAotICAgICAqIEl0IHNlZW1zIHRoYXQgeW91IHNob3VsZCBBTFdB
WVMgcHJlZml4IHRoZSBwYXRoIHdpdGggY3VycmVudCBmaWxlLnNlcGFyYXRvciAsIGN1cnJlbnQg
ZW52aXJvbm1lbnQgc2hvdWxkIGFsd2F5cyBoYXZlIGl0IHNldCB1cAorICAgICAqIEl0IHNlZW1z
IHRoYXQgeW91IHNob3VsZCBBTFdBWVMgcHJlZml4IHRoZSBwYXRoIHdpdGggY3VycmVudCAKKyAg
ICAgKiBmaWxlLnNlcGFyYXRvciAsIGN1cnJlbnQgZW52aXJvbm1lbnQgc2hvdWxkIGFsd2F5cyBo
YXZlIGl0IHNldCB1cAogICAgICAqIEBwYXJhbSBwYXRoIHRoZSByZWxhdGl2ZSBwYXRoIGZyb20g
c291cmNlIHNyb290IHdoZXJlIHRoaXMgcHJvamVjdCBpcwogICAgICAqICAgICAgICAgICAgIGxv
Y2F0ZWQuCiAgICAgICovCmRpZmYgLXIgNjE1NDkwMjZhYWZlIC1yIDI2MTExNjUwN2M3YSBzcmMv
b3JnL29wZW5zb2xhcmlzL29wZW5ncm9rL2NvbmZpZ3VyYXRpb24vUnVudGltZUVudmlyb25tZW50
LmphdmEKLS0tIGEvc3JjL29yZy9vcGVuc29sYXJpcy9vcGVuZ3Jvay9jb25maWd1cmF0aW9uL1J1
bnRpbWVFbnZpcm9ubWVudC5qYXZhCVN1biBGZWIgMTIgMDQ6Mzc6MzYgMjAxMiArMDEwMAorKysg
Yi9zcmMvb3JnL29wZW5zb2xhcmlzL29wZW5ncm9rL2NvbmZpZ3VyYXRpb24vUnVudGltZUVudmly
b25tZW50LmphdmEJTW9uIEZlYiAxMyAwNjoxMjo0NyAyMDEyICswMTAwCkBAIC00MSw3ICs0MSw2
IEBACiBpbXBvcnQgamF2YS51dGlsLmxvZ2dpbmcuTGV2ZWw7CiBpbXBvcnQgamF2YS51dGlsLmxv
Z2dpbmcuTG9nZ2VyOwogCi1pbXBvcnQgb3JnLm9wZW5zb2xhcmlzLm9wZW5ncm9rLk9wZW5Hcm9r
TG9nZ2VyOwogaW1wb3J0IG9yZy5vcGVuc29sYXJpcy5vcGVuZ3Jvay5oaXN0b3J5Lkhpc3RvcnlH
dXJ1OwogaW1wb3J0IG9yZy5vcGVuc29sYXJpcy5vcGVuZ3Jvay5oaXN0b3J5LlJlcG9zaXRvcnlJ
bmZvOwogaW1wb3J0IG9yZy5vcGVuc29sYXJpcy5vcGVuZ3Jvay5pbmRleC5GaWx0ZXI7CkBAIC05
MCw3ICs4OSw5IEBACiAgICAgICAgICAgICB9CiAgICAgICAgICAgICByZXR1cm4gZmlsZS5nZXRD
YW5vbmljYWxQYXRoKCk7CiAgICAgICAgIH0gY2F0Y2ggKElPRXhjZXB0aW9uIGV4KSB7Ci0gICAg
ICAgICAgICBPcGVuR3Jva0xvZ2dlci5nZXRMb2dnZXIoKS5sb2coTGV2ZWwuU0VWRVJFLCAiRmFp
bGVkIHRvIGdldCBjYW5vbmljYWwgcGF0aCIsIGV4KTsKKyAgICAgICAgICAgIGxvZy53YXJuaW5n
KCJGYWlsZWQgdG8gZ2V0IGNhbm9uaWNhbCBwYXRoIGZvciAnIiArIHMgKyAiJzogIiAKKyAgICAg
ICAgICAgICAgICArIGV4LmdldE1lc3NhZ2UoKSk7CisgICAgICAgICAgICBsb2cubG9nKExldmVs
LkZJTkUsICJnZXRDYW5vbmljYWxQYXRoIiwgZXgpOwogICAgICAgICAgICAgcmV0dXJuIHM7CiAg
ICAgICAgIH0KICAgICB9CkBAIC0xODUsNyArMTg2LDggQEAKICAgICAgICAgICAgICAgICByZXR1
cm4gY2Fub25pY2FsUGF0aC5zdWJzdHJpbmcoYWxsb3dlZFRhcmdldC5sZW5ndGgoKSArIHN0cmlw
Q291bnQpOwogICAgICAgICAgICAgfQogICAgICAgICB9Ci0gICAgICAgIHRocm93IG5ldyBGaWxl
Tm90Rm91bmRFeGNlcHRpb24oIkZhaWxlZCB0byByZXNvbHZlIFsiK2Nhbm9uaWNhbFBhdGgrIl0g
cmVsYXRpdmUgdG8gc291cmNlIHJvb3QgWyIrc291cmNlUm9vdCsiXSIpOworICAgICAgICB0aHJv
dyBuZXcgRmlsZU5vdEZvdW5kRXhjZXB0aW9uKCJGYWlsZWQgdG8gcmVzb2x2ZSAnIiArIGNhbm9u
aWNhbFBhdGggCisgICAgICAgICAgICArICInIHJlbGF0aXZlIHRvIHNvdXJjZSByb290ICciICsg
c291cmNlUm9vdCArICInIik7CiAgICAgfQogCiAgICAgLyoqCkBAIC0yODMsMTAgKzI4NSwxMSBA
QAogICAgICAgICBleGVjdXRvci5leGVjKGZhbHNlKTsKICAgICAgICAgU3RyaW5nIG91dHB1dCA9
IGV4ZWN1dG9yLmdldE91dHB1dFN0cmluZygpOwogICAgICAgICBpZiAob3V0cHV0ID09IG51bGwg
fHwgb3V0cHV0LmluZGV4T2YoIkV4dWJlcmFudCBDdGFncyIpID09IC0xKSB7Ci0gICAgICAgICAg
ICBsb2cubG9nKExldmVsLlNFVkVSRSwiRXJyb3I6IE5vIEV4dWJlcmFudCBDdGFncyBmb3VuZCBp
biBQQVRIIVxuIiArCi0gICAgICAgICAgICAgICAgICAgICIodHJpZWQgcnVubmluZyAiICsgInsw
fSIgKyAiKVxuIiArCi0gICAgICAgICAgICAgICAgICAgICJQbGVhc2UgdXNlIG9wdGlvbiAtYyB0
byBzcGVjaWZ5IHBhdGggdG8gYSBnb29kIEV4dWJlcmFudCBDdGFncyBwcm9ncmFtXG4iKwotICAg
ICAgICAgICAgICAgICAgICAiT3Igc2V0IGl0IGluIGphdmEgcHJvcGVydHkgb3JnLm9wZW5zb2xh
cmlzLm9wZW5ncm9rLmFuYWx5c2lzLkN0YWdzIiwgZ2V0Q3RhZ3MoKSk7CisgICAgICAgICAgICBs
b2cud2FybmluZygiTm8gRXh1YmVyYW50IEN0YWdzIGZvdW5kIGluIFBBVEghXG4iICsKKyAgICAg
ICAgICAgICAgICAiKHRyaWVkIHJ1bm5pbmcgJyIgKyBnZXRDdGFncygpICsgIicpXG4iICsKKyAg
ICAgICAgICAgICAgICAiUGxlYXNlIHVzZSBvcHRpb24gLWMgdG8gc3BlY2lmeSBwYXRoIHRvIGEg
Z29vZCBFeHViZXJhbnQgQ3RhZ3MgcHJvZ3JhbVxuIisKKyAgICAgICAgICAgICAgICAiT3Igc2V0
IGl0IGluIGphdmEgc3lzdGVtIHByb3BlcnR5ICIgCisgICAgICAgICAgICAgICAgKyBDb25maWd1
cmF0aW9uLkNUQUdTX0NNRF9QUk9QRVJUWV9LRVkpOwogICAgICAgICAgICAgcmV0ID0gIGZhbHNl
OwogICAgICAgICB9CiAKQEAgLTgwOSw3ICs4MTIsNyBAQAogICAgICAgICAgICAgICAgICAgICAg
ICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzID0gc29jay5hY2NlcHQoKTsK
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICBib3MucmVzZXQoKTsKLSAgICAgICAgICAgICAg
ICAgICAgICAgICAgICBsb2cubG9nKExldmVsLkZJTkUsICJPcGVuR3JvazogR290IHJlcXVlc3Qg
ZnJvbSB7MH0iLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZy5pbmZvKCJSZS1jb25m
aWd1cmUgcmVxdWVzdCBmcm9tICIgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBz
LmdldEluZXRBZGRyZXNzKCkuZ2V0SG9zdEFkZHJlc3MoKSk7CiAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgaW4gPSBuZXcgQnVmZmVyZWRJbnB1dFN0cmVhbShzLmdldElucHV0U3RyZWFtKCkp
OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJ5dGVbXSBidWYgPSBuZXcgYnl0ZVsxMDI0
XTsKQEAgLTgxOSw3ICs4MjIsNyBAQAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICBidWYgPSBib3MudG9CeXRlQXJyYXkoKTsKICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICBpZiAobG9nLmlzTG9nZ2FibGUoTGV2ZWwuRklORSkpIHsK
LSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nLmxvZyhMZXZlbC5GSU5FLCAibmV3
IGNvbmZpZzoiICsgbmV3IFN0cmluZyhidWYpKTsKKyAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgbG9nLmZpbmUoIk5ldyBjb25maWc6IFxuIiArIG5ldyBTdHJpbmcoYnVmKSk7CiAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgIFhN
TERlY29kZXIgZCA9IG5ldyBYTUxEZWNvZGVyKG5ldyBCeXRlQXJyYXlJbnB1dFN0cmVhbShidWYp
KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICBPYmplY3Qgb2JqID0gZC5yZWFkT2JqZWN0
KCk7CkBAIC04MzAsOSArODMzLDExIEBACiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IGxvZy5sb2coTGV2ZWwuSU5GTywgIkNvbmZpZ3VyYXRpb24gdXBkYXRlZDogezB9IiwgY29uZmln
dXJhdGlvbi5nZXRTb3VyY2VSb290KCkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0K
ICAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKElPRXhjZXB0aW9uIGUpIHsKLSAgICAg
ICAgICAgICAgICAgICAgICAgICAgICBsb2cubG9nKExldmVsLlNFVkVSRSwgIkVycm9yIHJlYWRp
bmcgY29uZmlnIGZpbGU6ICIsZSk7CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nLndh
cm5pbmcoIkVycm9yIHJlYWRpbmcgY29uZmlnIGZpbGU6ICIgKyBlLmdldE1lc3NhZ2UoKSk7Cisg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nLmxvZyhMZXZlbC5GSU5FLCAicnVuIiwgZSk7
CiAgICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIGUpIHsK
LSAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2cubG9nKExldmVsLlNFVkVSRSwgIkVycm9y
IHBhcnNpbmcgY29uZmlnIGZpbGU6ICIsIGUpOworICAgICAgICAgICAgICAgICAgICAgICAgICAg
IGxvZy53YXJuaW5nKCJFcnJvciBwYXJzaW5nIGNvbmZpZyBmaWxlOiAiICsgZS5nZXRNZXNzYWdl
KCkpOworICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZy5sb2coTGV2ZWwuRklORSwgInJ1
biIsIGUpOwogICAgICAgICAgICAgICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICBJT1V0aWxzLmNsb3NlKHMpOwogICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIElPVXRpbHMuY2xvc2UoaW4pOwpAQCAtODQyLDkgKzg0Nyw5IEBACiAgICAgICAgICAg
ICB9KTsKICAgICAgICAgICAgIHQuc3RhcnQoKTsKICAgICAgICAgfSBjYXRjaCAoVW5rbm93bkhv
c3RFeGNlcHRpb24gZXgpIHsKLSAgICAgICAgICAgIGxvZy5sb2coTGV2ZWwuRklORSwiUHJvYmxl
bSByZXNvbHZpbmcgc2VuZGVyOiAiLGV4KTsKLSAgICAgICAgfSBjYXRjaCAoSU9FeGNlcHRpb24g
ZXgpIHsKLSAgICAgICAgICAgIGxvZy5sb2coTGV2ZWwuRklORSwiSS9PIGVycm9yIHdoZW4gd2Fp
dGluZyBmb3IgY29uZmlnOiAiLGV4KTsKKyAgICAgICAgICAgIGxvZy5sb2coTGV2ZWwuRklORSwi
UHJvYmxlbSByZXNvbHZpbmcgc2VuZGVyIiwgZXgpOworICAgICAgICB9IGNhdGNoIChJT0V4Y2Vw
dGlvbiBleCkgeyAKKyAgICAgICAgICAgIGxvZy5sb2coTGV2ZWwuRklORSwiSS9PIGVycm9yIHdo
ZW4gd2FpdGluZyBmb3IgY29uZmlnIiwgZXgpOwogICAgICAgICB9CiAKICAgICAgICAgaWYgKCFy
ZXQgJiYgY29uZmlnU2VydmVyU29ja2V0ICE9IG51bGwpIHsKZGlmZiAtciA2MTU0OTAyNmFhZmUg
LXIgMjYxMTE2NTA3YzdhIHNyYy9vcmcvb3BlbnNvbGFyaXMvb3Blbmdyb2svaGlzdG9yeS9CYXph
YXJIaXN0b3J5UGFyc2VyLmphdmEKLS0tIGEvc3JjL29yZy9vcGVuc29sYXJpcy9vcGVuZ3Jvay9o
aXN0b3J5L0JhemFhckhpc3RvcnlQYXJzZXIuamF2YQlTdW4gRmViIDEyIDA0OjM3OjM2IDIwMTIg
KzAxMDAKKysrIGIvc3JjL29yZy9vcGVuc29sYXJpcy9vcGVuZ3Jvay9oaXN0b3J5L0JhemFhckhp
c3RvcnlQYXJzZXIuamF2YQlNb24gRmViIDEzIDA2OjEyOjQ3IDIwMTIgKzAxMDAKQEAgLTM0LDcg
KzM0LDggQEAKIGltcG9ydCBqYXZhLnV0aWwuRGF0ZTsKIGltcG9ydCBqYXZhLnV0aWwuTGlzdDsK
IGltcG9ydCBqYXZhLnV0aWwubG9nZ2luZy5MZXZlbDsKLWltcG9ydCBvcmcub3BlbnNvbGFyaXMu
b3Blbmdyb2suT3Blbkdyb2tMb2dnZXI7CitpbXBvcnQgamF2YS51dGlsLmxvZ2dpbmcuTG9nZ2Vy
OworCiBpbXBvcnQgb3JnLm9wZW5zb2xhcmlzLm9wZW5ncm9rLmNvbmZpZ3VyYXRpb24uUnVudGlt
ZUVudmlyb25tZW50OwogaW1wb3J0IG9yZy5vcGVuc29sYXJpcy5vcGVuZ3Jvay51dGlsLkV4ZWN1
dG9yOwogCkBAIC00Miw3ICs0Myw3IEBACiAgKiBQYXJzZSBhIHN0cmVhbSBvZiBCYXphYXIgbG9n
IGNvbW1lbnRzLgogICovCiBjbGFzcyBCYXphYXJIaXN0b3J5UGFyc2VyIGltcGxlbWVudHMgRXhl
Y3V0b3IuU3RyZWFtSGFuZGxlciB7Ci0KKyAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBMb2dnZXIg
bG9nZ2VyID0gTG9nZ2VyLmdldExvZ2dlcihCYXphYXJIaXN0b3J5UGFyc2VyLmNsYXNzLmdldE5h
bWUoKSk7CiAgICAgcHJpdmF0ZSBTdHJpbmcgbXlEaXI7CiAgICAgcHJpdmF0ZSBMaXN0PEhpc3Rv
cnlFbnRyeT4gZW50cmllcyA9IG5ldyBBcnJheUxpc3Q8SGlzdG9yeUVudHJ5PigpOyAvL05PUE1E
CiAgICAgcHJpdmF0ZSBCYXphYXJSZXBvc2l0b3J5IHJlcG9zaXRvcnk9bmV3IEJhemFhclJlcG9z
aXRvcnkoKTsgLy9OT1BNRApAQCAtNTgsMTIgKzU5LDEyIEBACiAgICAgICAgICAgICBpbnQgc3Rh
dHVzID0gZXhlY3V0b3IuZXhlYyh0cnVlLCB0aGlzKTsKIAogICAgICAgICAgICAgaWYgKHN0YXR1
cyAhPSAwKSB7Ci0gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEhpc3RvcnlFeGNlcHRpb24oIkZh
aWxlZCB0byBnZXQgaGlzdG9yeSBmb3I6IFwiIiArCi0gICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgZmlsZS5nZXRBYnNvbHV0ZVBhdGgoKSArICJcIiBFeGl0IGNvZGU6
ICIgKyBzdGF0dXMpOworICAgICAgICAgICAgICAgIHRocm93IG5ldyBIaXN0b3J5RXhjZXB0aW9u
KCJGYWlsZWQgdG8gZ2V0IGhpc3RvcnkgZm9yICciICsKKyAgICAgICAgICAgICAgICAgICAgZmls
ZS5nZXRBYnNvbHV0ZVBhdGgoKSArICInIC0gRXhpdCBjb2RlICIgKyBzdGF0dXMpOwogICAgICAg
ICAgICAgfQogICAgICAgICB9IGNhdGNoIChJT0V4Y2VwdGlvbiBlKSB7Ci0gICAgICAgICAgICB0
aHJvdyBuZXcgSGlzdG9yeUV4Y2VwdGlvbigiRmFpbGVkIHRvIGdldCBoaXN0b3J5IGZvcjogXCIi
ICsKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGUuZ2V0QWJzb2x1
dGVQYXRoKCkgKyAiXCIiLCBlKTsKKyAgICAgICAgICAgIHRocm93IG5ldyBIaXN0b3J5RXhjZXB0
aW9uKCJGYWlsZWQgdG8gZ2V0IGhpc3RvcnkgZm9yICciICsKKyAgICAgICAgICAgICAgICBmaWxl
LmdldEFic29sdXRlUGF0aCgpICsgIiciLCBlKTsKICAgICAgICAgfQogCiAgICAgICAgIC8vIElm
IGEgY2hhbmdlc2V0IHRvIHN0YXJ0IGZyb20gaXMgc3BlY2lmaWVkLCByZW1vdmUgdGhhdCBjaGFu
Z2VzZXQKQEAgLTEyOCw4ICsxMjksOSBAQAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIERh
dGUgZGF0ZSA9IGRmLnBhcnNlKHMuc3Vic3RyaW5nKCJ0aW1lc3RhbXA6Ii5sZW5ndGgoKSkudHJp
bSgpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbnRyeS5zZXREYXRlKGRhdGUpOwog
ICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoUGFyc2VFeGNlcHRpb24gZSkgewotICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIE9wZW5Hcm9rTG9nZ2VyLmdldExvZ2dlcigpLmxvZyhM
ZXZlbC5XQVJOSU5HLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIkZhaWxl
ZCB0byBwYXJzZSBoaXN0b3J5IHRpbWVzdGFtcDoiICsgcywgZSk7CisgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoIkZhaWxlZCB0byBwYXJzZSBoaXN0b3J5IHRpbWVz
dGFtcCAiIAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICArIHMgKyAiOiAiICsgZS5n
ZXRNZXNzYWdlKCkpOworICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5sb2coTGV2
ZWwuRklORSwgInByb2Nlc3NTdHJlYW0iLCBlKTsKICAgICAgICAgICAgICAgICAgICAgICAgIH0K
ICAgICAgICAgICAgICAgICAgICAgICAgICsrc3RhdGU7CiAgICAgICAgICAgICAgICAgICAgIH0K
QEAgLTE2NSw3ICsxNjcsNyBAQAogICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg
ICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgIGRlZmF1bHQ6Ci0gICAgICAgICAgICAgICAg
ICAgIE9wZW5Hcm9rTG9nZ2VyLmdldExvZ2dlcigpLndhcm5pbmcoIlVua25vd24gcGFyc2VyIHN0
YXRlOiAiICsgc3RhdGUpOworICAgICAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZygiVW5r
bm93biBwYXJzZXIgc3RhdGUgIiArIHN0YXRlKTsKICAgICAgICAgICAgICAgICAgICAgYnJlYWs7
CiAgICAgICAgICAgICAgICAgfQogICAgICAgICB9CmRpZmYgLXIgNjE1NDkwMjZhYWZlIC1yIDI2
MTExNjUwN2M3YSBzcmMvb3JnL29wZW5zb2xhcmlzL29wZW5ncm9rL2hpc3RvcnkvQmF6YWFyUmVw
b3NpdG9yeS5qYXZhCi0tLSBhL3NyYy9vcmcvb3BlbnNvbGFyaXMvb3Blbmdyb2svaGlzdG9yeS9C
YXphYXJSZXBvc2l0b3J5LmphdmEJU3VuIEZlYiAxMiAwNDozNzozNiAyMDEyICswMTAwCisrKyBi
L3NyYy9vcmcvb3BlbnNvbGFyaXMvb3Blbmdyb2svaGlzdG9yeS9CYXphYXJSZXBvc2l0b3J5Lmph
dmEJTW9uIEZlYiAxMyAwNjoxMjo0NyAyMDEyICswMTAwCkBAIC0zMiw5ICszMiwxMCBAQAogaW1w
b3J0IGphdmEudXRpbC5BcnJheUxpc3Q7CiBpbXBvcnQgamF2YS51dGlsLkxpc3Q7CiBpbXBvcnQg
amF2YS51dGlsLmxvZ2dpbmcuTGV2ZWw7CitpbXBvcnQgamF2YS51dGlsLmxvZ2dpbmcuTG9nZ2Vy
OwogaW1wb3J0IGphdmEudXRpbC5yZWdleC5NYXRjaGVyOwogaW1wb3J0IGphdmEudXRpbC5yZWdl
eC5QYXR0ZXJuOwotaW1wb3J0IG9yZy5vcGVuc29sYXJpcy5vcGVuZ3Jvay5PcGVuR3Jva0xvZ2dl
cjsKKwogaW1wb3J0IG9yZy5vcGVuc29sYXJpcy5vcGVuZ3Jvay51dGlsLkV4ZWN1dG9yOwogCiAv
KioKQEAgLTQyLDYgKzQzLDcgQEAKICAqCiAgKi8KIHB1YmxpYyBjbGFzcyBCYXphYXJSZXBvc2l0
b3J5IGV4dGVuZHMgUmVwb3NpdG9yeSB7CisgICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgTG9nZ2Vy
IGxvZ2dlciA9IExvZ2dlci5nZXRMb2dnZXIoQmF6YWFyUmVwb3NpdG9yeS5jbGFzcy5nZXROYW1l
KCkpOwogICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGxvbmcgc2VyaWFsVmVyc2lvblVJRCA9IDFM
OwogICAgIC8qKiBUaGUgcHJvcGVydHkgbmFtZSB1c2VkIHRvIG9idGFpbiB0aGUgY2xpZW50IGNv
bW1hbmQgZm9yIHRoaXNyZXBvc2l0b3J5LiAqLwogICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgU3Ry
aW5nIENNRF9QUk9QRVJUWV9LRVkgPQpAQCAtMTE2LDggKzExOCw5IEBACiAKICAgICAgICAgICAg
IHJldCA9IG5ldyBCeXRlQXJyYXlJbnB1dFN0cmVhbShvdXQudG9CeXRlQXJyYXkoKSk7CiAgICAg
ICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBleHApIHsKLSAgICAgICAgICAgIE9wZW5Hcm9rTG9nZ2Vy
LmdldExvZ2dlcigpLmxvZyhMZXZlbC5TRVZFUkUsCi0gICAgICAgICAgICAgICAgIkZhaWxlZCB0
byBnZXQgaGlzdG9yeTogIiArIGV4cC5nZXRDbGFzcygpLnRvU3RyaW5nKCksIGV4cCk7CisgICAg
ICAgICAgICBsb2dnZXIud2FybmluZygiRmFpbGVkIHRvIGdldCBoaXN0b3J5IGZvciAnIiArIHBh
cmVudCAKKyAgICAgICAgICAgICAgICArIEZpbGUuc2VwYXJhdG9yICsgYmFzZW5hbWUgKyAiJzog
IiArIGV4cC5nZXRNZXNzYWdlKCkpOworICAgICAgICAgICAgbG9nZ2VyLmxvZyhMZXZlbC5GSU5F
LCAiZ2V0SGlzdG9yeUdldCIsIGV4cCk7CiAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAg
ICAvLyBDbGVhbiB1cCB6b21iaWUtcHJvY2Vzc2VzLi4uCiAgICAgICAgICAgICBpZiAocHJvY2Vz
cyAhPSBudWxsKSB7CkBAIC0xNjIsOSArMTY1LDggQEAKICAgICAgICAgaW50IHN0YXR1cyA9IGV4
ZWMuZXhlYygpOwogCiAgICAgICAgIGlmIChzdGF0dXMgIT0gMCkgewotICAgICAgICAgICAgT3Bl
bkdyb2tMb2dnZXIuZ2V0TG9nZ2VyKCkubG9nKExldmVsLldBUk5JTkcsCi0gICAgICAgICAgICAg
ICAgIkZhaWxlZCB0byBnZXQgYW5ub3RhdGlvbnMgZm9yOiBcInswfVwiIEV4aXQgY29kZTogezF9
IiwKLSAgICAgICAgICAgICAgICBuZXcgT2JqZWN0W117ZmlsZS5nZXRBYnNvbHV0ZVBhdGgoKSwg
U3RyaW5nLnZhbHVlT2Yoc3RhdHVzKX0pOworICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoIkZh
aWxlZCB0byBnZXQgYW5ub3RhdGlvbnMgZm9yICciICsgZmlsZS5nZXRBYnNvbHV0ZVBhdGgoKQor
ICAgICAgICAgICAgICAgICsgIicgLSBFeGl0IGNvZGUgIiArIHN0YXR1cyk7CiAgICAgICAgIH0K
IAogICAgICAgICByZXR1cm4gcGFyc2VBbm5vdGF0aW9uKGV4ZWMuZ2V0T3V0cHV0UmVhZGVyKCks
IGZpbGUuZ2V0TmFtZSgpKTsKQEAgLTE4Niw4ICsxODgsOCBAQAogICAgICAgICAgICAgICAgIFN0
cmluZyBhdXRob3IgPSBtYXRjaGVyLmdyb3VwKDIpLnRyaW0oKTsKICAgICAgICAgICAgICAgICBy
ZXQuYWRkTGluZShyZXYsIGF1dGhvciwgdHJ1ZSk7CiAgICAgICAgICAgICB9IGVsc2UgewotICAg
ICAgICAgICAgICAgIE9wZW5Hcm9rTG9nZ2VyLmdldExvZ2dlcigpLmxvZyhMZXZlbC5TRVZFUkUs
Ci0gICAgICAgICAgICAgICAgICAgICJFcnJvcjogZGlkIG5vdCBmaW5kIGFubm90YXRpb24gaW4g
bGluZSB7MH06IFt7MX1dIiwKKyAgICAgICAgICAgICAgICBsb2dnZXIubG9nKExldmVsLldBUk5J
TkcsCisgICAgICAgICAgICAgICAgICAgICJEaWQgbm90IGZpbmQgYW5ub3RhdGlvbiBpbiBsaW5l
IHswfSBbezF9XSIsCiAgICAgICAgICAgICAgICAgICAgIG5ldyBPYmplY3RbXXtTdHJpbmcudmFs
dWVPZihsaW5lbm8pLCBsaW5lfSk7CiAgICAgICAgICAgICB9CiAgICAgICAgIH0KZGlmZiAtciA2
MTU0OTAyNmFhZmUgLXIgMjYxMTE2NTA3YzdhIHNyYy9vcmcvb3BlbnNvbGFyaXMvb3Blbmdyb2sv
aGlzdG9yeS9DVlNIaXN0b3J5UGFyc2VyLmphdmEKLS0tIGEvc3JjL29yZy9vcGVuc29sYXJpcy9v
cGVuZ3Jvay9oaXN0b3J5L0NWU0hpc3RvcnlQYXJzZXIuamF2YQlTdW4gRmViIDEyIDA0OjM3OjM2
IDIwMTIgKzAxMDAKKysrIGIvc3JjL29yZy9vcGVuc29sYXJpcy9vcGVuZ3Jvay9oaXN0b3J5L0NW
U0hpc3RvcnlQYXJzZXIuamF2YQlNb24gRmViIDEzIDA2OjEyOjQ3IDIwMTIgKzAxMDAKQEAgLTMz
LDE0ICszMywxNSBAQAogaW1wb3J0IGphdmEudGV4dC5QYXJzZUV4Y2VwdGlvbjsKIGltcG9ydCBq
YXZhLnV0aWwuQXJyYXlMaXN0OwogaW1wb3J0IGphdmEudXRpbC5sb2dnaW5nLkxldmVsOwotaW1w
b3J0IG9yZy5vcGVuc29sYXJpcy5vcGVuZ3Jvay5PcGVuR3Jva0xvZ2dlcjsKK2ltcG9ydCBqYXZh
LnV0aWwubG9nZ2luZy5Mb2dnZXI7CisKIGltcG9ydCBvcmcub3BlbnNvbGFyaXMub3Blbmdyb2su
dXRpbC5FeGVjdXRvcjsKIAogLyoqCiAgKiBQYXJzZSBhIHN0cmVhbSBvZiBDVlMgbG9nIGNvbW1l
bnRzLgogICovCiBjbGFzcyBDVlNIaXN0b3J5UGFyc2VyIGltcGxlbWVudHMgRXhlY3V0b3IuU3Ry
ZWFtSGFuZGxlciB7Ci0KKyAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBMb2dnZXIgbG9nZ2VyID0g
TG9nZ2VyLmdldExvZ2dlcihDVlNIaXN0b3J5UGFyc2VyLmNsYXNzLmdldE5hbWUoKSk7CiAgICAg
cHJpdmF0ZSBlbnVtIFBhcnNlU3RhdGUgewogICAgICAgICBSRVZJU0lPTiwgTUVUQURBVEEsIENP
TU1FTlQKICAgICB9CkBAIC04OSw3ICs5MCw5IEBACiAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgdmFsID0gdmFsLnJlcGxhY2UoJy8nLCAnLScpOwogICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIGVudHJ5LnNldERhdGUoZGYucGFyc2UodmFsKSk7CiAgICAgICAgICAgICAgICAgICAgICAg
ICB9IGNhdGNoIChQYXJzZUV4Y2VwdGlvbiBwZSkgewotICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIE9wZW5Hcm9rTG9nZ2VyLmdldExvZ2dlcigpLmxvZyhMZXZlbC5XQVJOSU5HLCAiRmFpbGVk
IHRvIHBhcnNlIGRhdGU6ICciICsgdmFsICsgIiciLCBwZSk7CisgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgbG9nZ2VyLndhcm5pbmcoIkZhaWxlZCB0byBwYXJzZSBkYXRlICIgKyB2YWwgCisg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgIjogIiArIHBlLmdldE1lc3NhZ2UoKSk7
CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmxvZyhMZXZlbC5GSU5FLCAicHJv
Y2Vzc1N0cmVhbSIsIHBlKTsKICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg
ICAgICAgICAgfSBlbHNlIGlmICgiYXV0aG9yIi5lcXVhbHMoa2V5KSkgewogICAgICAgICAgICAg
ICAgICAgICAgICAgZW50cnkuc2V0QXV0aG9yKHZhbCk7CkBAIC0xMzIsMTIgKzEzNSwxMiBAQAog
ICAgICAgICAgICAgaW50IHN0YXR1cyA9IGV4ZWN1dG9yLmV4ZWModHJ1ZSwgdGhpcyk7CiAKICAg
ICAgICAgICAgIGlmIChzdGF0dXMgIT0gMCkgewotICAgICAgICAgICAgICAgIHRocm93IG5ldyBI
aXN0b3J5RXhjZXB0aW9uKCJGYWlsZWQgdG8gZ2V0IGhpc3RvcnkgZm9yOiBcIiIgKwotICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGUuZ2V0QWJzb2x1dGVQYXRo
KCkgKyAiXCIgRXhpdCBjb2RlOiAiICsgc3RhdHVzKTsKKyAgICAgICAgICAgICAgICB0aHJvdyBu
ZXcgSGlzdG9yeUV4Y2VwdGlvbigiRmFpbGVkIHRvIGdldCBoaXN0b3J5IGZvciAnIiArCisgICAg
ICAgICAgICAgICAgICAgIGZpbGUuZ2V0QWJzb2x1dGVQYXRoKCkgKyAiJyAtIEV4aXQgY29kZSAi
ICsgc3RhdHVzKTsKICAgICAgICAgICAgIH0KICAgICAgICAgfSBjYXRjaCAoSU9FeGNlcHRpb24g
ZSkgewotICAgICAgICAgICAgdGhyb3cgbmV3IEhpc3RvcnlFeGNlcHRpb24oIkZhaWxlZCB0byBn
ZXQgaGlzdG9yeSBmb3I6IFwiIiArCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICBmaWxlLmdldEFic29sdXRlUGF0aCgpICsgIlwiIiwgZSk7CisgICAgICAgICAgICB0aHJv
dyBuZXcgSGlzdG9yeUV4Y2VwdGlvbigiRmFpbGVkIHRvIGdldCBoaXN0b3J5IGZvciAnIiArCisg
ICAgICAgICAgICAgICAgZmlsZS5nZXRBYnNvbHV0ZVBhdGgoKSArICInIiwgZSk7CiAgICAgICAg
IH0KIAogICAgICAgICByZXR1cm4gaGlzdG9yeTsKZGlmZiAtciA2MTU0OTAyNmFhZmUgLXIgMjYx
MTE2NTA3YzdhIHNyYy9vcmcvb3BlbnNvbGFyaXMvb3Blbmdyb2svaGlzdG9yeS9DVlNSZXBvc2l0
b3J5LmphdmEKLS0tIGEvc3JjL29yZy9vcGVuc29sYXJpcy9vcGVuZ3Jvay9oaXN0b3J5L0NWU1Jl
cG9zaXRvcnkuamF2YQlTdW4gRmViIDEyIDA0OjM3OjM2IDIwMTIgKzAxMDAKKysrIGIvc3JjL29y
Zy9vcGVuc29sYXJpcy9vcGVuZ3Jvay9oaXN0b3J5L0NWU1JlcG9zaXRvcnkuamF2YQlNb24gRmVi
IDEzIDA2OjEyOjQ3IDIwMTIgKzAxMDAKQEAgLTM0LDkgKzM0LDEwIEBACiBpbXBvcnQgamF2YS51
dGlsLkFycmF5TGlzdDsKIGltcG9ydCBqYXZhLnV0aWwuTGlzdDsKIGltcG9ydCBqYXZhLnV0aWwu
bG9nZ2luZy5MZXZlbDsKK2ltcG9ydCBqYXZhLnV0aWwubG9nZ2luZy5Mb2dnZXI7CiBpbXBvcnQg
amF2YS51dGlsLnJlZ2V4Lk1hdGNoZXI7CiBpbXBvcnQgamF2YS51dGlsLnJlZ2V4LlBhdHRlcm47
Ci1pbXBvcnQgb3JnLm9wZW5zb2xhcmlzLm9wZW5ncm9rLk9wZW5Hcm9rTG9nZ2VyOworCiBpbXBv
cnQgb3JnLm9wZW5zb2xhcmlzLm9wZW5ncm9rLnV0aWwuRXhlY3V0b3I7CiBpbXBvcnQgb3JnLm9w
ZW5zb2xhcmlzLm9wZW5ncm9rLnV0aWwuSU9VdGlsczsKIApAQCAtNDQsNiArNDUsNyBAQAogICog
QWNjZXNzIHRvIGEgbG9jYWwgQ1ZTIHJlcG9zaXRvcnkuCiAgKi8KIHB1YmxpYyBjbGFzcyBDVlNS
ZXBvc2l0b3J5IGV4dGVuZHMgUkNTUmVwb3NpdG9yeSB7CisgICAgcHJpdmF0ZSBzdGF0aWMgZmlu
YWwgTG9nZ2VyIGxvZ2dlciA9IExvZ2dlci5nZXRMb2dnZXIoQ1ZTUmVwb3NpdG9yeS5jbGFzcy5n
ZXROYW1lKCkpOwogICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGxvbmcgc2VyaWFsVmVyc2lvblVJ
RCA9IDFMOwogICAgIC8qKiBUaGUgcHJvcGVydHkgbmFtZSB1c2VkIHRvIG9idGFpbiB0aGUgY2xp
ZW50IGNvbW1hbmQgZm9yIHJlcG9zaXRvcnkuICovCiAgICAgcHVibGljIHN0YXRpYyBmaW5hbCBT
dHJpbmcgQ01EX1BST1BFUlRZX0tFWSA9CkBAIC0xMjAsMzIgKzEyMiwzMCBAQAogICAgICAgICBj
bWQuYWRkKCJsb2ciKTsKICAgICAgICAgY21kLmFkZCgiLU4iKTsgLy9kb24ndCBkaXNwbGF5IHRh
Z3MKIAotICAgICAgICBpZiAoaXNCcmFuY2g9PW51bGwpIHsKKyAgICAgICAgaWYgKGlzQnJhbmNo
ID09IG51bGwpIHsKICAgICAgICAgICAgIEZpbGUgdGFnRmlsZSA9IG5ldyBGaWxlKGdldERpcmVj
dG9yeU5hbWUoKSwgIkNWUy9UYWciKTsKLSAgICAgICAgICAgIGlmICggdGFnRmlsZS5pc0ZpbGUo
KSApIHsKLSAgICAgICAgICAgICAgICBpc0JyYW5jaD1Cb29sZWFuLlRSVUU7CisgICAgICAgICAg
ICBpZiAodGFnRmlsZS5pc0ZpbGUoKSkgeworICAgICAgICAgICAgICAgIGlzQnJhbmNoID0gQm9v
bGVhbi5UUlVFOwogICAgICAgICAgICAgICAgIHRyeSB7Ci0gICAgICAgICAgICAgICAgIEJ1ZmZl
cmVkUmVhZGVyIGJyPW5ldyBCdWZmZXJlZFJlYWRlcihuZXcgRmlsZVJlYWRlcih0YWdGaWxlKSk7
Ci0gICAgICAgICAgICAgICAgIHRyeSB7Ci0gICAgICAgICAgICAgICAgICBTdHJpbmcgbGluZT1i
ci5yZWFkTGluZSgpOwotICAgICAgICAgICAgICAgICAgaWYgKGxpbmUhPW51bGwpIHsKLSAgICAg
ICAgICAgICAgICAgICAgICAgICBicmFuY2g9bGluZS5zdWJzdHJpbmcoMSk7IH0KLSAgICAgICAg
ICAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGV4cCkgewotICAgICAgICAgICAgICAgICAgICBP
cGVuR3Jva0xvZ2dlci5nZXRMb2dnZXIoKS5sb2coTGV2ZWwuV0FSTklORywKLSAgICAgICAgICAg
ICAgICAgICAgICAgICJGYWlsZWQgdG8gZ2V0IHJldmlzaW9uIHRhZyBvZiB7MH0iLAotICAgICAg
ICAgICAgICAgICAgICAgICAgZ2V0RGlyZWN0b3J5TmFtZSgpICsgIjogIitleHAuZ2V0Q2xhc3Mo
KS50b1N0cmluZygpICk7Ci0gICAgICAgICAgICAgICAgIH0gZmluYWxseSB7Ci0gICAgICAgICAg
ICAgICAgICAgIElPVXRpbHMuY2xvc2UoYnIpOwotICAgICAgICAgICAgICAgICAgIH0KLSAgICAg
ICAgICAgICAgICB9IGNhdGNoIChJT0V4Y2VwdGlvbiBleCl7Ci0gICAgICAgICAgICAgICAgIE9w
ZW5Hcm9rTG9nZ2VyLmdldExvZ2dlcigpLmxvZyhMZXZlbC5XQVJOSU5HLAotICAgICAgICAgICAg
ICAgICAgICAgIkZhaWxlZCB0byB3b3JrIHdpdGggQ1ZTL1RhZyBmaWxlIG9mIHswfSIsCi0gICAg
ICAgICAgICAgICAgICAgICBnZXREaXJlY3RvcnlOYW1lKCkgKyAiOiAiK2V4LmdldENsYXNzKCku
dG9TdHJpbmcoKSApOworICAgICAgICAgICAgICAgICAgICBCdWZmZXJlZFJlYWRlciBiciA9IG5l
dyBCdWZmZXJlZFJlYWRlcihuZXcgRmlsZVJlYWRlcih0YWdGaWxlKSk7CisgICAgICAgICAgICAg
ICAgICAgIHRyeSB7CisgICAgICAgICAgICAgICAgICAgICAgICBTdHJpbmcgbGluZSA9IGJyLnJl
YWRMaW5lKCk7CisgICAgICAgICAgICAgICAgICAgICAgICBpZiAobGluZSAhPSBudWxsKSB7Cisg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJhbmNoID0gbGluZS5zdWJzdHJpbmcoMSk7Cisg
ICAgICAgICAgICAgICAgICAgICAgICB9CisgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKEV4
Y2VwdGlvbiBleHApIHsKKyAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKCJG
YWlsZWQgdG8gZ2V0IHJldmlzaW9uIHRhZyBvZiAnIgorICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICsgZ2V0RGlyZWN0b3J5TmFtZSgpICsgIic6ICIgKyBleHAuZ2V0TWVzc2FnZSgpKTsKKyAg
ICAgICAgICAgICAgICAgICAgfSBmaW5hbGx5IHsKKyAgICAgICAgICAgICAgICAgICAgICAgIElP
VXRpbHMuY2xvc2UoYnIpOworICAgICAgICAgICAgICAgICAgICB9CisgICAgICAgICAgICAgICAg
fSBjYXRjaCAoSU9FeGNlcHRpb24gZXgpIHsKKyAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLndh
cm5pbmcoIkZhaWxlZCB0byB3b3JrIHdpdGggQ1ZTL1RhZyBmaWxlIG9mICciCisgICAgICAgICAg
ICAgICAgICAgICAgICArIGdldERpcmVjdG9yeU5hbWUoKSArICInOiAiICsgZXguZ2V0TWVzc2Fn
ZSgpKTsKICAgICAgICAgICAgICAgICB9Ci0KLQorICAgICAgICAgICAgfSBlbHNlIHsKKyAgICAg
ICAgICAgICAgICBpc0JyYW5jaCA9IEJvb2xlYW4uRkFMU0U7CiAgICAgICAgICAgICB9Ci0gICAg
ICAgICAgICBlbHNlIHsgaXNCcmFuY2g9Qm9vbGVhbi5GQUxTRTsgfQogICAgICAgICB9CiAgICAg
ICAgIGlmIChpc0JyYW5jaC5lcXVhbHMoQm9vbGVhbi5UUlVFKSAmJiBicmFuY2ghPW51bGwgJiYg
IWJyYW5jaC5pc0VtcHR5KCkpCiAgICAgICAgIHsKQEAgLTE5MCw4ICsxOTAsNyBAQAogCiAgICAg
ICAgICAgICByZXQgPSBuZXcgQnl0ZUFycmF5SW5wdXRTdHJlYW0ob3V0LnRvQnl0ZUFycmF5KCkp
OwogICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZXhwKSB7Ci0gICAgICAgICAgICBPcGVuR3Jv
a0xvZ2dlci5nZXRMb2dnZXIoKS5sb2coTGV2ZWwuU0VWRVJFLAotICAgICAgICAgICAgICAgICJG
YWlsZWQgdG8gZ2V0IGhpc3Rvcnk6IHswfSIsIGV4cC5nZXRDbGFzcygpLnRvU3RyaW5nKCkpOwor
ICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoIkZhaWxlZCB0byBnZXQgaGlzdG9yeTogIiArIGV4
cC5nZXRNZXNzYWdlKCkpOwogICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgSU9VdGls
cy5jbG9zZShpbik7CiAgICAgICAgICAgICAvLyBDbGVhbiB1cCB6b21iaWUtcHJvY2Vzc2VzLi4u
CkBAIC0yNDIsOSArMjQxLDggQEAKICAgICAgICAgaW50IHN0YXR1cyA9IGV4ZWMuZXhlYygpOwog
CiAgICAgICAgIGlmIChzdGF0dXMgIT0gMCkgewotICAgICAgICAgICAgT3Blbkdyb2tMb2dnZXIu
Z2V0TG9nZ2VyKCkubG9nKExldmVsLldBUk5JTkcsCi0gICAgICAgICAgICAgICAgIkZhaWxlZCB0
byBnZXQgYW5ub3RhdGlvbnMgZm9yOiBcInswfVwiIEV4aXQgY29kZTogezF9IiwKLSAgICAgICAg
ICAgICAgICBuZXcgT2JqZWN0W117ZmlsZS5nZXRBYnNvbHV0ZVBhdGgoKSwgU3RyaW5nLnZhbHVl
T2Yoc3RhdHVzKX0pOworICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoIkZhaWxlZCB0byBnZXQg
YW5ub3RhdGlvbnMgZm9yICciCisgICAgICAgICAgICAgICAgKyBmaWxlLmdldEFic29sdXRlUGF0
aCgpICsgIicgLSAgRXhpdCBjb2RlICIgKyBzdGF0dXMpOwogICAgICAgICB9CiAKICAgICAgICAg
cmV0dXJuIHBhcnNlQW5ub3RhdGlvbihleGVjLmdldE91dHB1dFJlYWRlcigpLCBmaWxlLmdldE5h
bWUoKSk7CkBAIC0yODAsOCArMjc4LDcgQEAKICAgICAgICAgICAgICAgICBTdHJpbmcgYXV0aG9y
ID0gbWF0Y2hlci5ncm91cCgyKS50cmltKCk7CiAgICAgICAgICAgICAgICAgcmV0LmFkZExpbmUo
cmV2LCBhdXRob3IsIHRydWUpOwogICAgICAgICAgICAgfSBlbHNlIHsKLSAgICAgICAgICAgICAg
ICBPcGVuR3Jva0xvZ2dlci5nZXRMb2dnZXIoKS5sb2coTGV2ZWwuU0VWRVJFLAotICAgICAgICAg
ICAgICAgICAgICAiRXJyb3I6IGRpZCBub3QgZmluZCBhbm5vdGF0aW9uIGluIGxpbmUgezB9OiBb
ezF9XSIsCisgICAgICAgICAgICAgICAgbG9nZ2VyLmxvZyhMZXZlbC5XQVJOSU5HLCAiRGlkIG5v
dCBmaW5kIGFubm90YXRpb24gaW4gbGluZSB7MH0gW3sxfV0iLAogICAgICAgICAgICAgICAgICAg
ICBuZXcgT2JqZWN0W117U3RyaW5nLnZhbHVlT2YobGluZW5vKSwgbGluZX0pOwogICAgICAgICAg
ICAgfQogICAgICAgICB9CmRpZmYgLXIgNjE1NDkwMjZhYWZlIC1yIDI2MTExNjUwN2M3YSBzcmMv
b3JnL29wZW5zb2xhcmlzL29wZW5ncm9rL2hpc3RvcnkvQ2xlYXJDYXNlSGlzdG9yeVBhcnNlci5q
YXZhCi0tLSBhL3NyYy9vcmcvb3BlbnNvbGFyaXMvb3Blbmdyb2svaGlzdG9yeS9DbGVhckNhc2VI
aXN0b3J5UGFyc2VyLmphdmEJU3VuIEZlYiAxMiAwNDozNzozNiAyMDEyICswMTAwCisrKyBiL3Ny
Yy9vcmcvb3BlbnNvbGFyaXMvb3Blbmdyb2svaGlzdG9yeS9DbGVhckNhc2VIaXN0b3J5UGFyc2Vy
LmphdmEJTW9uIEZlYiAxMyAwNjoxMjo0NyAyMDEyICswMTAwCkBAIC0zMCwxNCArMzAsMTUgQEAK
IGltcG9ydCBqYXZhLnV0aWwuQXJyYXlMaXN0OwogaW1wb3J0IGphdmEudXRpbC5MaXN0OwogaW1w
b3J0IGphdmEudXRpbC5sb2dnaW5nLkxldmVsOwotaW1wb3J0IG9yZy5vcGVuc29sYXJpcy5vcGVu
Z3Jvay5PcGVuR3Jva0xvZ2dlcjsKK2ltcG9ydCBqYXZhLnV0aWwubG9nZ2luZy5Mb2dnZXI7CisK
IGltcG9ydCBvcmcub3BlbnNvbGFyaXMub3Blbmdyb2sudXRpbC5FeGVjdXRvcjsKIAogLyoqCiAg
KiBQYXJzZSBhIHN0cmVhbSBvZiBDbGVhckNhc2UgbG9nIGNvbW1lbnRzLgogICovCiBjbGFzcyBD
bGVhckNhc2VIaXN0b3J5UGFyc2VyIGltcGxlbWVudHMgRXhlY3V0b3IuU3RyZWFtSGFuZGxlciB7
Ci0KKyAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBMb2dnZXIgbG9nZ2VyID0gTG9nZ2VyLmdldExv
Z2dlcihDbGVhckNhc2VIaXN0b3J5UGFyc2VyLmNsYXNzLmdldE5hbWUoKSk7CiAgICAgcHJpdmF0
ZSBIaXN0b3J5IGhpc3Rvcnk7CiAgICAgcHJpdmF0ZSBDbGVhckNhc2VSZXBvc2l0b3J5IHJlcG9z
aXRvcnk9bmV3IENsZWFyQ2FzZVJlcG9zaXRvcnkoKTsKIApAQCAtNDgsMTQgKzQ5LDE0IEBACiAg
ICAgICAgICAgICBpbnQgc3RhdHVzID0gZXhlY3V0b3IuZXhlYyh0cnVlLCB0aGlzKTsKIAogICAg
ICAgICAgICAgaWYgKHN0YXR1cyAhPSAwKSB7Ci0gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEhp
c3RvcnlFeGNlcHRpb24oIkZhaWxlZCB0byBnZXQgaGlzdG9yeSBmb3I6IFwiIiArCi0gICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZS5nZXRBYnNvbHV0ZVBhdGgo
KSArICJcIiBFeGl0IGNvZGU6ICIgKyBzdGF0dXMpOworICAgICAgICAgICAgICAgIHRocm93IG5l
dyBIaXN0b3J5RXhjZXB0aW9uKCJGYWlsZWQgdG8gZ2V0IGhpc3RvcnkgZm9yICciICsKKyAgICAg
ICAgICAgICAgICAgICAgZmlsZS5nZXRBYnNvbHV0ZVBhdGgoKSArICInIC0gRXhpdCBjb2RlICIg
KyBzdGF0dXMpOwogICAgICAgICAgICAgfQogCiAgICAgICAgICAgICByZXR1cm4gaGlzdG9yeTsK
ICAgICAgICAgfSBjYXRjaCAoSU9FeGNlcHRpb24gZSkgewotICAgICAgICAgICAgdGhyb3cgbmV3
IEhpc3RvcnlFeGNlcHRpb24oIkZhaWxlZCB0byBnZXQgaGlzdG9yeSBmb3I6IFwiIiArCi0gICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlLmdldEFic29sdXRlUGF0aCgp
ICsgIlwiIiwgZSk7CisgICAgICAgICAgICB0aHJvdyBuZXcgSGlzdG9yeUV4Y2VwdGlvbigiRmFp
bGVkIHRvIGdldCBoaXN0b3J5IGZvciAnIiArCisgICAgICAgICAgICAgICAgZmlsZS5nZXRBYnNv
bHV0ZVBhdGgoKSArICInIiwgZSk7CiAgICAgICAgIH0KICAgICB9CiAKQEAgLTkwLDcgKzkxLDgg
QEAKICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICBlbnRyeS5zZXRE
YXRlKGRmLnBhcnNlKHMpKTsKICAgICAgICAgICAgICAgICB9IGNhdGNoIChQYXJzZUV4Y2VwdGlv
biBwZSkgewotICAgICAgICAgICAgICAgICAgICBPcGVuR3Jva0xvZ2dlci5nZXRMb2dnZXIoKS5s
b2coTGV2ZWwuV0FSTklORywgIkNvdWxkIG5vdCBwYXJzZSBkYXRlOiAiICsgcywgcGUpOworICAg
ICAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZygiQ291bGQgbm90IHBhcnNlIGRhdGUgIiAr
IHMgKyAiOiAiICsgcGUuZ2V0TWVzc2FnZSgpKTsKKyAgICAgICAgICAgICAgICAgICAgbG9nZ2Vy
LmxvZyhMZXZlbC5GSU5FLCAicHJvY2Vzc1N0cmVhbSIsIHBlKTsKICAgICAgICAgICAgICAgICB9
CiAgICAgICAgICAgICB9CiAgICAgICAgICAgICBpZiAoKHMgPSBpbi5yZWFkTGluZSgpKSAhPSBu
dWxsKSB7CmRpZmYgLXIgNjE1NDkwMjZhYWZlIC1yIDI2MTExNjUwN2M3YSBzcmMvb3JnL29wZW5z
b2xhcmlzL29wZW5ncm9rL2hpc3RvcnkvQ2xlYXJDYXNlUmVwb3NpdG9yeS5qYXZhCi0tLSBhL3Ny
Yy9vcmcvb3BlbnNvbGFyaXMvb3Blbmdyb2svaGlzdG9yeS9DbGVhckNhc2VSZXBvc2l0b3J5Lmph
dmEJU3VuIEZlYiAxMiAwNDozNzozNiAyMDEyICswMTAwCisrKyBiL3NyYy9vcmcvb3BlbnNvbGFy
aXMvb3Blbmdyb2svaGlzdG9yeS9DbGVhckNhc2VSZXBvc2l0b3J5LmphdmEJTW9uIEZlYiAxMyAw
NjoxMjo0NyAyMDEyICswMTAwCkBAIC0zMyw4ICszMyw5IEBACiBpbXBvcnQgamF2YS51dGlsLkFy
cmF5czsKIGltcG9ydCBqYXZhLnV0aWwuTGlzdDsKIGltcG9ydCBqYXZhLnV0aWwubG9nZ2luZy5M
ZXZlbDsKK2ltcG9ydCBqYXZhLnV0aWwubG9nZ2luZy5Mb2dnZXI7CiBpbXBvcnQgamF2YS51dGls
LnJlZ2V4LlBhdHRlcm47Ci1pbXBvcnQgb3JnLm9wZW5zb2xhcmlzLm9wZW5ncm9rLk9wZW5Hcm9r
TG9nZ2VyOworCiBpbXBvcnQgb3JnLm9wZW5zb2xhcmlzLm9wZW5ncm9rLnV0aWwuRXhlY3V0b3I7
CiBpbXBvcnQgb3JnLm9wZW5zb2xhcmlzLm9wZW5ncm9rLnV0aWwuSU9VdGlsczsKIApAQCAtNDQs
NiArNDUsNyBAQAogICovCiBwdWJsaWMgY2xhc3MgQ2xlYXJDYXNlUmVwb3NpdG9yeSBleHRlbmRz
IFJlcG9zaXRvcnkgewogICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGxvbmcgc2VyaWFsVmVyc2lv
blVJRCA9IDFMOworICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIExvZ2dlciBsb2dnZXIgPSBMb2dn
ZXIuZ2V0TG9nZ2VyKENsZWFyQ2FzZVJlcG9zaXRvcnkuY2xhc3MuZ2V0TmFtZSgpKTsKICAgICAv
KiogVGhlIHByb3BlcnR5IG5hbWUgdXNlZCB0byBvYnRhaW4gdGhlIGNsaWVudCBjb21tYW5kIGZv
ciB0aGlzIHJlcG9zaXRvcnkuICovCiAgICAgcHVibGljIHN0YXRpYyBmaW5hbCBTdHJpbmcgQ01E
X1BST1BFUlRZX0tFWSA9CiAgICAgICAgICJvcmcub3BlbnNvbGFyaXMub3Blbmdyb2suaGlzdG9y
eS5DbGVhckNhc2UiOwpAQCAtMTE3LDggKzExOSw3IEBACiAKICAgICAgICAgICAgIC8vIGNsZWFy
dG9vbCBjYW4ndCBnZXQgdG8gYSBwcmV2aW91c2x5IGV4aXN0aW5nIGZpbGUKICAgICAgICAgICAg
IGlmICh0bXAuZXhpc3RzKCkgJiYgIXRtcC5kZWxldGUoKSkgewotICAgICAgICAgICAgICAgIE9w
ZW5Hcm9rTG9nZ2VyLmdldExvZ2dlcigpLmxvZyhMZXZlbC5XQVJOSU5HLAotICAgICAgICAgICAg
ICAgICAgICAiRmFpbGVkIHRvIHJlbW92ZSB0ZW1wb3JhcnkgZmlsZSB1c2VkIGJ5IGhpc3Rvcnkg
Y2FjaGUiKTsKKyAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZygiRmFpbGVkIHRvIHJlbW92
ZSB0ZW1wb3JhcnkgZmlsZSB1c2VkIGJ5IGhpc3RvcnkgY2FjaGUiKTsKICAgICAgICAgICAgIH0K
IAogICAgICAgICAgICAgU3RyaW5nIGRlY29yYXRlZCA9IGZpbGVuYW1lICsgIkBAIiArIHJldjsK
QEAgLTE0Niw4ICsxNDcsOSBAQAogICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgIH07CiAg
ICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBleHApIHsKLSAgICAgICAgICAgIE9wZW5Hcm9rTG9n
Z2VyLmdldExvZ2dlcigpLmxvZyhMZXZlbC5TRVZFUkUsCi0gICAgICAgICAgICAgICAgIkZhaWxl
ZCB0byBnZXQgaGlzdG9yeTogIiArIGV4cC5nZXRDbGFzcygpLnRvU3RyaW5nKCksIGV4cCk7Cisg
ICAgICAgICAgICBsb2dnZXIud2FybmluZygiRmFpbGVkIHRvIGdldCBoaXN0b3J5IGZvciAnIiAr
IHBhcmVudCAKKyAgICAgICAgICAgICAgICArIEZpbGUuc2VwYXJhdG9yICsgYmFzZW5hbWUgKyAi
JzogIiArIGV4cC5nZXRNZXNzYWdlKCkpOworICAgICAgICAgICAgbG9nZ2VyLmxvZyhMZXZlbC5G
SU5FLCAiZ2V0SGlzdG9yeUdldCIsIGV4cCk7CiAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAg
ICAgICAvLyBDbGVhbiB1cCB6b21iaWUtcHJvY2Vzc2VzLi4uCiAgICAgICAgICAgICBpZiAocHJv
Y2VzcyAhPSBudWxsKSB7CkBAIC0xNzYsOCArMTc4LDcgQEAKICAgICAgICAgICAgIH0gY2F0Y2gg
KElPRXhjZXB0aW9uIGlvZSkgewogICAgICAgICAgICAgICAgIC8vIGlnbm9yZWQgLSBzdHJlYW0g
aXNuJ3Qgc2Vla2FibGUsIGJ1dCBza2lwcGVkIHZhcmlhYmxlIHN0aWxsCiAgICAgICAgICAgICAg
ICAgLy8gaGFzIGNvcnJlY3QgdmFsdWUuCi0gICAgICAgICAgICAgICAgT3Blbkdyb2tMb2dnZXIu
Z2V0TG9nZ2VyKCkubG9nKExldmVsLkZJTkVTVCwKLSAgICAgICAgICAgICAgICAgICAgIlN0cmVh
bSBub3Qgc2Vla2FibGUiLCBpb2UpOworICAgICAgICAgICAgICAgIGxvZ2dlci5sb2coTGV2ZWwu
RklORVNULCAiU3RyZWFtIG5vdCBzZWVrYWJsZSIsIGlvZSk7CiAgICAgICAgICAgICB9CiAgICAg
ICAgICAgICBpZiAoc2tpcHBlZCA9PSAwICYmIGluLnJlYWQoKSA9PSAtMSkgewogICAgICAgICAg
ICAgICAgIC8vIE5vIGJ5dGVzIHNraXBwZWQsIGNoZWNrZWQgdGhhdCB3ZSd2ZSByZWFjaGVkIEVP
RiB3aXRoIHJlYWQoKQpAQCAtMjIxLDkgKzIyMiw3IEBACiAgICAgICAgICAgICBpbiA9IG5ldyBC
dWZmZXJlZFJlYWRlcihuZXcgSW5wdXRTdHJlYW1SZWFkZXIocHJvY2Vzcy5nZXRJbnB1dFN0cmVh
bSgpKSk7CiAgICAgICAgICAgICBBbm5vdGF0aW9uIGEgPSBuZXcgQW5ub3RhdGlvbihmaWxlLmdl
dE5hbWUoKSk7CiAgICAgICAgICAgICBTdHJpbmcgbGluZTsKLSAgICAgICAgICAgIGludCBsaW5l
bm8gPSAwOwogICAgICAgICAgICAgd2hpbGUgKChsaW5lID0gaW4ucmVhZExpbmUoKSkgIT0gbnVs
bCkgewotICAgICAgICAgICAgICAgICsrbGluZW5vOwogICAgICAgICAgICAgICAgIFN0cmluZyBw
YXJ0c1tdID0gbGluZS5zcGxpdCgiXFx8Iik7CiAgICAgICAgICAgICAgICAgU3RyaW5nIGFBdXRo
b3IgPSBwYXJ0c1swXTsKICAgICAgICAgICAgICAgICBTdHJpbmcgYVJldmlzaW9uID0gcGFydHNb
MV07CkBAIC0yNTUsNiArMjU0LDcgQEAKICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAg
ICAgcmV0dXJuIHByb2Nlc3Mud2FpdEZvcigpOwogICAgICAgICAgICAgfSBjYXRjaCAoSW50ZXJy
dXB0ZWRFeGNlcHRpb24gZXhwKSB7CisgICAgICAgICAgICAgICAgLy8gb2sKICAgICAgICAgICAg
IH0KICAgICAgICAgfSB3aGlsZSAodHJ1ZSk7CiAgICAgfQpAQCAtMzQ3LDggKzM0Nyw5IEBACiAg
ICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICB9IGNh
dGNoIChJT0V4Y2VwdGlvbiBlKSB7Ci0gICAgICAgICAgICAgICAgT3Blbkdyb2tMb2dnZXIuZ2V0
TG9nZ2VyKCkubG9nKExldmVsLldBUk5JTkcsCi0gICAgICAgICAgICAgICAgICAgICJDb3VsZCBu
b3QgZ2V0IGNhbm9uaWNhbCBwYXRoIGZvciBcIiIrZmlsZSsiXCIiLCBlKTsKKyAgICAgICAgICAg
ICAgICBsb2dnZXIud2FybmluZygiQ291bGQgbm90IGdldCBjYW5vbmljYWwgcGF0aCBmb3IgJyIg
KyBmaWxlIAorICAgICAgICAgICAgICAgICAgICArICInOiAiICsgZS5nZXRNZXNzYWdlKCkpOwor
ICAgICAgICAgICAgICAgIGxvZ2dlci5sb2coTGV2ZWwuRklORSwgImlzUmVwb3NpdG9yeUZvciIs
IGUpOwogICAgICAgICAgICAgfQogICAgICAgICB9CiAgICAgICAgIHJldHVybiBmYWxzZTsKQEAg
LTM3MywxOCArMzc0LDE1IEBACiAgICAgICAgICAgICAgICAgU3RyaW5nIG91dHB1dCA9IGV4ZWMu
Z2V0T3V0cHV0U3RyaW5nKCk7CiAKICAgICAgICAgICAgICAgICBpZiAob3V0cHV0ID09IG51bGwp
IHsKLSAgICAgICAgICAgICAgICAgICAgT3Blbkdyb2tMb2dnZXIuZ2V0TG9nZ2VyKCkubG9nKExl
dmVsLlNFVkVSRSwKLSAgICAgICAgICAgICAgICAgICAgICAgICJcImNsZWFydG9vbCBsc3ZvYiAt
c1wiIG91dHB1dCB3YXMgbnVsbCIpOworICAgICAgICAgICAgICAgICAgICBsb2dnZXIud2Fybmlu
ZygiW2NsZWFydG9vbCBsc3ZvYiAtc10gb3V0cHV0IHdhcyBudWxsIik7CiAgICAgICAgICAgICAg
ICAgICAgIHJldHVybiBuZXcgU3RyaW5nWzBdOwogICAgICAgICAgICAgICAgIH0KICAgICAgICAg
ICAgICAgICBTdHJpbmcgc2VwID0gU3lzdGVtLmdldFByb3BlcnR5KCJsaW5lLnNlcGFyYXRvciIp
OwogICAgICAgICAgICAgICAgIFN0cmluZ1tdIHZvYnMgPSBvdXRwdXQuc3BsaXQoUGF0dGVybi5x
dW90ZShzZXApKTsKLSAgICAgICAgICAgICAgICBPcGVuR3Jva0xvZ2dlci5nZXRMb2dnZXIoKS5s
b2coTGV2ZWwuQ09ORklHLCAiRm91bmQgVk9CczogezB9IiwKLSAgICAgICAgICAgICAgICAgICAg
QXJyYXlzLmFzTGlzdCh2b2JzKSk7CisgICAgICAgICAgICAgICAgbG9nZ2VyLmxvZyhMZXZlbC5G
SU5FLCAiRm91bmQgVk9CczogezB9IiwgQXJyYXlzLmFzTGlzdCh2b2JzKSk7CiAgICAgICAgICAg
ICAgICAgcmV0dXJuIHZvYnM7CiAgICAgICAgICAgICB9Ci0gICAgICAgICAgICBPcGVuR3Jva0xv
Z2dlci5nZXRMb2dnZXIoKS5sb2coTGV2ZWwuU0VWRVJFLAotICAgICAgICAgICAgICAgICJcImNs
ZWFydG9vbCBsc3ZvYiAtc1wiIHJldHVybmVkIG5vbi16ZXJvIHN0YXR1czogIiArIHJjKTsKKyAg
ICAgICAgICAgIGxvZ2dlci53YXJuaW5nKCJbY2xlYXJ0b29sIGxzdm9iIC1zXSByZXR1cm5lZCBu
b24temVybyBzdGF0dXMgIiArIHJjKTsKICAgICAgICAgfQogICAgICAgICByZXR1cm4gbmV3IFN0
cmluZ1swXTsKICAgICB9CmRpZmYgLXIgNjE1NDkwMjZhYWZlIC1yIDI2MTExNjUwN2M3YSBzcmMv
b3JnL29wZW5zb2xhcmlzL29wZW5ncm9rL2hpc3RvcnkvRGlyZWN0b3J5SGlzdG9yeVJlYWRlci5q
YXZhCi0tLSBhL3NyYy9vcmcvb3BlbnNvbGFyaXMvb3Blbmdyb2svaGlzdG9yeS9EaXJlY3RvcnlI
aXN0b3J5UmVhZGVyLmphdmEJU3VuIEZlYiAxMiAwNDozNzozNiAyMDEyICswMTAwCisrKyBiL3Ny
Yy9vcmcvb3BlbnNvbGFyaXMvb3Blbmdyb2svaGlzdG9yeS9EaXJlY3RvcnlIaXN0b3J5UmVhZGVy
LmphdmEJTW9uIEZlYiAxMyAwNjoxMjo0NyAyMDEyICswMTAwCkBAIC0zMyw2ICszMyw4IEBACiBp
bXBvcnQgamF2YS51dGlsLlNvcnRlZFNldDsKIGltcG9ydCBqYXZhLnV0aWwuVHJlZVNldDsKIGlt
cG9ydCBqYXZhLnV0aWwubG9nZ2luZy5MZXZlbDsKK2ltcG9ydCBqYXZhLnV0aWwubG9nZ2luZy5M
b2dnZXI7CisKIGltcG9ydCBvcmcuYXBhY2hlLmx1Y2VuZS5kb2N1bWVudC5EYXRlVG9vbHM7CiBp
bXBvcnQgb3JnLmFwYWNoZS5sdWNlbmUuZG9jdW1lbnQuRG9jdW1lbnQ7CiBpbXBvcnQgb3JnLmFw
YWNoZS5sdWNlbmUuaW5kZXguSW5kZXhSZWFkZXI7CkBAIC00Myw3ICs0NSw2IEBACiBpbXBvcnQg
b3JnLmFwYWNoZS5sdWNlbmUuc2VhcmNoLlNvcnQ7CiBpbXBvcnQgb3JnLmFwYWNoZS5sdWNlbmUu
c2VhcmNoLlNvcnRGaWVsZDsKIGltcG9ydCBvcmcuYXBhY2hlLmx1Y2VuZS5zZWFyY2guVG9wRmll
bGREb2NzOwotaW1wb3J0IG9yZy5vcGVuc29sYXJpcy5vcGVuZ3Jvay5PcGVuR3Jva0xvZ2dlcjsK
IGltcG9ydCBvcmcub3BlbnNvbGFyaXMub3Blbmdyb2suYW5hbHlzaXMuQ29tcGF0aWJsZUFuYWx5
c2VyOwogaW1wb3J0IG9yZy5vcGVuc29sYXJpcy5vcGVuZ3Jvay5jb25maWd1cmF0aW9uLlJ1bnRp
bWVFbnZpcm9ubWVudDsKIGltcG9ydCBvcmcub3BlbnNvbGFyaXMub3Blbmdyb2suaW5kZXguSW5k
ZXhEYXRhYmFzZTsKQEAgLTU4LDcgKzU5LDcgQEAKICAqIEBhdXRob3IgTHVib3MgS29zY28gdXBk
YXRlIGZvciBsdWNlbmUgMy4wLjAKICAqLwogcHVibGljIGNsYXNzIERpcmVjdG9yeUhpc3RvcnlS
ZWFkZXIgewotCisgICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgTG9nZ2VyIGxvZ2dlciA9IExvZ2dl
ci5nZXRMb2dnZXIoRGlyZWN0b3J5SGlzdG9yeVJlYWRlci5jbGFzcy5nZXROYW1lKCkpOwogICAg
IHByaXZhdGUgZmluYWwgTWFwPERhdGUsIE1hcDxTdHJpbmcsIE1hcDxTdHJpbmcsIFNvcnRlZFNl
dDxTdHJpbmc+Pj4+IGhhc2ggPQogICAgICAgICBuZXcgTGlua2VkSGFzaE1hcDxEYXRlLCBNYXA8
U3RyaW5nLCBNYXA8U3RyaW5nLCBTb3J0ZWRTZXQ8U3RyaW5nPj4+PigpOwogICAgIEl0ZXJhdG9y
PERhdGU+IGRpdGVyOwpAQCAtOTQsNyArOTUsOSBAQAogICAgICAgICAgICAgICAgIGZkb2NzPXNl
YXJjaGVyLnNlYXJjaChxdWVyeSwgbnVsbCxmZG9jcy50b3RhbEhpdHMsIHNvcnQpOwogICAgICAg
ICAgICAgICAgIGhpdHMgPSBmZG9jcy5zY29yZURvY3M7CiAgICAgICAgICAgICB9IGNhdGNoIChv
cmcuYXBhY2hlLmx1Y2VuZS5xdWVyeVBhcnNlci5QYXJzZUV4Y2VwdGlvbiBlKSB7Ci0gICAgICAg
ICAgICAgICAgT3Blbkdyb2tMb2dnZXIuZ2V0TG9nZ2VyKCkubG9nKExldmVsLldBUk5JTkcsICJB
biBlcnJvciBvY2N1cmVkIHdoaWxlIHBhcnNpbmcgc2VhcmNoIHF1ZXJ5IiwgZSk7CisgICAgICAg
ICAgICAgICAgbG9nZ2VyLndhcm5pbmcoIkFuIGVycm9yIG9jY3VyZWQgd2hpbGUgcGFyc2luZyBz
ZWFyY2ggcXVlcnk6ICIgCisgICAgICAgICAgICAgICAgICAgICsgZS5nZXRNZXNzYWdlKCkpOwor
ICAgICAgICAgICAgICAgIGxvZ2dlci5sb2coTGV2ZWwuRklORSwgIkRpcmVjdG9yeUhpc3RvcnlS
ZWFkZXIiLCBlKTsKICAgICAgICAgICAgIH0KICAgICAgICAgICAgIGlmIChoaXRzICE9IG51bGwp
IHsKICAgICAgICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IDQwICYmIGkgPCBoaXRzLmxl
bmd0aDsgaSsrKSB7CkBAIC0xMDgsNyArMTExLDkgQEAKICAgICAgICAgICAgICAgICAgICAgdHJ5
IHsKICAgICAgICAgICAgICAgICAgICAgICAgIGNkYXRlID0gRGF0ZVRvb2xzLnN0cmluZ1RvRGF0
ZShkb2MuZ2V0KCJkYXRlIikpOwogICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChqYXZhLnRl
eHQuUGFyc2VFeGNlcHRpb24gZXgpIHsKLSAgICAgICAgICAgICAgICAgICAgICAgIE9wZW5Hcm9r
TG9nZ2VyLmdldExvZ2dlcigpLmxvZyhMZXZlbC5XQVJOSU5HLCAiQ291bGQgbm90IGdldCBkYXRl
IGZvciAiICsgcGF0aCwgZXgpOworICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5p
bmcoIkNvdWxkIG5vdCBnZXQgZGF0ZSBmb3IgJyIgKyBwYXRoIAorICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICsgIic6ICIgKyBleC5nZXRNZXNzYWdlKCkpOworICAgICAgICAgICAgICAgICAg
ICAgICAgbG9nZ2VyLmxvZyhMZXZlbC5GSU5FLCAiRGlyZWN0b3J5SGlzdG9yeVJlYWRlciIsIGV4
KTsKICAgICAgICAgICAgICAgICAgICAgICAgIGNkYXRlID0gbmV3IERhdGUoKTsKICAgICAgICAg
ICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICBpbnQgbHMgPSBycGF0aC5sYXN0SW5k
ZXhPZignLycpOwpAQCAtMTIwLDcgKzEyNSw5IEBACiAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgRmlsZSBmID0gbmV3IEZpbGUoc3JjX3Jvb3QgKyBycGFyZW50LCByYmFzZSk7CiAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgaGlzdCA9IEhpc3RvcnlHdXJ1LmdldEluc3RhbmNlKCkuZ2V0
SGlzdG9yeShmKTsKICAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKEhpc3RvcnlFeGNl
cHRpb24gZSkgewotICAgICAgICAgICAgICAgICAgICAgICAgICAgIE9wZW5Hcm9rTG9nZ2VyLmdl
dExvZ2dlcigpLmxvZyhMZXZlbC5XQVJOSU5HLCAiQW4gZXJyb3Igb2NjdXJlZCB3aGlsZSBnZXR0
aW5nIGhpc3RvcnkgcmVhZGVyIiwgZSk7CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9n
Z2VyLndhcm5pbmcoIkFuIGVycm9yIG9jY3VyZWQgd2hpbGUgZ2V0dGluZyBoaXN0b3J5IHJlYWRl
cjogIgorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICArIGUuZ2V0TWVzc2FnZSgpKTsK
KyAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIubG9nKExldmVsLkZJTkUsICJEaXJl
Y3RvcnlIaXN0b3J5UmVhZGVyIiwgZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAg
ICAgICAgICAgICAgICAgICAgICBpZiAoaGlzdCA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgcHV0KGNkYXRlLCAiLSIsICIiLCBycGF0aCk7CkBAIC0xNDIsMTQgKzE0OSwx
OCBAQAogICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgIHNlYXJjaGVy
LmNsb3NlKCk7CiAgICAgICAgICAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGV4KSB7Ci0gICAg
ICAgICAgICAgICAgICAgIE9wZW5Hcm9rTG9nZ2VyLmdldExvZ2dlcigpLmxvZyhMZXZlbC5XQVJO
SU5HLCAiQW4gZXJyb3Igb2NjdXJlZCB3aGlsZSBjbG9zaW5nIHNlYXJjaGVyIiwgZXgpOworICAg
ICAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZygiQW4gZXJyb3Igb2NjdXJlZCB3aGlsZSBj
bG9zaW5nIHNlYXJjaGVyOiAiIAorICAgICAgICAgICAgICAgICAgICAgICAgKyBleC5nZXRNZXNz
YWdlKCkpOworICAgICAgICAgICAgICAgICAgICBsb2dnZXIubG9nKExldmVsLkZJTkUsICJEaXJl
Y3RvcnlIaXN0b3J5UmVhZGVyIiwgZXgpOwogICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg
IH0KICAgICAgICAgICAgIGlmIChpcmVhZGVyICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICB0
cnkgewogICAgICAgICAgICAgICAgICAgICBpcmVhZGVyLmNsb3NlKCk7CiAgICAgICAgICAgICAg
ICAgfSBjYXRjaCAoRXhjZXB0aW9uIGV4KSB7Ci0gICAgICAgICAgICAgICAgICAgIE9wZW5Hcm9r
TG9nZ2VyLmdldExvZ2dlcigpLmxvZyhMZXZlbC5XQVJOSU5HLCAiQW4gZXJyb3Igb2NjdXJlZCB3
aGlsZSBjbG9zaW5nIHJlYWRlciIsIGV4KTsKKyAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLndh
cm5pbmcoIkFuIGVycm9yIG9jY3VyZWQgd2hpbGUgY2xvc2luZyByZWFkZXI6ICIgCisgICAgICAg
ICAgICAgICAgICAgICAgICArIGV4LmdldE1lc3NhZ2UoKSk7CisgICAgICAgICAgICAgICAgICAg
IGxvZ2dlci5sb2coTGV2ZWwuRklORSwgIkRpcmVjdG9yeUhpc3RvcnlSZWFkZXIiLCBleCk7CiAg
ICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgfQogICAgICAgICB9CmRpZmYgLXIgNjE1NDkw
MjZhYWZlIC1yIDI2MTExNjUwN2M3YSBzcmMvb3JnL29wZW5zb2xhcmlzL29wZW5ncm9rL2hpc3Rv
cnkvRmlsZUhpc3RvcnlDYWNoZS5qYXZhCi0tLSBhL3NyYy9vcmcvb3BlbnNvbGFyaXMvb3Blbmdy
b2svaGlzdG9yeS9GaWxlSGlzdG9yeUNhY2hlLmphdmEJU3VuIEZlYiAxMiAwNDozNzozNiAyMDEy
ICswMTAwCisrKyBiL3NyYy9vcmcvb3BlbnNvbGFyaXMvb3Blbmdyb2svaGlzdG9yeS9GaWxlSGlz
dG9yeUNhY2hlLmphdmEJTW9uIEZlYiAxMyAwNjoxMjo0NyAyMDEyICswMTAwCkBAIC00MCwxMyAr
NDAsMTUgQEAKIGltcG9ydCBqYXZhLnV0aWwuTGlzdDsKIGltcG9ydCBqYXZhLnV0aWwuTWFwOwog
aW1wb3J0IGphdmEudXRpbC5sb2dnaW5nLkxldmVsOworaW1wb3J0IGphdmEudXRpbC5sb2dnaW5n
LkxvZ2dlcjsKIGltcG9ydCBqYXZhLnV0aWwuemlwLkdaSVBJbnB1dFN0cmVhbTsKIGltcG9ydCBq
YXZhLnV0aWwuemlwLkdaSVBPdXRwdXRTdHJlYW07Ci1pbXBvcnQgb3JnLm9wZW5zb2xhcmlzLm9w
ZW5ncm9rLk9wZW5Hcm9rTG9nZ2VyOworCiBpbXBvcnQgb3JnLm9wZW5zb2xhcmlzLm9wZW5ncm9r
LmNvbmZpZ3VyYXRpb24uUnVudGltZUVudmlyb25tZW50OwogaW1wb3J0IG9yZy5vcGVuc29sYXJp
cy5vcGVuZ3Jvay51dGlsLklPVXRpbHM7CiAKIGNsYXNzIEZpbGVIaXN0b3J5Q2FjaGUgaW1wbGVt
ZW50cyBIaXN0b3J5Q2FjaGUgeworICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIExvZ2dlciBsb2dn
ZXIgPSBMb2dnZXIuZ2V0TG9nZ2VyKEZpbGVIaXN0b3J5Q2FjaGUuY2xhc3MuZ2V0TmFtZSgpKTsK
ICAgICBwcml2YXRlIGZpbmFsIE9iamVjdCBsb2NrID0gbmV3IE9iamVjdCgpOwogCiAgICAgc3Rh
dGljIGNsYXNzIEZpbGVQZXJzaXN0ZW5jZURlbGVnYXRlIGV4dGVuZHMgUGVyc2lzdGVuY2VEZWxl
Z2F0ZSB7CkBAIC05NSw3ICs5Nyw4IEBACiAgICAgICAgICAgICBzYi5hcHBlbmQoYWRkKTsKICAg
ICAgICAgICAgIHNiLmFwcGVuZCgiLmd6Iik7CiAgICAgICAgIH0gY2F0Y2ggKElPRXhjZXB0aW9u
IGUpIHsKLSAgICAgICAgICAgIHRocm93IG5ldyBIaXN0b3J5RXhjZXB0aW9uKCJGYWlsZWQgdG8g
Z2V0IHBhdGggcmVsYXRpdmUgdG8gc291cmNlIHJvb3QgZm9yICIgKyBmaWxlLCBlKTsKKyAgICAg
ICAgICAgIHRocm93IG5ldyBIaXN0b3J5RXhjZXB0aW9uKCJGYWlsZWQgdG8gZ2V0IHBhdGggcmVs
YXRpdmUgdG8gc291cmNlIHJvb3QgZm9yICciIAorICAgICAgICAgICAgICAgICsgZmlsZSArICIn
IiwgZSk7CiAgICAgICAgIH0KIAogICAgICAgICByZXR1cm4gbmV3IEZpbGUoc2IudG9TdHJpbmco
KSk7CkBAIC0xMjQsNyArMTI3LDcgQEAKICAgICAgICAgRmlsZSBkaXIgPSBjYWNoZS5nZXRQYXJl
bnRGaWxlKCk7CiAgICAgICAgIGlmICghZGlyLmlzRGlyZWN0b3J5KCkgJiYgIWRpci5ta2RpcnMo
KSkgewogICAgICAgICAgICAgdGhyb3cgbmV3IEhpc3RvcnlFeGNlcHRpb24oCi0gICAgICAgICAg
ICAgICAgICAgICJVbmFibGUgdG8gY3JlYXRlIGNhY2hlIGRpcmVjdG9yeSAnIiArIGRpciArICIn
LiIpOworICAgICAgICAgICAgICAgICJVbmFibGUgdG8gY3JlYXRlIGNhY2hlIGRpcmVjdG9yeSAn
IiArIGRpciArICInIik7CiAgICAgICAgIH0KIAogICAgICAgICAvLyBXZSBoYXZlIGEgcHJvYmxl
bSB0aGF0IG11bHRpcGxlIHRocmVhZHMgbWF5IGFjY2VzcyB0aGUgY2FjaGUgbGF5ZXIKQEAgLTE1
NCwxNiArMTU3LDE2IEBACiAgICAgICAgIHN5bmNocm9uaXplZCAobG9jaykgewogICAgICAgICAg
ICAgaWYgKCFjYWNoZS5kZWxldGUoKSAmJiBjYWNoZS5leGlzdHMoKSkgewogICAgICAgICAgICAg
ICAgIGlmICghb3V0cHV0LmRlbGV0ZSgpKSB7Ci0gICAgICAgICAgICAgICAgICAgIE9wZW5Hcm9r
TG9nZ2VyLmdldExvZ2dlcigpLmxvZyhMZXZlbC5XQVJOSU5HLCAiRmFpbGVkIHRvIHJlbW92ZSB0
ZW1wb3JhcnkgaGlzdG9yeSBjYWNoZSBmaWxlIik7CisgICAgICAgICAgICAgICAgICAgIGxvZ2dl
ci53YXJuaW5nKCJGYWlsZWQgdG8gcmVtb3ZlIHRlbXBvcmFyeSBoaXN0b3J5IGNhY2hlIGZpbGUi
KTsKICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEhpc3RvcnlF
eGNlcHRpb24oCi0gICAgICAgICAgICAgICAgICAgICAgICAiQ2FjaGVmaWxlIGV4aXN0cywgYW5k
IEkgY291bGQgbm90IGRlbGV0ZSBpdC4iKTsKKyAgICAgICAgICAgICAgICAgICAgIkNhY2hlIGZp
bGUgZXhpc3RzLCBhbmQgSSBjb3VsZCBub3QgZGVsZXRlIGl0Iik7CiAgICAgICAgICAgICB9CiAg
ICAgICAgICAgICBpZiAoIW91dHB1dC5yZW5hbWVUbyhjYWNoZSkpIHsKICAgICAgICAgICAgICAg
ICBpZiAoIW91dHB1dC5kZWxldGUoKSkgewotICAgICAgICAgICAgICAgICAgICBPcGVuR3Jva0xv
Z2dlci5nZXRMb2dnZXIoKS5sb2coTGV2ZWwuV0FSTklORywgIkZhaWxlZCB0byByZW1vdmUgdGVt
cG9yYXJ5IGhpc3RvcnkgY2FjaGUgZmlsZSIpOworICAgICAgICAgICAgICAgICAgICBsb2dnZXIu
d2FybmluZygiRmFpbGVkIHRvIHJlbW92ZSB0ZW1wb3JhcnkgaGlzdG9yeSBjYWNoZSBmaWxlIik7
CiAgICAgICAgICAgICAgICAgfQotICAgICAgICAgICAgICAgIHRocm93IG5ldyBIaXN0b3J5RXhj
ZXB0aW9uKCJGYWlsZWQgdG8gcmVuYW1lIGNhY2hlIHRtcGZpbGUuIik7CisgICAgICAgICAgICAg
ICAgdGhyb3cgbmV3IEhpc3RvcnlFeGNlcHRpb24oIkZhaWxlZCB0byByZW5hbWUgY2FjaGUgdG1w
ZmlsZSIpOwogICAgICAgICAgICAgfQogICAgICAgICB9CiAgICAgfQpAQCAtMjEyLDggKzIxNSw5
IEBACiAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgIHJldHVybiByZWFkQ2FjaGUo
Y2FjaGUpOwogICAgICAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKLSAgICAgICAgICAg
ICAgICBPcGVuR3Jva0xvZ2dlci5nZXRMb2dnZXIoKS5sb2coTGV2ZWwuV0FSTklORywKLSAgICAg
ICAgICAgICAgICAgICAgICAgICJFcnJvciB3aGVuIHJlYWRpbmcgY2FjaGUgZmlsZSAnIiArIGNh
Y2hlLCBlKTsKKyAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZygiRXJyb3Igd2hlbiByZWFk
aW5nIGNhY2hlIGZpbGUgJyIgKyBjYWNoZSAKKyAgICAgICAgICAgICAgICAgICAgKyAiJzogIiAr
IGUuZ2V0TWVzc2FnZSgpKTsKKyAgICAgICAgICAgICAgICBsb2dnZXIubG9nKExldmVsLkZJTkUs
ICJnZXQiLCBlKTsKICAgICAgICAgICAgIH0KICAgICAgICAgfQogCkBAIC0yNzgsNyArMjgyLDgg
QEAKICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgIGRpciA9IG5ldyBGaWxlKGRpciwgZW52Lmdl
dFBhdGhSZWxhdGl2ZVRvU291cmNlUm9vdChuZXcgRmlsZShyZXBvcy5nZXREaXJlY3RvcnlOYW1l
KCkpLCAwKSk7CiAgICAgICAgIH0gY2F0Y2ggKElPRXhjZXB0aW9uIGUpIHsKLSAgICAgICAgICAg
IHRocm93IG5ldyBIaXN0b3J5RXhjZXB0aW9uKCJDb3VsZCBub3QgcmVzb2x2ZSAiK3JlcG9zLmdl
dERpcmVjdG9yeU5hbWUoKSsiIHJlbGF0aXZlIHRvIHNvdXJjZSByb290IiwgZSk7CisgICAgICAg
ICAgICB0aHJvdyBuZXcgSGlzdG9yeUV4Y2VwdGlvbigiQ291bGQgbm90IHJlc29sdmUgJyIKKyAg
ICAgICAgICAgICAgICArIHJlcG9zLmdldERpcmVjdG9yeU5hbWUoKSArICInIHJlbGF0aXZlIHRv
IHNvdXJjZSByb290IiwgZSk7CiAgICAgICAgIH0KICAgICAgICAgcmV0dXJuIGRpci5leGlzdHMo
KTsKICAgICB9CmRpZmYgLXIgNjE1NDkwMjZhYWZlIC1yIDI2MTExNjUwN2M3YSBzcmMvb3JnL29w
ZW5zb2xhcmlzL29wZW5ncm9rL2hpc3RvcnkvR2l0SGlzdG9yeVBhcnNlci5qYXZhCi0tLSBhL3Ny
Yy9vcmcvb3BlbnNvbGFyaXMvb3Blbmdyb2svaGlzdG9yeS9HaXRIaXN0b3J5UGFyc2VyLmphdmEJ
U3VuIEZlYiAxMiAwNDozNzozNiAyMDEyICswMTAwCisrKyBiL3NyYy9vcmcvb3BlbnNvbGFyaXMv
b3Blbmdyb2svaGlzdG9yeS9HaXRIaXN0b3J5UGFyc2VyLmphdmEJTW9uIEZlYiAxMyAwNjoxMjo0
NyAyMDEyICswMTAwCkBAIC0zMiw3ICszMiw4IEBACiBpbXBvcnQgamF2YS50ZXh0LlBhcnNlRXhj
ZXB0aW9uOwogaW1wb3J0IGphdmEudXRpbC5BcnJheUxpc3Q7CiBpbXBvcnQgamF2YS51dGlsLmxv
Z2dpbmcuTGV2ZWw7Ci1pbXBvcnQgb3JnLm9wZW5zb2xhcmlzLm9wZW5ncm9rLk9wZW5Hcm9rTG9n
Z2VyOworaW1wb3J0IGphdmEudXRpbC5sb2dnaW5nLkxvZ2dlcjsKKwogaW1wb3J0IG9yZy5vcGVu
c29sYXJpcy5vcGVuZ3Jvay5jb25maWd1cmF0aW9uLlJ1bnRpbWVFbnZpcm9ubWVudDsKIGltcG9y
dCBvcmcub3BlbnNvbGFyaXMub3Blbmdyb2sudXRpbC5FeGVjdXRvcjsKIGltcG9ydCBvcmcub3Bl
bnNvbGFyaXMub3Blbmdyb2sudXRpbC5JT1V0aWxzOwpAQCAtNDIsNyArNDMsNyBAQAogICogUGFy
c2UgYSBzdHJlYW0gb2YgR2l0IGxvZyBjb21tZW50cy4KICAqLwogY2xhc3MgR2l0SGlzdG9yeVBh
cnNlciBpbXBsZW1lbnRzIEV4ZWN1dG9yLlN0cmVhbUhhbmRsZXIgewotCisgICAgcHJpdmF0ZSBz
dGF0aWMgZmluYWwgTG9nZ2VyIGxvZ2dlciA9IExvZ2dlci5nZXRMb2dnZXIoR2l0SGlzdG9yeVBh
cnNlci5jbGFzcy5nZXROYW1lKCkpOwogICAgIHByaXZhdGUgZW51bSBQYXJzZVN0YXRlIHsKIAog
ICAgICAgICBIRUFERVIsIE1FU1NBR0UsIEZJTEVTCkBAIC05Nyw3ICs5OCw5IEBACiAgICAgICAg
ICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICBlbnRyeS5zZXREYXRl
KGRmLnBhcnNlKGRhdGVTdHJpbmcpKTsKICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoUGFy
c2VFeGNlcHRpb24gcGUpIHsKLSAgICAgICAgICAgICAgICAgICAgICAgIE9wZW5Hcm9rTG9nZ2Vy
LmdldExvZ2dlcigpLmxvZyhMZXZlbC5XQVJOSU5HLCAiRmFpbGVkIHRvIHBhcnNlIGF1dGhvciBk
YXRlOiAiICsgcywgcGUpOworICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmco
IkZhaWxlZCB0byBwYXJzZSBhdXRob3IgZGF0ZSAiICsgcyAKKyAgICAgICAgICAgICAgICAgICAg
ICAgICAgICArICI6ICIgKyBwZS5nZXRNZXNzYWdlKCkpOworICAgICAgICAgICAgICAgICAgICAg
ICAgbG9nZ2VyLmxvZyhMZXZlbC5GSU5FLCAicHJvY2VzcyIsIHBlKTsKICAgICAgICAgICAgICAg
ICAgICAgfQogICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoU3RyaW5nVXRpbHMuaXNPbmx5V2hp
dGVzcGFjZShzKSkgewogICAgICAgICAgICAgICAgICAgICAvLyBXZSBhcmUgZG9uZSByZWFkaW5n
IHRoZSBoZWFkaW5nLCBzdGFydCB0byByZWFkIHRoZSBtZXNzYWdlCkBAIC0xNTgsMTIgKzE2MSwx
MiBAQAogICAgICAgICAgICAgaW50IHN0YXR1cyA9IGV4ZWN1dG9yLmV4ZWModHJ1ZSwgdGhpcyk7
CiAKICAgICAgICAgICAgIGlmIChzdGF0dXMgIT0gMCkgewotICAgICAgICAgICAgICAgIHRocm93
IG5ldyBIaXN0b3J5RXhjZXB0aW9uKCJGYWlsZWQgdG8gZ2V0IGhpc3RvcnkgZm9yOiBcIiIgKwot
ICAgICAgICAgICAgICAgICAgICAgICAgZmlsZS5nZXRBYnNvbHV0ZVBhdGgoKSArICJcIiBFeGl0
IGNvZGU6ICIgKyBzdGF0dXMpOworICAgICAgICAgICAgICAgIHRocm93IG5ldyBIaXN0b3J5RXhj
ZXB0aW9uKCJGYWlsZWQgdG8gZ2V0IGhpc3RvcnkgZm9yICciICsKKyAgICAgICAgICAgICAgICAg
ICAgZmlsZS5nZXRBYnNvbHV0ZVBhdGgoKSArICInIC0gRXhpdCBjb2RlICIgKyBzdGF0dXMpOwog
ICAgICAgICAgICAgfQogICAgICAgICB9IGNhdGNoIChJT0V4Y2VwdGlvbiBlKSB7Ci0gICAgICAg
ICAgICB0aHJvdyBuZXcgSGlzdG9yeUV4Y2VwdGlvbigiRmFpbGVkIHRvIGdldCBoaXN0b3J5IGZv
cjogXCIiICsKLSAgICAgICAgICAgICAgICAgICAgZmlsZS5nZXRBYnNvbHV0ZVBhdGgoKSArICJc
IiIsIGUpOworICAgICAgICAgICAgdGhyb3cgbmV3IEhpc3RvcnlFeGNlcHRpb24oIkZhaWxlZCB0
byBnZXQgaGlzdG9yeSBmb3IgJyIgKworICAgICAgICAgICAgICAgIGZpbGUuZ2V0QWJzb2x1dGVQ
YXRoKCkgKyAiJyIsIGUpOwogICAgICAgICB9CiAKICAgICAgICAgcmV0dXJuIGhpc3Rvcnk7CmRp
ZmYgLXIgNjE1NDkwMjZhYWZlIC1yIDI2MTExNjUwN2M3YSBzcmMvb3JnL29wZW5zb2xhcmlzL29w
ZW5ncm9rL2hpc3RvcnkvR2l0UmVwb3NpdG9yeS5qYXZhCi0tLSBhL3NyYy9vcmcvb3BlbnNvbGFy
aXMvb3Blbmdyb2svaGlzdG9yeS9HaXRSZXBvc2l0b3J5LmphdmEJU3VuIEZlYiAxMiAwNDozNzoz
NiAyMDEyICswMTAwCisrKyBiL3NyYy9vcmcvb3BlbnNvbGFyaXMvb3Blbmdyb2svaGlzdG9yeS9H
aXRSZXBvc2l0b3J5LmphdmEJTW9uIEZlYiAxMyAwNjoxMjo0NyAyMDEyICswMTAwCkBAIC0zMywx
MCArMzMsMTAgQEAKIGltcG9ydCBqYXZhLnV0aWwuQXJyYXlMaXN0OwogaW1wb3J0IGphdmEudXRp
bC5MaXN0OwogaW1wb3J0IGphdmEudXRpbC5sb2dnaW5nLkxldmVsOworaW1wb3J0IGphdmEudXRp
bC5sb2dnaW5nLkxvZ2dlcjsKIGltcG9ydCBqYXZhLnV0aWwucmVnZXguTWF0Y2hlcjsKIGltcG9y
dCBqYXZhLnV0aWwucmVnZXguUGF0dGVybjsKIAotaW1wb3J0IG9yZy5vcGVuc29sYXJpcy5vcGVu
Z3Jvay5PcGVuR3Jva0xvZ2dlcjsKIGltcG9ydCBvcmcub3BlbnNvbGFyaXMub3Blbmdyb2sudXRp
bC5FeGVjdXRvcjsKIAogLyoqCkBAIC00NSw2ICs0NSw3IEBACiAgKi8KIHB1YmxpYyBjbGFzcyBH
aXRSZXBvc2l0b3J5IGV4dGVuZHMgUmVwb3NpdG9yeSB7CiAKKyAgICBwcml2YXRlIHN0YXRpYyBm
aW5hbCBMb2dnZXIgbG9nZ2VyID0gTG9nZ2VyLmdldExvZ2dlcihHaXRSZXBvc2l0b3J5LmNsYXNz
LmdldE5hbWUoKSk7CiAgICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgbG9uZyBzZXJpYWxWZXJzaW9u
VUlEID0gMUw7CiAgICAgLyoqIFRoZSBwcm9wZXJ0eSBuYW1lIHVzZWQgdG8gb2J0YWluIHRoZSBj
bGllbnQgY29tbWFuZCBmb3IgdGhpcyByZXBvc2l0b3J5LiAqLwogICAgIHB1YmxpYyBzdGF0aWMg
ZmluYWwgU3RyaW5nIENNRF9QUk9QRVJUWV9LRVkgPQpAQCAtODMsNyArODQsNyBAQAogCiAgICAg
ICAgIGludCBzdGF0dXMgPSBleGVjLmV4ZWMoKTsKICAgICAgICAgaWYgKHN0YXR1cyAhPSAwKSB7
Ci0gICAgICAgICAgICBPcGVuR3Jva0xvZ2dlci5nZXRMb2dnZXIoKS5sb2coTGV2ZWwuU0VWRVJF
LCAiRmFpbGVkIHRvIGdldCBibGFtZSBsaXN0IGluIHJlc29sdmluZyBjb3JyZWN0IHBhdGgiKTsK
KyAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKCJGYWlsZWQgdG8gZ2V0IGJsYW1lIGxpc3QgaW4g
cmVzb2x2aW5nIGNvcnJlY3QgcGF0aCIpOwogICAgICAgICAgICAgcmV0dXJuIHBhdGg7CiAgICAg
ICAgIH0KICAgICAgICAgQnVmZmVyZWRSZWFkZXIgaW4gPSBuZXcgQnVmZmVyZWRSZWFkZXIoZXhl
Yy5nZXRPdXRwdXRSZWFkZXIoKSk7CkBAIC0xOTgsOCArMTk5LDggQEAKIAogICAgICAgICAgICAg
cmV0ID0gbmV3IEJ5dGVBcnJheUlucHV0U3RyZWFtKG91dHB1dC50b0J5dGVBcnJheSgpKTsKICAg
ICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGV4cCkgewotICAgICAgICAgICAgT3Blbkdyb2tMb2dn
ZXIuZ2V0TG9nZ2VyKCkubG9nKExldmVsLlNFVkVSRSwKLSAgICAgICAgICAgICAgICAiRmFpbGVk
IHRvIGdldCBoaXN0b3J5OiAiICsgZXhwLmdldENsYXNzKCkudG9TdHJpbmcoKSwgZXhwKTsKKyAg
ICAgICAgICAgIGxvZ2dlci53YXJuaW5nKCJGYWlsZWQgdG8gZ2V0IGhpc3Rvcnk6ICIgKyBleHAu
Z2V0TWVzc2FnZSgpKTsKKyAgICAgICAgICAgIGxvZ2dlci5sb2coTGV2ZWwuRklORSwgImdldEhp
c3RvcnlHZXQiLCBleHApOwogICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgLy8gQ2xl
YW4gdXAgem9tYmllLXByb2Nlc3Nlcy4uLgogICAgICAgICAgICAgaWYgKHByb2Nlc3MgIT0gbnVs
bCkgewpAQCAtMjUyLDcgKzI1Myw3IEBACiAgICAgICAgICAgICBleGVjID0gbmV3IEV4ZWN1dG9y
KGNtZCwgZmlsZS5nZXRQYXJlbnRGaWxlKCkpOwogICAgICAgICAgICAgc3RhdHVzID0gZXhlYy5l
eGVjKCk7CiAgICAgICAgICAgICBpZiAoc3RhdHVzICE9IDApIHsKLSAgICAgICAgICAgICAgICBP
cGVuR3Jva0xvZ2dlci5nZXRMb2dnZXIoKS5sb2coTGV2ZWwuU0VWRVJFLCAiRmFpbGVkIHRvIGdl
dCBibGFtZSBsaXN0Iik7CisgICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoIkZhaWxlZCB0
byBnZXQgYmxhbWUgbGlzdCIpOwogICAgICAgICAgICAgfQogICAgICAgICAgICAgQnVmZmVyZWRS
ZWFkZXIgaW4gPSBuZXcgQnVmZmVyZWRSZWFkZXIoZXhlYy5nZXRPdXRwdXRSZWFkZXIoKSk7CiAg
ICAgICAgICAgICB0cnkgewpAQCAtMjc4LDcgKzI3OSw3IEBACiAgICAgICAgICAgICAgICAgICAg
ICAgICBleGVjID0gbmV3IEV4ZWN1dG9yKGNtZCwgZGlyZWN0b3J5KTsKICAgICAgICAgICAgICAg
ICAgICAgICAgIHN0YXR1cyA9IGV4ZWMuZXhlYygpOwogICAgICAgICAgICAgICAgICAgICAgICAg
aWYgKHN0YXR1cyAhPSAwKSB7Ci0gICAgICAgICAgICAgICAgICAgICAgICAgICAgT3Blbkdyb2tM
b2dnZXIuZ2V0TG9nZ2VyKCkubG9nKExldmVsLlNFVkVSRSwgIkZhaWxlZCB0byBnZXQgYmxhbWUg
ZGV0YWlscyBmb3IgbW9kaWZpZWQgZmlsZSBwYXRoIik7CisgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgbG9nZ2VyLndhcm5pbmcoIkZhaWxlZCB0byBnZXQgYmxhbWUgZGV0YWlscyBmb3IgbW9k
aWZpZWQgZmlsZSBwYXRoIik7CiAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg
ICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgfQpAQCAtMjg5LDkgKzI5
MCw4IEBACiAgICAgICAgIH0KIAogICAgICAgICBpZiAoc3RhdHVzICE9IDApIHsKLSAgICAgICAg
ICAgIE9wZW5Hcm9rTG9nZ2VyLmdldExvZ2dlcigpLmxvZyhMZXZlbC5XQVJOSU5HLAotICAgICAg
ICAgICAgICAgICJGYWlsZWQgdG8gZ2V0IGFubm90YXRpb25zIGZvcjogXCJ7MH1cIiBFeGl0IGNv
ZGU6IHsxfSIsCi0gICAgICAgICAgICAgICAgbmV3IE9iamVjdFtde2ZpbGUuZ2V0QWJzb2x1dGVQ
YXRoKCksIFN0cmluZy52YWx1ZU9mKHN0YXR1cyl9KTsKKyAgICAgICAgICAgIGxvZ2dlci53YXJu
aW5nKCJGYWlsZWQgdG8gZ2V0IGFubm90YXRpb25zIGZvciAnIgorICAgICAgICAgICAgICAgICsg
ZmlsZS5nZXRBYnNvbHV0ZVBhdGgoKSArICInIC0gRXhpdCBjb2RlICIgKyBzdGF0dXMpOwogICAg
ICAgICB9CiAKICAgICAgICAgcmV0dXJuIHBhcnNlQW5ub3RhdGlvbigKQEAgLTMxNCw5ICszMTQs
OSBAQAogICAgICAgICAgICAgICAgIFN0cmluZyBhdXRob3IgPSBtYXRjaGVyLmdyb3VwKDIpLnRy
aW0oKTsKICAgICAgICAgICAgICAgICByZXQuYWRkTGluZShyZXYsIGF1dGhvciwgdHJ1ZSk7CiAg
ICAgICAgICAgICB9IGVsc2UgewotICAgICAgICAgICAgICAgIE9wZW5Hcm9rTG9nZ2VyLmdldExv
Z2dlcigpLmxvZyhMZXZlbC5TRVZFUkUsCi0gICAgICAgICAgICAgICAgICAgICJFcnJvcjogZGlk
IG5vdCBmaW5kIGFubm90YXRpb24gaW4gbGluZSB7MH06IFt7MX1dIG9mIHsyfSIsCi0gICAgICAg
ICAgICAgICAgICAgIG5ldyBPYmplY3RbXXtTdHJpbmcudmFsdWVPZihsaW5lbm8pLCBsaW5lLCBm
aWxlTmFtZX0pOworICAgICAgICAgICAgICAgIGxvZ2dlci5sb2coTGV2ZWwuV0FSTklORywKKyAg
ICAgICAgICAgICAgICAgICAgIkRpZCBub3QgZmluZCBhbm5vdGF0aW9uIGluIGxpbmUgezB9IFt7
MX1dIG9mIHsyfSIsCisgICAgICAgICAgICAgICAgICAgIG5ldyBPYmplY3RbXSB7IFN0cmluZy52
YWx1ZU9mKGxpbmVubyksIGxpbmUsIGZpbGVOYW1lIH0pOwogICAgICAgICAgICAgfQogICAgICAg
ICB9CiAgICAgICAgIHJldHVybiByZXQ7CmRpZmYgLXIgNjE1NDkwMjZhYWZlIC1yIDI2MTExNjUw
N2M3YSBzcmMvb3JnL29wZW5zb2xhcmlzL29wZW5ncm9rL2hpc3RvcnkvSGlzdG9yeUVudHJ5Lmph
dmEKLS0tIGEvc3JjL29yZy9vcGVuc29sYXJpcy9vcGVuZ3Jvay9oaXN0b3J5L0hpc3RvcnlFbnRy
eS5qYXZhCVN1biBGZWIgMTIgMDQ6Mzc6MzYgMjAxMiArMDEwMAorKysgYi9zcmMvb3JnL29wZW5z
b2xhcmlzL29wZW5ncm9rL2hpc3RvcnkvSGlzdG9yeUVudHJ5LmphdmEJTW9uIEZlYiAxMyAwNjox
Mjo0NyAyMDEyICswMTAwCkBAIC0zMSw3ICszMSw2IEBACiBpbXBvcnQgamF2YS51dGlsLlRyZWVT
ZXQ7CiBpbXBvcnQgamF2YS51dGlsLmxvZ2dpbmcuTGV2ZWw7CiBpbXBvcnQgamF2YS51dGlsLmxv
Z2dpbmcuTG9nZ2VyOwotaW1wb3J0IG9yZy5vcGVuc29sYXJpcy5vcGVuZ3Jvay5PcGVuR3Jva0xv
Z2dlcjsKIAogLyoqCiAgKiBDb2xsZWN0IGFsbCBpbmZvcm1hdGlvbiBvZiBhIGdpdmVuIHJldmlz
aW9uCkBAIC03Myw4ICs3MiwxMCBAQAogICAgIH0KIAogICAgIHB1YmxpYyB2b2lkIGR1bXAoKSB7
Ci0gICAgICAgIExvZ2dlciBsb2cgPSBPcGVuR3Jva0xvZ2dlci5nZXRMb2dnZXIoKTsKLQorICAg
ICAgICBMb2dnZXIgbG9nID0gTG9nZ2VyLmdldExvZ2dlcihIaXN0b3J5RW50cnkuY2xhc3MuZ2V0
TmFtZSgpKTsKKyAgICAgICAgaWYgKCFsb2cuaXNMb2dnYWJsZShMZXZlbC5GSU5FKSkgeworICAg
ICAgICAgICAgcmV0dXJuOworICAgICAgICB9CiAgICAgICAgIGxvZy5sb2coTGV2ZWwuRklORSwg
Ikhpc3RvcnlFbnRyeSA6IHJldmlzaW9uICAgICAgID0gezB9IiwgcmV2aXNpb24pOwogICAgICAg
ICBsb2cubG9nKExldmVsLkZJTkUsICJIaXN0b3J5RW50cnkgOiBkYXRlICAgICAgICAgICA9IHsw
fSIsIGRhdGUpOwogICAgICAgICBsb2cubG9nKExldmVsLkZJTkUsICJIaXN0b3J5RW50cnkgOiBh
dXRob3IgICAgICAgICA9IHswfSIsIGF1dGhvcik7CmRpZmYgLXIgNjE1NDkwMjZhYWZlIC1yIDI2
MTExNjUwN2M3YSBzcmMvb3JnL29wZW5zb2xhcmlzL29wZW5ncm9rL2hpc3RvcnkvSGlzdG9yeUd1
cnUuamF2YQotLS0gYS9zcmMvb3JnL29wZW5zb2xhcmlzL29wZW5ncm9rL2hpc3RvcnkvSGlzdG9y
eUd1cnUuamF2YQlTdW4gRmViIDEyIDA0OjM3OjM2IDIwMTIgKzAxMDAKKysrIGIvc3JjL29yZy9v
cGVuc29sYXJpcy9vcGVuZ3Jvay9oaXN0b3J5L0hpc3RvcnlHdXJ1LmphdmEJTW9uIEZlYiAxMyAw
NjoxMjo0NyAyMDEyICswMTAwCkBAIC0zNiw3ICszNiw3IEBACiBpbXBvcnQgamF2YS51dGlsLmNv
bmN1cnJlbnQuVGltZVVuaXQ7CiBpbXBvcnQgamF2YS51dGlsLmxvZ2dpbmcuTGV2ZWw7CiBpbXBv
cnQgamF2YS51dGlsLmxvZ2dpbmcuTG9nZ2VyOwotaW1wb3J0IG9yZy5vcGVuc29sYXJpcy5vcGVu
Z3Jvay5PcGVuR3Jva0xvZ2dlcjsKKwogaW1wb3J0IG9yZy5vcGVuc29sYXJpcy5vcGVuZ3Jvay5j
b25maWd1cmF0aW9uLlJ1bnRpbWVFbnZpcm9ubWVudDsKIGltcG9ydCBvcmcub3BlbnNvbGFyaXMu
b3Blbmdyb2suaW5kZXguSWdub3JlZE5hbWVzOwogCkBAIC00Nyw3ICs0Nyw4IEBACiAgKiBAYXV0
aG9yIENoYW5kYW4KICAqLwogcHVibGljIGZpbmFsIGNsYXNzIEhpc3RvcnlHdXJ1IHsKLSAgICBw
cml2YXRlIHN0YXRpYyBmaW5hbCBMb2dnZXIgbG9nID0gT3Blbkdyb2tMb2dnZXIuZ2V0TG9nZ2Vy
KCk7CisgICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgTG9nZ2VyIGxvZ2dlciA9IAorICAgICAgICBM
b2dnZXIuZ2V0TG9nZ2VyKEhpc3RvcnlHdXJ1LmNsYXNzLmdldE5hbWUoKSk7CiAKICAgICAvKiog
VGhlIG9uZSBhbmQgb25seSBpbnN0YW5jZSBvZiB0aGUgSGlzdG9yeUd1cnUgKi8KICAgICBwcml2
YXRlIHN0YXRpYyBIaXN0b3J5R3VydSBpbnN0YW5jZSA9IG5ldyBIaXN0b3J5R3VydSgpOwpAQCAt
NzYsOCArNzcsOCBAQAogICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICBjYWNoZS5p
bml0aWFsaXplKCk7CiAgICAgICAgICAgICB9IGNhdGNoIChIaXN0b3J5RXhjZXB0aW9uIGhlKSB7
Ci0gICAgICAgICAgICAgICAgbG9nLmxvZyhMZXZlbC5XQVJOSU5HLAotICAgICAgICAgICAgICAg
ICAgICAgICAgIkZhaWxlZCB0byBpbml0aWFsaXplIHRoZSBoaXN0b3J5IGNhY2hlIiwgaGUpOwor
ICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKCJGYWlsZWQgdG8gaW5pdGlhbGl6ZSB0aGUg
aGlzdG9yeSBjYWNoZTogIiArIGhlLmdldE1lc3NhZ2UoKSk7CisgICAgICAgICAgICAgICAgbG9n
Z2VyLmxvZyhMZXZlbC5GSU5FLCAiSGlzdG9yeUd1cnUiLCBoZSk7CiAgICAgICAgICAgICAgICAg
Ly8gRmFpbGVkIHRvIGluaXRpYWxpemUsIHJ1biB3aXRob3V0IGEgaGlzdG9yeSBjYWNoZQogICAg
ICAgICAgICAgICAgIGNhY2hlID0gbnVsbDsKICAgICAgICAgICAgIH0KQEAgLTEzMSw4ICsxMzIs
NyBAQAogICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICBoaXN0ID0gcmVwb3MuZ2V0
SGlzdG9yeShmaWxlKTsKICAgICAgICAgICAgIH0gY2F0Y2ggKEhpc3RvcnlFeGNlcHRpb24gZXgp
IHsKLSAgICAgICAgICAgICAgICBMb2dnZXIuZ2V0TG9nZ2VyKEhpc3RvcnlHdXJ1LmNsYXNzLmdl
dE5hbWUoKSkubG9nKExldmVsLkZJTkVTVCwKLSAgICAgICAgICAgICAgICAgICAgIkNhbm5vdCBn
ZXQgbWVzc2FnZXMgZm9yIHRvb2x0aXA6ICIsIGV4KTsKKyAgICAgICAgICAgICAgICBsb2dnZXIu
bG9nKExldmVsLkZJTkVTVCwgIkNhbm5vdCBnZXQgbWVzc2FnZXMgZm9yIHRvb2x0aXAiLCBleCk7
CiAgICAgICAgICAgICB9CiAgICAgICAgICAgICBpZiAoaGlzdCAhPSBudWxsICYmIHJldCAhPSBu
dWxsKSB7CiAgICAgICAgICAgICAgU2V0PFN0cmluZz4gcmV2cz1yZXQuZ2V0UmV2aXNpb25zKCk7
CkBAIC0yOTAsMTkgKzI5MCwyMCBAQAogICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAg
ICByZXBvc2l0b3J5ID0gUmVwb3NpdG9yeUZhY3RvcnkuZ2V0UmVwb3NpdG9yeShmaWxlKTsKICAg
ICAgICAgICAgIH0gY2F0Y2ggKEluc3RhbnRpYXRpb25FeGNlcHRpb24gaWUpIHsKLSAgICAgICAg
ICAgICAgICBsb2cubG9nKExldmVsLldBUk5JTkcsICJDb3VsZCBub3QgY3JlYXRlIHJlcG9pdG9y
eSBmb3IgJyIKLSAgICAgICAgICAgICAgICAgICAgKyBmaWxlICsgIicsIGNvdWxkIG5vdCBpbnN0
YW50aWF0ZSB0aGUgcmVwb3NpdG9yeS4iLCBpZSk7CisgICAgICAgICAgICAgICAgbG9nZ2VyLndh
cm5pbmcoIkNvdWxkIG5vdCBjcmVhdGUgcmVwb2l0b3J5IGZvciAnIgorICAgICAgICAgICAgICAg
ICAgICArIGZpbGUgKyAiJywgY291bGQgbm90IGluc3RhbnRpYXRlIHRoZSByZXBvc2l0b3J5OiAi
CisgICAgICAgICAgICAgICAgICAgICsgaWUuZ2V0TWVzc2FnZSgpKTsKKyAgICAgICAgICAgICAg
ICBsb2dnZXIubG9nKExldmVsLkZJTkUsICJhZGRSZXBvc2l0b3JpZXMiLCBpZSk7CiAgICAgICAg
ICAgICB9IGNhdGNoIChJbGxlZ2FsQWNjZXNzRXhjZXB0aW9uIGlhZSkgewotICAgICAgICAgICAg
ICAgIGxvZy5sb2coTGV2ZWwuV0FSTklORywgIkNvdWxkIG5vdCBjcmVhdGUgcmVwb2l0b3J5IGZv
ciAnIgotICAgICAgICAgICAgICAgICAgICArIGZpbGUgKyAiJywgbWlzc2luZyBhY2Nlc3Mgcmln
aHRzLiIsIGlhZSk7CisgICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoIkNvdWxkIG5vdCBj
cmVhdGUgcmVwb2l0b3J5IGZvciAnIgorICAgICAgICAgICAgICAgICAgICArIGZpbGUgKyAiJywg
bWlzc2luZyBhY2Nlc3MgcmlnaHRzOiAiICsgaWFlLmdldE1lc3NhZ2UoKSk7CiAgICAgICAgICAg
ICB9CiAgICAgICAgICAgICBpZiAocmVwb3NpdG9yeSA9PSBudWxsKSB7CiAgICAgICAgICAgICAg
ICAgLy8gTm90IGEgcmVwb3NpdG9yeSwgc2VhcmNoIGl0J3Mgc3ViLWRpcnMKICAgICAgICAgICAg
ICAgICBpZiAoZmlsZS5pc0RpcmVjdG9yeSgpICYmICFpZ25vcmVkTmFtZXMuaWdub3JlKGZpbGUp
KSB7CiAgICAgICAgICAgICAgICAgICAgIEZpbGUgc3ViRmlsZXNbXSA9IGZpbGUubGlzdEZpbGVz
KCk7CiAgICAgICAgICAgICAgICAgICAgIGlmIChzdWJGaWxlcyA9PSBudWxsKSB7Ci0gICAgICAg
ICAgICAgICAgICAgICAgICBsb2cubG9nKExldmVsLldBUk5JTkcsCi0gICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIkZhaWxlZCB0byBnZXQgc3ViIGRpcmVjdG9yaWVzIGZvciAnIgorICAgICAg
ICAgICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoIkZhaWxlZCB0byBnZXQgc3ViIGRpcmVj
dG9yaWVzIGZvciAnIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgZmlsZS5nZXRBYnNv
bHV0ZVBhdGgoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgIicsIGNoZWNrIGFjY2Vz
cyBwZXJtaXNzaW9ucy4iKTsKICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChkZXB0aDw9
c2Nhbm5pbmdEZXB0aCkgewpAQCAtMzE0LDcgKzMxNSw3IEBACiAgICAgICAgICAgICAgICAgICAg
IFN0cmluZyBwYXRoID0gZmlsZS5nZXRDYW5vbmljYWxQYXRoKCk7CiAgICAgICAgICAgICAgICAg
ICAgIHJlcG9zaXRvcnkuc2V0RGlyZWN0b3J5TmFtZShwYXRoKTsKICAgICAgICAgICAgICAgICAg
ICAgaWYgKFJ1bnRpbWVFbnZpcm9ubWVudC5nZXRJbnN0YW5jZSgpLmlzVmVyYm9zZSgpKSB7Ci0g
ICAgICAgICAgICAgICAgICAgICAgICBsb2cubG9nKExldmVsLkNPTkZJRywgIkFkZGluZyA8ezB9
PiByZXBvc2l0b3J5OiA8ezF9PiIsCisgICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIubG9n
KExldmVsLkZJTkUsICJBZGRpbmcgPHswfT4gcmVwb3NpdG9yeTogPHsxfT4iLAogICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIG5ldyBPYmplY3RbXXtyZXBvc2l0b3J5LmdldENsYXNzKCkuZ2V0
TmFtZSgpLCBwYXRofSk7CiAgICAgICAgICAgICAgICAgICAgIH0KIApAQCAtMzI0LDggKzMyNSw3
IEBACiAgICAgICAgICAgICAgICAgICAgIGlmIChyZWN1cnNpdmVTZWFyY2ggJiYgcmVwb3NpdG9y
eS5zdXBwb3J0c1N1YlJlcG9zaXRvcmllcygpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICBG
aWxlIHN1YkZpbGVzW10gPSBmaWxlLmxpc3RGaWxlcygpOwogICAgICAgICAgICAgICAgICAgICAg
ICAgaWYgKHN1YkZpbGVzID09IG51bGwpIHsKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICBs
b2cubG9nKExldmVsLldBUk5JTkcsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJG
YWlsZWQgdG8gZ2V0IHN1YiBkaXJlY3RvcmllcyBmb3IgJyIKKyAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBsb2dnZXIud2FybmluZygiRmFpbGVkIHRvIGdldCBzdWIgZGlyZWN0b3JpZXMgZm9y
ICciCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgZmlsZS5nZXRBYnNvbHV0ZVBh
dGgoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICArICInLCBjaGVjayBhY2Nlc3Mg
cGVybWlzc2lvbnMuIik7CiAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGRlcHRo
PD1zY2FubmluZ0RlcHRoKSB7CkBAIC0zMzcsOSArMzM3LDEwIEBACiAgICAgICAgICAgICAgICAg
ICAgIH0KIAogICAgICAgICAgICAgICAgIH0gY2F0Y2ggKElPRXhjZXB0aW9uIGV4cCkgewotICAg
ICAgICAgICAgICAgICAgICBsb2cubG9nKExldmVsLldBUk5JTkcsICJGYWlsZWQgdG8gZ2V0IGNh
bm9uaWNhbCBwYXRoIGZvciAiCi0gICAgICAgICAgICAgICAgICAgICAgICArIGZpbGUuZ2V0QWJz
b2x1dGVQYXRoKCkgKyAiOiAiICsgZXhwLmdldE1lc3NhZ2UoKSk7Ci0gICAgICAgICAgICAgICAg
ICAgIGxvZy5sb2coTGV2ZWwuV0FSTklORywgIlJlcG9zaXRvcnkgd2lsbCBiZSBpZ25vcmVkLi4u
IiwgZXhwKTsKKyAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoIkZhaWxlZCB0byBn
ZXQgY2Fub25pY2FsIHBhdGggZm9yICciCisgICAgICAgICAgICAgICAgICAgICAgICArIGZpbGUu
Z2V0QWJzb2x1dGVQYXRoKCkgCisgICAgICAgICAgICAgICAgICAgICAgICArICInLiBSZXBvc2l0
b3J5IHdpbGwgYmUgaWdub3JlZDogIiArIGV4cC5nZXRNZXNzYWdlKCkpOworICAgICAgICAgICAg
ICAgICAgICBsb2dnZXIubG9nKExldmVsLkZJTkUsICJhZGRSZXBvc2l0b3JpZXMiLCBleHApOwog
ICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgIH0KICAgICAgICAgfQpAQCAtMzczLDIyICsz
NzQsMjMgQEAKIAogICAgICAgICAgICAgaWYgKHJlcG9zaXRvcnkuaXNXb3JraW5nKCkpIHsKICAg
ICAgICAgICAgICAgICBpZiAodmVyYm9zZSkgewotICAgICAgICAgICAgICAgICAgICBsb2cuaW5m
byhTdHJpbmcuZm9ybWF0KCJVcGRhdGUgJXMgcmVwb3NpdG9yeSBpbiAlcyIsCi0gICAgICAgICAg
ICAgICAgICAgICAgICB0eXBlLCBwYXRoKSk7CisgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5s
b2coTGV2ZWwuSU5GTywgIlVwZGF0ZSB7MH0gcmVwb3NpdG9yeSBpbiAnJ3sxfScnIiwKKyAgICAg
ICAgICAgICAgICAgICAgICAgIG5ldyBTdHJpbmdbXSB7IHR5cGUsIHBhdGggfSk7CiAgICAgICAg
ICAgICAgICAgfQogCiAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAg
cmVwb3NpdG9yeS51cGRhdGUoKTsKICAgICAgICAgICAgICAgICB9IGNhdGNoIChVbnN1cHBvcnRl
ZE9wZXJhdGlvbkV4Y2VwdGlvbiBlKSB7Ci0gICAgICAgICAgICAgICAgICAgIGxvZy53YXJuaW5n
KFN0cmluZy5mb3JtYXQoIlNraXBwaW5nIHVwZGF0ZSBvZiAlcyByZXBvc2l0b3J5IgotICAgICAg
ICAgICAgICAgICAgICAgICAgKyAiIGluICVzOiBOb3QgaW1wbGVtZW50ZWQiLCB0eXBlLCBwYXRo
KSk7CisgICAgICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKCJTa2lwcGluZyB1cGRhdGUg
b2YgIiArIHR5cGUgKyAiIHJlcG9zaXRvcnkiCisgICAgICAgICAgICAgICAgICAgICAgICArICIg
aW4gJyIgKyBwYXRoICsgIic6IE5vdCBpbXBsZW1lbnRlZCIpOwogICAgICAgICAgICAgICAgIH0g
Y2F0Y2ggKEV4Y2VwdGlvbiBlKSB7Ci0gICAgICAgICAgICAgICAgICAgIGxvZy5sb2coTGV2ZWwu
V0FSTklORywgIkFuIGVycm9yIG9jY3VyZWQgd2hpbGUgdXBkYXRpbmcgIgotICAgICAgICAgICAg
ICAgICAgICAgICAgKyBwYXRoICsgIiAoIiArIHR5cGUgKyAiKSIsIGUpOworICAgICAgICAgICAg
ICAgICAgICBsb2dnZXIud2FybmluZygiQW4gZXJyb3Igb2NjdXJlZCB3aGlsZSB1cGRhdGluZyAn
IgorICAgICAgICAgICAgICAgICAgICAgICAgKyBwYXRoICsgIicgKCIgKyB0eXBlICsgIik6ICIg
KyBlLmdldE1lc3NhZ2UoKSk7CisgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5sb2coTGV2ZWwu
RklORSwgInVwZGF0ZVJlcG9zaXRvcmllcyIsIGUpOwogICAgICAgICAgICAgICAgIH0KICAgICAg
ICAgICAgIH0gZWxzZSB7Ci0gICAgICAgICAgICAgICAgbG9nLndhcm5pbmcoU3RyaW5nLmZvcm1h
dCgiU2tpcHBpbmcgdXBkYXRlIG9mICVzIHJlcG9zaXRvcnkgaW4gIgotICAgICAgICAgICAgICAg
ICAgICArICIlczogTWlzc2luZyBTQ00gZGVwZW5kZW5jaWVzPyIsIHR5cGUsIHBhdGgpKTsKKyAg
ICAgICAgICAgICAgICBsb2dnZXIud2FybmluZygiU2tpcHBpbmcgdXBkYXRlIG9mICIgKyB0eXBl
ICsgIiByZXBvc2l0b3J5IGluICciCisgICAgICAgICAgICAgICAgICAgICsgcGF0aCArICInOiBN
aXNzaW5nIFNDTSBkZXBlbmRlbmNpZXM/Iik7CiAgICAgICAgICAgICB9CiAgICAgICAgIH0KICAg
ICB9CkBAIC00MDcsMjQgKzQwOSwyNSBAQAogCiAgICAgICAgICAgICBpZiAocmVwb3NpdG9yeS5p
c1dvcmtpbmcoKSkgewogICAgICAgICAgICAgICAgIGlmICh2ZXJib3NlKSB7Ci0gICAgICAgICAg
ICAgICAgICAgIGxvZy5pbmZvKFN0cmluZy5mb3JtYXQoIlVwZGF0ZSAlcyByZXBvc2l0b3J5IGlu
ICVzIiwgdHlwZSwKLSAgICAgICAgICAgICAgICAgICAgICAgIHJlcG9zaXRvcnkuZ2V0RGlyZWN0
b3J5TmFtZSgpKSk7CisgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5sb2coTGV2ZWwuSU5GTywg
IlVwZGF0ZSB7MH0gcmVwb3NpdG9yeSBpbiAnJ3sxfScnIiwgCisgICAgICAgICAgICAgICAgICAg
ICAgICBuZXcgU3RyaW5nW10geyB0eXBlLCByZXBvc2l0b3J5LmdldERpcmVjdG9yeU5hbWUoKX0p
OwogICAgICAgICAgICAgICAgIH0KIAogICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAg
ICAgICAgICAgIHJlcG9zaXRvcnkudXBkYXRlKCk7CiAgICAgICAgICAgICAgICAgfSBjYXRjaCAo
VW5zdXBwb3J0ZWRPcGVyYXRpb25FeGNlcHRpb24gZSkgewotICAgICAgICAgICAgICAgICAgICBs
b2cud2FybmluZyhTdHJpbmcuZm9ybWF0KCJTa2lwcGluZyB1cGRhdGUgb2YgJXMgcmVwb3NpdG9y
eSIKLSAgICAgICAgICAgICAgICAgICAgICAgICsgIiBpbiAlczogTm90IGltcGxlbWVudGVkIiwg
dHlwZSwKLSAgICAgICAgICAgICAgICAgICAgICAgIHJlcG9zaXRvcnkuZ2V0RGlyZWN0b3J5TmFt
ZSgpKSk7CisgICAgICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKCJTa2lwcGluZyB1cGRh
dGUgb2YgIiArIHR5cGUgKyAiIHJlcG9zaXRvcnkiCisgICAgICAgICAgICAgICAgICAgICAgICAr
ICIgaW4gJyIgKyByZXBvc2l0b3J5LmdldERpcmVjdG9yeU5hbWUoKSAKKyAgICAgICAgICAgICAg
ICAgICAgICAgICsgIic6IE5vdCBpbXBsZW1lbnRlZCIpOwogICAgICAgICAgICAgICAgIH0gY2F0
Y2ggKEV4Y2VwdGlvbiBlKSB7Ci0gICAgICAgICAgICAgICAgICAgIGxvZy5sb2coTGV2ZWwuV0FS
TklORywgIkFuIGVycm9yIG9jY3VyZWQgd2hpbGUgdXBkYXRpbmcgIgotICAgICAgICAgICAgICAg
ICAgICAgICAgKyByZXBvc2l0b3J5LmdldERpcmVjdG9yeU5hbWUoKSArICIgKCIgKyB0eXBlICsg
IikiLCBlKTsKKyAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoIkFuIGVycm9yIG9j
Y3VyZWQgd2hpbGUgdXBkYXRpbmcgJyIKKyAgICAgICAgICAgICAgICAgICAgICAgICsgcmVwb3Np
dG9yeS5nZXREaXJlY3RvcnlOYW1lKCkgKyAiJyAoIiArIHR5cGUgKyAiKTogIgorICAgICAgICAg
ICAgICAgICAgICAgICAgKyBlLmdldE1lc3NhZ2UoKSk7CisgICAgICAgICAgICAgIAkgICAgbG9n
Z2VyLmxvZyhMZXZlbC5GSU5FLCAidXBkYXRlUmVwb3NpdG9yaWVzIiwgZSk7CiAgICAgICAgICAg
ICAgICAgfQogICAgICAgICAgICAgfSBlbHNlIHsKLSAgICAgICAgICAgICAgICBsb2cud2Fybmlu
ZyhTdHJpbmcuZm9ybWF0KCJTa2lwcGluZyB1cGRhdGUgb2YgJXMgcmVwb3NpdG9yeSBpbiIKLSAg
ICAgICAgICAgICAgICAgICAgKyAiICVzOiBNaXNzaW5nIFNDTSBkZXBlbmRlbmNpZXM/IiwgdHlw
ZSwKLSAgICAgICAgICAgICAgICAgICAgcmVwb3NpdG9yeS5nZXREaXJlY3RvcnlOYW1lKCkpKTsK
KyAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZygiU2tpcHBpbmcgdXBkYXRlIG9mICIgKyB0
eXBlICsgIiByZXBvc2l0b3J5IGluICciCisgICAgICAgICAgICAgICAgICAgICsgcmVwb3NpdG9y
eS5nZXREaXJlY3RvcnlOYW1lKCkgKyAiJzogTWlzc2luZyBTQ00gZGVwZW5kZW5jaWVzPyIpOwog
ICAgICAgICAgICAgfQogICAgICAgICB9CiAgICAgfQpAQCAtNDQyLDI2ICs0NDUsMjYgQEAKICAg
ICAgICAgICAgIGxvbmcgc3RhcnQgPSBTeXN0ZW0uY3VycmVudFRpbWVNaWxsaXMoKTsKIAogICAg
ICAgICAgICAgaWYgKHZlcmJvc2UpIHsKLSAgICAgICAgICAgICAgICBsb2cubG9nKExldmVsLklO
Rk8sICJDcmVhdGUgaGlzdG9yeWNhY2hlIGZvciB7MH0gKHsxfSkiLAotICAgICAgICAgICAgICAg
ICAgICBuZXcgT2JqZWN0W117cGF0aCwgdHlwZX0pOworICAgICAgICAgICAgICAgIGxvZ2dlci5s
b2coTGV2ZWwuSU5GTywgIkNyZWF0ZSBoaXN0b3J5Y2FjaGUgZm9yICcnezB9JycgKHsxfSkiLAor
ICAgICAgICAgICAgICAgICAgICBuZXcgU3RyaW5nW117cGF0aCwgdHlwZX0pOwogICAgICAgICAg
ICAgfQogCiAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgIHJlcG9zaXRvcnkuY3Jl
YXRlQ2FjaGUoaGlzdG9yeUNhY2hlLCBzaW5jZVJldmlzaW9uKTsKICAgICAgICAgICAgIH0gY2F0
Y2ggKEV4Y2VwdGlvbiBlKSB7Ci0gICAgICAgICAgICAgICAgbG9nLmxvZyhMZXZlbC5XQVJOSU5H
LAotICAgICAgICAgICAgICAgICAgICAiQW4gZXJyb3Igb2NjdXJlZCB3aGlsZSBjcmVhdGluZyBj
YWNoZSBmb3IgIiArIHBhdGggKyAiICgiCi0gICAgICAgICAgICAgICAgICAgICsgdHlwZSArICIp
IiwgZSk7CisgICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoIkFuIGVycm9yIG9jY3VyZWQg
d2hpbGUgY3JlYXRpbmcgY2FjaGUgZm9yICciIAorICAgICAgICAgICAgICAgICAgICArIHBhdGgg
KyAiJyAoIiArIHR5cGUgKyAiKTogIiArIGUuZ2V0TWVzc2FnZSgpKTsKKyAgICAgICAgICAgICAg
ICBsb2dnZXIubG9nKExldmVsLkZJTkUsICJjcmVhdGVDYWNoZSIsIGUpOwogICAgICAgICAgICAg
fQogCiAgICAgICAgICAgICBpZiAodmVyYm9zZSkgewogICAgICAgICAgICAgICAgIGxvbmcgc3Rv
cCA9IFN5c3RlbS5jdXJyZW50VGltZU1pbGxpcygpOwotICAgICAgICAgICAgICAgIGxvZy5sb2co
TGV2ZWwuSU5GTywgIkNyZWF0aW5nIGhpc3RvcnljYWNoZSBmb3IgezB9IHRvb2sgKHsxfW1zKSIs
Ci0gICAgICAgICAgICAgICAgICAgIG5ldyBPYmplY3RbXXtwYXRoLCBTdHJpbmcudmFsdWVPZihz
dG9wIC0gc3RhcnQpfSk7CisgICAgICAgICAgICAgICAgbG9nZ2VyLmxvZyhMZXZlbC5JTkZPLCAi
Q3JlYXRpbmcgaGlzdG9yeWNhY2hlIGZvciAnJ3swfScnIHRvb2sgezF9bXMiLAorICAgICAgICAg
ICAgICAgICAgICBuZXcgU3RyaW5nW117cGF0aCwgU3RyaW5nLnZhbHVlT2Yoc3RvcCAtIHN0YXJ0
KX0pOwogICAgICAgICAgICAgfQogICAgICAgICB9IGVsc2UgewotICAgICAgICAgICAgbG9nLmxv
ZyhMZXZlbC5XQVJOSU5HLCAiU2tpcHBpbmcgY3JlYXRpb24gb2YgaGlzdG9yeWNhY2hlIG9mICIK
LSAgICAgICAgICAgICAgICArIHR5cGUgKyAiIHJlcG9zaXRvcnkgaW4gIiArIHBhdGggKyAiOiBN
aXNzaW5nIFNDTSBkZXBlbmRlbmNpZXM/Iik7CisgICAgICAgICAgICBsb2dnZXIud2FybmluZygi
U2tpcHBpbmcgY3JlYXRpb24gb2YgaGlzdG9yeWNhY2hlIG9mICIKKyAgICAgICAgICAgICAgICAr
IHR5cGUgKyAiIHJlcG9zaXRvcnkgaW4gJyIgKyBwYXRoICsgIic6IE1pc3NpbmcgU0NNIGRlcGVu
ZGVuY2llcz8iKTsKICAgICAgICAgfQogICAgIH0KIApAQCAtNDc0LDEwICs0NzcsOSBAQAogICAg
ICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICBsYXRlc3RSZXYgPSBoaXN0b3J5Q2FjaGUu
Z2V0TGF0ZXN0Q2FjaGVkUmV2aXNpb24ocmVwb3MpOwogICAgICAgICAgICAgfSBjYXRjaCAoSGlz
dG9yeUV4Y2VwdGlvbiBoZSkgewotICAgICAgICAgICAgICAgIGxvZy5sb2coTGV2ZWwuV0FSTklO
RywKLSAgICAgICAgICAgICAgICAgICAgICAgIFN0cmluZy5mb3JtYXQoCi0gICAgICAgICAgICAg
ICAgICAgICAgICAiRmFpbGVkIHRvIHJldHJpZXZlIGxhdGVzdCBjYWNoZWQgcmV2aXNpb24gZm9y
ICVzIiwKLSAgICAgICAgICAgICAgICAgICAgICAgIHJlcG9zLmdldERpcmVjdG9yeU5hbWUoKSks
IGhlKTsKKyAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZygiRmFpbGVkIHRvIHJldHJpZXZl
IGxhdGVzdCBjYWNoZWQgcmV2aXNpb24gZm9yICciCisgICAgICAgICAgICAgICAgICAgICsgcmVw
b3MuZ2V0RGlyZWN0b3J5TmFtZSgpICsgIic6ICIgKyBoZS5nZXRNZXNzYWdlKCkpOworICAgICAg
ICAgIAkgICAgbG9nZ2VyLmxvZyhMZXZlbC5GSU5FLCAiY3JlYXRlQ2FjaGVSZWFsIiwgaGUpOwog
ICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgfQogICAgICAgICAgICAgZXhl
Y3V0b3Iuc3VibWl0KG5ldyBSdW5uYWJsZSgpIHsKQEAgLTQ5Myw4ICs0OTUsOSBAQAogICAgICAg
ICAgICAgICAgIC8vIFdhaXQgZm9yZXZlcgogICAgICAgICAgICAgICAgIGV4ZWN1dG9yLmF3YWl0
VGVybWluYXRpb24oOTk5LFRpbWVVbml0LkRBWVMpOwogICAgICAgICAgICAgfSBjYXRjaCAoSW50
ZXJydXB0ZWRFeGNlcHRpb24gZXhwKSB7Ci0gICAgICAgICAgICAgICAgT3Blbkdyb2tMb2dnZXIu
Z2V0TG9nZ2VyKCkubG9nKExldmVsLldBUk5JTkcsCi0gICAgICAgICAgICAgICAgICAgICJSZWNl
aXZlZCBpbnRlcnJ1cHQgd2hpbGUgd2FpdGluZyBmb3IgZXhlY3V0b3IgdG8gZmluaXNoIiwgZXhw
KTsKKyAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZygiUmVjZWl2ZWQgaW50ZXJydXB0IHdo
aWxlIHdhaXRpbmcgZm9yIGV4ZWN1dG9yIHRvIGZpbmlzaDogIgorICAgICAgICAgICAgICAgICAg
ICArIGV4cC5nZXRNZXNzYWdlKCkpOworICAgICAgICAgIAkgICAgbG9nZ2VyLmxvZyhMZXZlbC5G
SU5FLCAiY3JlYXRlQ2FjaGVSZWFsIiwgZXhwKTsKICAgICAgICAgICAgIH0KICAgICAgICAgfQog
CkBAIC01MDMsOCArNTA2LDkgQEAKICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgIGhpc3RvcnlD
YWNoZS5vcHRpbWl6ZSgpOwogICAgICAgICB9IGNhdGNoIChIaXN0b3J5RXhjZXB0aW9uIGhlKSB7
Ci0gICAgICAgICAgICBPcGVuR3Jva0xvZ2dlci5nZXRMb2dnZXIoKS5sb2coTGV2ZWwuV0FSTklO
RywKLSAgICAgICAgICAgICAgICAgICAgIkZhaWxlZCBvcHRpbWl6aW5nIHRoZSBoaXN0b3J5IGNh
Y2hlIGRhdGFiYXNlIiwgaGUpOworICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoIkZhaWxlZCBv
cHRpbWl6aW5nIHRoZSBoaXN0b3J5IGNhY2hlIGRhdGFiYXNlOiAiCisgICAgICAgICAgICAgICAg
KyBoZS5nZXRNZXNzYWdlKCkpOworICAgICAgIAkgICAgbG9nZ2VyLmxvZyhMZXZlbC5GSU5FLCAi
Y3JlYXRlQ2FjaGVSZWFsIiwgaGUpOwogICAgICAgICB9CiAgICAgfQogCkBAIC01MjksMTAgKzUz
MywxMCBAQAogICAgICAgICBmb3IgKFJlcG9zaXRvcnkgciA6IHJlcG9zKSB7CiAgICAgICAgICAg
ICB0cnkgewogICAgICAgICAgICAgICAgIGNhY2hlLmNsZWFyKHIpOwotICAgICAgICAgICAgICAg
IGxvZy5pbmZvKCJIaXN0b3J5IGNhY2hlIGZvciAiICsgci5nZXREaXJlY3RvcnlOYW1lKCkgKyAi
IGNsZWFyZWQuIik7CisgICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oIkhpc3RvcnkgY2FjaGUg
Zm9yICciICsgci5nZXREaXJlY3RvcnlOYW1lKCkgKyAiJyBjbGVhcmVkLiIpOwogICAgICAgICAg
ICAgfSBjYXRjaCAoSGlzdG9yeUV4Y2VwdGlvbiBlKSB7Ci0gICAgICAgICAgICAgICAgbG9nLndh
cm5pbmcoIkNsZWFyaW5nIGhpc3RvcnkgY2FjaGUgZm9yIHJlcG9zaXRvcnkgIiArCi0gICAgICAg
ICAgICAgICAgICAgIHIuZ2V0RGlyZWN0b3J5TmFtZSgpICsgIiBmYWlsZWQ6ICIgKyBlLmdldExv
Y2FsaXplZE1lc3NhZ2UoKSk7CisgICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoIkNsZWFy
aW5nIGhpc3RvcnkgY2FjaGUgZm9yIHJlcG9zaXRvcnkgJyIgKworICAgICAgICAgICAgICAgICAg
ICByLmdldERpcmVjdG9yeU5hbWUoKSArICInIGZhaWxlZDogIiArIGUuZ2V0TG9jYWxpemVkTWVz
c2FnZSgpKTsKICAgICAgICAgICAgIH0KICAgICAgICAgfQogICAgICAgICBpbnZhbGlkYXRlUmVw
b3NpdG9yaWVzKHJlcG9zKTsKQEAgLTU1Niw4ICs1NjAsOCBAQAogICAgICAgICAgICAgRmlsZSBm
ID0gbmV3IEZpbGUocm9vdCwgZmlsZSk7CiAgICAgICAgICAgICBSZXBvc2l0b3J5IHIgPSBnZXRS
ZXBvc2l0b3J5KGYpOwogICAgICAgICAgICAgaWYgKHIgPT0gbnVsbCkgewotICAgICAgICAgICAg
ICAgIGxvZy5sb2coTGV2ZWwuV0FSTklORywgIkNvdWxkIG5vdCBsb2NhdGUgYSByZXBvc2l0b3J5
IGZvciB7MH0iLAotICAgICAgICAgICAgICAgICAgICBmLmdldEFic29sdXRlUGF0aCgpKTsKKyAg
ICAgICAgICAgICAgICBsb2dnZXIud2FybmluZygiQ291bGQgbm90IGxvY2F0ZSBhIHJlcG9zaXRv
cnkgZm9yICciIAorICAgICAgICAgICAgICAgICAgICArIGYuZ2V0QWJzb2x1dGVQYXRoKCkgKyAi
JyIpOwogICAgICAgICAgICAgfSBlbHNlIGlmICghcmVwb3MuY29udGFpbnMocikpewogICAgICAg
ICAgICAgICAgIHJlcG9zLmFkZChyKTsKICAgICAgICAgICAgIH0KQEAgLTYxMCw3ICs2MTQsOCBA
QAogICAgICAgICB0cnkgewogICAgICAgICAgICAgZmlsZSA9IHBhdGguZ2V0Q2Fub25pY2FsRmls
ZSgpOwogICAgICAgICB9IGNhdGNoIChJT0V4Y2VwdGlvbiBlKSB7Ci0gICAgICAgICAgICBsb2cu
bG9nKExldmVsLldBUk5JTkcsICJGYWlsZWQgdG8gZ2V0IGNhbm9uaWNhbCBwYXRoIGZvciAiICsg
cGF0aCwgZSk7CisgICAgICAgICAgICBsb2dnZXIud2FybmluZygiRmFpbGVkIHRvIGdldCBjYW5v
bmljYWwgcGF0aCBmb3IgJyIgKyBwYXRoICsgIic6ICIKKyAgICAgICAgICAgICAgICArIGUuZ2V0
TG9jYWxpemVkTWVzc2FnZSgpKTsKICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICB9
CiAgICAgICAgIHdoaWxlIChmaWxlICE9IG51bGwpIHsKQEAgLTY0MCwyMCArNjQ1LDIyIEBACiAg
ICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgUmVwb3NpdG9yeSByID0g
UmVwb3NpdG9yeUZhY3RvcnkuZ2V0UmVwb3NpdG9yeShpKTsKICAgICAgICAgICAgICAgICAgICAg
aWYgKHIgPT0gbnVsbCkgewotICAgICAgICAgICAgICAgICAgICAgICAgbG9nLmxvZyhMZXZlbC5X
QVJOSU5HLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICJGYWlsZWQgdG8gaW5zdGFuY2lh
dGUgaW50ZXJuYWwgcmVwb3NpdG9yeSBkYXRhIGZvciAiCi0gICAgICAgICAgICAgICAgICAgICAg
ICAgICAgKyBpLmdldFR5cGUoKSArICIgaW4gIiArIGkuZ2V0RGlyZWN0b3J5TmFtZSgpKTsKKyAg
ICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKCJGYWlsZWQgdG8gaW5zdGFuY2lh
dGUgaW50ZXJuYWwgcmVwb3NpdG9yeSBkYXRhIGZvciAiCisgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgKyBpLmdldFR5cGUoKSArICIgaW4gJyIgKyBpLmdldERpcmVjdG9yeU5hbWUoKSArICIn
Iik7CiAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAg
ICBucmVwLnB1dChyLmdldERpcmVjdG9yeU5hbWUoKSwgcik7CiAgICAgICAgICAgICAgICAgICAg
IH0KICAgICAgICAgICAgICAgICB9IGNhdGNoIChJbnN0YW50aWF0aW9uRXhjZXB0aW9uIGV4KSB7
Ci0gICAgICAgICAgICAgICAgICAgIGxvZy5sb2coTGV2ZWwuV0FSTklORywgIkNvdWxkIG5vdCBj
cmVhdGUgIiArIGkuZ2V0VHlwZSgpCisgICAgICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5n
KCJDb3VsZCBub3QgY3JlYXRlICIgKyBpLmdldFR5cGUoKQogICAgICAgICAgICAgICAgICAgICAg
ICAgKyAiIGZvciAnIiArIGkuZ2V0RGlyZWN0b3J5TmFtZSgpCi0gICAgICAgICAgICAgICAgICAg
ICAgICArICInLCBjb3VsZCBub3QgaW5zdGFudGlhdGUgdGhlIHJlcG9zaXRvcnkuIiwgZXgpOwor
ICAgICAgICAgICAgICAgICAgICAgICAgKyAiJywgY291bGQgbm90IGluc3RhbnRpYXRlIHRoZSBy
ZXBvc2l0b3J5OiAiCisgICAgICAgICAgICAgICAgICAgICAgICArIGV4LmdldE1lc3NhZ2UoKSk7
CisgICAgICAgICAgICAgICAJICAgIGxvZ2dlci5sb2coTGV2ZWwuRklORSwgImludmFsaWRhdGVS
ZXBvc2l0b3JpZXMiLCBleCk7CiAgICAgICAgICAgICAgICAgfSBjYXRjaCAoSWxsZWdhbEFjY2Vz
c0V4Y2VwdGlvbiBpYWUpIHsKLSAgICAgICAgICAgICAgICAgICAgbG9nLmxvZyhMZXZlbC5XQVJO
SU5HLCAiQ291bGQgbm90IGNyZWF0ZSAiICsgaS5nZXRUeXBlKCkKKyAgICAgICAgICAgICAgICAg
ICAgbG9nZ2VyLndhcm5pbmcoIkNvdWxkIG5vdCBjcmVhdGUgIiArIGkuZ2V0VHlwZSgpCiAgICAg
ICAgICAgICAgICAgICAgICAgICArICIgZm9yICciICsgaS5nZXREaXJlY3RvcnlOYW1lKCkKLSAg
ICAgICAgICAgICAgICAgICAgICAgICsgIicsIG1pc3NpbmcgYWNjZXNzIHJpZ2h0cy4iLCBpYWUp
OworICAgICAgICAgICAgICAgICAgICAgICAgKyAiJywgbWlzc2luZyBhY2Nlc3MgcmlnaHRzOiAi
ICsgaWFlLmdldE1lc3NhZ2UoKSk7CisgICAgICAgICAgICAgICAJICAgIGxvZ2dlci5sb2coTGV2
ZWwuRklORSwgImludmFsaWRhdGVSZXBvc2l0b3JpZXMiLCBpYWUpOwogICAgICAgICAgICAgICAg
IH0KICAgICAgICAgICAgIH0KICAgICAgICAgICAgIHJlcG9zaXRvcmllcyA9IG5yZXA7CmRpZmYg
LXIgNjE1NDkwMjZhYWZlIC1yIDI2MTExNjUwN2M3YSBzcmMvb3JnL29wZW5zb2xhcmlzL29wZW5n
cm9rL2hpc3RvcnkvSkRCQ0hpc3RvcnlDYWNoZS5qYXZhCi0tLSBhL3NyYy9vcmcvb3BlbnNvbGFy
aXMvb3Blbmdyb2svaGlzdG9yeS9KREJDSGlzdG9yeUNhY2hlLmphdmEJU3VuIEZlYiAxMiAwNDoz
NzozNiAyMDEyICswMTAwCisrKyBiL3NyYy9vcmcvb3BlbnNvbGFyaXMvb3Blbmdyb2svaGlzdG9y
eS9KREJDSGlzdG9yeUNhY2hlLmphdmEJTW9uIEZlYiAxMyAwNjoxMjo0NyAyMDEyICswMTAwCkBA
IC00NCw3ICs0NCw3IEBACiBpbXBvcnQgamF2YS51dGlsLmNvbmN1cnJlbnQuYXRvbWljLkF0b21p
Y0ludGVnZXI7CiBpbXBvcnQgamF2YS51dGlsLmxvZ2dpbmcuTGV2ZWw7CiBpbXBvcnQgamF2YS51
dGlsLmxvZ2dpbmcuTG9nZ2VyOwotaW1wb3J0IG9yZy5vcGVuc29sYXJpcy5vcGVuZ3Jvay5PcGVu
R3Jva0xvZ2dlcjsKKwogaW1wb3J0IG9yZy5vcGVuc29sYXJpcy5vcGVuZ3Jvay5jb25maWd1cmF0
aW9uLlJ1bnRpbWVFbnZpcm9ubWVudDsKIGltcG9ydCBvcmcub3BlbnNvbGFyaXMub3Blbmdyb2su
amRiYy5Db25uZWN0aW9uTWFuYWdlcjsKIGltcG9ydCBvcmcub3BlbnNvbGFyaXMub3Blbmdyb2su
amRiYy5Db25uZWN0aW9uUmVzb3VyY2U7CkBAIC01NCw2ICs1NCw3IEBACiAKIGNsYXNzIEpEQkNI
aXN0b3J5Q2FjaGUgaW1wbGVtZW50cyBIaXN0b3J5Q2FjaGUgewogCisgICAgcHJpdmF0ZSBzdGF0
aWMgZmluYWwgTG9nZ2VyIGxvZ2dlciA9IExvZ2dlci5nZXRMb2dnZXIoSkRCQ0hpc3RvcnlDYWNo
ZS5jbGFzcy5nZXROYW1lKCkpOwogICAgIC8qKiBUaGUgc2NoZW1hIGluIHdoaWNoIHRoZSB0YWJs
ZXMgbGl2ZS4gKi8KICAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBTdHJpbmcgU0NIRU1BID0gIk9Q
RU5HUk9LIjsKIApAQCAtMTY2LDkgKzE2Nyw4IEBACiAgICAgICAgIH0gd2hpbGUgKCFpc1RyYW5z
aWVudCAmJiB0ICE9IG51bGwpOwogCiAgICAgICAgIGlmIChpc1RyYW5zaWVudCAmJiBhdHRlbXB0
Tm8gPCBNQVhfUkVUUklFUykgewotICAgICAgICAgICAgTG9nZ2VyIGxvZ2dlciA9IE9wZW5Hcm9r
TG9nZ2VyLmdldExvZ2dlcigpOwogICAgICAgICAgICAgbG9nZ2VyLmluZm8oIlRyYW5zaWVudCBk
YXRhYmFzZSBmYWlsdXJlIGRldGVjdGVkLiBSZXRyeWluZy4iKTsKLSAgICAgICAgICAgIGxvZ2dl
ci5sb2coTGV2ZWwuRklORSwgIlRyYW5zaWVudCBkYXRhYmFzZSBmYWlsdXJlIGRldGFpbHM6Iiwg
c3FsZSk7CisgICAgICAgICAgICBsb2dnZXIubG9nKExldmVsLkZJTkUsICJUcmFuc2llbnQgZGF0
YWJhc2UgZmFpbHVyZSBkZXRhaWxzIiwgc3FsZSk7CiAgICAgICAgIH0gZWxzZSB7CiAgICAgICAg
ICAgICB0aHJvdyBzcWxlOwogICAgICAgICB9CmRpZmYgLXIgNjE1NDkwMjZhYWZlIC1yIDI2MTEx
NjUwN2M3YSBzcmMvb3JnL29wZW5zb2xhcmlzL29wZW5ncm9rL2hpc3RvcnkvTWVyY3VyaWFsSGlz
dG9yeVBhcnNlci5qYXZhCi0tLSBhL3NyYy9vcmcvb3BlbnNvbGFyaXMvb3Blbmdyb2svaGlzdG9y
eS9NZXJjdXJpYWxIaXN0b3J5UGFyc2VyLmphdmEJU3VuIEZlYiAxMiAwNDozNzozNiAyMDEyICsw
MTAwCisrKyBiL3NyYy9vcmcvb3BlbnNvbGFyaXMvb3Blbmdyb2svaGlzdG9yeS9NZXJjdXJpYWxI
aXN0b3J5UGFyc2VyLmphdmEJTW9uIEZlYiAxMyAwNjoxMjo0NyAyMDEyICswMTAwCkBAIC0zNSw3
ICszNSw4IEBACiBpbXBvcnQgamF2YS51dGlsLkRhdGU7CiBpbXBvcnQgamF2YS51dGlsLkxpc3Q7
CiBpbXBvcnQgamF2YS51dGlsLmxvZ2dpbmcuTGV2ZWw7Ci1pbXBvcnQgb3JnLm9wZW5zb2xhcmlz
Lm9wZW5ncm9rLk9wZW5Hcm9rTG9nZ2VyOworaW1wb3J0IGphdmEudXRpbC5sb2dnaW5nLkxvZ2dl
cjsKKwogaW1wb3J0IG9yZy5vcGVuc29sYXJpcy5vcGVuZ3Jvay5jb25maWd1cmF0aW9uLlJ1bnRp
bWVFbnZpcm9ubWVudDsKIGltcG9ydCBvcmcub3BlbnNvbGFyaXMub3Blbmdyb2sudXRpbC5FeGVj
dXRvcjsKIApAQCAtNDMsNyArNDQsNyBAQAogICogUGFyc2UgYSBzdHJlYW0gb2YgbWVyY3VyaWFs
IGxvZyBjb21tZW50cy4KICAqLwogY2xhc3MgTWVyY3VyaWFsSGlzdG9yeVBhcnNlciBpbXBsZW1l
bnRzIEV4ZWN1dG9yLlN0cmVhbUhhbmRsZXIgewotCisgICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwg
TG9nZ2VyIGxvZ2dlciA9IExvZ2dlci5nZXRMb2dnZXIoTWVyY3VyaWFsSGlzdG9yeVBhcnNlci5j
bGFzcy5nZXROYW1lKCkpOwogICAgIC8qKiBQcmVmaXggd2hpY2ggaWRlbnRpZmllcyBsaW5lcyB3
aXRoIHRoZSBkZXNjcmlwdGlvbiBvZiBhIGNvbW1pdC4gKi8KICAgICBwcml2YXRlIHN0YXRpYyBm
aW5hbCBTdHJpbmcgREVTQ19QUkVGSVggPSAiZGVzY3JpcHRpb246ICI7CiAKQEAgLTczLDEyICs3
NCwxMiBAQAogICAgICAgICAgICAgaW50IHN0YXR1cyA9IGV4ZWN1dG9yLmV4ZWModHJ1ZSwgdGhp
cyk7CiAKICAgICAgICAgICAgIGlmIChzdGF0dXMgIT0gMCkgewotICAgICAgICAgICAgICAgIHRo
cm93IG5ldyBIaXN0b3J5RXhjZXB0aW9uKCJGYWlsZWQgdG8gZ2V0IGhpc3RvcnkgZm9yOiBcIiIg
KwotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGUuZ2V0QWJz
b2x1dGVQYXRoKCkgKyAiXCIgRXhpdCBjb2RlOiAiICsgc3RhdHVzKTsKKyAgICAgICAgICAgICAg
ICB0aHJvdyBuZXcgSGlzdG9yeUV4Y2VwdGlvbigiRmFpbGVkIHRvIGdldCBoaXN0b3J5IGZvciAn
IiArCisgICAgICAgICAgICAgICAgICAgIGZpbGUuZ2V0QWJzb2x1dGVQYXRoKCkgKyAiJyAtIEV4
aXQgY29kZSAiICsgc3RhdHVzKTsKICAgICAgICAgICAgIH0KICAgICAgICAgfSBjYXRjaCAoSU9F
eGNlcHRpb24gZSkgewotICAgICAgICAgICAgdGhyb3cgbmV3IEhpc3RvcnlFeGNlcHRpb24oIkZh
aWxlZCB0byBnZXQgaGlzdG9yeSBmb3I6IFwiIiArCi0gICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICBmaWxlLmdldEFic29sdXRlUGF0aCgpICsgIlwiIiwgZSk7CisgICAgICAg
ICAgICB0aHJvdyBuZXcgSGlzdG9yeUV4Y2VwdGlvbigiRmFpbGVkIHRvIGdldCBoaXN0b3J5IGZv
ciAnIiArCisgICAgICAgICAgICAgICAgZmlsZS5nZXRBYnNvbHV0ZVBhdGgoKSArICInIiwgZSk7
CiAgICAgICAgIH0KIAogICAgICAgICAvLyBJZiBhIGNoYW5nZXNldCB0byBzdGFydCBmcm9tIGlz
IHNwZWNpZmllZCwgcmVtb3ZlIHRoYXQgY2hhbmdlc2V0CkBAIC0xMjAsNyArMTIxLDggQEAKICAg
ICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICBkYXRlID0gZGYucGFyc2Uo
cy5zdWJzdHJpbmcoImRhdGU6Ii5sZW5ndGgoKSkudHJpbSgpKTsKICAgICAgICAgICAgICAgICB9
IGNhdGNoIChQYXJzZUV4Y2VwdGlvbiBwZSkgewotICAgICAgICAgICAgICAgICAgICBPcGVuR3Jv
a0xvZ2dlci5nZXRMb2dnZXIoKS5sb2coTGV2ZWwuV0FSTklORywgIkNvdWxkIG5vdCBwYXJzZSBk
YXRlOiAiICsgcywgcGUpOworICAgICAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZygiQ291
bGQgbm90IHBhcnNlIGRhdGUgIiArIHMgKyAiOiAiICsgcGUuZ2V0TWVzc2FnZSgpKTsKKyAgICAg
ICAgICAgICAgICAgICAgbG9nZ2VyLmxvZyhMZXZlbC5GSU5FLCAicHJvY2Vzc1N0cmVhbSIsIHBl
KTsKICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgZW50cnkuc2V0RGF0ZShkYXRl
KTsKICAgICAgICAgICAgIH0gZWxzZSBpZiAocy5zdGFydHNXaXRoKCJmaWxlczoiKSAmJiBlbnRy
eSAhPSBudWxsKSB7CmRpZmYgLXIgNjE1NDkwMjZhYWZlIC1yIDI2MTExNjUwN2M3YSBzcmMvb3Jn
L29wZW5zb2xhcmlzL29wZW5ncm9rL2hpc3RvcnkvTWVyY3VyaWFsUmVwb3NpdG9yeS5qYXZhCi0t
LSBhL3NyYy9vcmcvb3BlbnNvbGFyaXMvb3Blbmdyb2svaGlzdG9yeS9NZXJjdXJpYWxSZXBvc2l0
b3J5LmphdmEJU3VuIEZlYiAxMiAwNDozNzozNiAyMDEyICswMTAwCisrKyBiL3NyYy9vcmcvb3Bl
bnNvbGFyaXMvb3Blbmdyb2svaGlzdG9yeS9NZXJjdXJpYWxSZXBvc2l0b3J5LmphdmEJTW9uIEZl
YiAxMyAwNjoxMjo0NyAyMDEyICswMTAwCkBAIC0zMiwxMSArMzIsMTAgQEAKIGltcG9ydCBqYXZh
LnV0aWwuQXJyYXlMaXN0OwogaW1wb3J0IGphdmEudXRpbC5IYXNoTWFwOwogaW1wb3J0IGphdmEu
dXRpbC5MaXN0OwotaW1wb3J0IGphdmEudXRpbC5sb2dnaW5nLkxldmVsOworaW1wb3J0IGphdmEu
dXRpbC5sb2dnaW5nLkxvZ2dlcjsKIGltcG9ydCBqYXZhLnV0aWwucmVnZXguTWF0Y2hlcjsKIGlt
cG9ydCBqYXZhLnV0aWwucmVnZXguUGF0dGVybjsKIAotaW1wb3J0IG9yZy5vcGVuc29sYXJpcy5v
cGVuZ3Jvay5PcGVuR3Jva0xvZ2dlcjsKIGltcG9ydCBvcmcub3BlbnNvbGFyaXMub3Blbmdyb2su
dXRpbC5FeGVjdXRvcjsKIGltcG9ydCBvcmcub3BlbnNvbGFyaXMub3Blbmdyb2sudXRpbC5JT1V0
aWxzOwogaW1wb3J0IG9yZy5vcGVuc29sYXJpcy5vcGVuZ3Jvay53ZWIuVXRpbDsKQEAgLTQ2LDYg
KzQ1LDcgQEAKICAqCiAgKi8KIHB1YmxpYyBjbGFzcyBNZXJjdXJpYWxSZXBvc2l0b3J5IGV4dGVu
ZHMgUmVwb3NpdG9yeSB7CisgICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgTG9nZ2VyIGxvZ2dlciA9
IExvZ2dlci5nZXRMb2dnZXIoTWVyY3VyaWFsUmVwb3NpdG9yeS5jbGFzcy5nZXROYW1lKCkpOwog
ICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGxvbmcgc2VyaWFsVmVyc2lvblVJRCA9IDFMOwogCiAg
ICAgLyoqIFRoZSBwcm9wZXJ0eSBuYW1lIHVzZWQgdG8gb2J0YWluIHRoZSBjbGllbnQgY29tbWFu
ZCBmb3IgdGhpc3JlcG9zaXRvcnkuICovCkBAIC0xMDYsOCArMTA2LDcgQEAKICAgICAgICAgICAg
ICAgICBjbWQuYWRkKCJ0aXA6IiArIHBhcnRzWzBdKTsKICAgICAgICAgICAgIH0gZWxzZSB7CiAg
ICAgICAgICAgICAgICAgdGhyb3cgbmV3IEhpc3RvcnlFeGNlcHRpb24oCi0gICAgICAgICAgICAg
ICAgICAgICAgICAiRG9uJ3Qga25vdyBob3cgdG8gcGFyc2UgY2hhbmdlc2V0IGlkZW50aWZpZXI6
ICIgKwotICAgICAgICAgICAgICAgICAgICAgICAgY2hhbmdlc2V0KTsKKyAgICAgICAgICAgICAg
ICAgICAgIkRvbid0IGtub3cgaG93IHRvIHBhcnNlIGNoYW5nZXNldCBpZGVudGlmaWVyICIgKyBj
aGFuZ2VzZXQpOwogICAgICAgICAgICAgfQogICAgICAgICB9CiAKQEAgLTE1Miw4ICsxNTEsNyBA
QAogCiAgICAgICAgICAgICByZXQgPSBuZXcgQnl0ZUFycmF5SW5wdXRTdHJlYW0ob3V0LnRvQnl0
ZUFycmF5KCkpOwogICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZXhwKSB7Ci0gICAgICAgICAg
ICBPcGVuR3Jva0xvZ2dlci5nZXRMb2dnZXIoKS5sb2coTGV2ZWwuU0VWRVJFLAotICAgICAgICAg
ICAgICAgICJGYWlsZWQgdG8gZ2V0IGhpc3Rvcnk6ICIgKyBleHAuZ2V0Q2xhc3MoKS50b1N0cmlu
ZygpKTsKKyAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKCJGYWlsZWQgdG8gZ2V0IGhpc3Rvcnk6
ICIgKyBleHAuZ2V0TWVzc2FnZSgpKTsKICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAg
IElPVXRpbHMuY2xvc2UoaW4pOwogICAgICAgICAgICAgLy8gQ2xlYW4gdXAgem9tYmllLXByb2Nl
c3Nlcy4uLgpAQCAtMjE2LDggKzIxNCw3IEBACiAgICAgICAgICAgICAgICAgcmV2cy5wdXQoZS5n
ZXRSZXZpc2lvbigpLnJlcGxhY2VGaXJzdCgiOlthLWYwLTldKyIsICIiKSwgZSk7CiAgICAgICAg
ICAgICB9CiAJfSBjYXRjaCAoSGlzdG9yeUV4Y2VwdGlvbiBoZSkgewotICAgICAgICAgICAgT3Bl
bkdyb2tMb2dnZXIuZ2V0TG9nZ2VyKCkubG9nKExldmVsLlNFVkVSRSwKLSAgICAgICAgICAgICAg
ICAiRXJyb3I6IGNhbm5vdCBnZXQgaGlzdG9yeSBmb3IgZmlsZSAiICsgZmlsZSk7CisgICAgICAg
ICAgICBsb2dnZXIud2FybmluZygiQ2Fubm90IGdldCBoaXN0b3J5IGZvciBmaWxlICciICsgZmls
ZSArICInIik7CiAJICAgIHJldHVybiBudWxsOwogCX0KIApAQCAtMjQwLDkgKzIzNyw4IEBACiAJ
ICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICByZXQuYWRkTGluZShyZXYsIFV0aWwu
Z2V0RW1haWwoYXV0aG9yLnRyaW0oKSksIHRydWUpOwogICAgICAgICAgICAgICAgIH0gZWxzZSB7
Ci0gICAgICAgICAgICAgICAgICAgIE9wZW5Hcm9rTG9nZ2VyLmdldExvZ2dlcigpLmxvZyhMZXZl
bC5TRVZFUkUsCi0gICAgICAgICAgICAgICAgICAgICAgICAiRXJyb3I6IGRpZCBub3QgZmluZCBh
bm5vdGF0aW9uIGluIGxpbmUgIgotICAgICAgICAgICAgICAgICAgICAgICAgKyBsaW5lbm8gKyAi
OiBbIiArIGxpbmUgKyAiXSIpOworICAgICAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZygi
RGlkIG5vdCBmaW5kIGFubm90YXRpb24gaW4gbGluZSAiCisgICAgICAgICAgICAgICAgICAgICAg
ICArIGxpbmVubyArICIgWyIgKyBsaW5lICsgIl0iKTsKICAgICAgICAgICAgICAgICB9CiAgICAg
ICAgICAgICB9CiAgICAgICAgIH0gZmluYWxseSB7CmRpZmYgLXIgNjE1NDkwMjZhYWZlIC1yIDI2
MTExNjUwN2M3YSBzcmMvb3JnL29wZW5zb2xhcmlzL29wZW5ncm9rL2hpc3RvcnkvTW9ub3RvbmVI
aXN0b3J5UGFyc2VyLmphdmEKLS0tIGEvc3JjL29yZy9vcGVuc29sYXJpcy9vcGVuZ3Jvay9oaXN0
b3J5L01vbm90b25lSGlzdG9yeVBhcnNlci5qYXZhCVN1biBGZWIgMTIgMDQ6Mzc6MzYgMjAxMiAr
MDEwMAorKysgYi9zcmMvb3JnL29wZW5zb2xhcmlzL29wZW5ncm9rL2hpc3RvcnkvTW9ub3RvbmVI
aXN0b3J5UGFyc2VyLmphdmEJTW9uIEZlYiAxMyAwNjoxMjo0NyAyMDEyICswMTAwCkBAIC0zNSw3
ICszNSw4IEBACiBpbXBvcnQgamF2YS51dGlsLkRhdGU7CiBpbXBvcnQgamF2YS51dGlsLkxpc3Q7
CiBpbXBvcnQgamF2YS51dGlsLmxvZ2dpbmcuTGV2ZWw7Ci1pbXBvcnQgb3JnLm9wZW5zb2xhcmlz
Lm9wZW5ncm9rLk9wZW5Hcm9rTG9nZ2VyOworaW1wb3J0IGphdmEudXRpbC5sb2dnaW5nLkxvZ2dl
cjsKKwogaW1wb3J0IG9yZy5vcGVuc29sYXJpcy5vcGVuZ3Jvay5jb25maWd1cmF0aW9uLlJ1bnRp
bWVFbnZpcm9ubWVudDsKIGltcG9ydCBvcmcub3BlbnNvbGFyaXMub3Blbmdyb2sudXRpbC5FeGVj
dXRvcjsKIApAQCAtNDYsNiArNDcsNyBAQAogICovCiBjbGFzcyBNb25vdG9uZUhpc3RvcnlQYXJz
ZXIgaW1wbGVtZW50cyBFeGVjdXRvci5TdHJlYW1IYW5kbGVyIHsKIAorICAgIHByaXZhdGUgc3Rh
dGljIGZpbmFsIExvZ2dlciBsb2dnZXIgPSBMb2dnZXIuZ2V0TG9nZ2VyKE1vbm90b25lSGlzdG9y
eVBhcnNlci5jbGFzcy5nZXROYW1lKCkpOwogICAgIHByaXZhdGUgTGlzdDxIaXN0b3J5RW50cnk+
IGVudHJpZXMgPSBuZXcgQXJyYXlMaXN0PEhpc3RvcnlFbnRyeT4oKTsgLy9OT1BNRAogICAgIHBy
aXZhdGUgZmluYWwgTW9ub3RvbmVSZXBvc2l0b3J5IHJlcG9zaXRvcnk7CiAgICAgcHJpdmF0ZSBm
aW5hbCBTdHJpbmcgbXlkaXI7CkBAIC03MiwxMiArNzQsMTIgQEAKICAgICAgICAgICAgIGludCBz
dGF0dXMgPSBleGVjdXRvci5leGVjKHRydWUsIHRoaXMpOwogCiAgICAgICAgICAgICBpZiAoc3Rh
dHVzICE9IDApIHsKLSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSGlzdG9yeUV4Y2VwdGlvbigi
RmFpbGVkIHRvIGdldCBoaXN0b3J5IGZvcjogXCIiICsKLSAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICBmaWxlLmdldEFic29sdXRlUGF0aCgpICsgIlwiIEV4aXQgY29k
ZTogIiArIHN0YXR1cyk7CisgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEhpc3RvcnlFeGNlcHRp
b24oIkZhaWxlZCB0byBnZXQgaGlzdG9yeSBmb3IgJyIgCisgICAgICAgICAgICAgICAgICAgICsg
ZmlsZS5nZXRBYnNvbHV0ZVBhdGgoKSArICInIC0gRXhpdCBjb2RlICIgKyBzdGF0dXMpOwogICAg
ICAgICAgICAgfQogICAgICAgICB9IGNhdGNoIChJT0V4Y2VwdGlvbiBlKSB7Ci0gICAgICAgICAg
ICB0aHJvdyBuZXcgSGlzdG9yeUV4Y2VwdGlvbigiRmFpbGVkIHRvIGdldCBoaXN0b3J5IGZvcjog
XCIiICsKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGUuZ2V0QWJz
b2x1dGVQYXRoKCkgKyAiXCIiLCBlKTsKKyAgICAgICAgICAgIHRocm93IG5ldyBIaXN0b3J5RXhj
ZXB0aW9uKCJGYWlsZWQgdG8gZ2V0IGhpc3RvcnkgZm9yICciIAorICAgICAgICAgICAgICAgICsg
ZmlsZS5nZXRBYnNvbHV0ZVBhdGgoKSArICInIiwgZSk7CiAgICAgICAgIH0KIAogICAgICAgICBy
ZXR1cm4gbmV3IEhpc3RvcnkoZW50cmllcyk7CkBAIC0xMzIsNyArMTM0LDkgQEAKICAgICAgICAg
ICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0ZSA9
IGRmLnBhcnNlKHMuc3Vic3RyaW5nKCJkYXRlOiIubGVuZ3RoKCkpLnRyaW0oKSk7CiAgICAgICAg
ICAgICAgICAgICAgICAgICB9IGNhdGNoIChQYXJzZUV4Y2VwdGlvbiBwZSkgewotICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIE9wZW5Hcm9rTG9nZ2VyLmdldExvZ2dlcigpLmxvZyhMZXZlbC5X
QVJOSU5HLCAiQ291bGQgbm90IHBhcnNlIGRhdGU6ICIgKyBzLCBwZSk7CisgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoIkNvdWxkIG5vdCBwYXJzZSBkYXRlICIgKyBz
IAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICArICI6ICIgKyBwZS5nZXRNZXNzYWdl
KCkpOworICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5sb2coTGV2ZWwuRklORSwg
InByb2Nlc3NTdHJlYW0iLCBwZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAg
ICAgICAgICAgICAgICAgICBlbnRyeS5zZXREYXRlKGRhdGUpOwogICAgICAgICAgICAgICAgICAg
ICAgICAgKytzdGF0ZTsKQEAgLTE2Niw3ICsxNzAsNyBAQAogICAgICAgICAgICAgICAgICAgICBl
bnRyeS5hcHBlbmRNZXNzYWdlKHMpOwogICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAg
ICAgICAgICAgICBkZWZhdWx0OgotICAgICAgICAgICAgICAgICAgICBPcGVuR3Jva0xvZ2dlci5n
ZXRMb2dnZXIoKS53YXJuaW5nKCJVbmtub3duIHBhcnNlciBzdGF0ZTogIiArIHN0YXRlKTsKKyAg
ICAgICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoIlVua25vd24gcGFyc2VyIHN0YXRlICIg
KyBzdGF0ZSk7CiAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgfQogICAg
ICAgICB9CmRpZmYgLXIgNjE1NDkwMjZhYWZlIC1yIDI2MTExNjUwN2M3YSBzcmMvb3JnL29wZW5z
b2xhcmlzL29wZW5ncm9rL2hpc3RvcnkvTW9ub3RvbmVSZXBvc2l0b3J5LmphdmEKLS0tIGEvc3Jj
L29yZy9vcGVuc29sYXJpcy9vcGVuZ3Jvay9oaXN0b3J5L01vbm90b25lUmVwb3NpdG9yeS5qYXZh
CVN1biBGZWIgMTIgMDQ6Mzc6MzYgMjAxMiArMDEwMAorKysgYi9zcmMvb3JnL29wZW5zb2xhcmlz
L29wZW5ncm9rL2hpc3RvcnkvTW9ub3RvbmVSZXBvc2l0b3J5LmphdmEJTW9uIEZlYiAxMyAwNjox
Mjo0NyAyMDEyICswMTAwCkBAIC0zMiw5ICszMiwxMCBAQAogaW1wb3J0IGphdmEudXRpbC5BcnJh
eUxpc3Q7CiBpbXBvcnQgamF2YS51dGlsLkxpc3Q7CiBpbXBvcnQgamF2YS51dGlsLmxvZ2dpbmcu
TGV2ZWw7CitpbXBvcnQgamF2YS51dGlsLmxvZ2dpbmcuTG9nZ2VyOwogaW1wb3J0IGphdmEudXRp
bC5yZWdleC5NYXRjaGVyOwogaW1wb3J0IGphdmEudXRpbC5yZWdleC5QYXR0ZXJuOwotaW1wb3J0
IG9yZy5vcGVuc29sYXJpcy5vcGVuZ3Jvay5PcGVuR3Jva0xvZ2dlcjsKKwogaW1wb3J0IG9yZy5v
cGVuc29sYXJpcy5vcGVuZ3Jvay51dGlsLkV4ZWN1dG9yOwogaW1wb3J0IG9yZy5vcGVuc29sYXJp
cy5vcGVuZ3Jvay51dGlsLklPVXRpbHM7CiAKQEAgLTQ1LDYgKzQ2LDcgQEAKICAqLwogcHVibGlj
IGNsYXNzIE1vbm90b25lUmVwb3NpdG9yeSBleHRlbmRzIFJlcG9zaXRvcnkgewogCisgICAgcHJp
dmF0ZSBzdGF0aWMgZmluYWwgTG9nZ2VyIGxvZ2dlciA9IExvZ2dlci5nZXRMb2dnZXIoTW9ub3Rv
bmVSZXBvc2l0b3J5LmNsYXNzLmdldE5hbWUoKSk7CiAgICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwg
bG9uZyBzZXJpYWxWZXJzaW9uVUlEID0gMUw7CiAgICAgLyoqIFRoZSBwcm9wZXJ0eSBuYW1lIHVz
ZWQgdG8gb2J0YWluIHRoZSBjbGllbnQgY29tbWFuZCBmb3IgdGhpcyByZXBvc2l0b3J5LiAqLwog
ICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgU3RyaW5nIENNRF9QUk9QRVJUWV9LRVkgPQpAQCAtODgs
OCArOTAsNyBAQAogCiAgICAgICAgICAgICByZXQgPSBuZXcgQnVmZmVyZWRJbnB1dFN0cmVhbShu
ZXcgQnl0ZUFycmF5SW5wdXRTdHJlYW0ob3V0LnRvQnl0ZUFycmF5KCkpKTsKICAgICAgICAgfSBj
YXRjaCAoRXhjZXB0aW9uIGV4cCkgewotICAgICAgICAgICAgT3Blbkdyb2tMb2dnZXIuZ2V0TG9n
Z2VyKCkubG9nKExldmVsLlNFVkVSRSwKLSAgICAgICAgICAgICAgICAiRmFpbGVkIHRvIGdldCBo
aXN0b3J5OiAiICsgZXhwLmdldENsYXNzKCkudG9TdHJpbmcoKSk7CisgICAgICAgICAgICBsb2dn
ZXIud2FybmluZygiRmFpbGVkIHRvIGdldCBoaXN0b3J5OiAiICsgZXhwLmdldE1lc3NhZ2UoKSk7
CiAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICBJT1V0aWxzLmNsb3NlKGluKTsKICAg
ICAgICAgICAgIC8vIENsZWFuIHVwIHpvbWJpZS1wcm9jZXNzZXMuLi4KQEAgLTE2NiwxMSArMTY3
LDkgQEAKICAgICAgICAgICAgIGluID0gbmV3IEJ1ZmZlcmVkUmVhZGVyKGV4ZWN1dG9yLmdldE91
dHB1dFJlYWRlcigpKTsKICAgICAgICAgICAgIHJldCA9IG5ldyBBbm5vdGF0aW9uKGZpbGUuZ2V0
TmFtZSgpKTsKICAgICAgICAgICAgIFN0cmluZyBsaW5lOwotICAgICAgICAgICAgaW50IGxpbmVu
byA9IDA7CiAgICAgICAgICAgICBTdHJpbmcgYXV0aG9yID0gbnVsbDsKICAgICAgICAgICAgIFN0
cmluZyByZXYgPSBudWxsOwogICAgICAgICAgICAgd2hpbGUgKChsaW5lID0gaW4ucmVhZExpbmUo
KSkgIT0gbnVsbCkgewotICAgICAgICAgICAgICAgICsrbGluZW5vOwogICAgICAgICAgICAgICAg
IE1hdGNoZXIgbWF0Y2hlciA9IEFOTk9UQVRJT05fUEFUVEVSTi5tYXRjaGVyKGxpbmUpOwogICAg
ICAgICAgICAgICAgIGlmIChtYXRjaGVyLmZpbmQoKSkgewogICAgICAgICAgICAgICAgICAgICBy
ZXYgPSBtYXRjaGVyLmdyb3VwKDEpOwpkaWZmIC1yIDYxNTQ5MDI2YWFmZSAtciAyNjExMTY1MDdj
N2Egc3JjL29yZy9vcGVuc29sYXJpcy9vcGVuZ3Jvay9oaXN0b3J5L1BlcmZvcmNlUmVwb3NpdG9y
eS5qYXZhCi0tLSBhL3NyYy9vcmcvb3BlbnNvbGFyaXMvb3Blbmdyb2svaGlzdG9yeS9QZXJmb3Jj
ZVJlcG9zaXRvcnkuamF2YQlTdW4gRmViIDEyIDA0OjM3OjM2IDIwMTIgKzAxMDAKKysrIGIvc3Jj
L29yZy9vcGVuc29sYXJpcy9vcGVuZ3Jvay9oaXN0b3J5L1BlcmZvcmNlUmVwb3NpdG9yeS5qYXZh
CU1vbiBGZWIgMTMgMDY6MTI6NDcgMjAxMiArMDEwMApAQCAtMzEsMTAgKzMxLDEwIEBACiBpbXBv
cnQgamF2YS51dGlsLkhhc2hNYXA7CiBpbXBvcnQgamF2YS51dGlsLkxpc3Q7CiBpbXBvcnQgamF2
YS51dGlsLmxvZ2dpbmcuTGV2ZWw7CitpbXBvcnQgamF2YS51dGlsLmxvZ2dpbmcuTG9nZ2VyOwog
aW1wb3J0IGphdmEudXRpbC5yZWdleC5NYXRjaGVyOwogaW1wb3J0IGphdmEudXRpbC5yZWdleC5Q
YXR0ZXJuOwogCi1pbXBvcnQgb3JnLm9wZW5zb2xhcmlzLm9wZW5ncm9rLk9wZW5Hcm9rTG9nZ2Vy
OwogaW1wb3J0IG9yZy5vcGVuc29sYXJpcy5vcGVuZ3Jvay51dGlsLkV4ZWN1dG9yOwogaW1wb3J0
IG9yZy5vcGVuc29sYXJpcy5vcGVuZ3Jvay51dGlsLklPVXRpbHM7CiAKQEAgLTQ1LDYgKzQ1LDcg
QEAKICAqLwogcHVibGljIGNsYXNzIFBlcmZvcmNlUmVwb3NpdG9yeSBleHRlbmRzIFJlcG9zaXRv
cnkgewogCisgICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgTG9nZ2VyIGxvZ2dlciA9IExvZ2dlci5n
ZXRMb2dnZXIoUGVyZm9yY2VSZXBvc2l0b3J5LmNsYXNzLmdldE5hbWUoKSk7CiAgICAgcHJpdmF0
ZSBzdGF0aWMgZmluYWwgbG9uZyBzZXJpYWxWZXJzaW9uVUlEID0gMUw7CiAgICAgLyoqIFRoZSBw
cm9wZXJ0eSBuYW1lIHVzZWQgdG8gb2J0YWluIHRoZSBjbGllbnQgY29tbWFuZCBmb3IgdGhpcyBy
ZXBvc2l0b3J5LiAqLwogICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgU3RyaW5nIENNRF9QUk9QRVJU
WV9LRVkgPQpAQCAtOTMsMTQgKzk0LDE0IEBACiAgICAgICAgICAgICAgICAgICAgIFN0cmluZyBh
dXRob3IgPSByZXZBdXRob3IuZ2V0KHJldmlzaW9uKTsKICAgICAgICAgICAgICAgICAgICAgYS5h
ZGRMaW5lKHJldmlzaW9uLCBhdXRob3IsIHRydWUpOwogICAgICAgICAgICAgICAgIH0gZWxzZSB7
Ci0gICAgICAgICAgICAgICAgICAgIE9wZW5Hcm9rTG9nZ2VyLmdldExvZ2dlcigpLmxvZyhMZXZl
bC5TRVZFUkUsCi0gICAgICAgICAgICAgICAgICAgICAgICAiRXJyb3I6IGRpZCBub3QgZmluZCBh
bm5vdGF0aW9uIGluIGxpbmUgIgotICAgICAgICAgICAgICAgICAgICAgICAgKyBsaW5lbm8gKyAi
OiBbIiArIGxpbmUgKyAiXSIpOworICAgICAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZygi
RGlkIG5vdCBmaW5kIGFubm90YXRpb24gaW4gbGluZSAiCisgICAgICAgICAgICAgICAgICAgICAg
ICArIGxpbmVubyArICIgWyIgKyBsaW5lICsgIl0iKTsKICAgICAgICAgICAgICAgICB9CiAgICAg
ICAgICAgICB9CiAgICAgICAgIH0gY2F0Y2ggKElPRXhjZXB0aW9uIGUpIHsKLSAgICAgICAgICAg
IE9wZW5Hcm9rTG9nZ2VyLmdldExvZ2dlcigpLmxvZyhMZXZlbC5TRVZFUkUsCi0gICAgICAgICAg
ICAgICAgICAgICJFcnJvcjogQ291bGQgbm90IHJlYWQgYW5ub3RhdGlvbnMgZm9yICIgKyBmaWxl
LCBlKTsKKyAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKCJDb3VsZCBub3QgcmVhZCBhbm5vdGF0
aW9ucyBmb3IgJyIgKyBmaWxlICsgIic6ICIKKyAgICAgICAgICAgICAgICArIGUuZ2V0TWVzc2Fn
ZSgpKTsKKyAgICAgICAgICAgIGxvZ2dlci5sb2coTGV2ZWwuRklORSwgImFubm90YXRlIiwgZSk7
CiAgICAgICAgIH0KICAgICAgICAgSU9VdGlscy5jbG9zZShyZWFkZXIpOwogICAgICAgICByZXR1
cm4gYTsKZGlmZiAtciA2MTU0OTAyNmFhZmUgLXIgMjYxMTE2NTA3YzdhIHNyYy9vcmcvb3BlbnNv
bGFyaXMvb3Blbmdyb2svaGlzdG9yeS9SQ1NIaXN0b3J5UGFyc2VyLmphdmEKLS0tIGEvc3JjL29y
Zy9vcGVuc29sYXJpcy9vcGVuZ3Jvay9oaXN0b3J5L1JDU0hpc3RvcnlQYXJzZXIuamF2YQlTdW4g
RmViIDEyIDA0OjM3OjM2IDIwMTIgKzAxMDAKKysrIGIvc3JjL29yZy9vcGVuc29sYXJpcy9vcGVu
Z3Jvay9oaXN0b3J5L1JDU0hpc3RvcnlQYXJzZXIuamF2YQlNb24gRmViIDEzIDA2OjEyOjQ3IDIw
MTIgKzAxMDAKQEAgLTMyLDExICszMiwxMiBAQAogaW1wb3J0IGphdmEudXRpbC5MaXN0OwogaW1w
b3J0IGphdmEudXRpbC5UcmVlTWFwOwogaW1wb3J0IGphdmEudXRpbC5sb2dnaW5nLkxldmVsOwor
aW1wb3J0IGphdmEudXRpbC5sb2dnaW5nLkxvZ2dlcjsKKwogaW1wb3J0IG9yZy5hcGFjaGUuY29t
bW9ucy5qcmNzLnJjcy5BcmNoaXZlOwogaW1wb3J0IG9yZy5hcGFjaGUuY29tbW9ucy5qcmNzLnJj
cy5Ob2RlOwogaW1wb3J0IG9yZy5hcGFjaGUuY29tbW9ucy5qcmNzLnJjcy5QYXJzZUV4Y2VwdGlv
bjsKIGltcG9ydCBvcmcuYXBhY2hlLmNvbW1vbnMuanJjcy5yY3MuVmVyc2lvbjsKLWltcG9ydCBv
cmcub3BlbnNvbGFyaXMub3Blbmdyb2suT3Blbkdyb2tMb2dnZXI7CiBpbXBvcnQgb3JnLm9wZW5z
b2xhcmlzLm9wZW5ncm9rLnV0aWwuSU9VdGlsczsKIAogCkBAIC00NSw2ICs0Niw3IEBACiAgKi8K
IGNsYXNzIFJDU0hpc3RvcnlQYXJzZXIgewogCisgICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgTG9n
Z2VyIGxvZ2dlciA9IExvZ2dlci5nZXRMb2dnZXIoUkNTSGlzdG9yeVBhcnNlci5jbGFzcy5nZXRO
YW1lKCkpOwogICAgIHByaXZhdGUgc3RhdGljIEZpbGUgcmVhZENWU1Jvb3QoRmlsZSByb290LCBG
aWxlIENWU2RpciwgU3RyaW5nIG5hbWUpIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgIFN0
cmluZyBjdnNyb290ID0gcmVhZEZpcnN0TGluZShyb290KTsKIApAQCAtOTIsNyArOTQsNyBAQAog
ICAgICAgICAgICAgcmV0dXJuIGhpc3Rvcnk7CiAgICAgICAgIH0gY2F0Y2ggKFBhcnNlRXhjZXB0
aW9uIHBlKSB7CiAgICAgICAgICAgICB0aHJvdyBSQ1NSZXBvc2l0b3J5LndyYXBJbklPRXhjZXB0
aW9uKAotICAgICAgICAgICAgICAgICAgICAiQ291bGQgbm90IHBhcnNlIGZpbGUgIiArIGZpbGUu
Z2V0UGF0aCgpLCBwZSk7CisgICAgICAgICAgICAgICAgIkNvdWxkIG5vdCBwYXJzZSBmaWxlICci
ICsgZmlsZS5nZXRQYXRoKCkgKyAiJyIsIHBlKTsKICAgICAgICAgfQogICAgIH0KIApAQCAtMTQz
LDggKzE0NSw5IEBACiAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgfQogICAgICAgICB9
IGNhdGNoIChFeGNlcHRpb24gZSkgewotICAgICAgICAgICAgT3Blbkdyb2tMb2dnZXIuZ2V0TG9n
Z2VyKCkubG9nKExldmVsLldBUk5JTkcsCi0gICAgICAgICAgICAgICAgICAgICJGYWlsZWQgdG8g
cmV0cmlldmUgQ1ZTIGZpbGUgb2YgcGFyZW50OiAiICsgcGFyZW50ICsgIiwgbmFtZTogIiArIG5h
bWUsIGUpOworICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoIkZhaWxlZCB0byByZXRyaWV2ZSBD
VlMgZmlsZSBvZiBwYXJlbnQgJyIgKyBwYXJlbnQgCisgICAgICAgICAgICAgICAgKyAiJywgbmFt
ZSAnIiArIG5hbWUgKyAiJzogIiArIGUuZ2V0TWVzc2FnZSgpKTsKKyAgICAgICAgICAgIGxvZ2dl
ci5sb2coTGV2ZWwuRklORSwgImdldENWU0ZpbGUiLCBlKTsKICAgICAgICAgfQogICAgICAgICBy
ZXR1cm4gbnVsbDsKICAgICB9CmRpZmYgLXIgNjE1NDkwMjZhYWZlIC1yIDI2MTExNjUwN2M3YSBz
cmMvb3JnL29wZW5zb2xhcmlzL29wZW5ncm9rL2hpc3RvcnkvUkNTUmVwb3NpdG9yeS5qYXZhCi0t
LSBhL3NyYy9vcmcvb3BlbnNvbGFyaXMvb3Blbmdyb2svaGlzdG9yeS9SQ1NSZXBvc2l0b3J5Lmph
dmEJU3VuIEZlYiAxMiAwNDozNzozNiAyMDEyICswMTAwCisrKyBiL3NyYy9vcmcvb3BlbnNvbGFy
aXMvb3Blbmdyb2svaGlzdG9yeS9SQ1NSZXBvc2l0b3J5LmphdmEJTW9uIEZlYiAxMyAwNjoxMjo0
NyAyMDEyICswMTAwCkBAIC0yOCwxOCArMjgsMjAgQEAKIGltcG9ydCBqYXZhLmlvLklPRXhjZXB0
aW9uOwogaW1wb3J0IGphdmEuaW8uSW5wdXRTdHJlYW07CiBpbXBvcnQgamF2YS51dGlsLmxvZ2dp
bmcuTGV2ZWw7CitpbXBvcnQgamF2YS51dGlsLmxvZ2dpbmcuTG9nZ2VyOworCiBpbXBvcnQgb3Jn
LmFwYWNoZS5jb21tb25zLmpyY3MuZGlmZi5QYXRjaEZhaWxlZEV4Y2VwdGlvbjsKIGltcG9ydCBv
cmcuYXBhY2hlLmNvbW1vbnMuanJjcy5yY3MuQXJjaGl2ZTsKIGltcG9ydCBvcmcuYXBhY2hlLmNv
bW1vbnMuanJjcy5yY3MuSW52YWxpZEZpbGVGb3JtYXRFeGNlcHRpb247CiBpbXBvcnQgb3JnLmFw
YWNoZS5jb21tb25zLmpyY3MucmNzLk5vZGU7CiBpbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmpy
Y3MucmNzLlBhcnNlRXhjZXB0aW9uOwogaW1wb3J0IG9yZy5hcGFjaGUuY29tbW9ucy5qcmNzLnJj
cy5WZXJzaW9uOwotaW1wb3J0IG9yZy5vcGVuc29sYXJpcy5vcGVuZ3Jvay5PcGVuR3Jva0xvZ2dl
cjsKIAogLyoqCiAgKiBBY2Nlc3MgdG8gYW4gUkNTIHJlcG9zaXRvcnkuCiAgKi8KIHB1YmxpYyBj
bGFzcyBSQ1NSZXBvc2l0b3J5IGV4dGVuZHMgUmVwb3NpdG9yeSB7CisgICAgcHJpdmF0ZSBzdGF0
aWMgZmluYWwgTG9nZ2VyIGxvZ2dlciA9IExvZ2dlci5nZXRMb2dnZXIoUkNTUmVwb3NpdG9yeS5j
bGFzcy5nZXROYW1lKCkpOwogICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGxvbmcgc2VyaWFsVmVy
c2lvblVJRCA9IDFMOwogCiAgICAgcHVibGljIFJDU1JlcG9zaXRvcnkoKSB7CkBAIC01OSw4ICs2
MSw5IEBACiAgICAgICAgICAgICBGaWxlIHJjc0ZpbGUgPSBnZXRSQ1NGaWxlKGZpbGUpOwogICAg
ICAgICAgICAgcmV0dXJuIG5ldyBSQ1NnZXQocmNzRmlsZS5nZXRQYXRoKCksIHJldik7CiAgICAg
ICAgIH0gY2F0Y2ggKElPRXhjZXB0aW9uIGlvZSkgewotICAgICAgICAgICAgT3Blbkdyb2tMb2dn
ZXIuZ2V0TG9nZ2VyKCkubG9nKExldmVsLlNFVkVSRSwKLSAgICAgICAgICAgICAgICAgICAgIkZh
aWxlZCB0byByZXRyaWV2ZSByZXZpc2lvbiAiICsgcmV2ICsgIiBvZiAiICsgYmFzZW5hbWUsIGlv
ZSk7CisgICAgICAgICAgICBsb2dnZXIud2FybmluZygiRmFpbGVkIHRvIHJldHJpZXZlIHJldmlz
aW9uICciICsgcmV2ICsgIicgb2YgJyIgCisgICAgICAgICAgICAgICAgKyBiYXNlbmFtZSArICIn
OiAiICsgaW9lLmdldE1lc3NhZ2UoKSk7CisgICAgICAgICAgICBsb2dnZXIubG9nKExldmVsLkZJ
TkUsICJnZXRIaXN0b3J5R2V0IiwgaW9lKTsKICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAg
ICAgICB9CiAgICAgfQpkaWZmIC1yIDYxNTQ5MDI2YWFmZSAtciAyNjExMTY1MDdjN2Egc3JjL29y
Zy9vcGVuc29sYXJpcy9vcGVuZ3Jvay9oaXN0b3J5L1Jhem9ySGlzdG9yeVBhcnNlci5qYXZhCi0t
LSBhL3NyYy9vcmcvb3BlbnNvbGFyaXMvb3Blbmdyb2svaGlzdG9yeS9SYXpvckhpc3RvcnlQYXJz
ZXIuamF2YQlTdW4gRmViIDEyIDA0OjM3OjM2IDIwMTIgKzAxMDAKKysrIGIvc3JjL29yZy9vcGVu
c29sYXJpcy9vcGVuZ3Jvay9oaXN0b3J5L1Jhem9ySGlzdG9yeVBhcnNlci5qYXZhCU1vbiBGZWIg
MTMgMDY6MTI6NDcgMjAxMiArMDEwMApAQCAtMzIsOSArMzIsMTAgQEAKIGltcG9ydCBqYXZhLnV0
aWwuQXJyYXlMaXN0OwogaW1wb3J0IGphdmEudXRpbC5EYXRlOwogaW1wb3J0IGphdmEudXRpbC5s
b2dnaW5nLkxldmVsOworaW1wb3J0IGphdmEudXRpbC5sb2dnaW5nLkxvZ2dlcjsKIGltcG9ydCBq
YXZhLnV0aWwucmVnZXguTWF0Y2hlcjsKIGltcG9ydCBqYXZhLnV0aWwucmVnZXguUGF0dGVybjsK
LWltcG9ydCBvcmcub3BlbnNvbGFyaXMub3Blbmdyb2suT3Blbkdyb2tMb2dnZXI7CisKIGltcG9y
dCBvcmcub3BlbnNvbGFyaXMub3Blbmdyb2sudXRpbC5JT1V0aWxzOwogaW1wb3J0IG9yZy5vcGVu
c29sYXJpcy5vcGVuZ3Jvay51dGlsLlN0cmluZ1V0aWxzOwogCkBAIC00NSw2ICs0Niw3IEBACiAg
Ki8KIGNsYXNzIFJhem9ySGlzdG9yeVBhcnNlciB7CiAKKyAgICBwcml2YXRlIHN0YXRpYyBmaW5h
bCBMb2dnZXIgbG9nZ2VyID0gTG9nZ2VyLmdldExvZ2dlcihSYXpvckhpc3RvcnlQYXJzZXIuY2xh
c3MuZ2V0TmFtZSgpKTsKICAgICBwcml2YXRlIFJhem9yUmVwb3NpdG9yeSByZXBvc2l0b3J5PW5l
dyBSYXpvclJlcG9zaXRvcnkoKTsKIAogICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIFBhdHRlcm4g
QUNUSU9OX1RZUEVfUEFUVEVSTiA9CkBAIC02NiwxNSArNjgsMTggQEAKIAogICAgICAgICByZXBv
c2l0b3J5ID0gKFJhem9yUmVwb3NpdG9yeSkgcmVwb3M7CiAgICAgICAgIEZpbGUgbWFwcGVkRmls
ZSA9IHJlcG9zaXRvcnkuZ2V0UmF6b3JIaXN0b3J5RmlsZUZvcihmaWxlKTsKLSAgICAgICAgcGFy
c2VEZWJ1ZygiTWFwcGluZyAiICsgZmlsZS5nZXRQYXRoKCkgKyAiIHRvICciICsgbWFwcGVkRmls
ZS5nZXRQYXRoKCkgKyAiJyIpOworICAgICAgICBsb2dnZXIubG9nKExldmVsLkZJTkUsICJNYXBw
aW5nICcnezB9JycgdG8gJyd7MX0nJyIsIAorICAgICAgICAgICAgbmV3IFN0cmluZ1tdIHsgZmls
ZS5nZXRQYXRoKCksIG1hcHBlZEZpbGUuZ2V0UGF0aCgpIH0pOwogCiAgICAgICAgIGlmICghbWFw
cGVkRmlsZS5leGlzdHMoKSkgewotICAgICAgICAgICAgcGFyc2VQcm9ibGVtKCJIaXN0b3J5IEZp
bGUgTWFwcGluZyBpcyBOT04tRVhJU1RFTlQgKCIgKyBtYXBwZWRGaWxlLmdldEFic29sdXRlUGF0
aCgpICsgIikiKTsKKyAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKCJIaXN0b3J5IEZpbGUgTWFw
cGluZyBpcyBOT04tRVhJU1RFTlQgKCIgCisgICAgICAgICAgICAgICAgKyBtYXBwZWRGaWxlLmdl
dEFic29sdXRlUGF0aCgpICsgIikiKTsKICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAg
ICB9CiAKICAgICAgICAgaWYgKG1hcHBlZEZpbGUuaXNEaXJlY3RvcnkoKSkgewotICAgICAgICAg
ICAgcGFyc2VQcm9ibGVtKCJIaXN0b3J5IEZpbGUgTWFwcGluZyBpcyBhIERJUkVDVE9SWSAoIiAr
IG1hcHBlZEZpbGUuZ2V0QWJzb2x1dGVQYXRoKCkgKyAiKSIpOworICAgICAgICAgICAgbG9nZ2Vy
Lndhcm5pbmcoIkhpc3RvcnkgRmlsZSBNYXBwaW5nIGlzIGEgRElSRUNUT1JZICgiIAorICAgICAg
ICAgICAgICAgICsgbWFwcGVkRmlsZS5nZXRBYnNvbHV0ZVBhdGgoKSArICIpIik7CiAgICAgICAg
ICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgfQogCkBAIC0xMDEsNyArMTA2LDcgQEAKICAgICAg
ICAgTWF0Y2hlciBpbmZvTWF0Y2hlciA9IEFERElUSU9OQUxfSU5GT19QQVRURVJOLm1hdGNoZXIo
IiIpOwogICAgICAgICB3aGlsZSAoKGxpbmUgPSBjb250ZW50cy5yZWFkTGluZSgpKSAhPSBudWxs
KSB7CiAKLSAgICAgICAgICAgIHBhcnNlRGVidWcoIlByb2Nlc3NpbmcgJyIgKyBsaW5lICsgIici
KTsKKyAgICAgICAgICAgIGxvZ2dlci5sb2coTGV2ZWwuRklORSwgIlByb2Nlc3NpbmcgW3swfV0i
LCBsaW5lKTsKIAogICAgICAgICAgICAgaWYgKFN0cmluZ1V0aWxzLmlzT25seVdoaXRlc3BhY2Uo
bGluZSkpIHsKIApAQCAtMTIzLDI1ICsxMjgsMjUgQEAKICAgICAgICAgICAgICAgICAgICAgICAg
IFN0cmluZyBkZXRhaWxzID0gaW5mb01hdGNoZXIuZ3JvdXAoMik7CiAKICAgICAgICAgICAgICAg
ICAgICAgICAgIGlmICgiVElUTEUiLmVxdWFscyhpbmZvVHlwZSkpIHsKLSAgICAgICAgICAgICAg
ICAgICAgICAgICAgICBwYXJzZURlYnVnKCJTZXR0aW5nIE1lc3NhZ2UgOiAnIiArIGRldGFpbHMg
KyAiJyIpOworICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5sb2coTGV2ZWwuRklO
RSwgIlNldHRpbmcgTWVzc2FnZSAnJ3swfScnIiwgZGV0YWlscyk7CiAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgZW50cnkuc2V0TWVzc2FnZShkZXRhaWxzKTsKICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICBsYXN0V2FzVGl0bGUgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICAg
fSBlbHNlIGlmICgiSVNTVUUiLmVxdWFscyhpbmZvVHlwZSkpIHsKLSAgICAgICAgICAgICAgICAg
ICAgICAgICAgICBwYXJzZURlYnVnKCJBZGRpbmcgQ1IgOiAnIiArIGRldGFpbHMgKyAiJyIpOwor
ICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5sb2coTGV2ZWwuRklORSwgIkFkZGlu
ZyBDUiAnJ3swfScnIiwgZGV0YWlscyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW50
cnkuYWRkQ2hhbmdlUmVxdWVzdChkZXRhaWxzKTsKICAgICAgICAgICAgICAgICAgICAgICAgIH0g
ZWxzZSB7Ci0gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VEZWJ1ZygiSWdub3Jpbmcg
SW5mbyBUeXBlIExpbmUgJyIgKyBsaW5lICsgIiciKTsKKyAgICAgICAgICAgICAgICAgICAgICAg
ICAgICBsb2dnZXIubG9nKExldmVsLkZJTkUsICJJZ25vcmluZyBJbmZvIFR5cGUgTGluZSBbezB9
XSIsIGxpbmUpOwogICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAg
ICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFsaW5lLnN0YXJ0c1dpdGgo
IiMjIikgJiYgbGluZS5jaGFyQXQoMCkgPT0gJyMnKSB7Ci0gICAgICAgICAgICAgICAgICAgICAg
ICAgICAgcGFyc2VEZWJ1ZygiU2VlbiBDb21tZW50IDogJyIgKyBsaW5lICsgIiciKTsKKyAgICAg
ICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIubG9nKExldmVsLkZJTkUsICJTZWVuIENvbW1l
bnQgW3swfV0iLCBsaW5lKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobGFzdFdh
c1RpdGxlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVudHJ5LmFwcGVuZE1l
c3NhZ2UoIiIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXN0V2FzVGl0bGUg
PSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgZW50cnkuYXBwZW5kTWVzc2FnZShsaW5lLnN1YnN0cmluZygxKSk7CiAgICAg
ICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewotICAgICAgICAgICAgICAgICAgICAgICAgICAg
IHBhcnNlUHJvYmxlbSgiRXhwZWN0aW5nIGFkZGxJbmZvIGFuZCBnb3QgJyIgKyBsaW5lICsgIici
KTsKKyAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKCJFeHBlY3Rpbmcg
YWRkbEluZm8gYW5kIGdvdCBbIiArIGxpbmUgKyAiXSIpOwogICAgICAgICAgICAgICAgICAgICAg
ICAgfQogICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgfSBlbHNlIHsKQEAg
LTE2MSw3ICsxNjYsOCBAQAogICAgICAgICAgICAgICAgICAgICAgICAgU3RyaW5nIHJldmlzaW9u
ID0gYWN0aW9uTWF0Y2hlci5ncm91cCgzKTsKICAgICAgICAgICAgICAgICAgICAgICAgIFN0cmlu
ZyBzdGF0ZSA9IGFjdGlvbk1hdGNoZXIuZ3JvdXAoNCk7CiAgICAgICAgICAgICAgICAgICAgICAg
ICBTdHJpbmcgZGF0ZVRpbWUgPSBhY3Rpb25NYXRjaGVyLmdyb3VwKDUpOwotICAgICAgICAgICAg
ICAgICAgICAgICAgcGFyc2VEZWJ1ZygiTmV3IEhpc3RvcnkgRXZlbnQgU2VlbiA6IGFjdGlvblR5
cGUgPSAiICsgYWN0aW9uVHlwZSArICIsIHVzZXJOYW1lID0gIiArIHVzZXJOYW1lICsgIiwgcmV2
aXNpb24gPSAiICsgcmV2aXNpb24gKyAiLCBzdGF0ZSA9ICIgKyBzdGF0ZSArICIsIGRhdGVUaW1l
ID0gIiArIGRhdGVUaW1lKTsKKyAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5sb2coTGV2
ZWwuRklORSwgIk5ldyBIaXN0b3J5IEV2ZW50IFNlZW46IGFjdGlvblR5cGUgPSB7MH0sIHVzZXJO
YW1lID0gezF9LCByZXZpc2lvbiA9IHsyfSwgc3RhdGUgPSB7M30sIGRhdGVUaW1lID0gezR9Iiwg
CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3IFN0cmluZ1tdIHsgYWN0aW9uVHlwZSwg
dXNlck5hbWUsIHJldmlzaW9uLCBzdGF0ZSwgZGF0ZVRpbWUgfSk7CiAgICAgICAgICAgICAgICAg
ICAgICAgICBpZiAoYWN0aW9uVHlwZS5zdGFydHNXaXRoKCJJTlRST0RVQ0UiKSB8fAogICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb25UeXBlLmNvbnRhaW5zKCJDSEVDSy1JTiIp
IHx8CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJDSEVDSy1QT0lOVCIuZXF1YWxz
KGFjdGlvblR5cGUpIHx8CkBAIC0xNzMsNyArMTc5LDkgQEAKICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRlID0gZGYu
cGFyc2UoZGF0ZVRpbWUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKFBh
cnNlRXhjZXB0aW9uIHBlKSB7Ci0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE9wZW5H
cm9rTG9nZ2VyLmdldExvZ2dlcigpLmxvZyhMZXZlbC5XQVJOSU5HLCAiQ291bGQgbm90IHBhcnNl
IGRhdGU6ICIgKyBkYXRlVGltZSwgcGUpOworICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICBsb2dnZXIud2FybmluZygiQ291bGQgbm90IHBhcnNlIGRhdGUgIiArIGRhdGVUaW1lIAorICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyAiOiAiICsgcGUuZ2V0TWVzc2FnZSgp
KTsKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmxvZyhMZXZlbC5GSU5F
LCAicGFyc2VDb250ZW50cyIsIHBlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgZW50cnkuc2V0RGF0ZShkYXRlKTsKICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICBpZ25vcmVFbnRyeSA9IGZhbHNlOwpAQCAtMTgxLDcgKzE4OSw3
IEBACiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWdub3JlRW50cnkgPSB0cnVlOwogICAg
ICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewotICAg
ICAgICAgICAgICAgICAgICAgICAgcGFyc2VQcm9ibGVtKCJFeHBlY3RpbmcgYWN0aW9uVHlwZSBh
bmQgZ290ICciICsgbGluZSArICInIik7CisgICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIu
d2FybmluZygiRXhwZWN0aW5nIGFjdGlvblR5cGUgYW5kIGdvdCBbIiArIGxpbmUgKyAiXSIpOwog
ICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgfQpA
QCAtMjAyLDEyICsyMTAsNCBAQAogICAgICAgICAgICAgZW50cnkuZHVtcCgpOwogICAgICAgICB9
CiAgICAgfQotCi0gICAgcHJpdmF0ZSB2b2lkIHBhcnNlRGVidWcoU3RyaW5nIG1lc3NhZ2UpIHsK
LSAgICAgICAgT3Blbkdyb2tMb2dnZXIuZ2V0TG9nZ2VyKCkubG9nKExldmVsLkZJTkUsICJSYXpv
ckhpc3RvcnlQYXJzZXI6ICIgKyBtZXNzYWdlICk7Ci0gICAgfQotCi0gICAgcHJpdmF0ZSB2b2lk
IHBhcnNlUHJvYmxlbShTdHJpbmcgbWVzc2FnZSkgewotICAgICAgICBPcGVuR3Jva0xvZ2dlci5n
ZXRMb2dnZXIoKS5sb2coTGV2ZWwuU0VWRVJFLCAiUFJPQkxFTTogUmF6b3JIaXN0b3J5UGFyc2Vy
IC0gIiArIG1lc3NhZ2UpOwotICAgIH0KIH0KZGlmZiAtciA2MTU0OTAyNmFhZmUgLXIgMjYxMTE2
NTA3YzdhIHNyYy9vcmcvb3BlbnNvbGFyaXMvb3Blbmdyb2svaGlzdG9yeS9SYXpvclJlcG9zaXRv
cnkuamF2YQotLS0gYS9zcmMvb3JnL29wZW5zb2xhcmlzL29wZW5ncm9rL2hpc3RvcnkvUmF6b3JS
ZXBvc2l0b3J5LmphdmEJU3VuIEZlYiAxMiAwNDozNzozNiAyMDEyICswMTAwCisrKyBiL3NyYy9v
cmcvb3BlbnNvbGFyaXMvb3Blbmdyb2svaGlzdG9yeS9SYXpvclJlcG9zaXRvcnkuamF2YQlNb24g
RmViIDEzIDA2OjEyOjQ3IDIwMTIgKzAxMDAKQEAgLTI2LDEwICsyNiw5IEBACiBpbXBvcnQgamF2
YS5pby5JT0V4Y2VwdGlvbjsKIGltcG9ydCBqYXZhLmlvLklucHV0U3RyZWFtOwogaW1wb3J0IGph
dmEudXRpbC5sb2dnaW5nLkxldmVsOworaW1wb3J0IGphdmEudXRpbC5sb2dnaW5nLkxvZ2dlcjsK
IGltcG9ydCBqYXZhLnV0aWwuemlwLkdaSVBJbnB1dFN0cmVhbTsKIAotaW1wb3J0IG9yZy5vcGVu
c29sYXJpcy5vcGVuZ3Jvay5PcGVuR3Jva0xvZ2dlcjsKLQogLyoqCiAgKiBBZGRzIGFjY2VzcyB0
byB0byBhIFJhem9yIFJlcG9zaXRvcnkKICAqCkBAIC0xMzEsNiArMTMwLDcgQEAKICAqIEBhdXRo
b3IgUGV0ZXIgQnJheSA8UGV0ZXIuRGFycmVuLkJyYXlAZ21haWwuY29tPgogICovCiBwdWJsaWMg
Y2xhc3MgUmF6b3JSZXBvc2l0b3J5IGV4dGVuZHMgUmVwb3NpdG9yeSB7CisgICAgcHJpdmF0ZSBz
dGF0aWMgZmluYWwgTG9nZ2VyIGxvZ2dlciA9IExvZ2dlci5nZXRMb2dnZXIoUmF6b3JSZXBvc2l0
b3J5LmNsYXNzLmdldE5hbWUoKSk7CiAgICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgbG9uZyBzZXJp
YWxWZXJzaW9uVUlEID0gMUw7CiAKICAgICAvLyBUaGUgcGF0aCBvZiB0aGUgcmVwb3NpdG9yeSBp
dHNlbGYgaXMgc3RvcmVkIGluIHRoZSBzdXBlciBjbGFzcy4KQEAgLTIzOSw4ICsyMzksOSBAQAog
ICAgICAgICAgICAgICAgIHJldHVybiBTQ0NTZ2V0LmdldFJldmlzaW9uKGNtZCwgc2Njc0ZpbGUs
IHJldik7CiAgICAgICAgICAgICB9CiAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7Ci0g
ICAgICAgICAgICBPcGVuR3Jva0xvZ2dlci5nZXRMb2dnZXIoKS5sb2coTGV2ZWwuU0VWRVJFLCAi
Z2V0SGlzdG9yeUdldCggIgotICAgICAgICAgICAgICAgICsgcGFyZW50ICsgIiwgIiArIGJhc2Vu
YW1lICsgIiwgIiArIHJldiArICIpIiwgZSk7CisgICAgICAgICAgICBsb2dnZXIud2FybmluZygi
RmFpbGVkIHRvIGdldCBoaXN0b3J5IGZvciAnIiArIHBhcmVudCArIEZpbGUuc2VwYXJhdG9yCisg
ICAgICAgICAgICAgICAgKyAgYmFzZW5hbWUgKyAiJyByZXY9JyIgKyByZXYgKyAiJzogIiArIGUu
Z2V0TWVzc2FnZSgpKTsKKyAgICAgICAgICAgIGxvZ2dlci5sb2coTGV2ZWwuRklORSwgImdldEhp
c3RvcnlHZXQiLCBlKTsKICAgICAgICAgfQogICAgICAgICByZXR1cm4gbnVsbDsKICAgICB9CmRp
ZmYgLXIgNjE1NDkwMjZhYWZlIC1yIDI2MTExNjUwN2M3YSBzcmMvb3JnL29wZW5zb2xhcmlzL29w
ZW5ncm9rL2hpc3RvcnkvUmVwb3NpdG9yeS5qYXZhCi0tLSBhL3NyYy9vcmcvb3BlbnNvbGFyaXMv
b3Blbmdyb2svaGlzdG9yeS9SZXBvc2l0b3J5LmphdmEJU3VuIEZlYiAxMiAwNDozNzozNiAyMDEy
ICswMTAwCisrKyBiL3NyYy9vcmcvb3BlbnNvbGFyaXMvb3Blbmdyb2svaGlzdG9yeS9SZXBvc2l0
b3J5LmphdmEJTW9uIEZlYiAxMyAwNjoxMjo0NyAyMDEyICswMTAwCkBAIC0zMCw5ICszMCw4IEBA
CiBpbXBvcnQgamF2YS51dGlsLkFycmF5TGlzdDsKIGltcG9ydCBqYXZhLnV0aWwuTGlzdDsKIGlt
cG9ydCBqYXZhLnV0aWwuTG9jYWxlOwotaW1wb3J0IGphdmEudXRpbC5sb2dnaW5nLkxldmVsOwog
aW1wb3J0IGphdmEudXRpbC5sb2dnaW5nLkxvZ2dlcjsKLWltcG9ydCBvcmcub3BlbnNvbGFyaXMu
b3Blbmdyb2suT3Blbkdyb2tMb2dnZXI7CisKIGltcG9ydCBvcmcub3BlbnNvbGFyaXMub3Blbmdy
b2suY29uZmlndXJhdGlvbi5SdW50aW1lRW52aXJvbm1lbnQ7CiBpbXBvcnQgb3JnLm9wZW5zb2xh
cmlzLm9wZW5ncm9rLnV0aWwuRXhlY3V0b3I7CiAKQEAgLTQzLDYgKzQyLDggQEAKICAqLwogcHVi
bGljIGFic3RyYWN0IGNsYXNzIFJlcG9zaXRvcnkgZXh0ZW5kcyBSZXBvc2l0b3J5SW5mbyB7CiAK
KyAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBMb2dnZXIgbG9nZ2VyID0gCisgICAgICAgIExvZ2dl
ci5nZXRMb2dnZXIoUmVwb3NpdG9yeS5jbGFzcy5nZXROYW1lKCkpOwogICAgIC8qKgogICAgICAq
IFRoZSBjb21tYW5kIHdpdGggd2hpY2ggdG8gYWNjZXNzIHRoZSBleHRlcm5hbCByZXBvc2l0b3J5
LiBDYW4gYmUKICAgICAgKiB7QGNvZGUgbnVsbH0gaWYgdGhlIHJlcG9zaXRvcnkgaXNuJ3QgYWNj
ZXNzZWQgdmlhIGEgQ0xJLCBvciBpZiBpdApAQCAtOTMsMTIgKzk0LDkgQEAKICAgICAgICAgLy8g
SWYgd2Ugd2FudCBhbiBpbmNyZW1lbnRhbCBoaXN0b3J5IHVwZGF0ZSBhbmQgZ2V0IGhlcmUsIHdh
cm4gdGhhdAogICAgICAgICAvLyBpdCBtYXkgYmUgc2xvdy4KICAgICAgICAgaWYgKHNpbmNlUmV2
aXNpb24gIT0gbnVsbCkgewotICAgICAgICAgICAgTG9nZ2VyIGxvZ2dlciA9IE9wZW5Hcm9rTG9n
Z2VyLmdldExvZ2dlcigpOwotICAgICAgICAgICAgbG9nZ2VyLmxvZyhMZXZlbC5XQVJOSU5HLAot
ICAgICAgICAgICAgICAgICAgICAiSW5jcmVtZW50YWwgaGlzdG9yeSByZXRyaWV2YWwgaXMgbm90
IGltcGxlbWVudGVkIGZvciB7MH0uIiwKLSAgICAgICAgICAgICAgICAgICAgZ2V0Q2xhc3MoKS5n
ZXRTaW1wbGVOYW1lKCkpOwotICAgICAgICAgICAgbG9nZ2VyLmxvZyhMZXZlbC5XQVJOSU5HLAot
ICAgICAgICAgICAgICAgICAgICAiRmFsbGluZyBiYWNrIHRvIHNsb3dlciBmdWxsIGhpc3Rvcnkg
cmV0cmlldmFsLiIpOworICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoIkluY3JlbWVudGFsIGhp
c3RvcnkgcmV0cmlldmFsIGlzIG5vdCBpbXBsZW1lbnRlZCBmb3IgIgorICAgICAgICAgICAgICAg
ICsgZ2V0Q2xhc3MoKS5nZXRTaW1wbGVOYW1lKCkgCisgICAgICAgICAgICAgICAgKyAiLiBGYWxs
aW5nIGJhY2sgdG8gc2xvd2VyIGZ1bGwgaGlzdG9yeSByZXRyaWV2YWwuIik7CiAgICAgICAgIH0K
IAogICAgICAgICBIaXN0b3J5IGhpc3RvcnkgPSBnZXRIaXN0b3J5KGZpbGUpOwpAQCAtMjE1LDkg
KzIxMyw4IEBACiAgICAgICAgICAgICAvLyBieSBjaGFuZ2VzIGluIHRoZSByZXZpc2lvbiBudW1i
ZXJzIHNpbmNlIHRoZSBsYXN0IHVwZGF0ZQogICAgICAgICAgICAgLy8gKGJ1ZyAjMTQ3MjQpIHNv
IHdlJ2xsIHRyeSB0byByZWdlbmVyYXRlIHRoZSBjYWNoZSBmcm9tCiAgICAgICAgICAgICAvLyBz
Y3JhdGNoIGluc3RlYWQuCi0gICAgICAgICAgICBPcGVuR3Jva0xvZ2dlci5nZXRMb2dnZXIoKS5s
b2coTGV2ZWwuSU5GTywKLSAgICAgICAgICAgICAgICAgICAgIkZhaWxlZCB0byBnZXQgcGFydGlh
bCBoaXN0b3J5LiBBdHRlbXB0aW5nIHRvICIgKwotICAgICAgICAgICAgICAgICAgICAicmVjcmVh
dGUgdGhlIGhpc3RvcnkgY2FjaGUgZnJvbSBzY3JhdGNoLiIsIGhlKTsKKyAgICAgICAgICAgIGxv
Z2dlci5pbmZvKCJGYWlsZWQgdG8gZ2V0IHBhcnRpYWwgaGlzdG9yeS4gQXR0ZW1wdGluZyB0byAi
ICsKKyAgICAgICAgICAgICAgICAicmVjcmVhdGUgdGhlIGhpc3RvcnkgY2FjaGUgZnJvbSBzY3Jh
dGNoICgiICsgIGhlLmdldE1lc3NhZ2UoKSArICIpIik7CiAgICAgICAgICAgICBoaXN0b3J5ID0g
bnVsbDsKICAgICAgICAgfQogCmRpZmYgLXIgNjE1NDkwMjZhYWZlIC1yIDI2MTExNjUwN2M3YSBz
cmMvb3JnL29wZW5zb2xhcmlzL29wZW5ncm9rL2hpc3RvcnkvUmVwb3NpdG9yeUZhY3RvcnkuamF2
YQotLS0gYS9zcmMvb3JnL29wZW5zb2xhcmlzL29wZW5ncm9rL2hpc3RvcnkvUmVwb3NpdG9yeUZh
Y3RvcnkuamF2YQlTdW4gRmViIDEyIDA0OjM3OjM2IDIwMTIgKzAxMDAKKysrIGIvc3JjL29yZy9v
cGVuc29sYXJpcy9vcGVuZ3Jvay9oaXN0b3J5L1JlcG9zaXRvcnlGYWN0b3J5LmphdmEJTW9uIEZl
YiAxMyAwNjoxMjo0NyAyMDEyICswMTAwCkBAIC0yOCw4ICsyOCw3IEBACiBpbXBvcnQgamF2YS51
dGlsLkFycmF5TGlzdDsKIGltcG9ydCBqYXZhLnV0aWwuTGlzdDsKIGltcG9ydCBqYXZhLnV0aWwu
bG9nZ2luZy5MZXZlbDsKLQotaW1wb3J0IG9yZy5vcGVuc29sYXJpcy5vcGVuZ3Jvay5PcGVuR3Jv
a0xvZ2dlcjsKK2ltcG9ydCBqYXZhLnV0aWwubG9nZ2luZy5Mb2dnZXI7CiAKIC8qKgogICogVGhp
cyBpcyBhIGZhY3RvcnkgY2xhc3MgZm9yIHRoZSBkaWZmZXJlbnQgcmVwb3NpdG9yaWVzLgpAQCAt
MzcsNyArMzYsNyBAQAogICogQGF1dGhvciBhdXN0dmlrCiAgKi8KIHB1YmxpYyBmaW5hbCBjbGFz
cyBSZXBvc2l0b3J5RmFjdG9yeSB7Ci0KKyAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBMb2dnZXIg
bG9nZ2VyID0gTG9nZ2VyLmdldExvZ2dlcihSZXBvc2l0b3J5RmFjdG9yeS5jbGFzcy5nZXROYW1l
KCkpOwogICAgIHByaXZhdGUgc3RhdGljIFJlcG9zaXRvcnkgcmVwb3NpdG9yaWVzW10gPSB7CiAg
ICAgICAgIG5ldyBNZXJjdXJpYWxSZXBvc2l0b3J5KCksCiAgICAgICAgIG5ldyBCYXphYXJSZXBv
c2l0b3J5KCksCkBAIC04NCwxNyArODMsMTQgQEAKICAgICAgICAgICAgICAgICB0cnkgewogICAg
ICAgICAgICAgICAgICAgICByZXMuc2V0RGlyZWN0b3J5TmFtZShmaWxlLmdldENhbm9uaWNhbFBh
dGgoKSk7CiAgICAgICAgICAgICAgICAgfSBjYXRjaCAoSU9FeGNlcHRpb24gZSkgewotICAgICAg
ICAgICAgICAgICAgICBPcGVuR3Jva0xvZ2dlci5nZXRMb2dnZXIoKS5sb2coTGV2ZWwuU0VWRVJF
LCAiRmFpbGVkIHRvIGdldCBjYW5vbmljYWwgcGF0aCBuYW1lIGZvciAiICsgZmlsZS5nZXRBYnNv
bHV0ZVBhdGgoKSwgZSk7CisgICAgICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKCJGYWls
ZWQgdG8gZ2V0IGNhbm9uaWNhbCBwYXRoIG5hbWUgZm9yICciIAorICAgICAgICAgICAgICAgICAg
ICAgICAgKyBmaWxlLmdldEFic29sdXRlUGF0aCgpICsgIic6ICIgKyBlLmdldE1lc3NhZ2UoKSk7
CisgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5sb2coTGV2ZWwuRklORSwgImdldFJlcG9zaXRv
cnkiLCBlKTsKICAgICAgICAgICAgICAgICB9CiAKICAgICAgICAgICAgICAgICBpZiAoIXJlcy5p
c1dvcmtpbmcoKSkgewotICAgICAgICAgICAgICAgICAgICBPcGVuR3Jva0xvZ2dlci5nZXRMb2dn
ZXIoKS5sb2coCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgTGV2ZWwuV0FSTklORywKLSAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAiezB9IG5vdCB3b3JraW5nIChtaXNzaW5nIGJpbmFy
aWVzPyk6IHsxfSIsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3IE9iamVjdFtdIHsK
LSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzLmdldENsYXNzKCkuZ2V0U2ltcGxl
TmFtZSgpLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlLmdldFBhdGgoKQot
ICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOworICAgICAgICAgICAgICAgICAgICBsb2dn
ZXIud2FybmluZyhyZXMuZ2V0Q2xhc3MoKS5nZXRTaW1wbGVOYW1lKCkgCisgICAgICAgICAgICAg
ICAgICAgICAgICArICIgbm90IHdvcmtpbmcgKG1pc3NpbmcgYmluYXJpZXM/KSAnIiArIGZpbGUu
Z2V0UGF0aCgpICsgIiciKTsKICAgICAgICAgICAgICAgICB9CiAKICAgICAgICAgICAgICAgICBp
ZiAocmVzLmdldFR5cGUoKSA9PSBudWxsIHx8IHJlcy5nZXRUeXBlKCkubGVuZ3RoKCkgPT0gMCkg
ewpkaWZmIC1yIDYxNTQ5MDI2YWFmZSAtciAyNjExMTY1MDdjN2Egc3JjL29yZy9vcGVuc29sYXJp
cy9vcGVuZ3Jvay9oaXN0b3J5L1NDQ1NIaXN0b3J5UGFyc2VyLmphdmEKLS0tIGEvc3JjL29yZy9v
cGVuc29sYXJpcy9vcGVuZ3Jvay9oaXN0b3J5L1NDQ1NIaXN0b3J5UGFyc2VyLmphdmEJU3VuIEZl
YiAxMiAwNDozNzozNiAyMDEyICswMTAwCisrKyBiL3NyYy9vcmcvb3BlbnNvbGFyaXMvb3Blbmdy
b2svaGlzdG9yeS9TQ0NTSGlzdG9yeVBhcnNlci5qYXZhCU1vbiBGZWIgMTMgMDY6MTI6NDcgMjAx
MiArMDEwMApAQCAtMzMsOCArMzMsOCBAQAogaW1wb3J0IGphdmEudXRpbC5BcnJheUxpc3Q7CiBp
bXBvcnQgamF2YS51dGlsLkRhdGU7CiBpbXBvcnQgamF2YS51dGlsLkxvY2FsZTsKLWltcG9ydCBq
YXZhLnV0aWwubG9nZ2luZy5MZXZlbDsKLWltcG9ydCBvcmcub3BlbnNvbGFyaXMub3Blbmdyb2su
T3Blbkdyb2tMb2dnZXI7CitpbXBvcnQgamF2YS51dGlsLmxvZ2dpbmcuTG9nZ2VyOworCiBpbXBv
cnQgb3JnLm9wZW5zb2xhcmlzLm9wZW5ncm9rLnV0aWwuSU9VdGlsczsKIAogLyoqCkBAIC00NCw2
ICs0NCw3IEBACiAgKiB0YWtpbmcgYSBsb3Qgb2YgdGltZS4gVGltZSB0byBpbmRleCBoaXN0b3J5
IGhhcyByZWR1Y2VkIDQgdG8gMSEKICAqLwogY2xhc3MgU0NDU0hpc3RvcnlQYXJzZXIgeworICAg
IHByaXZhdGUgc3RhdGljIGZpbmFsIExvZ2dlciBsb2dnZXIgPSBMb2dnZXIuZ2V0TG9nZ2VyKFND
Q1NIaXN0b3J5UGFyc2VyLmNsYXNzLmdldE5hbWUoKSk7CiAgICAgYm9vbGVhbiBwYXNzOwogICAg
IGJvb2xlYW4gcGFzc1JlY29yZDsKICAgICBib29sZWFuIGFjdGl2ZTsKQEAgLTEyNCw3ICsxMjUs
NyBAQAogICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgIHJkYXRlID0g
c2Njc0RhdGVGb3JtYXQucGFyc2UoZlsyXSArICIgIiArIGZbM10pOwogICAgICAgICAgICAgICAg
IH0gY2F0Y2ggKFBhcnNlRXhjZXB0aW9uIGUpIHsKLSAgICAgICAgICAgICAgICAgICAgT3Blbkdy
b2tMb2dnZXIuZ2V0TG9nZ2VyKCkubG9nKExldmVsLldBUk5JTkcsICJBbiBlcnJvciBvY2N1cmVk
IHdoaWxlIHBhcnNpbmcgZGF0ZSIsIGUpOworICAgICAgICAgICAgICAgICAgICBsb2dnZXIud2Fy
bmluZygiQW4gZXJyb3Igb2NjdXJlZCB3aGlsZSBwYXJzaW5nIGRhdGU6ICIgKyBlLmdldE1lc3Nh
Z2UoKSk7CiAgICAgICAgICAgICAgICAgICAgIHJkYXRlID0gbnVsbDsKICAgICAgICAgICAgICAg
ICB9CiAgICAgICAgICAgICAgICAgYXV0aG9yID0gZls0XTsKZGlmZiAtciA2MTU0OTAyNmFhZmUg
LXIgMjYxMTE2NTA3YzdhIHNyYy9vcmcvb3BlbnNvbGFyaXMvb3Blbmdyb2svaGlzdG9yeS9TQ0NT
UmVwb3NpdG9yeS5qYXZhCi0tLSBhL3NyYy9vcmcvb3BlbnNvbGFyaXMvb3Blbmdyb2svaGlzdG9y
eS9TQ0NTUmVwb3NpdG9yeS5qYXZhCVN1biBGZWIgMTIgMDQ6Mzc6MzYgMjAxMiArMDEwMAorKysg
Yi9zcmMvb3JnL29wZW5zb2xhcmlzL29wZW5ncm9rL2hpc3RvcnkvU0NDU1JlcG9zaXRvcnkuamF2
YQlNb24gRmViIDEzIDA2OjEyOjQ3IDIwMTIgKzAxMDAKQEAgLTMyLDkgKzMyLDEwIEBACiBpbXBv
cnQgamF2YS51dGlsLkhhc2hNYXA7CiBpbXBvcnQgamF2YS51dGlsLk1hcDsKIGltcG9ydCBqYXZh
LnV0aWwubG9nZ2luZy5MZXZlbDsKK2ltcG9ydCBqYXZhLnV0aWwubG9nZ2luZy5Mb2dnZXI7CiBp
bXBvcnQgamF2YS51dGlsLnJlZ2V4Lk1hdGNoZXI7CiBpbXBvcnQgamF2YS51dGlsLnJlZ2V4LlBh
dHRlcm47Ci1pbXBvcnQgb3JnLm9wZW5zb2xhcmlzLm9wZW5ncm9rLk9wZW5Hcm9rTG9nZ2VyOwor
CiBpbXBvcnQgb3JnLm9wZW5zb2xhcmlzLm9wZW5ncm9rLnV0aWwuSU9VdGlsczsKIAogLyoqCkBA
IC00Miw2ICs0Myw3IEBACiAgKiBUZWFtV2FyZSkuCiAgKi8KIHB1YmxpYyBjbGFzcyBTQ0NTUmVw
b3NpdG9yeSBleHRlbmRzIFJlcG9zaXRvcnkgeworICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIExv
Z2dlciBsb2dnZXIgPSBMb2dnZXIuZ2V0TG9nZ2VyKFNDQ1NSZXBvc2l0b3J5LmNsYXNzLmdldE5h
bWUoKSk7CiAgICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgbG9uZyBzZXJpYWxWZXJzaW9uVUlEID0g
MUw7CiAgICAgLyoqIFRoZSBwcm9wZXJ0eSBuYW1lIHVzZWQgdG8gb2J0YWluIHRoZSBjbGllbnQg
Y29tbWFuZCBmb3IgdGhpcyByZXBvc2l0b3J5LiAqLwogICAgIHB1YmxpYyBzdGF0aWMgZmluYWwg
U3RyaW5nIENNRF9QUk9QRVJUWV9LRVkgPQpAQCAtNjUsOCArNjcsOCBAQAogICAgICAgICB9IGNh
dGNoIChGaWxlTm90Rm91bmRFeGNlcHRpb24gZXgpIHsKICAgICAgICAgICAgIHJldHVybiBudWxs
OwogICAgICAgICB9IGNhdGNoIChJT0V4Y2VwdGlvbiBleCkgewotICAgICAgICAgICAgT3Blbkdy
b2tMb2dnZXIuZ2V0TG9nZ2VyKCkubG9nKExldmVsLldBUk5JTkcsCi0gICAgICAgICAgICAgICAg
IkFuIGVycm9yIG9jY3VyZWQgd2hpbGUgZ2V0dGluZyByZXZpc2lvbiIsIGV4KTsKKyAgICAgICAg
ICAgIGxvZ2dlci53YXJuaW5nKCJBbiBlcnJvciBvY2N1cmVkIHdoaWxlIGdldHRpbmcgcmV2aXNp
b246ICIgKyBleC5nZXRNZXNzYWdlKCkpOworICAgICAgICAgICAgbG9nZ2VyLmxvZyhMZXZlbC5G
SU5FLCAiZ2V0SGlzdG9yeUdldCIsIGV4KTsKICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAg
ICAgICB9CiAgICAgfQpAQCAtMTA1LDkgKzEwNyw4IEBACiAgICAgICAgICAgICAgICAgICAgIFN0
cmluZyBhdXRoID0gbWF0Y2hlci5ncm91cCgyKTsKICAgICAgICAgICAgICAgICAgICAgYXV0aG9y
c19jYWNoZS5wdXQocmV2LCBhdXRoKTsKICAgICAgICAgICAgICAgICB9IGVsc2UgewotICAgICAg
ICAgICAgICAgICAgICBPcGVuR3Jva0xvZ2dlci5nZXRMb2dnZXIoKS5sb2coTGV2ZWwuU0VWRVJF
LAotICAgICAgICAgICAgICAgICAgICAgICAgIkVycm9yOiBkaWQgbm90IGZpbmQgYXV0aG9ycyBp
biBsaW5lIHswfTogW3sxfV0iLAotICAgICAgICAgICAgICAgICAgICAgICAgbmV3IE9iamVjdFtd
e2xpbmVubywgbGluZX0pOworICAgICAgICAgICAgICAgICAgICBsb2dnZXIubG9nKExldmVsLldB
Uk5JTkcsICJEaWQgbm90IGZpbmQgYXV0aG9ycyBpbiBsaW5lIHswfSBbezF9XSIsCisgICAgICAg
ICAgICAgICAgICAgICAgICBuZXcgT2JqZWN0W10geyBsaW5lbm8sIGxpbmUgfSk7CiAgICAgICAg
ICAgICAgICAgfQogICAgICAgICAgICAgfQogICAgICAgICB9IGZpbmFsbHkgewpAQCAtMTcyLDkg
KzE3Myw4IEBACiAKICAgICAgICAgICAgICAgICAgICAgYS5hZGRMaW5lKHJldiwgYXV0aG9yLCB0
cnVlKTsKICAgICAgICAgICAgICAgICB9IGVsc2UgewotICAgICAgICAgICAgICAgICAgICBPcGVu
R3Jva0xvZ2dlci5nZXRMb2dnZXIoKS5sb2coTGV2ZWwuU0VWRVJFLAotICAgICAgICAgICAgICAg
ICAgICAgICAgIkVycm9yOiBkaWQgbm90IGZpbmQgYW5ub3RhdGlvbnMgaW4gbGluZSB7MH06IFt7
MX1dIiwKLSAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBPYmplY3RbXXtsaW5lbm8sIGxpbmV9
KTsKKyAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmxvZyhMZXZlbC5XQVJOSU5HLCAiRGlkIG5v
dCBmaW5kIGFubm90YXRpb25zIGluIGxpbmUgezB9IFt7MX1dIiwKKyAgICAgICAgICAgICAgICAg
ICAgICAgIG5ldyBPYmplY3RbXSB7IGxpbmVubywgbGluZSB9KTsKICAgICAgICAgICAgICAgICB9
CiAgICAgICAgICAgICB9CiAgICAgICAgICAgICByZXR1cm4gYTsKZGlmZiAtciA2MTU0OTAyNmFh
ZmUgLXIgMjYxMTE2NTA3YzdhIHNyYy9vcmcvb3BlbnNvbGFyaXMvb3Blbmdyb2svaGlzdG9yeS9T
dWJ2ZXJzaW9uSGlzdG9yeVBhcnNlci5qYXZhCi0tLSBhL3NyYy9vcmcvb3BlbnNvbGFyaXMvb3Bl
bmdyb2svaGlzdG9yeS9TdWJ2ZXJzaW9uSGlzdG9yeVBhcnNlci5qYXZhCVN1biBGZWIgMTIgMDQ6
Mzc6MzYgMjAxMiArMDEwMAorKysgYi9zcmMvb3JnL29wZW5zb2xhcmlzL29wZW5ncm9rL2hpc3Rv
cnkvU3VidmVyc2lvbkhpc3RvcnlQYXJzZXIuamF2YQlNb24gRmViIDEzIDA2OjEyOjQ3IDIwMTIg
KzAxMDAKQEAgLTM0LDkgKzM0LDExIEBACiBpbXBvcnQgamF2YS51dGlsLkxpc3Q7CiBpbXBvcnQg
amF2YS51dGlsLkxvY2FsZTsKIGltcG9ydCBqYXZhLnV0aWwubG9nZ2luZy5MZXZlbDsKK2ltcG9y
dCBqYXZhLnV0aWwubG9nZ2luZy5Mb2dnZXI7CisKIGltcG9ydCBqYXZheC54bWwucGFyc2Vycy5T
QVhQYXJzZXI7CiBpbXBvcnQgamF2YXgueG1sLnBhcnNlcnMuU0FYUGFyc2VyRmFjdG9yeTsKLWlt
cG9ydCBvcmcub3BlbnNvbGFyaXMub3Blbmdyb2suT3Blbkdyb2tMb2dnZXI7CisKIGltcG9ydCBv
cmcub3BlbnNvbGFyaXMub3Blbmdyb2suY29uZmlndXJhdGlvbi5SdW50aW1lRW52aXJvbm1lbnQ7
CiBpbXBvcnQgb3JnLm9wZW5zb2xhcmlzLm9wZW5ncm9rLnV0aWwuRXhlY3V0b3I7CiBpbXBvcnQg
b3JnLm9wZW5zb2xhcmlzLm9wZW5ncm9rLnV0aWwuSW50ZXJuZXI7CkBAIC01MCwxMSArNTIsMTQg
QEAKICAqLwogY2xhc3MgU3VidmVyc2lvbkhpc3RvcnlQYXJzZXIgaW1wbGVtZW50cyBFeGVjdXRv
ci5TdHJlYW1IYW5kbGVyIHsKIAorICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIExvZ2dlciBsb2dn
ZXIgPSAKKyAgICAgICAgTG9nZ2VyLmdldExvZ2dlcihTdWJ2ZXJzaW9uSGlzdG9yeVBhcnNlci5j
bGFzcy5nZXROYW1lKCkpOwogICAgIHByaXZhdGUgU0FYUGFyc2VyIHNheFBhcnNlciA9IG51bGw7
CiAgICAgcHJpdmF0ZSBIYW5kbGVyIGhhbmRsZXI7CiAKICAgICBwcml2YXRlIHN0YXRpYyBjbGFz
cyBIYW5kbGVyIGV4dGVuZHMgRGVmYXVsdEhhbmRsZXIyIHsKLQorICAgICAgICBwcml2YXRlIHN0
YXRpYyBmaW5hbCBMb2dnZXIgbG9nZ2VyID0gTG9nZ2VyCisgICAgICAgICAgICAuZ2V0TG9nZ2Vy
KFN1YnZlcnNpb25IaXN0b3J5UGFyc2VyLkhhbmRsZXIuY2xhc3MuZ2V0TmFtZSgpKTsKICAgICAg
ICAgZmluYWwgU3RyaW5nIHByZWZpeDsKICAgICAgICAgZmluYWwgU3RyaW5nIGhvbWU7CiAgICAg
ICAgIGZpbmFsIGludCBsZW5ndGg7CkBAIC05MSw3ICs5Niw4IEBACiAgICAgICAgICAgICAgICAg
dHJ5IHsKICAgICAgICAgICAgICAgICAgICAgZW50cnkuc2V0RGF0ZShmb3JtYXQucGFyc2Uocykp
OwogICAgICAgICAgICAgICAgIH0gY2F0Y2ggKFBhcnNlRXhjZXB0aW9uIGV4KSB7Ci0gICAgICAg
ICAgICAgICAgICAgIE9wZW5Hcm9rTG9nZ2VyLmdldExvZ2dlcigpLmxvZyhMZXZlbC5TRVZFUkUs
ICJGYWlsZWQgdG8gcGFyc2U6ICIgKyBzLCBleCk7CisgICAgICAgICAgICAgICAgICAgIGxvZ2dl
ci5zZXZlcmUoIkZhaWxlZCB0byBwYXJzZSBkYXRlICIgKyBzICsgIjogIiArIGV4LmdldE1lc3Nh
Z2UoKSk7CisgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5sb2coTGV2ZWwuRklORSwgImVuZEVs
ZW1lbnQiLCBleCk7CiAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgfSBlbHNlIGlmICgi
cGF0aCIuZXF1YWxzKHFuYW1lKSkgewogICAgICAgICAgICAgICAgIGlmIChzLnN0YXJ0c1dpdGgo
cHJlZml4KSkgewpAQCAtMTA1LDcgKzExMSw3IEBACiAgICAgICAgICAgICAgICAgICAgIHBhdGgg
PSBzdHJpbmdJbnRlcm5lci5pbnRlcm4ocGF0aCk7CiAgICAgICAgICAgICAgICAgICAgIGVudHJ5
LmFkZEZpbGUocGF0aCk7CiAgICAgICAgICAgICAgICAgfSBlbHNlIHsKLSAgICAgICAgICAgICAg
ICAgICAgT3Blbkdyb2tMb2dnZXIuZ2V0TG9nZ2VyKCkubG9nKExldmVsLklORk8sICJTa2lwcGlu
ZyBmaWxlIG91dHNpZGUgcmVwb3NpdG9yeTogIiArIHMpOworICAgICAgICAgICAgICAgICAgICBs
b2dnZXIubG9nKExldmVsLkZJTkUsICJTa2lwcGluZyBmaWxlIG91dHNpZGUgcmVwb3NpdG9yeSAn
J3swfScnIiwgcyk7CiAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgfSBlbHNlIGlmICgi
bXNnIi5lcXVhbHMocW5hbWUpKSB7CiAgICAgICAgICAgICAgICAgZW50cnkuc2V0TWVzc2FnZShz
KTsKQEAgLTE1NCw4ICsxNjAsOCBAQAogICAgICAgICBpbnQgc3RhdHVzID0gZXhlY3V0b3IuZXhl
Yyh0cnVlLCB0aGlzKTsKIAogICAgICAgICBpZiAoc3RhdHVzICE9IDApIHsKLSAgICAgICAgICAg
IHRocm93IG5ldyBIaXN0b3J5RXhjZXB0aW9uKCJGYWlsZWQgdG8gZ2V0IGhpc3RvcnkgZm9yOiBc
IiIgKwotICAgICAgICAgICAgICAgICAgICBmaWxlLmdldEFic29sdXRlUGF0aCgpICsgIlwiIEV4
aXQgY29kZTogIiArIHN0YXR1cyk7CisgICAgICAgICAgICB0aHJvdyBuZXcgSGlzdG9yeUV4Y2Vw
dGlvbigiRmFpbGVkIHRvIGdldCBoaXN0b3J5IGZvciAnIiArCisgICAgICAgICAgICAgICAgZmls
ZS5nZXRBYnNvbHV0ZVBhdGgoKSArICInIC0gRXhpdCBjb2RlICIgKyBzdGF0dXMpOwogICAgICAg
ICB9CiAKICAgICAgICAgTGlzdDxIaXN0b3J5RW50cnk+IGVudHJpZXMgPSBoYW5kbGVyLmVudHJp
ZXM7CkBAIC0xODEsNyArMTg3LDkgQEAKICAgICAgICAgICAgIGluaXRTYXhQYXJzZXIoKTsKICAg
ICAgICAgICAgIHNheFBhcnNlci5wYXJzZShuZXcgQnVmZmVyZWRJbnB1dFN0cmVhbShpbnB1dCks
IGhhbmRsZXIpOwogICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewotICAgICAgICAgICAg
T3Blbkdyb2tMb2dnZXIuZ2V0TG9nZ2VyKCkubG9nKExldmVsLlNFVkVSRSwgIkFuIGVycm9yIG9j
Y3VycmVkIHdoaWxlIHBhcnNpbmcgdGhlIHhtbCBvdXRwdXQiLCBlKTsKKyAgICAgICAgICAgIGxv
Z2dlci53YXJuaW5nKCJBbiBlcnJvciBvY2N1cnJlZCB3aGlsZSBwYXJzaW5nIHRoZSBjb21tYW5k
IG91dHB1dCAoeG1sKTogIiAKKyAgICAgICAgICAgICAgICArIGUuZ2V0TWVzc2FnZSgpKTsKKyAg
ICAgICAgICAgIGxvZ2dlci5sb2coTGV2ZWwuRklORSwgInByb2Nlc3NTdHJlYW0iLCBlKTsKICAg
ICAgICAgfQogICAgIH0KIApkaWZmIC1yIDYxNTQ5MDI2YWFmZSAtciAyNjExMTY1MDdjN2Egc3Jj
L29yZy9vcGVuc29sYXJpcy9vcGVuZ3Jvay9oaXN0b3J5L1N1YnZlcnNpb25SZXBvc2l0b3J5Lmph
dmEKLS0tIGEvc3JjL29yZy9vcGVuc29sYXJpcy9vcGVuZ3Jvay9oaXN0b3J5L1N1YnZlcnNpb25S
ZXBvc2l0b3J5LmphdmEJU3VuIEZlYiAxMiAwNDozNzozNiAyMDEyICswMTAwCisrKyBiL3NyYy9v
cmcvb3BlbnNvbGFyaXMvb3Blbmdyb2svaGlzdG9yeS9TdWJ2ZXJzaW9uUmVwb3NpdG9yeS5qYXZh
CU1vbiBGZWIgMTMgMDY6MTI6NDcgMjAxMiArMDEwMApAQCAtMzAsMTMgKzMwLDE0IEBACiBpbXBv
cnQgamF2YS51dGlsLkFycmF5TGlzdDsKIGltcG9ydCBqYXZhLnV0aWwuTGlzdDsKIGltcG9ydCBq
YXZhLnV0aWwubG9nZ2luZy5MZXZlbDsKK2ltcG9ydCBqYXZhLnV0aWwubG9nZ2luZy5Mb2dnZXI7
CiAKIGltcG9ydCBqYXZheC54bWwucGFyc2Vycy5Eb2N1bWVudEJ1aWxkZXI7CiBpbXBvcnQgamF2
YXgueG1sLnBhcnNlcnMuRG9jdW1lbnRCdWlsZGVyRmFjdG9yeTsKIGltcG9ydCBqYXZheC54bWwu
cGFyc2Vycy5QYXJzZXJDb25maWd1cmF0aW9uRXhjZXB0aW9uOwogaW1wb3J0IGphdmF4LnhtbC5w
YXJzZXJzLlNBWFBhcnNlcjsKIGltcG9ydCBqYXZheC54bWwucGFyc2Vycy5TQVhQYXJzZXJGYWN0
b3J5OwotaW1wb3J0IG9yZy5vcGVuc29sYXJpcy5vcGVuZ3Jvay5PcGVuR3Jva0xvZ2dlcjsKKwog
aW1wb3J0IG9yZy5vcGVuc29sYXJpcy5vcGVuZ3Jvay51dGlsLkV4ZWN1dG9yOwogaW1wb3J0IG9y
Zy5vcGVuc29sYXJpcy5vcGVuZ3Jvay51dGlsLklPVXRpbHM7CiBpbXBvcnQgb3JnLnczYy5kb20u
RG9jdW1lbnQ7CkBAIC02MCw2ICs2MSw4IEBACiAgICAgICAgICJvcmcub3BlbnNvbGFyaXMub3Bl
bmdyb2suaGlzdG9yeS5TdWJ2ZXJzaW9uIjsKICAgICAvKiogVGhlIGNvbW1hbmQgdG8gdXNlIHRv
IGFjY2VzcyB0aGUgcmVwb3NpdG9yeSBpZiBub25lIHdhcyBnaXZlbiBleHBsaWNpdGx5ICovCiAg
ICAgcHVibGljIHN0YXRpYyBmaW5hbCBTdHJpbmcgQ01EX0ZBTExCQUNLID0gInN2biI7CisgICAg
cHJpdmF0ZSBzdGF0aWMgZmluYWwgTG9nZ2VyIGxvZ2dlciA9IAorICAgICAgICBMb2dnZXIuZ2V0
TG9nZ2VyKFN1YnZlcnNpb25SZXBvc2l0b3J5LmNsYXNzLmdldE5hbWUoKSk7CiAKICAgICBwcm90
ZWN0ZWQgU3RyaW5nIHJlcG9zUGF0aDsKIApAQCAtMTA4LDEwICsxMTEsOCBAQAogICAgICAgICAg
ICAgICAgICAgICBTdHJpbmcgdXJsID0KICAgICAgICAgICAgICAgICAgICAgICAgIGdldFZhbHVl
KGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCJ1cmwiKS5pdGVtKDApKTsKICAgICAgICAg
ICAgICAgICAgICAgaWYgKHVybCA9PSBudWxsKSB7Ci0gICAgICAgICAgICAgICAgICAgICAgICBP
cGVuR3Jva0xvZ2dlci5nZXRMb2dnZXIoKQotICAgICAgICAgICAgICAgICAgICAgICAgICAgIC53
YXJuaW5nKCJzdm4gaW5mbyBkaWQgbm90IGNvbnRhaW4gYW4gVVJMIGZvciBbIgotICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICArIGRpcmVjdG9yeU5hbWUKLSAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgKyAiXS4gQXNzdW1pbmcgcmVtb3RlIHJlcG9zaXRvcnkuIik7CisgICAg
ICAgICAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZygic3ZuIGluZm8gZGlkIG5vdCBjb250
YWluIGFuIFVSTCBmb3IgJyIKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICArIGRpcmVjdG9y
eU5hbWUgKyAiJy4gQXNzdW1pbmcgcmVtb3RlIHJlcG9zaXRvcnkuIik7CiAgICAgICAgICAgICAg
ICAgICAgICAgICBzZXRSZW1vdGUodHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7
CiAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXVybC5zdGFydHNXaXRoKCJmaWxlIikpIHsK
QEAgLTEyNSwxOSArMTI2LDIxIEBACiAgICAgICAgICAgICAgICAgICAgICAgICByb290Rm91bmQg
PSBCb29sZWFuLlRSVUU7CiAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICB9
IGNhdGNoIChTQVhFeGNlcHRpb24gc2F4ZSkgewotICAgICAgICAgICAgICAgICAgICBPcGVuR3Jv
a0xvZ2dlci5nZXRMb2dnZXIoKS5sb2coTGV2ZWwuV0FSTklORywKLSAgICAgICAgICAgICAgICAg
ICAgICAgICJQYXJzZXIgZXJyb3IgcGFyc2luZyBzdm4gb3V0cHV0Iiwgc2F4ZSk7CisgICAgICAg
ICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKCJQYXJzZXIgZXJyb3IgcGFyc2luZyBzdm4gb3V0
cHV0OiAiIAorICAgICAgICAgICAgICAgICAgICAgICAgKyBzYXhlLmdldE1lc3NhZ2UoKSk7Cisg
ICAgICAgICAgICAgICAgICAgIGxvZ2dlci5sb2coTGV2ZWwuRklORSwgInNldERpcmVjdG9yeU5h
bWUiLCBzYXhlKTsKICAgICAgICAgICAgICAgICB9IGNhdGNoIChQYXJzZXJDb25maWd1cmF0aW9u
RXhjZXB0aW9uIHBjZSkgewotICAgICAgICAgICAgICAgICAgICBPcGVuR3Jva0xvZ2dlci5nZXRM
b2dnZXIoKS5sb2coTGV2ZWwuV0FSTklORywKLSAgICAgICAgICAgICAgICAgICAgICAgICJQYXJz
ZXIgY29uZmlndXJhdGlvbiBlcnJvciBwYXJzaW5nIHN2biBvdXRwdXQiLCBwY2UpOworICAgICAg
ICAgICAgICAgICAgICBsb2dnZXIud2FybmluZygiUGFyc2VyIGNvbmZpZ3VyYXRpb24gZXJyb3Ig
cGFyc2luZyBzdm4gb3V0cHV0OiAiCisgICAgICAgICAgICAgICAgICAgICAgICArIHBjZS5nZXRN
ZXNzYWdlKCkpOworICAgICAgICAgICAgICAgICAgICBsb2dnZXIubG9nKExldmVsLkZJTkUsICJz
ZXREaXJlY3RvcnlOYW1lIiwgcGNlKTsKICAgICAgICAgICAgICAgICB9IGNhdGNoIChJT0V4Y2Vw
dGlvbiBpb2UpIHsKLSAgICAgICAgICAgICAgICAgICAgT3Blbkdyb2tMb2dnZXIuZ2V0TG9nZ2Vy
KCkubG9nKExldmVsLldBUk5JTkcsCi0gICAgICAgICAgICAgICAgICAgICAgICAiSU9FeGNlcHRp
b24gcmVhZGluZyBmcm9tIHN2biBwcm9jZXNzIiwgaW9lKTsKKyAgICAgICAgICAgICAgICAgICAg
bG9nZ2VyLndhcm5pbmcoIklPRXhjZXB0aW9uIHJlYWRpbmcgZnJvbSBzdm4gcHJvY2VzczogIiAK
KyAgICAgICAgICAgICAgICAgICAgICAgICsgaW9lLmdldE1lc3NhZ2UoKSk7CisgICAgICAgICAg
ICAgICAgICAgIGxvZ2dlci5sb2coTGV2ZWwuRklORSwgInNldERpcmVjdG9yeU5hbWUiLCBpb2Up
OwogICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgIH0gZWxzZSB7Ci0gICAgICAgICAgICAg
ICAgT3Blbkdyb2tMb2dnZXIuZ2V0TG9nZ2VyKCkKLSAgICAgICAgICAgICAgICAgICAgICAgIC53
YXJuaW5nKCJGYWlsZWQgdG8gZXhlY3V0ZSBzdm4gaW5mbyBmb3IgWyIKLSAgICAgICAgICAgICAg
ICAgICAgICAgICAgICArIGRpcmVjdG9yeU5hbWUgKyAiXS4gUmVwb3NpdG9yeSBkaXNhYmxlZC4i
KTsKKyAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZygiRmFpbGVkIHRvIGV4ZWN1dGUgc3Zu
IGluZm8gZm9yICciCisgICAgICAgICAgICAgICAgICAgICsgZGlyZWN0b3J5TmFtZSArICInLiBS
ZXBvc2l0b3J5IGRpc2FibGVkLiIpOwogICAgICAgICAgICAgfQogCiAgICAgICAgICAgICBzZXRX
b3JraW5nKHJvb3RGb3VuZCk7CkBAIC0yNzcsOCArMjgwLDggQEAKICAgICAgICAgdHJ5IHsKICAg
ICAgICAgICAgIHNheFBhcnNlciA9IGZhY3RvcnkubmV3U0FYUGFyc2VyKCk7CiAgICAgICAgIH0g
Y2F0Y2ggKEV4Y2VwdGlvbiBleCkgewotICAgICAgICAgICAgSU9FeGNlcHRpb24gZXJyID0gbmV3
IElPRXhjZXB0aW9uKCJGYWlsZWQgdG8gY3JlYXRlIFNBWCBwYXJzZXIiLCBleCk7Ci0gICAgICAg
ICAgICB0aHJvdyBlcnI7CisgICAgICAgICAgICB0aHJvdyBuZXcgSU9FeGNlcHRpb24oIkZhaWxl
ZCB0byBjcmVhdGUgU0FYIHBhcnNlciAoIgorICAgICAgICAgICAgICAgICsgIGV4LmdldE1lc3Nh
Z2UoKSArICIpIik7CiAgICAgICAgIH0KIAogICAgICAgICBBcnJheUxpc3Q8U3RyaW5nPiBhcmd2
ID0gbmV3IEFycmF5TGlzdDxTdHJpbmc+KCk7CkBAIC0zMDcsOCArMzEwLDkgQEAKICAgICAgICAg
ICAgICAgICBzYXhQYXJzZXIucGFyc2UoaW4sIGhhbmRsZXIpOwogICAgICAgICAgICAgICAgIHJl
dCA9IGhhbmRsZXIuYW5ub3RhdGlvbjsKICAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBl
KSB7Ci0gICAgICAgICAgICAgICAgT3Blbkdyb2tMb2dnZXIuZ2V0TG9nZ2VyKCkubG9nKExldmVs
LlNFVkVSRSwKLSAgICAgICAgICAgICAgICAgICAgIkFuIGVycm9yIG9jY3VycmVkIHdoaWxlIHBh
cnNpbmcgdGhlIHhtbCBvdXRwdXQiLCBlKTsKKyAgICAgICAgICAgICAgICBsb2dnZXIuc2V2ZXJl
KCJBbiBlcnJvciBvY2N1cnJlZCB3aGlsZSBwYXJzaW5nIHRoZSBjb21tYW5kIG91dHB1dCAoeG1s
KTogIgorICAgICAgICAgICAgICAgICAgICArIGUuZ2V0TWVzc2FnZSgpKTsKKyAgICAgICAgICAg
ICAgICBsb2dnZXIubG9nKExldmVsLkZJTkUsICJhbm5vdGF0ZSIsIGUpOwogICAgICAgICAgICAg
fQogICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgSU9VdGlscy5jbG9zZShpbik7CmRp
ZmYgLXIgNjE1NDkwMjZhYWZlIC1yIDI2MTExNjUwN2M3YSBzcmMvb3JnL29wZW5zb2xhcmlzL29w
ZW5ncm9rL2luZGV4L0NvbW1hbmRMaW5lT3B0aW9ucy5qYXZhCi0tLSBhL3NyYy9vcmcvb3BlbnNv
bGFyaXMvb3Blbmdyb2svaW5kZXgvQ29tbWFuZExpbmVPcHRpb25zLmphdmEJU3VuIEZlYiAxMiAw
NDozNzozNiAyMDEyICswMTAwCisrKyBiL3NyYy9vcmcvb3BlbnNvbGFyaXMvb3Blbmdyb2svaW5k
ZXgvQ29tbWFuZExpbmVPcHRpb25zLmphdmEJTW9uIEZlYiAxMyAwNjoxMjo0NyAyMDEyICswMTAw
CkBAIC05Niw3ICs5Niw3IEBACiAgICAgICAgIG9wdGlvbnMuYWRkKG5ldyBPcHRpb24oJ1AnLCBu
dWxsLCAiR2VuZXJhdGUgYSBwcm9qZWN0IGZvciBlYWNoIG9mIHRoZSB0b3AtbGV2ZWwgZGlyZWN0
b3JpZXMgaW4gc291cmNlIHJvb3QiKSk7CiAgICAgICAgIG9wdGlvbnMuYWRkKG5ldyBPcHRpb24o
J3AnLCAiL3BhdGgvdG8vZGVmYXVsdC9wcm9qZWN0IiwgIlRoaXMgaXMgdGhlIHBhdGggdG8gdGhl
IHByb2plY3QgdGhhdCBzaG91bGQgYmUgc2VsZWN0ZWQgYnkgZGVmYXVsdCBpbiB0aGUgd2ViIGFw
cGxpY2F0aW9uKHdoZW4gbm8gb3RoZXIgcHJvamVjdCBzZXQgZWl0aGVyIGluIGNvb2tpZSBvciBp
biBwYXJhbWV0ZXIpLiBZb3Ugc2hvdWxkIHN0cmlwIG9mZiB0aGUgc291cmNlIHJvb3QuIikpOwog
ICAgICAgICBvcHRpb25zLmFkZChuZXcgT3B0aW9uKCdRJywgT05fT0ZGLCAiVHVybiBvbi9vZmYg
cXVpY2sgY29udGV4dCBzY2FuLiBCeSBkZWZhdWx0IG9ubHkgdGhlIGZpcnN0IDMyayBvZiBhIGZp
bGUgaXMgc2Nhbm5lZCwgYW5kIGEgJ1suLmFsbC4uXScgbGluayBpcyBpbnNlcnRlZCBpZiB0aGUg
ZmlsZSBpcyBiaWdnZXIuIEFjdGl2YXRpbmcgdGhpcyBtYXkgc2xvdyB0aGUgc2VydmVyIGRvd24g
KE5vdGU6IHRoaXMgaXMgc2V0dGluZyBvbmx5IGFmZmVjdHMgdGhlIHdlYiBhcHBsaWNhdGlvbiki
KSk7Ci0gICAgICAgIG9wdGlvbnMuYWRkKG5ldyBPcHRpb24oJ3EnLCBudWxsLCAiUnVuIGFzIHF1
aWV0bHkgYXMgcG9zc2libGUiKSk7CisgICAgICAgIG9wdGlvbnMuYWRkKG5ldyBPcHRpb24oJ3En
LCBudWxsLCAiUnVuIGFzIHF1aWV0bHkgYXMgcG9zc2libGUsIHJlc2V0IGNvbnNvbGUgbG9nZ2Vy
cyB0byBzdXBwcmVzcyBtZXNzYWdlcyB3aXRoIGEgc2V2ZXJpdHkgPCBXQVJNSU5HIGFuZCBmaWxl
IGxvZ2dlcnMgdG8gc3VwcmVzcyBtZXNzYWdlcyB3aXRoIGEgc2V2ZXJpdHkgPCBJTkZPIGFzIHdl
bGwgYXMgdmVyYm9zZSBtZXNzYWdlcy4iKSk7CiAgICAgICAgIG9wdGlvbnMuYWRkKG5ldyBPcHRp
b24oJ1InLCAiL3BhdGgvdG8vY29uZmlndXJhdGlvbiIsICJSZWFkIGNvbmZpZ3VyYXRpb24gZnJv
bSB0aGUgc3BlY2lmaWVkIGZpbGUiKSk7CiAgICAgICAgIG9wdGlvbnMuYWRkKG5ldyBPcHRpb24o
J3InLCBPTl9PRkYsICJUdXJuIG9uL29mZiBzdXBwb3J0IGZvciByZW1vdGUgU0NNIHN5c3RlbXMi
KSk7CiAgICAgICAgIG9wdGlvbnMuYWRkKG5ldyBPcHRpb24oJ1MnLCBudWxsLCAiU2VhcmNoIGZv
ciBcImV4dGVybmFsXCIgc291cmNlIHJlcG9zaXRvcmllcyBhbmQgYWRkIHRoZW0iKSk7CkBAIC0x
MDYsNyArMTA2LDcgQEAKICAgICAgICAgb3B0aW9ucy5hZGQobmV3IE9wdGlvbignVScsICJob3N0
OnBvcnQiLCAiU2VuZCB0aGUgY3VycmVudCBjb25maWd1cmF0aW9uIHRvIHRoZSBzcGVjaWZpZWQg
YWRkcmVzcyAoVGhpcyBpcyBtb3N0IGxpa2VseSB0aGUgd2ViLWFwcCBjb25maWd1cmVkIHdpdGgg
Q29uZmlnQWRkcmVzcykiKSk7CiAgICAgICAgIG9wdGlvbnMuYWRkKG5ldyBPcHRpb24oJ3UnLCAi
dXJsIiwgIlVSTCB0byB0aGUgZGF0YWJhc2UgdGhhdCBjb250YWlucyB0aGUgaGlzdG9yeSBjYWNo
ZS4gRGVmYXVsdDogSWYgLWogc3BlY2lmaWVzIFwiZW1iZWRkZWRcIiwgXCJqZGJjOmRlcmJ5OiRE
QVRBX1JPT1QvY2FjaGVkYjtjcmVhdGU9dHJ1ZVwiOyBvdGhlcndpc2UsIFwiamRiYzpkZXJieTov
L2xvY2FsaG9zdC9jYWNoZWRiO2NyZWF0ZT10cnVlXCIiKSk7CiAgICAgICAgIG9wdGlvbnMuYWRk
KG5ldyBPcHRpb24oJ1YnLCBudWxsLCAiUHJpbnQgdmVyc2lvbiBhbmQgcXVpdCIpKTsKLSAgICAg
ICAgb3B0aW9ucy5hZGQobmV3IE9wdGlvbigndicsIG51bGwsICJQcmludCBwcm9ncmVzcyBpbmZv
cm1hdGlvbiBhcyB3ZSBnbyBhbG9uZyIpKTsKKyAgICAgICAgb3B0aW9ucy5hZGQobmV3IE9wdGlv
bigndicsIG51bGwsICJFbmFibGUgdmVyYm9zZSBtZXNzYWdlcywgaS5lLiByZXNldCBjb25zb2xl
IGFuZCBmaWxlIGxvZ2dlcnMgdG8gc3VwcHJlc3MgbWVzc2FnZXMgd2l0aCBhIHNldmVyaXR5IDwg
SU5GTywgb25seS4iKSk7CiAgICAgICAgIG9wdGlvbnMuYWRkKG5ldyBPcHRpb24oJ1cnLCAiL3Bh
dGgvdG8vY29uZmlndXJhdGlvbiIsICJXcml0ZSB0aGUgY3VycmVudCBjb25maWd1cmF0aW9uIHRv
IHRoZSBzcGVjaWZpZWQgZmlsZSAoc28gdGhhdCB0aGUgd2ViIGFwcGxpY2F0aW9uIGNhbiB1c2Ug
dGhlIHNhbWUgY29uZmlndXJhdGlvbiIpKTsKICAgICAgICAgb3B0aW9ucy5hZGQobmV3IE9wdGlv
bigndycsICJ3ZWJhcHAtY29udGV4dCIsICJDb250ZXh0IG9mIHdlYmFwcC4gRGVmYXVsdCBpcyAv
c291cmNlLiBJZiB5b3Ugc3BlY2lmeSBhIGRpZmZlcmVudCBuYW1lLCBtYWtlIHN1cmUgdG8gcmVu
YW1lIHNvdXJjZS53YXIgdG8gdGhhdCBuYW1lLiIpKTsKICAgICAgICAgb3B0aW9ucy5hZGQobmV3
IE9wdGlvbignWCcsICJ1cmw6c3VmZml4IiwgIlVSTCBTdWZmaXggZm9yIHRoZSB1c2VyIEluZm9y
bWF0aW9uIHByb3ZpZGVyLiBEZWZhdWx0OiBcIlwiIikpOwpkaWZmIC1yIDYxNTQ5MDI2YWFmZSAt
ciAyNjExMTY1MDdjN2Egc3JjL29yZy9vcGVuc29sYXJpcy9vcGVuZ3Jvay9pbmRleC9EZWZhdWx0
SW5kZXhDaGFuZ2VkTGlzdGVuZXIuamF2YQotLS0gYS9zcmMvb3JnL29wZW5zb2xhcmlzL29wZW5n
cm9rL2luZGV4L0RlZmF1bHRJbmRleENoYW5nZWRMaXN0ZW5lci5qYXZhCVN1biBGZWIgMTIgMDQ6
Mzc6MzYgMjAxMiArMDEwMAorKysgYi9zcmMvb3JnL29wZW5zb2xhcmlzL29wZW5ncm9rL2luZGV4
L0RlZmF1bHRJbmRleENoYW5nZWRMaXN0ZW5lci5qYXZhCU1vbiBGZWIgMTMgMDY6MTI6NDcgMjAx
MiArMDEwMApAQCAtMzgsMjcgKzM4LDI5IEBACiAKICAgICBAT3ZlcnJpZGUKICAgICBwdWJsaWMg
dm9pZCBmaWxlQWRkKFN0cmluZyBwYXRoLCBTdHJpbmcgYW5hbHl6ZXIpIHsKLSAgICAgICAgaWYg
KGxvZy5pc0xvZ2dhYmxlKExldmVsLklORk8pKSB7Ci0gICAgICAgICAgICBsb2cubG9nKExldmVs
LklORk8sICJBZGQ6IHswfSAoezF9KSIsIG5ldyBPYmplY3RbXXtwYXRoLCBhbmFseXplcn0pO30K
KyAgICAgICAgaWYgKGxvZy5pc0xvZ2dhYmxlKExldmVsLkZJTkUpKSB7CisgICAgICAgICAgICBs
b2cubG9nKExldmVsLkZJTkUsICJBZGQgZmlsZSAnJ3swfScnICh7MX0pIiwgbmV3IE9iamVjdFtd
e3BhdGgsIGFuYWx5emVyfSk7CisgICAgICAgIH0KICAgICB9CiAKICAgICBAT3ZlcnJpZGUKICAg
ICBwdWJsaWMgdm9pZCBmaWxlUmVtb3ZlKFN0cmluZyBwYXRoKSB7Ci0gICAgICAgIGxvZy5sb2co
TGV2ZWwuSU5GTywgIlJlbW92ZSBmaWxlOnswfSIsIHBhdGgpOworICAgICAgICBsb2cubG9nKExl
dmVsLkZJTkUsICJSZW1vdmUgZmlsZSAnJ3swfScnIiwgcGF0aCk7CiAgICAgfQogICAgIEBPdmVy
cmlkZQogICAgIHB1YmxpYyB2b2lkIGZpbGVVcGRhdGUoU3RyaW5nIHBhdGgpIHsKLSAgICAgICAg
bG9nLmxvZyhMZXZlbC5JTkZPLCAiVXBkYXRlOiB7MH0iLCBwYXRoKTsKKyAgICAgICAgbG9nLmxv
ZyhMZXZlbC5GSU5FLCAiVXBkYXRlIGZpbGUgJyd7MH0nJyIsIHBhdGgpOwogICAgIH0KIAogICAg
IEBPdmVycmlkZQogICAgIHB1YmxpYyB2b2lkIGZpbGVBZGRlZChTdHJpbmcgcGF0aCwgU3RyaW5n
IGFuYWx5emVyKSB7CiAgICAgICAgIGlmIChsb2cuaXNMb2dnYWJsZShMZXZlbC5GSU5FUikpIHsK
LSAgICAgICAgICAgIGxvZy5sb2coTGV2ZWwuRklORVIsICJBZGRlZDogezB9ICh7MX0pIiwgbmV3
IE9iamVjdFtde3BhdGgsIGFuYWx5emVyfSk7fQorICAgICAgICAgICAgbG9nLmxvZyhMZXZlbC5G
SU5FUiwgIkFkZGVkIGZpbGUgJyd7MH0nJyAoezF9KSIsIG5ldyBPYmplY3RbXXtwYXRoLCBhbmFs
eXplcn0pOworICAgICAgICB9CiAgICAgfQogCiAgICAgQE92ZXJyaWRlCiAgICAgcHVibGljIHZv
aWQgZmlsZVJlbW92ZWQoU3RyaW5nIHBhdGgpIHsKLSAgICAgICAgbG9nLmxvZyhMZXZlbC5GSU5F
UiwgIlJlbW92ZWQgZmlsZTp7MH0iLCBwYXRoKTsKKyAgICAgICAgbG9nLmxvZyhMZXZlbC5GSU5F
UiwgIlJlbW92ZWQgZmlsZSAnJ3swfScnIiwgcGF0aCk7CiAgICAgfQogfQpkaWZmIC1yIDYxNTQ5
MDI2YWFmZSAtciAyNjExMTY1MDdjN2Egc3JjL29yZy9vcGVuc29sYXJpcy9vcGVuZ3Jvay9pbmRl
eC9JbmRleERhdGFiYXNlLmphdmEKLS0tIGEvc3JjL29yZy9vcGVuc29sYXJpcy9vcGVuZ3Jvay9p
bmRleC9JbmRleERhdGFiYXNlLmphdmEJU3VuIEZlYiAxMiAwNDozNzozNiAyMDEyICswMTAwCisr
KyBiL3NyYy9vcmcvb3BlbnNvbGFyaXMvb3Blbmdyb2svaW5kZXgvSW5kZXhEYXRhYmFzZS5qYXZh
CU1vbiBGZWIgMTMgMDY6MTI6NDcgMjAxMiArMDEwMApAQCAtMzYsMTMgKzM2LDE4IEBACiBpbXBv
cnQgamF2YS51dGlsLmNvbmN1cnJlbnQuRXhlY3V0b3JTZXJ2aWNlOwogaW1wb3J0IGphdmEudXRp
bC5sb2dnaW5nLkxldmVsOwogaW1wb3J0IGphdmEudXRpbC5sb2dnaW5nLkxvZ2dlcjsKKwogaW1w
b3J0IG9yZy5hcGFjaGUubHVjZW5lLmFuYWx5c2lzLkFuYWx5emVyOwogaW1wb3J0IG9yZy5hcGFj
aGUubHVjZW5lLmFuYWx5c2lzLnN0YW5kYXJkLlN0YW5kYXJkQW5hbHl6ZXI7CiBpbXBvcnQgb3Jn
LmFwYWNoZS5sdWNlbmUuZG9jdW1lbnQuRGF0ZVRvb2xzOwogaW1wb3J0IG9yZy5hcGFjaGUubHVj
ZW5lLmRvY3VtZW50LkRvY3VtZW50OwogaW1wb3J0IG9yZy5hcGFjaGUubHVjZW5lLmRvY3VtZW50
LkZpZWxkYWJsZTsKLWltcG9ydCBvcmcuYXBhY2hlLmx1Y2VuZS5pbmRleC4qOworaW1wb3J0IG9y
Zy5hcGFjaGUubHVjZW5lLmluZGV4LkluZGV4UmVhZGVyOworaW1wb3J0IG9yZy5hcGFjaGUubHVj
ZW5lLmluZGV4LkluZGV4V3JpdGVyOworaW1wb3J0IG9yZy5hcGFjaGUubHVjZW5lLmluZGV4Lklu
ZGV4V3JpdGVyQ29uZmlnOwogaW1wb3J0IG9yZy5hcGFjaGUubHVjZW5lLmluZGV4LkluZGV4V3Jp
dGVyQ29uZmlnLk9wZW5Nb2RlOworaW1wb3J0IG9yZy5hcGFjaGUubHVjZW5lLmluZGV4LlRlcm07
CitpbXBvcnQgb3JnLmFwYWNoZS5sdWNlbmUuaW5kZXguVGVybUVudW07CiBpbXBvcnQgb3JnLmFw
YWNoZS5sdWNlbmUucXVlcnlQYXJzZXIuUGFyc2VFeGNlcHRpb247CiBpbXBvcnQgb3JnLmFwYWNo
ZS5sdWNlbmUuc2VhcmNoLkluZGV4U2VhcmNoZXI7CiBpbXBvcnQgb3JnLmFwYWNoZS5sdWNlbmUu
c2VhcmNoLlF1ZXJ5OwpAQCAtNTMsNyArNTgsNiBAQAogaW1wb3J0IG9yZy5hcGFjaGUubHVjZW5l
LnN0b3JlLkxvY2tGYWN0b3J5OwogaW1wb3J0IG9yZy5hcGFjaGUubHVjZW5lLnN0b3JlLk5vTG9j
a0ZhY3Rvcnk7CiBpbXBvcnQgb3JnLmFwYWNoZS5sdWNlbmUuc3RvcmUuU2ltcGxlRlNMb2NrRmFj
dG9yeTsKLWltcG9ydCBvcmcuYXBhY2hlLmx1Y2VuZS51dGlsLlZlcnNpb247CiBpbXBvcnQgb3Jn
Lm9wZW5zb2xhcmlzLm9wZW5ncm9rLmFuYWx5c2lzLkFuYWx5emVyR3VydTsKIGltcG9ydCBvcmcu
b3BlbnNvbGFyaXMub3Blbmdyb2suYW5hbHlzaXMuQ3RhZ3M7CiBpbXBvcnQgb3JnLm9wZW5zb2xh
cmlzLm9wZW5ncm9rLmFuYWx5c2lzLkRlZmluaXRpb25zOwpAQCAtNjUsNyArNjksNyBAQAogaW1w
b3J0IG9yZy5vcGVuc29sYXJpcy5vcGVuZ3Jvay5oaXN0b3J5Lkhpc3RvcnlHdXJ1OwogaW1wb3J0
IG9yZy5vcGVuc29sYXJpcy5vcGVuZ3Jvay5zZWFyY2guUXVlcnlCdWlsZGVyOwogaW1wb3J0IG9y
Zy5vcGVuc29sYXJpcy5vcGVuZ3Jvay5zZWFyY2guU2VhcmNoRW5naW5lOwotaW1wb3J0IG9yZy5v
cGVuc29sYXJpcy5vcGVuZ3Jvay51dGlsLkV4ZWN1dG9yOworaW1wb3J0IG9yZy5vcGVuc29sYXJp
cy5vcGVuZ3Jvay51dGlsLklPVXRpbHM7CiBpbXBvcnQgb3JnLm9wZW5zb2xhcmlzLm9wZW5ncm9r
LndlYi5VdGlsOwogCiAvKioKQEAgLTkzLDcgKzk3LDcgQEAKICAgICBwcml2YXRlIGJvb2xlYW4g
ZGlydHk7CiAgICAgcHJpdmF0ZSBib29sZWFuIHJ1bm5pbmc7CiAgICAgcHJpdmF0ZSBMaXN0PFN0
cmluZz4gZGlyZWN0b3JpZXM7Ci0gICAgc3RhdGljIGZpbmFsIExvZ2dlciBsb2cgPSBMb2dnZXIu
Z2V0TG9nZ2VyKEluZGV4RGF0YWJhc2UuY2xhc3MuZ2V0TmFtZSgpKTsKKyAgICBzdGF0aWMgZmlu
YWwgTG9nZ2VyIGxvZ2dlciA9IExvZ2dlci5nZXRMb2dnZXIoSW5kZXhEYXRhYmFzZS5jbGFzcy5n
ZXROYW1lKCkpOwogICAgIHByaXZhdGUgQ3RhZ3MgY3RhZ3M7CiAgICAgcHJpdmF0ZSBMb2NrRmFj
dG9yeSBsb2NrZmFjdDsKIApAQCAtMTU5LDcgKzE2Myw4IEBACiAgICAgICAgICAgICAgICAgICAg
IHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICBkYi51cGRhdGUoKTsKICAgICAgICAgICAg
ICAgICAgICAgfSBjYXRjaCAoVGhyb3dhYmxlIGUpIHsKLSAgICAgICAgICAgICAgICAgICAgICAg
IGxvZy5sb2coTGV2ZWwuU0VWRVJFLCJQcm9ibGVtIHVwZGF0aW5nIGx1Y2VuZSBpbmRleCBkYXRh
YmFzZTogIixlKTsKKyAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKCJQcm9i
bGVtIHVwZGF0aW5nICIgKyBkYiArICI6ICIrIGUuZ2V0TWVzc2FnZSgpKTsKKyAgICAgICAgICAg
ICAgICAgICAgICAgIGxvZ2dlci5sb2coTGV2ZWwuRklORSwgInVwZGF0ZUFsbCIsIGUpOwogICAg
ICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgfSk7CkBA
IC0xNzEsMTggKzE3NiwxNyBAQAogICAgICAqIEBwYXJhbSBleGVjdXRvciBBbiBleGVjdXRvciB0
byBydW4gdGhlIGpvYgogICAgICAqIEBwYXJhbSBsaXN0ZW5lciB3aGVyZSB0byBzaWduYWwgdGhl
IGNoYW5nZXMgdG8gdGhlIGRhdGFiYXNlCiAgICAgICogQHBhcmFtIHBhdGhzCi0gICAgICogQHRo
cm93cyBJT0V4Y2VwdGlvbiBpZiBhbiBlcnJvciBvY2N1cnMKICAgICAgKi8KLSAgICBwdWJsaWMg
c3RhdGljIHZvaWQgdXBkYXRlKEV4ZWN1dG9yU2VydmljZSBleGVjdXRvciwgSW5kZXhDaGFuZ2Vk
TGlzdGVuZXIgbGlzdGVuZXIsIExpc3Q8U3RyaW5nPiBwYXRocykgdGhyb3dzIElPRXhjZXB0aW9u
IHsKKyAgICBwdWJsaWMgc3RhdGljIHZvaWQgdXBkYXRlKEV4ZWN1dG9yU2VydmljZSBleGVjdXRv
ciwgSW5kZXhDaGFuZ2VkTGlzdGVuZXIgbGlzdGVuZXIsIExpc3Q8U3RyaW5nPiBwYXRocykgewog
ICAgICAgICBSdW50aW1lRW52aXJvbm1lbnQgZW52ID0gUnVudGltZUVudmlyb25tZW50LmdldElu
c3RhbmNlKCk7CiAgICAgICAgIExpc3Q8SW5kZXhEYXRhYmFzZT4gZGJzID0gbmV3IEFycmF5TGlz
dDxJbmRleERhdGFiYXNlPigpOwogCiAgICAgICAgIGZvciAoU3RyaW5nIHBhdGggOiBwYXRocykg
ewogICAgICAgICAgICAgUHJvamVjdCBwcm9qZWN0ID0gUHJvamVjdC5nZXRQcm9qZWN0KHBhdGgp
OwogICAgICAgICAgICAgaWYgKHByb2plY3QgPT0gbnVsbCAmJiBlbnYuaGFzUHJvamVjdHMoKSkg
ewotICAgICAgICAgICAgICAgIGxvZy5sb2coTGV2ZWwuV0FSTklORywgIkNvdWxkIG5vdCBmaW5k
IGEgcHJvamVjdCBmb3IgXCJ7MH1cIiIsIHBhdGgpOworICAgICAgICAgICAgICAgIGxvZ2dlci53
YXJuaW5nKCJDb3VsZCBub3QgZmluZCBhIHByb2plY3QgZm9yICciICsgIHBhdGggKyAiJyIpOwog
ICAgICAgICAgICAgfSBlbHNlIHsKLSAgICAgICAgICAgICAgICBJbmRleERhdGFiYXNlIGRiOwor
ICAgICAgICAgICAgICAgIEluZGV4RGF0YWJhc2UgZGIgPSBudWxsOwogCiAgICAgICAgICAgICAg
ICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgaWYgKHByb2plY3QgPT0gbnVsbCkgewpAQCAt
MjAxLDExICsyMDUsMTIgQEAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYnMuYWRkKGRi
KTsKICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgfSBlbHNl
IHsKLSAgICAgICAgICAgICAgICAgICAgICAgIGxvZy5sb2coTGV2ZWwuV0FSTklORywgIkRpcmVj
dG9yeSBkb2VzIG5vdCBleGlzdCBcInswfVwiIiwgcGF0aCk7CisgICAgICAgICAgICAgICAgICAg
ICAgICBsb2dnZXIud2FybmluZygiRGlyZWN0b3J5IGRvZXMgbm90IGV4aXN0ICciICsgcGF0aCAr
ICInIik7CiAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICB9IGNhdGNoIChJ
T0V4Y2VwdGlvbiBlKSB7Ci0gICAgICAgICAgICAgICAgICAgIGxvZy5sb2coTGV2ZWwuV0FSTklO
RywgIkFuIGVycm9yIG9jY3VyZWQgd2hpbGUgdXBkYXRpbmcgaW5kZXgiLCBlKTsKLQorICAgICAg
ICAgICAgICAgICAgICBsb2dnZXIud2FybmluZygiQW4gZXJyb3Igb2NjdXJlZCB3aGlsZSB1cGRh
dGluZyAiCisgICAgICAgICAgICAgICAgICAgICAgICArIGRiICsgIjogIiArIGUuZ2V0TWVzc2Fn
ZSgpKTsKKyAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmxvZyhMZXZlbC5GSU5FLCAidXBkYXRl
IiwgZSk7CiAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgfQogCkBAIC0yMTgsNyArMjIz
LDkgQEAKICAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgZGIudXBkYXRlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChU
aHJvd2FibGUgZSkgewotICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZy5sb2coTGV2ZWwu
U0VWRVJFLCAiQW4gZXJyb3Igb2NjdXJlZCB3aGlsZSB1cGRhdGluZyBpbmRleCIsIGUpOworICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKCJBbiBlcnJvciBvY2N1cmVk
IHdoaWxlIHVwZGF0aW5nICIKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyBkYiAr
ICI6ICIgKyBlLmdldExvY2FsaXplZE1lc3NhZ2UoKSk7CisgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgbG9nZ2VyLmxvZyhMZXZlbC5GSU5FLCAicnVuIiwgZSk7CiAgICAgICAgICAgICAgICAg
ICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICB9KTsKQEAg
LTI0MCwxMyArMjQ3LDE1IEBACiAgICAgICAgICAgICBpZiAoIWluZGV4RGlyLmV4aXN0cygpICYm
ICFpbmRleERpci5ta2RpcnMoKSkgewogICAgICAgICAgICAgICAgIC8vIHRvIGF2b2lkIHJhY2Ug
Y29uZGl0aW9ucywganVzdCByZWNoZWNrLi4KICAgICAgICAgICAgICAgICBpZiAoIWluZGV4RGly
LmV4aXN0cygpKSB7Ci0gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBGaWxlTm90Rm91bmRF
eGNlcHRpb24oIkZhaWxlZCB0byBjcmVhdGUgcm9vdCBkaXJlY3RvcnkgWyIgKyBpbmRleERpci5n
ZXRBYnNvbHV0ZVBhdGgoKSArICJdIik7CisgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBG
aWxlTm90Rm91bmRFeGNlcHRpb24oIkZhaWxlZCB0byBjcmVhdGUgcm9vdCBkaXJlY3RvcnkgJyIg
CisgICAgICAgICAgICAgICAgICAgICAgICArIGluZGV4RGlyLmdldEFic29sdXRlUGF0aCgpICsg
IiciKTsKICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICB9CiAKICAgICAgICAgICAgIGlm
ICghc3BlbGxEaXIuZXhpc3RzKCkgJiYgIXNwZWxsRGlyLm1rZGlycygpKSB7CiAgICAgICAgICAg
ICAgICAgaWYgKCFzcGVsbERpci5leGlzdHMoKSkgewotICAgICAgICAgICAgICAgICAgICB0aHJv
dyBuZXcgRmlsZU5vdEZvdW5kRXhjZXB0aW9uKCJGYWlsZWQgdG8gY3JlYXRlIHJvb3QgZGlyZWN0
b3J5IFsiICsgc3BlbGxEaXIuZ2V0QWJzb2x1dGVQYXRoKCkgKyAiXSIpOworICAgICAgICAgICAg
ICAgICAgICB0aHJvdyBuZXcgRmlsZU5vdEZvdW5kRXhjZXB0aW9uKCJGYWlsZWQgdG8gY3JlYXRl
IHJvb3QgZGlyZWN0b3J5ICciIAorICAgICAgICAgICAgICAgICAgICAgICAgKyBzcGVsbERpci5n
ZXRBYnNvbHV0ZVBhdGgoKSArICInIik7CiAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg
fQogCkBAIC0zMDAsNyArMzA5LDcgQEAKICAgICBwdWJsaWMgdm9pZCB1cGRhdGUoKSB0aHJvd3Mg
SU9FeGNlcHRpb24sIEhpc3RvcnlFeGNlcHRpb24gewogICAgICAgICBzeW5jaHJvbml6ZWQgKGxv
Y2spIHsKICAgICAgICAgICAgIGlmIChydW5uaW5nKSB7Ci0gICAgICAgICAgICAgICAgdGhyb3cg
bmV3IElPRXhjZXB0aW9uKCJJbmRleGVyIGFscmVhZHkgcnVubmluZyEiKTsKKyAgICAgICAgICAg
ICAgICB0aHJvdyBuZXcgSU9FeGNlcHRpb24oIkluZGV4ZXIgYWxyZWFkeSBydW5uaW5nIik7CiAg
ICAgICAgICAgICB9CiAgICAgICAgICAgICBydW5uaW5nID0gdHJ1ZTsKICAgICAgICAgICAgIGlu
dGVycnVwdGVkID0gZmFsc2U7CkBAIC0zMTIsNyArMzIxLDcgQEAKICAgICAgICAgICAgIGN0YWdz
LnNldEJpbmFyeShjdGdzKTsKICAgICAgICAgfQogICAgICAgICBpZiAoY3RhZ3MgPT0gbnVsbCkg
ewotICAgICAgICAgICAgbG9nLnNldmVyZSgiVW5hYmxlIHRvIHJ1biBjdGFncyEgc2VhcmNoaW5n
IGRlZmluaXRpb25zIHdpbGwgbm90IHdvcmshIik7CisgICAgICAgICAgICBsb2dnZXIud2Fybmlu
ZygiVW5hYmxlIHRvIHJ1biBjdGFncyEgU2VhcmNoaW5nIGRlZmluaXRpb25zIHdpbGwgbm90IHdv
cmshIik7CiAgICAgICAgIH0KIAogICAgICAgICB0cnkgewpAQCAtMzUxLDE2ICszNjAsMTkgQEAK
ICAgICAgICAgICAgICAgICAgICAgLy9UT0RPIGJlbG93IHNob3VsZCBiZSBvcHRpb25hbCwgc2lu
Y2UgaXQgdHJhdmVyc2VzIHRoZSB0cmVlIG9uY2UgbW9yZSB0byBnZXQgdG90YWwgY291bnQhIDoo
CiAgICAgICAgICAgICAgICAgICAgIGludCBmaWxlX2NudCA9IDA7CiAgICAgICAgICAgICAgICAg
ICAgIGlmIChSdW50aW1lRW52aXJvbm1lbnQuZ2V0SW5zdGFuY2UoKS5pc1ByaW50UHJvZ3Jlc3Mo
KSkgewotICAgICAgICAgICAgICAgICAgICAgbG9nLmxvZyhMZXZlbC5JTkZPLCAiQ291bnRpbmcg
ZmlsZXMgaW4gezB9IC4uLiIsIGRpcik7Ci0gICAgICAgICAgICAgICAgICAgICBmaWxlX2NudCA9
IGluZGV4RG93bihzb3VyY2VSb290LCBkaXIsIHRydWUsIDAsIDApOwotICAgICAgICAgICAgICAg
ICAgICAgaWYgKGxvZy5pc0xvZ2dhYmxlKExldmVsLklORk8pKSB7Ci0gICAgICAgICAgICAgICAg
ICAgICAgbG9nLmxvZyhMZXZlbC5JTkZPLCAiTmVlZCB0byBwcm9jZXNzOiB7MH0gZmlsZXMgZm9y
IHsxfSIsIG5ldyBPYmplY3RbXXtmaWxlX2NudCxkaXJ9KTsKLSAgICAgICAgICAgICAgICAgICAg
IH0KKyAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5sb2coTGV2ZWwuSU5GTywgIkNvdW50
aW5nIGZpbGVzIGluICcnezB9JycgLi4uIiwgZGlyKTsKKyAgICAgICAgICAgICAgICAgICAgICAg
IGZpbGVfY250ID0gaW5kZXhEb3duKHNvdXJjZVJvb3QsIGRpciwgdHJ1ZSwgMCwgMCk7CisgICAg
ICAgICAgICAgICAgICAgICAgICBpZiAobG9nZ2VyLmlzTG9nZ2FibGUoTGV2ZWwuSU5GTykpIHsK
KyAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIubG9nKExldmVsLklORk8sICJOZWVk
IHRvIHByb2Nlc3MgezB9IGZpbGVzIGZvciAnJ3sxfScnIiwgCisgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIG5ldyBPYmplY3RbXSB7IGZpbGVfY250LCBkaXIgfSk7CisgICAgICAgICAg
ICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgIH0KIAogICAgICAgICAgICAgICAg
ICAgICBpbmRleERvd24oc291cmNlUm9vdCwgZGlyLCBmYWxzZSwgMCwgZmlsZV9jbnQpOwogCi0g
ICAgICAgICAgICAgICAgICAgIHdoaWxlICh1aWRJdGVyLnRlcm0oKSAhPSBudWxsICYmIHVpZEl0
ZXIudGVybSgpLmZpZWxkKCkuZXF1YWxzKCJ1IikgJiYgdWlkSXRlci50ZXJtKCkudGV4dCgpLnN0
YXJ0c1dpdGgoc3RhcnR1aWQpKSB7CisgICAgICAgICAgICAgICAgICAgIHdoaWxlICh1aWRJdGVy
LnRlcm0oKSAhPSBudWxsICYmIHVpZEl0ZXIudGVybSgpLmZpZWxkKCkuZXF1YWxzKCJ1IikgCisg
ICAgICAgICAgICAgICAgICAgICAgICAmJiB1aWRJdGVyLnRlcm0oKS50ZXh0KCkuc3RhcnRzV2l0
aChzdGFydHVpZCkpIAorICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAg
ICAgICByZW1vdmVGaWxlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICB1aWRJdGVyLm5leHQo
KTsKICAgICAgICAgICAgICAgICAgICAgfQpAQCAtMzY5LDIwICszODEsOSBAQAogICAgICAgICAg
ICAgICAgIH0KICAgICAgICAgICAgIH0KICAgICAgICAgfSBmaW5hbGx5IHsKLSAgICAgICAgICAg
IGlmICh3cml0ZXIgIT0gbnVsbCkgewotICAgICAgICAgICAgICAgIHRyeSB7Ci0gICAgICAgICAg
ICAgICAgICAgIHdyaXRlci5jbG9zZSgpOwotICAgICAgICAgICAgICAgIH0gY2F0Y2ggKElPRXhj
ZXB0aW9uIGUpIHsKLSAgICAgICAgICAgICAgICAgICAgbG9nLmxvZyhMZXZlbC5XQVJOSU5HLCAi
QW4gZXJyb3Igb2NjdXJlZCB3aGlsZSBjbG9zaW5nIHdyaXRlciIsIGUpOwotICAgICAgICAgICAg
ICAgIH0KLSAgICAgICAgICAgIH0KLQorICAgICAgICAgICAgSU9VdGlscy5jbG9zZSh3cml0ZXIp
OwogICAgICAgICAgICAgaWYgKGN0YWdzICE9IG51bGwpIHsKLSAgICAgICAgICAgICAgICB0cnkg
ewotICAgICAgICAgICAgICAgICAgICBjdGFncy5jbG9zZSgpOwotICAgICAgICAgICAgICAgIH0g
Y2F0Y2ggKElPRXhjZXB0aW9uIGUpIHsKLSAgICAgICAgICAgICAgICAgICAgbG9nLmxvZyhMZXZl
bC5XQVJOSU5HLCAiQW4gZXJyb3Igb2NjdXJlZCB3aGlsZSBjbG9zaW5nIGN0YWdzIHByb2Nlc3Mi
LCBlKTsKLSAgICAgICAgICAgICAgICB9CisgICAgICAgICAgICAgICAgY3RhZ3MuY2xvc2UoKTsK
ICAgICAgICAgICAgIH0KIAogICAgICAgICAgICAgc3luY2hyb25pemVkIChsb2NrKSB7CkBAIC0z
OTksMTIgKzQwMCwxNCBAQAogICAgICAgICAgICAgRmlsZSB0aW1lc3RhbXAgPSBuZXcgRmlsZShl
bnYuZ2V0RGF0YVJvb3RGaWxlKCksICJ0aW1lc3RhbXAiKTsKICAgICAgICAgICAgIGlmICh0aW1l
c3RhbXAuZXhpc3RzKCkpIHsKICAgICAgICAgICAgICAgICBpZiAoIXRpbWVzdGFtcC5zZXRMYXN0
TW9kaWZpZWQoU3lzdGVtLmN1cnJlbnRUaW1lTWlsbGlzKCkpKSB7Ci0gICAgICAgICAgICAgICAg
ICAgbG9nLmxvZyhMZXZlbC5XQVJOSU5HLCAiRmFpbGVkIHRvIHNldCBsYXN0IG1vZGlmaWVkIHRp
bWUgb24gJyd7MH0nJywgdXNlZCBmb3IgdGltZXN0YW1waW5nIHRoZSBpbmRleCBkYXRhYmFzZS4i
LCB0aW1lc3RhbXAuZ2V0QWJzb2x1dGVQYXRoKCkpOworICAgICAgICAgICAgICAgICAgIGxvZ2dl
ci53YXJuaW5nKCJGYWlsZWQgdG8gc2V0IGxhc3QgbW9kaWZpZWQgdGltZSBvbiAnIiAKKyAgICAg
ICAgICAgICAgICAgICAgICAgKyB0aW1lc3RhbXAuZ2V0QWJzb2x1dGVQYXRoKCkgCisgICAgICAg
ICAgICAgICAgICAgICAgICsgIid1c2VkIGZvciB0aW1lc3RhbXBpbmcgdGhlIGluZGV4IGRhdGFi
YXNlIik7CiAgICAgICAgICAgICAgICAgfQotICAgICAgICAgICAgfSBlbHNlIHsKLSAgICAgICAg
ICAgICAgICBpZiAoIXRpbWVzdGFtcC5jcmVhdGVOZXdGaWxlKCkpIHsKLSAgICAgICAgICAgICAg
ICAgICBsb2cubG9nKExldmVsLldBUk5JTkcsICJGYWlsZWQgdG8gY3JlYXRlIGZpbGUgJyd7MH0n
JywgdXNlZCBmb3IgdGltZXN0YW1waW5nIHRoZSBpbmRleCBkYXRhYmFzZS4iLCB0aW1lc3RhbXAu
Z2V0QWJzb2x1dGVQYXRoKCkpOwotICAgICAgICAgICAgICAgIH0KKyAgICAgICAgICAgIH0gZWxz
ZSBpZiAoIXRpbWVzdGFtcC5jcmVhdGVOZXdGaWxlKCkpIHsKKyAgICAgICAgICAgICAgICBsb2dn
ZXIud2FybmluZygiRmFpbGVkIHRvIGNyZWF0ZSBmaWxlICciIAorICAgICAgICAgICAgICAgICAg
ICArIHRpbWVzdGFtcC5nZXRBYnNvbHV0ZVBhdGgoKQorICAgICAgICAgICAgICAgICAgICArICIn
LCB1c2VkIGZvciB0aW1lc3RhbXBpbmcgdGhlIGluZGV4IGRhdGFiYXNlIik7CiAgICAgICAgICAg
ICB9CiAgICAgICAgIH0KICAgICB9CkBAIC00MzUsNyArNDM4LDkgQEAKICAgICAgICAgICAgICAg
ICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGIudXBkYXRlKCk7
CiAgICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChUaHJvd2FibGUgZSkgewotICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIGxvZy5sb2coTGV2ZWwuU0VWRVJFLCJQcm9ibGVtIHVwZGF0
aW5nIGx1Y2VuZSBpbmRleCBkYXRhYmFzZTogIixlKTsKKyAgICAgICAgICAgICAgICAgICAgICAg
ICAgICBsb2dnZXIud2FybmluZygiUHJvYmxlbSB1cGRhdGluZyAiICsgZGIgKyAiOiAiCisgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgZS5nZXRNZXNzYWdlKCkpOworICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIGxvZ2dlci5sb2coTGV2ZWwuRklORSwgIm9wdGltaXplQWxsIiwg
ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgIH0KICAg
ICAgICAgICAgICAgICB9KTsKQEAgLTQ0OSwzNyArNDU0LDMzIEBACiAgICAgcHVibGljIHZvaWQg
b3B0aW1pemUoKSB7CiAgICAgICAgIHN5bmNocm9uaXplZCAobG9jaykgewogICAgICAgICAgICAg
aWYgKHJ1bm5pbmcpIHsKLSAgICAgICAgICAgICAgICBsb2cud2FybmluZygiT3B0aW1pemUgdGVy
bWluYXRlZC4uLiBTb21lb25lIGVsc2UgaXMgdXBkYXRpbmcgLyBvcHRpbWl6aW5nIGl0ISIpOwor
ICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKCJPcHRpbWl6ZSB0ZXJtaW5hdGVkLi4uIFNv
bWVvbmUgZWxzZSBpcyB1cGRhdGluZyAvIG9wdGltaXppbmcgaXQhIik7CiAgICAgICAgICAgICAg
ICAgcmV0dXJuIDsKICAgICAgICAgICAgIH0KICAgICAgICAgICAgIHJ1bm5pbmcgPSB0cnVlOwog
ICAgICAgICB9CiAgICAgICAgIEluZGV4V3JpdGVyIHdydCA9IG51bGw7CiAgICAgICAgIHRyeSB7
Ci0gICAgICAgICAgICBsb2cuaW5mbygiT3B0aW1pemluZyB0aGUgaW5kZXggLi4uICIpOworICAg
ICAgICAgICAgbG9nZ2VyLmluZm8oIk9wdGltaXppbmcgIiArIHRoaXMgKyAiIC4uLiIpOwogICAg
ICAgICAgICAgQW5hbHl6ZXIgYW5hbHl6ZXIgPSBuZXcgU3RhbmRhcmRBbmFseXplcihTZWFyY2hF
bmdpbmUuTFVDRU5FX1ZFUlNJT04pOyAgICAgICAgICAgIAogICAgICAgICAgICAgSW5kZXhXcml0
ZXJDb25maWcgY29uZiA9IG5ldyBJbmRleFdyaXRlckNvbmZpZyhTZWFyY2hFbmdpbmUuTFVDRU5F
X1ZFUlNJT04sYW5hbHl6ZXIpOwogICAgICAgICAgICAgY29uZi5zZXRPcGVuTW9kZShPcGVuTW9k
ZS5DUkVBVEVfT1JfQVBQRU5EKTsKICAgICAgICAgICAgIAogICAgICAgICAgICAgd3J0ID0gbmV3
IEluZGV4V3JpdGVyKGluZGV4RGlyZWN0b3J5LCBjb25mKTsKICAgICAgICAgICAgIHdydC5mb3Jj
ZU1lcmdlKDEpOyAvLyB0aGlzIGlzIGRlcHJlY2F0ZWQgYW5kIG5vdCBuZWVkZWQgYW55bW9yZQot
ICAgICAgICAgICAgbG9nLmluZm8oImRvbmUiKTsKKyAgICAgICAgICAgIGxvZ2dlci5pbmZvKCJP
cHRpbWl6aW5nICIgKyB0aGlzICsgIiBkb25lIik7CiAgICAgICAgICAgICBzeW5jaHJvbml6ZWQg
KGxvY2spIHsKICAgICAgICAgICAgICAgICBpZiAoZGlydHlGaWxlLmV4aXN0cygpICYmICFkaXJ0
eUZpbGUuZGVsZXRlKCkpIHsKLSAgICAgICAgICAgICAgICAgICAgbG9nLmxvZyhMZXZlbC5GSU5F
LCAiRmFpbGVkIHRvIHJlbW92ZSBcImRpcnR5LWZpbGVcIjogezB9IiwgZGlydHlGaWxlLmdldEFi
c29sdXRlUGF0aCgpKTsKKyAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmxvZyhMZXZlbC5GSU5F
LCAiRmFpbGVkIHRvIHJlbW92ZSBcImRpcnR5LWZpbGVcIiAnJ3swfScnIiwgCisgICAgICAgICAg
ICAgICAgICAgICAgICBkaXJ0eUZpbGUuZ2V0QWJzb2x1dGVQYXRoKCkpOwogICAgICAgICAgICAg
ICAgIH0KICAgICAgICAgICAgICAgICBkaXJ0eSA9IGZhbHNlOwogICAgICAgICAgICAgfQogICAg
ICAgICB9IGNhdGNoIChJT0V4Y2VwdGlvbiBlKSB7Ci0gICAgICAgICAgICBsb2cubG9nKExldmVs
LlNFVkVSRSwgIkVSUk9SOiBvcHRpbWl6aW5nIGluZGV4OiB7MH0iLCBlKTsKKyAgICAgICAgICAg
IGxvZ2dlci53YXJuaW5nKHRoaXMgKyAiIG9wdGltaXppbmcgcHJvYmxlbTogIiArIGUuZ2V0TWVz
c2FnZSgpKTsKKyAgICAgICAgICAgIGxvZ2dlci5sb2coTGV2ZWwuRklORSwgIm9wdGltaXplIiwg
ZSk7CiAgICAgICAgIH0gZmluYWxseSB7Ci0gICAgICAgICAgICBpZiAod3J0ICE9IG51bGwpIHsK
LSAgICAgICAgICAgICAgICB0cnkgewotICAgICAgICAgICAgICAgICAgICB3cnQuY2xvc2UoKTsK
LSAgICAgICAgICAgICAgICB9IGNhdGNoIChJT0V4Y2VwdGlvbiBlKSB7Ci0gICAgICAgICAgICAg
ICAgICAgIGxvZy5sb2coTGV2ZWwuV0FSTklORywgIkFuIGVycm9yIG9jY3VyZWQgd2hpbGUgY2xv
c2luZyB3cml0ZXIiLCBlKTsKLSAgICAgICAgICAgICAgICB9Ci0gICAgICAgICAgICB9CisgICAg
ICAgICAgICBJT1V0aWxzLmNsb3NlKHdydCk7CiAgICAgICAgICAgICBzeW5jaHJvbml6ZWQgKGxv
Y2spIHsKICAgICAgICAgICAgICAgICBydW5uaW5nID0gZmFsc2U7CiAgICAgICAgICAgICB9CkBA
IC00OTQsNyArNDk1LDcgQEAKICAgICAgICAgU3BlbGxDaGVja2VyIGNoZWNrZXIgPSBudWxsOwog
CiAgICAgICAgIHRyeSB7Ci0gICAgICAgICAgICBsb2cuaW5mbygiR2VuZXJhdGluZyBzcGVsbGlu
ZyBzdWdnZXN0aW9uIGluZGV4IC4uLiAiKTsKKyAgICAgICAgICAgIGxvZ2dlci5pbmZvKCJHZW5l
cmF0aW5nIHNwZWxsaW5nIHN1Z2dlc3Rpb25zIGZvciAiICsgdGhpcyArICIgLi4uIik7CiAgICAg
ICAgICAgICBpbmRleFJlYWRlciA9IEluZGV4UmVhZGVyLm9wZW4oaW5kZXhEaXJlY3RvcnksZmFs
c2UpOwogICAgICAgICAgICAgY2hlY2tlciA9IG5ldyBTcGVsbENoZWNrZXIoc3BlbGxEaXJlY3Rv
cnkpOwogICAgICAgICAgICAgLy9UT0RPIGJlbG93IHNlZW1zIG9ubHkgdG8gaW5kZXggImRlZnMi
ICwgcG9zc2libGUgYnVnID8KQEAgLTUwMiwyMCArNTAzLDE0IEBACiAgICAgICAgICAgICBJbmRl
eFdyaXRlckNvbmZpZyBpd2MgPSBuZXcgSW5kZXhXcml0ZXJDb25maWcoU2VhcmNoRW5naW5lLkxV
Q0VORV9WRVJTSU9OLCBhbmFseXplcik7IAogICAgICAgICAgICAgaXdjLnNldE9wZW5Nb2RlKE9w
ZW5Nb2RlLkNSRUFURV9PUl9BUFBFTkQpOwogICAgICAgICAgICAgY2hlY2tlci5pbmRleERpY3Rp
b25hcnkobmV3IEx1Y2VuZURpY3Rpb25hcnkoaW5kZXhSZWFkZXIsICJkZWZzIiksaXdjLGZhbHNl
KTsKLSAgICAgICAgICAgIGxvZy5pbmZvKCJkb25lIik7CisgICAgICAgICAgICBsb2dnZXIuaW5m
bygiR2VuZXJhdGluZyBzcGVsbGluZyBzdWdnZXN0aW9ucyBmb3IgIiArIHRoaXMgKyAiIGRvbmUi
KTsKICAgICAgICAgfSBjYXRjaCAoSU9FeGNlcHRpb24gZSkgewotICAgICAgICAgICAgbG9nLmxv
ZyhMZXZlbC5TRVZFUkUsICJFUlJPUjogR2VuZXJhdGluZyBzcGVsbGluZzogezB9IiwgZSk7Cisg
ICAgICAgICAgICBsb2dnZXIud2FybmluZygiUHJvYmxlbSB3aGVuIGdlbmVyYXRpbmcgc3BlbGxp
bmcgc3VnZ2VzdGlvbnMgZm9yICIgKyB0aGlzIAorICAgICAgICAgICAgICAgICsgIjogIiArIGUu
Z2V0TWVzc2FnZSgpKTsKKyAgICAgICAgICAgIGxvZ2dlci5sb2coTGV2ZWwuRklORSwgImNyZWF0
ZVNwZWxsaW5nU3VnZ2VzdGlvbnMiLCBlKTsKICAgICAgICAgfSBmaW5hbGx5IHsKLSAgICAgICAg
ICAgIGlmIChpbmRleFJlYWRlciAhPSBudWxsKSB7Ci0gICAgICAgICAgICAgICAgdHJ5IHsKLSAg
ICAgICAgICAgICAgICAgICAgaW5kZXhSZWFkZXIuY2xvc2UoKTsKLSAgICAgICAgICAgICAgICB9
IGNhdGNoIChJT0V4Y2VwdGlvbiBlKSB7Ci0gICAgICAgICAgICAgICAgICAgIGxvZy5sb2coTGV2
ZWwuV0FSTklORywgIkFuIGVycm9yIG9jY3VyZWQgd2hpbGUgY2xvc2luZyByZWFkZXIiLCBlKTsK
LSAgICAgICAgICAgICAgICB9Ci0gICAgICAgICAgICB9Ci0gICAgICAgICAgICBpZiAoc3BlbGxE
aXJlY3RvcnkgIT0gbnVsbCkgewotICAgICAgICAgICAgICAgIHNwZWxsRGlyZWN0b3J5LmNsb3Nl
KCk7Ci0gICAgICAgICAgICB9CisgICAgICAgICAgICBJT1V0aWxzLmNsb3NlKGluZGV4UmVhZGVy
KTsKKyAgICAgICAgICAgIElPVXRpbHMuY2xvc2Uoc3BlbGxEaXJlY3RvcnkpOwogICAgICAgICB9
CiAgICAgfQogCkBAIC01MjksMTUgKzUyNCwxNCBAQAogICAgICAgICBzeW5jaHJvbml6ZWQgKGxv
Y2spIHsKICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgaWYgKCFkaXJ0eSAmJiAh
ZGlydHlGaWxlLmNyZWF0ZU5ld0ZpbGUoKSkgewotICAgICAgICAgICAgICAgICAgICBpZiAoIWRp
cnR5RmlsZS5leGlzdHMoKSkgewotICAgICAgICAgICAgICAgICAgICAgICBsb2cubG9nKExldmVs
LkZJTkUsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIkZhaWxlZCB0byBjcmVhdGUg
XCJkaXJ0eS1maWxlXCI6IHswfSIsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGly
dHlGaWxlLmdldEFic29sdXRlUGF0aCgpKTsKKyAgICAgICAgICAgICAgICAgICAgaWYgKCFkaXJ0
eUZpbGUuZXhpc3RzKCkgJiYgbG9nZ2VyLmlzTG9nZ2FibGUoTGV2ZWwuRklORSkpIHsKKyAgICAg
ICAgICAgICAgICAgICAgICAgbG9nZ2VyLmZpbmUoIkZhaWxlZCB0byBjcmVhdGUgXCJkaXJ0eS1m
aWxlXCIgJyIgKworICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpcnR5RmlsZS5nZXRB
YnNvbHV0ZVBhdGgoKSArICInIik7CiAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg
ICAgICAgICAgZGlydHkgPSB0cnVlOwogICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgIH0g
Y2F0Y2ggKElPRXhjZXB0aW9uIGUpIHsKLSAgICAgICAgICAgICAgICBsb2cubG9nKExldmVsLkZJ
TkUsIldoZW4gY3JlYXRpbmcgZGlydHkgZmlsZTogIixlKTsKKyAgICAgICAgICAgICAgICBsb2dn
ZXIubG9nKExldmVsLkZJTkUsInVuYWJsZSB0byBjcmVhdGluZyBkaXJ0eSBmaWxlIiwgZSk7CiAg
ICAgICAgICAgICB9CiAgICAgICAgIH0KICAgICB9CkBAIC01NjMsMTIgKzU1NywxNCBAQAogICAg
ICAgICBGaWxlIHBhcmVudCA9IHhyZWZGaWxlLmdldFBhcmVudEZpbGUoKTsKIAogICAgICAgICBp
ZiAoIXhyZWZGaWxlLmRlbGV0ZSgpICYmIHhyZWZGaWxlLmV4aXN0cygpKSB7Ci0gICAgICAgICAg
ICBsb2cubG9nKExldmVsLklORk8sICJGYWlsZWQgdG8gcmVtb3ZlIG9ic29sZXRlIHhyZWYtZmls
ZTogezB9IiwgeHJlZkZpbGUuZ2V0QWJzb2x1dGVQYXRoKCkpOworICAgICAgICAgICAgbG9nZ2Vy
LmxvZyhMZXZlbC5JTkZPLCAiRmFpbGVkIHRvIHJlbW92ZSBvYnNvbGV0ZSB4cmVmLWZpbGUgJyd7
MH0nJyIsIAorICAgICAgICAgICAgICAgIHhyZWZGaWxlLmdldEFic29sdXRlUGF0aCgpKTsKICAg
ICAgICAgfQogCiAgICAgICAgIC8vIFJlbW92ZSB0aGUgcGFyZW50IGRpcmVjdG9yeSBpZiBpdCdz
IGVtcHR5CiAgICAgICAgIGlmIChwYXJlbnQuZGVsZXRlKCkpIHsKLSAgICAgICAgICAgIGxvZy5s
b2coTGV2ZWwuRklORSwgIlJlbW92ZWQgZW1wdHkgeHJlZiBkaXI6ezB9IiwgcGFyZW50LmdldEFi
c29sdXRlUGF0aCgpKTsKKyAgICAgICAgICAgIGxvZ2dlci5sb2coTGV2ZWwuRklORSwgIlJlbW92
ZWQgZW1wdHkgeHJlZiBkaXIgJyd7MH0nJyIsIAorICAgICAgICAgICAgICAgIHBhcmVudC5nZXRB
YnNvbHV0ZVBhdGgoKSk7CiAgICAgICAgIH0KICAgICAgICAgc2V0RGlydHkoKTsKICAgICAgICAg
Zm9yIChJbmRleENoYW5nZWRMaXN0ZW5lciBsaXN0ZW5lciA6IGxpc3RlbmVycykgewpAQCAtNTk3
LDExICs1OTMsMTAgQEAKICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgZCA9IGFu
YWx5emVyR3VydS5nZXREb2N1bWVudChmaWxlLCBpbiwgcGF0aCwgZmEpOwogICAgICAgICAgICAg
fSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKLSAgICAgICAgICAgICAgICBsb2cubG9nKExldmVsLklO
Rk8sCi0gICAgICAgICAgICAgICAgICAgICAgICAiU2tpcHBlZCBmaWxlICcnezB9JycgYmVjYXVz
ZSB0aGUgYW5hbHl6ZXIgZGlkbicndCAiICsKLSAgICAgICAgICAgICAgICAgICAgICAgICJ1bmRl
cnN0YW5kIGl0LiIsCi0gICAgICAgICAgICAgICAgICAgICAgICBwYXRoKTsKLSAgICAgICAgICAg
ICAgICBsb2cubG9nKExldmVsLkZJTkUsICJFeGNlcHRpb24gZnJvbSBhbmFseXplcjoiLCBlKTsK
KyAgICAgICAgICAgICAgICBsb2dnZXIubG9nKExldmVsLklORk8sCisgICAgICAgICAgICAgICAg
ICAgICJTa2lwcGVkIGZpbGUgJyd7MH0nJyBiZWNhdXNlIHRoZSBhbmFseXplciBkaWRuJyd0ICIg
KworICAgICAgICAgICAgICAgICAgICAidW5kZXJzdGFuZCBpdC4iLCBwYXRoKTsKKyAgICAgICAg
ICAgICAgICBsb2dnZXIubG9nKExldmVsLkZJTkUsICJhZGRGaWxlIiwgZSk7CiAgICAgICAgICAg
ICAgICAgcmV0dXJuOwogICAgICAgICAgICAgfQogCkBAIC02NDYsMjQgKzY0MSwyNSBAQAogICAg
ICAgICBTdHJpbmcgYWJzb2x1dGVQYXRoID0gZmlsZS5nZXRBYnNvbHV0ZVBhdGgoKTsKIAogICAg
ICAgICBpZiAoIWZpbGUuY2FuUmVhZCgpKSB7Ci0gICAgICAgICAgICBsb2cubG9nKExldmVsLldB
Uk5JTkcsICJXYXJuaW5nOiBjb3VsZCBub3QgcmVhZCB7MH0iLCBhYnNvbHV0ZVBhdGgpOworICAg
ICAgICAgICAgbG9nZ2VyLndhcm5pbmcoIkNvdWxkIG5vdCByZWFkICIgKyBhYnNvbHV0ZVBhdGgp
OwogICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICB9CiAKICAgICAgICAgdHJ5IHsK
ICAgICAgICAgICAgIFN0cmluZyBjYW5vbmljYWxQYXRoID0gZmlsZS5nZXRDYW5vbmljYWxQYXRo
KCk7CiAgICAgICAgICAgICBpZiAoIWFic29sdXRlUGF0aC5lcXVhbHMoY2Fub25pY2FsUGF0aCkg
JiYgIWFjY2VwdFN5bWxpbmsoYWJzb2x1dGVQYXRoLCBjYW5vbmljYWxQYXRoKSkgewotICAgICAg
ICAgICAgICAgIGxvZy5sb2coTGV2ZWwuRklORSwgIlNraXBwZWQgc3ltbGluayAnJ3swfScnIC0+
ICcnezF9JyciLCBuZXcgT2JqZWN0W117YWJzb2x1dGVQYXRoLCBjYW5vbmljYWxQYXRofSk7Cisg
ICAgICAgICAgICAgICAgbG9nZ2VyLmxvZyhMZXZlbC5GSU5FLCAiU2tpcHBlZCBzeW1saW5rICcn
ezB9JycgLT4gJyd7MX0nJyIsIAorICAgICAgICAgICAgICAgICAgICBuZXcgT2JqZWN0W117YWJz
b2x1dGVQYXRoLCBjYW5vbmljYWxQYXRofSk7CiAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNl
OwogICAgICAgICAgICAgfQogICAgICAgICAgICAgLy9iZWxvdyB3aWxsIG9ubHkgbGV0IGdvIGZp
bGVzIGFuZCBkaXJlY3RvcmllcywgYW55dGhpbmcgZWxzZSBpcyBjb25zaWRlcmVkIHNwZWNpYWwg
YW5kIGlzIG5vdCBhZGRlZAogICAgICAgICAgICAgaWYgKCFmaWxlLmlzRmlsZSgpICYmICFmaWxl
LmlzRGlyZWN0b3J5KCkpIHsKLSAgICAgICAgICAgICAgICBsb2cubG9nKExldmVsLldBUk5JTkcs
ICJXYXJuaW5nOiBpZ25vcmVkIHNwZWNpYWwgZmlsZSB7MH0iLCBhYnNvbHV0ZVBhdGgpOwotICAg
ICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CisgICAgICAgICAgICAgICAgbG9nZ2VyLndh
cm5pbmcoIklnbm9yZWQgc3BlY2lhbCBmaWxlICciICsgYWJzb2x1dGVQYXRoICsgIiciKTsKKyAg
ICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICB9CiAgICAgICAgIH0gY2F0
Y2ggKElPRXhjZXB0aW9uIGV4cCkgewotICAgICAgICAgICAgbG9nLmxvZyhMZXZlbC5XQVJOSU5H
LCAiV2FybmluZzogRmFpbGVkIHRvIHJlc29sdmUgbmFtZTogezB9IiwgYWJzb2x1dGVQYXRoKTsK
LSAgICAgICAgICAgIGxvZy5sb2coTGV2ZWwuRklORSwiU3RhY2sgVHJhY2U6ICIsZXhwKTsKKyAg
ICAgICAgICAgIGxvZ2dlci53YXJuaW5nKCJGYWlsZWQgdG8gcmVzb2x2ZSBuYW1lICciICsgYWJz
b2x1dGVQYXRoICsgIiciKTsKKyAgICAgICAgICAgIGxvZ2dlci5sb2coTGV2ZWwuRklORSwgImFj
Y2VwdCIsIGV4cCk7CiAgICAgICAgIH0KIAogICAgICAgICBpZiAoZmlsZS5pc0RpcmVjdG9yeSgp
KSB7CkBAIC02ODUsOCArNjgxLDggQEAKICAgICAgICAgICAgIEZpbGUgZjEgPSBwYXJlbnQuZ2V0
Q2Fub25pY2FsRmlsZSgpOwogICAgICAgICAgICAgRmlsZSBmMiA9IGZpbGUuZ2V0Q2Fub25pY2Fs
RmlsZSgpOwogICAgICAgICAgICAgaWYgKGYxLmVxdWFscyhmMikpIHsKLSAgICAgICAgICAgICAg
ICBsb2cubG9nKExldmVsLklORk8sICJTa2lwcGluZyBsaW5rcyB0byBpdHNlbGYuLi46IHswfSB7
MX0iLAotICAgICAgICAgICAgICAgICAgICAgICAgbmV3IE9iamVjdFtde3BhcmVudC5nZXRBYnNv
bHV0ZVBhdGgoKSwgZmlsZS5nZXRBYnNvbHV0ZVBhdGgoKX0pOworICAgICAgICAgICAgICAgIGxv
Z2dlci5sb2coTGV2ZWwuSU5GTywgIlNraXBwaW5nIGxpbmtzIHRvIGl0c2VsZiAoJyd7MH0nJyAn
J3sxfScnKSIsCisgICAgICAgICAgICAgICAgICAgIG5ldyBPYmplY3RbXXtwYXJlbnQuZ2V0QWJz
b2x1dGVQYXRoKCksIGZpbGUuZ2V0QWJzb2x1dGVQYXRoKCl9KTsKICAgICAgICAgICAgICAgICBy
ZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICB9CiAKQEAgLTY5NCwxNiArNjkwLDE2IEBACiAgICAg
ICAgICAgICBGaWxlIHQxID0gZjE7CiAgICAgICAgICAgICB3aGlsZSAoKHQxID0gdDEuZ2V0UGFy
ZW50RmlsZSgpKSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgaWYgKGYyLmVxdWFscyh0MSkp
IHsKLSAgICAgICAgICAgICAgICAgICAgbG9nLmxvZyhMZXZlbC5JTkZPLCAiU2tpcHBpbmcgbGlu
a3MgdG8gcGFyZW50Li4uOiB7MH0gezF9IiwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICBu
ZXcgT2JqZWN0W117cGFyZW50LmdldEFic29sdXRlUGF0aCgpLCBmaWxlLmdldEFic29sdXRlUGF0
aCgpfSk7CisgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5sb2coTGV2ZWwuSU5GTywgIlNraXBw
aW5nIGxpbmtzIHRvIHBhcmVudCAoJyd7MH0nJyAnJ3sxfScnKSIsCisgICAgICAgICAgICAgICAg
ICAgICAgICBuZXcgT2JqZWN0W117cGFyZW50LmdldEFic29sdXRlUGF0aCgpLCBmaWxlLmdldEFi
c29sdXRlUGF0aCgpfSk7CiAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAg
ICAgICAgICAgICB9CiAgICAgICAgICAgICB9CiAKICAgICAgICAgICAgIHJldHVybiBhY2NlcHQo
ZmlsZSk7CiAgICAgICAgIH0gY2F0Y2ggKElPRXhjZXB0aW9uIGV4KSB7Ci0gICAgICAgICAgICBs
b2cubG9nKExldmVsLldBUk5JTkcsICJXYXJuaW5nOiBGYWlsZWQgdG8gcmVzb2x2ZSBuYW1lOiB7
MH0gezF9IiwKLSAgICAgICAgICAgICAgICAgICAgbmV3IE9iamVjdFtde3BhcmVudC5nZXRBYnNv
bHV0ZVBhdGgoKSwgZmlsZS5nZXRBYnNvbHV0ZVBhdGgoKX0pOworICAgICAgICAgICAgbG9nZ2Vy
LmxvZyhMZXZlbC5XQVJOSU5HLCAiRmFpbGVkIHRvIHJlc29sdmUgbmFtZSAoJyd7MH0nJyAnJ3sx
fScnKSIsCisgICAgICAgICAgICAgICAgbmV3IE9iamVjdFtde3BhcmVudC5nZXRBYnNvbHV0ZVBh
dGgoKSwgZmlsZS5nZXRBYnNvbHV0ZVBhdGgoKX0pOwogICAgICAgICB9CiAgICAgICAgIHJldHVy
biBmYWxzZTsKICAgICB9CkBAIC03ODMsNyArNzc5LDcgQEAKIAogICAgICAgICBGaWxlW10gZmls
ZXMgPSBkaXIubGlzdEZpbGVzKCk7CiAgICAgICAgIGlmIChmaWxlcyA9PSBudWxsKSB7Ci0gICAg
ICAgICAgICBsb2cubG9nKExldmVsLlNFVkVSRSwgIkZhaWxlZCB0byBnZXQgZmlsZSBsaXN0aW5n
IGZvcjogezB9IiwgZGlyLmdldEFic29sdXRlUGF0aCgpKTsKKyAgICAgICAgICAgIGxvZ2dlci5z
ZXZlcmUoIkZhaWxlZCB0byBnZXQgZmlsZSBsaXN0aW5nIGZvciAnIiArIGRpci5nZXRBYnNvbHV0
ZVBhdGgoKSArICInIik7CiAgICAgICAgICAgICByZXR1cm4gbGN1cl9jb3VudDsKICAgICAgICAg
fQogICAgICAgICBBcnJheXMuc29ydChmaWxlcywgbmV3IENvbXBhcmF0b3I8RmlsZT4oKSB7CkBA
IC04MDUsMTMgKzgwMSwxOCBAQAogICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAg
ICAgICAgICAgICAgICAgICAgIH0KIAotICAgICAgICAgICAgICAgICAgICBpZiAoUnVudGltZUVu
dmlyb25tZW50LmdldEluc3RhbmNlKCkuaXNQcmludFByb2dyZXNzKCkgJiYgZXN0X3RvdGFsID4g
MCAmJiBsb2cuaXNMb2dnYWJsZShMZXZlbC5JTkZPKSApCisgICAgICAgICAgICAgICAgICAgIGlm
IChSdW50aW1lRW52aXJvbm1lbnQuZ2V0SW5zdGFuY2UoKS5pc1ByaW50UHJvZ3Jlc3MoKSAKKyAg
ICAgICAgICAgICAgICAgICAgICAgICYmIGVzdF90b3RhbCA+IDAgJiYgbG9nZ2VyLmlzTG9nZ2Fi
bGUoTGV2ZWwuSU5GTykgKQogICAgICAgICAgICAgICAgICAgICB7Ci0gICAgICAgICAgICAgICAg
ICAgICAgICBsb2cubG9nKExldmVsLklORk8sICJQcm9ncmVzczogezB9ICh7MX0lKSIsIG5ldyBP
YmplY3RbXXtsY3VyX2NvdW50LCAobGN1cl9jb3VudCAqIDEwMC4wZiAvIGVzdF90b3RhbCkgfSk7
CisgICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIubG9nKExldmVsLklORk8sICJQcm9ncmVz
czogezB9ICh7MX0lKSIsIAorICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBPYmplY3Rb
XSB7IGxjdXJfY291bnQsIAorICAgICAgICAgICAgICAgICAgICAgICAgICAgIChsY3VyX2NvdW50
ICogMTAwLjBmIC8gZXN0X3RvdGFsKSB9KTsKICAgICAgICAgICAgICAgICAgICAgfQogCiAgICAg
ICAgICAgICAgICAgICAgIGlmICh1aWRJdGVyICE9IG51bGwpIHsKLSAgICAgICAgICAgICAgICAg
ICAgICAgIFN0cmluZyB1aWQgPSBVdGlsLnBhdGgydWlkKHBhdGgsIERhdGVUb29scy50aW1lVG9T
dHJpbmcoZmlsZS5sYXN0TW9kaWZpZWQoKSwgRGF0ZVRvb2xzLlJlc29sdXRpb24uTUlMTElTRUNP
TkQpKTsgLy8gY29uc3RydWN0IHVpZCBmb3IgZG9jCisgICAgICAgICAgICAgICAgICAgICAgICBT
dHJpbmcgdWlkID0gVXRpbC5wYXRoMnVpZChwYXRoLCBEYXRlVG9vbHMKKyAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAudGltZVRvU3RyaW5nKGZpbGUubGFzdE1vZGlmaWVkKCksIAorICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICBEYXRlVG9vbHMuUmVzb2x1dGlvbi5NSUxMSVNFQ09O
RCkpOyAvLyBjb25zdHJ1Y3QgdWlkIGZvciBkb2MKICAgICAgICAgICAgICAgICAgICAgICAgIHdo
aWxlICh1aWRJdGVyLnRlcm0oKSAhPSBudWxsICYmIHVpZEl0ZXIudGVybSgpLmZpZWxkKCkuZXF1
YWxzKCJ1IikgJiYKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdWlkSXRlci50ZXJt
KCkudGV4dCgpLmNvbXBhcmVUbyh1aWQpIDwgMCkgewogICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIHJlbW92ZUZpbGUoKTsKQEAgLTgyNyw5ICs4MjgsOCBAQAogICAgICAgICAgICAgICAgICAg
ICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgYWRkRmlsZShmaWxlLCBwYXRoKTsKICAg
ICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKLSAgICAgICAgICAgICAg
ICAgICAgICAgIGxvZy5sb2coTGV2ZWwuV0FSTklORywKLSAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIkZhaWxlZCB0byBhZGQgZmlsZSAiICsgZmlsZS5nZXRBYnNvbHV0ZVBhdGgoKSwK
LSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZSk7CisgICAgICAgICAgICAgICAgICAg
ICAgICBsb2dnZXIud2FybmluZygiRmFpbGVkIHRvIGFkZCBmaWxlICciIAorICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICsgZmlsZS5nZXRBYnNvbHV0ZVBhdGgoKSArICInOiAiICsgZS5nZXRN
ZXNzYWdlKCkpOwogICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgfQogICAg
ICAgICAgICAgfQpAQCAtOTAwLDcgKzkwMCw4IEBACiAgICAgICAgICAgICAgICAgZm9yIChTdHJp
bmcgcGF0aCA6IHN1YkZpbGVzKSB7CiAgICAgICAgICAgICAgICAgICAgIFByb2plY3QgcHJvamVj
dCA9IFByb2plY3QuZ2V0UHJvamVjdChwYXRoKTsKICAgICAgICAgICAgICAgICAgICAgaWYgKHBy
b2plY3QgPT0gbnVsbCkgewotICAgICAgICAgICAgICAgICAgICAgICAgbG9nLmxvZyhMZXZlbC5X
QVJOSU5HLCAiV2FybmluZzogQ291bGQgbm90IGZpbmQgYSBwcm9qZWN0IGZvciBcInswfVwiIiwg
cGF0aCk7CisgICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZygiQ291bGQgbm90
IGZpbmQgYSBwcm9qZWN0IGZvciAnIiAKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICArIHBh
dGggKyAiJyIpOwogICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAg
ICAgICAgICAgSW5kZXhEYXRhYmFzZSBkYiA9IG5ldyBJbmRleERhdGFiYXNlKHByb2plY3QpOwog
ICAgICAgICAgICAgICAgICAgICAgICAgZGIubGlzdEZpbGVzKCk7CkBAIC05MjUsMjYgKzkyNiwx
NSBAQAogICAgICAgICB0cnkgewogICAgICAgICAgICAgaXJlYWRlciA9IEluZGV4UmVhZGVyLm9w
ZW4oaW5kZXhEaXJlY3RvcnksZmFsc2UpOyAvLyBvcGVuIGV4aXN0aW5nIGluZGV4CiAgICAgICAg
ICAgICBpdGVyID0gaXJlYWRlci50ZXJtcyhuZXcgVGVybSgidSIsICIiKSk7IC8vIGluaXQgdWlk
IGl0ZXJhdG9yCi0gICAgICAgICAgICB3aGlsZSAoaXRlci50ZXJtKCkgIT0gbnVsbCkgewotICAg
ICAgICAgICAgICAgIGxvZy5maW5lKFV0aWwudWlkMnVybChpdGVyLnRlcm0oKS50ZXh0KCkpKTsK
LSAgICAgICAgICAgICAgICBpdGVyLm5leHQoKTsKKyAgICAgICAgICAgIGlmIChsb2dnZXIuaXNM
b2dnYWJsZShMZXZlbC5GSU5FKSkgeworICAgICAgICAgICAgICAgIHdoaWxlIChpdGVyLnRlcm0o
KSAhPSBudWxsKSB7CisgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5maW5lKFV0aWwudWlkMnVy
bChpdGVyLnRlcm0oKS50ZXh0KCkpKTsKKyAgICAgICAgICAgICAgICAgICAgaXRlci5uZXh0KCk7
CisgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgfQogICAgICAgICB9IGZpbmFsbHkgewot
ICAgICAgICAgICAgaWYgKGl0ZXIgIT0gbnVsbCkgewotICAgICAgICAgICAgICAgIHRyeSB7Ci0g
ICAgICAgICAgICAgICAgICAgIGl0ZXIuY2xvc2UoKTsKLSAgICAgICAgICAgICAgICB9IGNhdGNo
IChJT0V4Y2VwdGlvbiBlKSB7Ci0gICAgICAgICAgICAgICAgICAgIGxvZy5sb2coTGV2ZWwuV0FS
TklORywgIkFuIGVycm9yIG9jY3VyZWQgd2hpbGUgY2xvc2luZyBpbmRleCBpdGVyYXRvciIsIGUp
OwotICAgICAgICAgICAgICAgIH0KLSAgICAgICAgICAgIH0KLQotICAgICAgICAgICAgaWYgKGly
ZWFkZXIgIT0gbnVsbCkgewotICAgICAgICAgICAgICAgIHRyeSB7Ci0gICAgICAgICAgICAgICAg
ICAgIGlyZWFkZXIuY2xvc2UoKTsKLSAgICAgICAgICAgICAgICB9IGNhdGNoIChJT0V4Y2VwdGlv
biBlKSB7Ci0gICAgICAgICAgICAgICAgICAgIGxvZy5sb2coTGV2ZWwuV0FSTklORywgIkFuIGVy
cm9yIG9jY3VyZWQgd2hpbGUgY2xvc2luZyBpbmRleCByZWFkZXIiLCBlKTsKLSAgICAgICAgICAg
ICAgICB9Ci0gICAgICAgICAgICB9CisgICAgICAgICAgICBJT1V0aWxzLmNsb3NlKGl0ZXIpOwor
ICAgICAgICAgICAgSU9VdGlscy5jbG9zZShpcmVhZGVyKTsKICAgICAgICAgfQogICAgIH0KIApA
QCAtOTY2LDcgKzk1Niw3IEBACiAgICAgICAgICAgICAgICAgZm9yIChTdHJpbmcgcGF0aCA6IHN1
YkZpbGVzKSB7CiAgICAgICAgICAgICAgICAgICAgIFByb2plY3QgcHJvamVjdCA9IFByb2plY3Qu
Z2V0UHJvamVjdChwYXRoKTsKICAgICAgICAgICAgICAgICAgICAgaWYgKHByb2plY3QgPT0gbnVs
bCkgewotICAgICAgICAgICAgICAgICAgICAgICAgbG9nLmxvZyhMZXZlbC5XQVJOSU5HLCAiV2Fy
bmluZzogQ291bGQgbm90IGZpbmQgYSBwcm9qZWN0IGZvciBcInswfVwiIiwgcGF0aCk7CisgICAg
ICAgICAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZygiQ291bGQgbm90IGZpbmQgYSBwcm9q
ZWN0IGZvciAnIiArIHBhdGggKyAiJyIpOwogICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugewog
ICAgICAgICAgICAgICAgICAgICAgICAgSW5kZXhEYXRhYmFzZSBkYiA9IG5ldyBJbmRleERhdGFi
YXNlKHByb2plY3QpOwogICAgICAgICAgICAgICAgICAgICAgICAgZGIubGlzdFRva2Vucyg0KTsK
QEAgLTk4OSw3ICs5NzksNyBAQAogICAgICAgICAgICAgd2hpbGUgKGl0ZXIudGVybSgpICE9IG51
bGwpIHsKICAgICAgICAgICAgICAgICBpZiAoaXRlci50ZXJtKCkuZmllbGQoKS5zdGFydHNXaXRo
KCJmIikpIHsKICAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZXIuZG9jRnJlcSgpID4gMTYgJiYg
aXRlci50ZXJtKCkudGV4dCgpLmxlbmd0aCgpID4gZnJlcSkgewotICAgICAgICAgICAgICAgICAg
ICAgICAgbG9nLndhcm5pbmcoaXRlci50ZXJtKCkudGV4dCgpKTsKKyAgICAgICAgICAgICAgICAg
ICAgICAgIGxvZ2dlci53YXJuaW5nKGl0ZXIudGVybSgpLnRleHQoKSk7CiAgICAgICAgICAgICAg
ICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgaXRlci5uZXh0KCk7CiAgICAgICAgICAgICAg
ICAgfSBlbHNlIHsKQEAgLTk5NywyMSArOTg3LDggQEAKICAgICAgICAgICAgICAgICB9CiAgICAg
ICAgICAgICB9CiAgICAgICAgIH0gZmluYWxseSB7Ci0gICAgICAgICAgICBpZiAoaXRlciAhPSBu
dWxsKSB7Ci0gICAgICAgICAgICAgICAgdHJ5IHsKLSAgICAgICAgICAgICAgICAgICAgaXRlci5j
bG9zZSgpOwotICAgICAgICAgICAgICAgIH0gY2F0Y2ggKElPRXhjZXB0aW9uIGUpIHsKLSAgICAg
ICAgICAgICAgICAgICAgbG9nLmxvZyhMZXZlbC5XQVJOSU5HLCAiQW4gZXJyb3Igb2NjdXJlZCB3
aGlsZSBjbG9zaW5nIGluZGV4IGl0ZXJhdG9yIiwgZSk7Ci0gICAgICAgICAgICAgICAgfQotICAg
ICAgICAgICAgfQotCi0gICAgICAgICAgICBpZiAoaXJlYWRlciAhPSBudWxsKSB7Ci0gICAgICAg
ICAgICAgICAgdHJ5IHsKLSAgICAgICAgICAgICAgICAgICAgaXJlYWRlci5jbG9zZSgpOwotICAg
ICAgICAgICAgICAgIH0gY2F0Y2ggKElPRXhjZXB0aW9uIGUpIHsKLSAgICAgICAgICAgICAgICAg
ICAgbG9nLmxvZyhMZXZlbC5XQVJOSU5HLCAiQW4gZXJyb3Igb2NjdXJlZCB3aGlsZSBjbG9zaW5n
IGluZGV4IHJlYWRlciIsIGUpOwotICAgICAgICAgICAgICAgIH0KLSAgICAgICAgICAgIH0KKyAg
ICAgICAgICAgIElPVXRpbHMuY2xvc2UoaXRlcik7CisgICAgICAgICAgICBJT1V0aWxzLmNsb3Nl
KGlyZWFkZXIpOwogICAgICAgICB9CiAgICAgfQogCkBAIC0xMDQwLDggKzEwMTcsOCBAQAogICAg
ICAgICAgICAgICAgIHJldCA9IEluZGV4UmVhZGVyLm9wZW4oZmRpcixmYWxzZSk7CiAgICAgICAg
ICAgICB9CiAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBleCkgewotICAgICAgICAgICAgbG9n
LmxvZyhMZXZlbC5TRVZFUkUsICJGYWlsZWQgdG8gb3BlbiBpbmRleDogezB9IiwgaW5kZXhEaXIu
Z2V0QWJzb2x1dGVQYXRoKCkpOwotICAgICAgICAgICAgbG9nLmxvZyhMZXZlbC5GSU5FLCJTdGFj
ayBUcmFjZTogIixleCk7CisgICAgICAgICAgICBsb2dnZXIud2FybmluZygiRmFpbGVkIHRvIG9w
ZW4gaW5kZXggJyIgKyBpbmRleERpci5nZXRBYnNvbHV0ZVBhdGgoKSArICInIik7CisgICAgICAg
ICAgICBsb2dnZXIubG9nKExldmVsLkZJTkUsICJnZXRJbmRleFJlYWRlciIsIGV4KTsKICAgICAg
ICAgfQogICAgICAgICByZXR1cm4gcmV0OwogICAgIH0KQEAgLTExMjEsNCArMTA5OCwxMSBAQAog
ICAgICAgICByZXR1cm4gaGFzaDsKICAgICB9CiAKKyAgICAvKioKKyAgICAgKiB7QGluaGVyaXRE
b2N9CisgICAgICovCisgICAgQE92ZXJyaWRlCisgICAgcHVibGljIFN0cmluZyB0b1N0cmluZygp
IHsKKyAgICAgICAgcmV0dXJuIChwcm9qZWN0ID09IG51bGwgPyAiIiA6IHByb2plY3QuZ2V0RGVz
Y3JpcHRpb24oKSkgKyAiIEx1Y2VuZSBJbmRleERCIjsKKyAgICB9CiB9CmRpZmYgLXIgNjE1NDkw
MjZhYWZlIC1yIDI2MTExNjUwN2M3YSBzcmMvb3JnL29wZW5zb2xhcmlzL29wZW5ncm9rL2luZGV4
L0luZGV4ZXIuamF2YQotLS0gYS9zcmMvb3JnL29wZW5zb2xhcmlzL29wZW5ncm9rL2luZGV4L0lu
ZGV4ZXIuamF2YQlTdW4gRmViIDEyIDA0OjM3OjM2IDIwMTIgKzAxMDAKKysrIGIvc3JjL29yZy9v
cGVuc29sYXJpcy9vcGVuZ3Jvay9pbmRleC9JbmRleGVyLmphdmEJTW9uIEZlYiAxMyAwNjoxMjo0
NyAyMDEyICswMTAwCkBAIC02NCwxMSArNjQsMTAgQEAKICAqLwogQFN1cHByZXNzV2FybmluZ3Mo
eyJQTUQuQXZvaWRQcmludFN0YWNrVHJhY2UiLCAiUE1ELlN5c3RlbVByaW50bG4ifSkKIHB1Ymxp
YyBmaW5hbCBjbGFzcyBJbmRleGVyIHsKLQogICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIFN0cmlu
ZyBPTiA9ICJvbiI7CiAgICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgU3RyaW5nIE9GRiA9ICJvZmYi
OwogICAgIHByaXZhdGUgc3RhdGljIEluZGV4ZXIgaW5kZXggPSBuZXcgSW5kZXhlcigpOwotICAg
IHN0YXRpYyBmaW5hbCBMb2dnZXIgbG9nID0gTG9nZ2VyLmdldExvZ2dlcihJbmRleGVyLmNsYXNz
LmdldE5hbWUoKSk7CisgICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgTG9nZ2VyIGxvZyA9IExvZ2dl
ci5nZXRMb2dnZXIoSW5kZXhlci5jbGFzcy5nZXROYW1lKCkpOwogCiAgICAgcHJpdmF0ZSBzdGF0
aWMgZmluYWwgU3RyaW5nIERFUkJZX0VNQkVEREVEX0RSSVZFUiA9CiAgICAgICAgICAgICAib3Jn
LmFwYWNoZS5kZXJieS5qZGJjLkVtYmVkZGVkRHJpdmVyIjsKQEAgLTExNyw3ICsxMTYsNyBAQAog
ICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICBnZXRvcHQucGFyc2UoKTsKICAgICAg
ICAgICAgIH0gY2F0Y2ggKFBhcnNlRXhjZXB0aW9uIGV4KSB7Ci0gICAgICAgICAgICAgICAgU3lz
dGVtLmVyci5wcmludGxuKCJPcGVuR3JvazogIiArIGV4LmdldE1lc3NhZ2UoKSk7CisgICAgICAg
ICAgICAgICAgU3lzdGVtLmVyci5wcmludGxuKGV4LmdldE1lc3NhZ2UoKSk7CiAgICAgICAgICAg
ICAgICAgU3lzdGVtLmVyci5wcmludGxuKGNtZE9wdGlvbnMuZ2V0VXNhZ2UoKSk7CiAgICAgICAg
ICAgICAgICAgU3lzdGVtLmV4aXQoMSk7CiAgICAgICAgICAgICB9CkBAIC0zNDMsMTIgKzM0Miwx
MSBAQAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAKICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgdHJ5IHsKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIEFuYWx5emVyR3VydS5hZGRFeHRlbnNpb24oCi0gICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIGFyZ1swXSwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgQW5hbHl6ZXJHdXJ1LmZpbmRGYWN0b3J5KGFyZ1sxXSkpOworICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQW5hbHl6ZXJHdXJ1LmFkZEV4dGVuc2lvbihh
cmdbMF0sCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQW5hbHl6ZXJH
dXJ1LmZpbmRGYWN0b3J5KGFyZ1sxXSkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgbG9nLmxvZyhMZXZlbC5TRVZFUkUsICJVbmFibGUgdG8gdXNlIHswfSBhcyBhIEZpbGVB
bmFseXplckZhY3RvcnkiLCBhcmdbMV0pOwotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgbG9nLmxvZyhMZXZlbC5TRVZFUkUsICJTdGFjazogIixlLmZpbGxJblN0YWNrVHJhY2Uo
KSk7CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2cubG9nKExldmVsLkZJ
TkUsICJtYWluIiwgZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTeXN0
ZW0uZXhpdCgxKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIH0KQEAgLTUwNSwxMiArNTAzLDEzIEBACiAgICAgICAgICAgICAg
ICAgfQogICAgICAgICAgICAgICAgIGdldEluc3RhbmNlKCkuc2VuZFRvQ29uZmlnSG9zdChlbnYs
IGNvbmZpZ0hvc3QpOwogICAgICAgICAgICAgfSBjYXRjaCAoSW5kZXhlckV4Y2VwdGlvbiBleCkg
ewotICAgICAgICAgICAgICAgIGxvZy5sb2coTGV2ZWwuU0VWRVJFLCAiRXhjZXB0aW9uIHJ1bm5p
bmcgaW5kZXhlciIsIGV4KTsKKyAgICAgICAgICAgICAgICBsb2cubG9nKExldmVsLlNFVkVSRSwg
IkV4Y2VwdGlvbiBydW5uaW5nIGluZGV4ZXI6ICIgKyBleC5nZXRNZXNzYWdlKCkpOworICAgICAg
ICAgICAgICAgIGxvZy5sb2coTGV2ZWwuRklORSwgIm1haW4iLCBleCk7CiAgICAgICAgICAgICAg
ICAgU3lzdGVtLmVyci5wcmludGxuKGNtZE9wdGlvbnMuZ2V0VXNhZ2UoKSk7CiAgICAgICAgICAg
ICAgICAgU3lzdGVtLmV4aXQoMSk7CiAgICAgICAgICAgICB9IGNhdGNoIChUaHJvd2FibGUgZSkg
ewotICAgICAgICAgICAgICAgIFN5c3RlbS5lcnIucHJpbnRsbigiRXhjZXB0aW9uOiAiICsgZS5n
ZXRMb2NhbGl6ZWRNZXNzYWdlKCkpOwotICAgICAgICAgICAgICAgIGxvZy5sb2coTGV2ZWwuU0VW
RVJFLCAiVW5leHBlY3RlZCBFeGNlcHRpb24iLCBlKTsKKyAgICAgICAgICAgICAgICBsb2cubG9n
KExldmVsLlNFVkVSRSwgZS5nZXRMb2NhbGl6ZWRNZXNzYWdlKCkpOworICAgICAgICAgICAgICAg
IGxvZy5sb2coTGV2ZWwuRklORSwgIm1haW4iLCBlKTsKICAgICAgICAgICAgICAgICBTeXN0ZW0u
ZXhpdCgxKTsKICAgICAgICAgICAgIH0KICAgICAgICAgfQpAQCAtNTM0LDExICs1MzMsMTEgQEAK
ICAgICAgICAgICAgIGJvb2xlYW4gbGlzdFJlcG9QYXRoZXMpIHRocm93cyBJbmRleGVyRXhjZXB0
aW9uLCBJT0V4Y2VwdGlvbiB7CiAKICAgICAgICAgaWYgKGVudi5nZXREYXRhUm9vdFBhdGgoKSA9
PSBudWxsKSB7Ci0gICAgICAgICAgICB0aHJvdyBuZXcgSW5kZXhlckV4Y2VwdGlvbigiRVJST1I6
IFBsZWFzZSBzcGVjaWZ5IGEgREFUQSBST09UIHBhdGgiKTsKKyAgICAgICAgICAgIHRocm93IG5l
dyBJbmRleGVyRXhjZXB0aW9uKCJQbGVhc2Ugc3BlY2lmeSBhIERBVEEgUk9PVCBwYXRoIik7CiAg
ICAgICAgIH0KIAogICAgICAgICBpZiAoZW52LmdldFNvdXJjZVJvb3RGaWxlKCkgPT0gbnVsbCkg
ewotICAgICAgICAgICAgdGhyb3cgbmV3IEluZGV4ZXJFeGNlcHRpb24oIkVSUk9SOiBwbGVhc2Ug
c3BlY2lmeSBhIFNSQ19ST09UIHdpdGggb3B0aW9uIC1zICEiKTsKKyAgICAgICAgICAgIHRocm93
IG5ldyBJbmRleGVyRXhjZXB0aW9uKCJQbGVhc2Ugc3BlY2lmeSBhIFNSQ19ST09UIHdpdGggb3B0
aW9uIC1zIik7CiAgICAgICAgIH0KIAogICAgICAgICBpZiAoIWVudi52YWxpZGF0ZUV4dWJlcmFu
dEN0YWdzKCkpIHsKQEAgLTU1Myw3ICs1NTIsNyBAQAogICAgICAgICAgICAgbG9uZyBzdGFydCA9
IFN5c3RlbS5jdXJyZW50VGltZU1pbGxpcygpOwogICAgICAgICAgICAgSGlzdG9yeUd1cnUuZ2V0
SW5zdGFuY2UoKS5hZGRSZXBvc2l0b3JpZXMoZW52LmdldFNvdXJjZVJvb3RQYXRoKCkpOwogICAg
ICAgICAgICAgbG9uZyB0aW1lID0gKFN5c3RlbS5jdXJyZW50VGltZU1pbGxpcygpIC0gc3RhcnQp
IC8gMTAwMDsKLSAgICAgICAgICAgIGxvZy5sb2coTGV2ZWwuSU5GTywgIkRvbmUgc2Nhbm5pbmcg
Zm9yIHJlcG9zaXRvcmllcyAoezB9cykiLCB0aW1lKTsKKyAgICAgICAgICAgIGxvZy5sb2coTGV2
ZWwuSU5GTywgIkRvbmUgc2Nhbm5pbmcgZm9yIHJlcG9zaXRvcmllcyB7MH1zIiwgdGltZSk7CiAg
ICAgICAgICAgICBpZiAobGlzdFJlcG9QYXRoZXMgfHwgIXphcENhY2hlLmlzRW1wdHkoKSkgewog
ICAgICAgICAgICAgICAgIExpc3Q8UmVwb3NpdG9yeUluZm8+IHJlcG9zID0gZW52LmdldFJlcG9z
aXRvcmllcygpOwogICAgICAgICAgICAgICAgIFN0cmluZyBwcmVmaXggPSAgZW52LmdldFNvdXJj
ZVJvb3RQYXRoKCk7CkBAIC02NjEsMTkgKzY2MCwxOSBAQAogICAgICAgICB9CiAKICAgICAgICAg
aWYgKGNvbmZpZ0ZpbGVuYW1lICE9IG51bGwpIHsKLSAgICAgICAgICAgIGxvZy5sb2coTGV2ZWwu
SU5GTywgIldyaXRpbmcgY29uZmlndXJhdGlvbiB0byB7MH0iLCBjb25maWdGaWxlbmFtZSk7Cisg
ICAgICAgICAgICBsb2cubG9nKExldmVsLklORk8sICJXcml0aW5nIGNvbmZpZ3VyYXRpb24gdG8g
Jyd7MH0nJyIsIGNvbmZpZ0ZpbGVuYW1lKTsKICAgICAgICAgICAgIGVudi53cml0ZUNvbmZpZ3Vy
YXRpb24obmV3IEZpbGUoY29uZmlnRmlsZW5hbWUpKTsKLSAgICAgICAgICAgIGxvZy5pbmZvKCJE
b25lLi4uIik7CisgICAgICAgICAgICBsb2cuaW5mbygiRG9uZS4iKTsKICAgICAgICAgfQogCiAg
ICAgICAgIGlmIChyZWZyZXNoSGlzdG9yeSkgewogICAgICAgICAgICAgbG9nLmxvZyhMZXZlbC5J
TkZPLCAiR2VuZXJhdGluZyBoaXN0b3J5IGNhY2hlIGZvciBhbGwgcmVwb3NpdG9yaWVzIC4uLiIp
OwogICAgICAgICAgICAgSGlzdG9yeUd1cnUuZ2V0SW5zdGFuY2UoKS5jcmVhdGVDYWNoZSgpOwot
ICAgICAgICAgICAgbG9nLmluZm8oIkRvbmUuLi4iKTsKKyAgICAgICAgICAgIGxvZy5pbmZvKCJE
b25lLiIpOwogICAgICAgICB9IGVsc2UgaWYgKHJlcG9zaXRvcmllcyAhPSBudWxsICYmICFyZXBv
c2l0b3JpZXMuaXNFbXB0eSgpKSB7CiAgICAgICAgICAgICBsb2cubG9nKExldmVsLklORk8sICJH
ZW5lcmF0aW5nIGhpc3RvcnkgY2FjaGUgZm9yIHNwZWNpZmllZCByZXBvc2l0b3JpZXMgLi4uIik7
CiAgICAgICAgICAgICBIaXN0b3J5R3VydS5nZXRJbnN0YW5jZSgpLmNyZWF0ZUNhY2hlKHJlcG9z
aXRvcmllcyk7Ci0gICAgICAgICAgICBsb2cuaW5mbygiRG9uZS4uLiIpOworICAgICAgICAgICAg
bG9nLmluZm8oIkRvbmUuIik7CiAgICAgICAgIH0KIAogICAgICAgICBpZiAobGlzdEZpbGVzKSB7
CkBAIC02ODksNyArNjg4LDcgQEAKICAgICAgICAgICAgIEluZGV4Q2hhbmdlZExpc3RlbmVyIHBy
b2dyZXNzKQogICAgICAgICAgICAgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICAgUnVudGlt
ZUVudmlyb25tZW50IGVudiA9IFJ1bnRpbWVFbnZpcm9ubWVudC5nZXRJbnN0YW5jZSgpLnJlZ2lz
dGVyKCk7Ci0gICAgICAgIGxvZy5pbmZvKCJTdGFydGluZyBpbmRleGluZyIpOworICAgICAgICBs
b2cuaW5mbygiU3RhcnRpbmcgaW5kZXhpbmcgLi4uIik7CiAKICAgICAgICAgRXhlY3V0b3JTZXJ2
aWNlIGV4ZWN1dG9yID0gRXhlY3V0b3JzLm5ld0ZpeGVkVGhyZWFkUG9vbChub1RocmVhZHMpOwog
CkBAIC03MDUsNyArNzA0LDcgQEAKICAgICAgICAgICAgIGZvciAoU3RyaW5nIHBhdGggOiBzdWJG
aWxlcykgewogICAgICAgICAgICAgICAgIFByb2plY3QgcHJvamVjdCA9IFByb2plY3QuZ2V0UHJv
amVjdChwYXRoKTsKICAgICAgICAgICAgICAgICBpZiAocHJvamVjdCA9PSBudWxsICYmIGVudi5o
YXNQcm9qZWN0cygpKSB7Ci0gICAgICAgICAgICAgICAgICAgIGxvZy5sb2coTGV2ZWwuV0FSTklO
RywgIkNvdWxkIG5vdCBmaW5kIGEgcHJvamVjdCBmb3IgXCJ7MH1cIiIsIHBhdGgpOworICAgICAg
ICAgICAgICAgICAgICBsb2cud2FybmluZygiQ291bGQgbm90IGZpbmQgYSBwcm9qZWN0IGZvciAn
IiArIHBhdGggKyAiJyIpOwogICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAg
ICAgICAgIEluZGV4RGF0YWJhc2UgZGI7CiAgICAgICAgICAgICAgICAgICAgIGlmIChwcm9qZWN0
ID09IG51bGwpIHsKQEAgLTcyMyw3ICs3MjIsNyBAQAogICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIGRicy5hZGQoZGIpOwogICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg
ICAgICAgICB9IGVsc2UgewotICAgICAgICAgICAgICAgICAgICAgICAgbG9nLmxvZyhMZXZlbC5X
QVJOSU5HLCAiRGlyZWN0b3J5IGRvZXMgbm90IGV4aXN0IFwiezB9XCIiLCBwYXRoKTsKKyAgICAg
ICAgICAgICAgICAgICAgICAgIGxvZy53YXJuaW5nKCJEaXJlY3RvcnkgZG9lcyBub3QgZXhpc3Qg
JyIgKyBwYXRoICsgIiciKTsKICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAg
IH0KICAgICAgICAgICAgIH0KQEAgLTc0Miw5ICs3NDEsMTAgQEAKICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgZGIub3B0aW1pemUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICB9CiAgICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChUaHJvd2FibGUgZSkgewotICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIGxvZy5sb2coTGV2ZWwuU0VWRVJFLCAiQW4gZXJyb3Ig
b2NjdXJlZCB3aGlsZSAiCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgKHVwZGF0
ZSA/ICJ1cGRhdGluZyIgOiAib3B0aW1pemluZyIpCi0gICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICsgIiBpbmRleCIsIGUpOworICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZy53
YXJuaW5nKCJBbiBlcnJvciBvY2N1cmVkIHdoaWxlICIKKyAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgKyAodXBkYXRlID8gInVwZGF0aW5nICIgOiAib3B0aW1pemluZyAiKQorICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICArIGRiICsgIjogIiArIGUuZ2V0TWVzc2FnZSgpKTsK
KyAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2cubG9nKExldmVsLkZJTkUsICJydW4iLCBl
KTsKICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgfQogICAg
ICAgICAgICAgICAgIH0pOwpAQCAtNzU3LDcgKzc1Nyw5IEBACiAgICAgICAgICAgICAgICAgLy8g
V2FpdCBmb3JldmVyCiAgICAgICAgICAgICAgICAgZXhlY3V0b3IuYXdhaXRUZXJtaW5hdGlvbig5
OTksVGltZVVuaXQuREFZUyk7CiAgICAgICAgICAgICB9IGNhdGNoIChJbnRlcnJ1cHRlZEV4Y2Vw
dGlvbiBleHApIHsKLSAgICAgICAgICAgICAgICBsb2cubG9nKExldmVsLldBUk5JTkcsICJSZWNl
aXZlZCBpbnRlcnJ1cHQgd2hpbGUgd2FpdGluZyBmb3IgZXhlY3V0b3IgdG8gZmluaXNoIiwgZXhw
KTsKKyAgICAgICAgICAgICAgICBsb2cud2FybmluZygiUmVjZWl2ZWQgaW50ZXJydXB0IHdoaWxl
IHdhaXRpbmcgZm9yIGV4ZWN1dG9yIHRvIGZpbmlzaDogIgorICAgICAgICAgICAgICAgICAgICAr
IGV4cC5nZXRNZXNzYWdlKCkpOworICAgICAgICAgICAgICAgIGxvZy5sb2coTGV2ZWwuRklORSwg
ImRvSW5kZXhlckV4ZWN1dGlvbiIsIGV4cCk7CiAgICAgICAgICAgICB9CiAgICAgICAgfQogICAg
IH0KQEAgLTc2NSwxOSArNzY3LDI1IEBACiAgICAgcHVibGljIHZvaWQgc2VuZFRvQ29uZmlnSG9z
dChSdW50aW1lRW52aXJvbm1lbnQgZW52LCBTdHJpbmcgY29uZmlnSG9zdCkgewogICAgICAgICBp
ZiAoY29uZmlnSG9zdCAhPSBudWxsKSB7CiAgICAgICAgICAgICBTdHJpbmdbXSBjZmcgPSBjb25m
aWdIb3N0LnNwbGl0KCI6Iik7Ci0gICAgICAgICAgICBsb2cubG9nKExldmVsLklORk8sICJTZW5k
IGNvbmZpZ3VyYXRpb24gdG86IHswfSIsIGNvbmZpZ0hvc3QpOworICAgICAgICAgICAgbG9nLmxv
ZyhMZXZlbC5JTkZPLCAiU2VuZGluZyBjb25maWd1cmF0aW9uIHRvIHswfSIsIGNvbmZpZ0hvc3Qp
OwogICAgICAgICAgICAgaWYgKGNmZy5sZW5ndGggPT0gMikgewogICAgICAgICAgICAgICAgIHRy
eSB7CiAgICAgICAgICAgICAgICAgICAgIEluZXRBZGRyZXNzIGhvc3QgPSBJbmV0QWRkcmVzcy5n
ZXRCeU5hbWUoY2ZnWzBdKTsKICAgICAgICAgICAgICAgICAgICAgUnVudGltZUVudmlyb25tZW50
LmdldEluc3RhbmNlKCkud3JpdGVDb25maWd1cmF0aW9uKGhvc3QsIEludGVnZXIucGFyc2VJbnQo
Y2ZnWzFdKSk7CiAgICAgICAgICAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGV4KSB7Ci0gICAg
ICAgICAgICAgICAgICAgIGxvZy5sb2coTGV2ZWwuU0VWRVJFLCAiRmFpbGVkIHRvIHNlbmQgY29u
ZmlndXJhdGlvbiB0byAiICsgY29uZmlnSG9zdCsiIChpcyB3ZWIgYXBwbGljYXRpb24gc2VydmVy
IHJ1bm5pbmcgd2l0aCBvcGVuZ3JvayBkZXBsb3llZD8pIiwgZXgpOworICAgICAgICAgICAgICAg
ICAgICBsb2cubG9nKExldmVsLldBUk5JTkcsICJGYWlsZWQgdG8gc2VuZCBjb25maWd1cmF0aW9u
IHRvICIgCisgICAgICAgICAgICAgICAgICAgICAgICArIGNvbmZpZ0hvc3QgCisgICAgICAgICAg
ICAgICAgICAgICAgICArICIgKGlzIHdlYiBhcHBsaWNhdGlvbiBzZXJ2ZXIgcnVubmluZyB3aXRo
IG9wZW5ncm9rIGRlcGxveWVkPyk6ICIKKyAgICAgICAgICAgICAgICAgICAgICAgICsgZXguZ2V0
TWVzc2FnZSgpKTsKKyAgICAgICAgICAgICAgICAgICAgbG9nLmxvZyhMZXZlbC5GSU5FLCAic2Vu
ZFRvQ29uZmlnSG9zdCIsIGV4KTsKICAgICAgICAgICAgICAgICB9Ci0gICAgICAgICAgICB9IGVs
c2UgewotICAgICAgICAgICAgICAgIGxvZy5zZXZlcmUoIlN5bnRheCBlcnJvcjogIik7CisgICAg
ICAgICAgICB9IGVsc2UgaWYgKCBjZmcubGVuZ3RoID4gMCApIHsKKyAgICAgICAgICAgICAgICBT
dHJpbmdCdWlsZGVyIHNiID0gbmV3IFN0cmluZ0J1aWxkZXIoIlN5bnRheCBlcnJvcnMgPSAiKTsK
ICAgICAgICAgICAgICAgICBmb3IgKFN0cmluZyBzIDogY2ZnKSB7Ci0gICAgICAgICAgICAgICAg
ICAgIGxvZy5sb2coTGV2ZWwuU0VWRVJFLCAiW3swfV0iLCBzKTsKKyAgICAgICAgICAgICAgICAg
ICAgc2IuYXBwZW5kKCdbJykuYXBwZW5kKHMpLmFwcGVuZCgnXScpLmFwcGVuZCgiLCAiKTsKICAg
ICAgICAgICAgICAgICB9CisgICAgICAgICAgICAgICAgc2Iuc2V0TGVuZ3RoKHNiLmxlbmd0aCgp
LTIpOworICAgICAgICAgICAgICAgIGxvZy53YXJuaW5nKHNiLnRvU3RyaW5nKCkpOwogICAgICAg
ICAgICAgfQogICAgICAgICAgICAgbG9nLmluZm8oIkNvbmZpZ3VyYXRpb24gdXBkYXRlIHJvdXRp
bmUgZG9uZSwgY2hlY2sgbG9nIG91dHB1dCBmb3IgZXJyb3JzLiIpOwogICAgICAgICB9CmRpZmYg
LXIgNjE1NDkwMjZhYWZlIC1yIDI2MTExNjUwN2M3YSBzcmMvb3JnL29wZW5zb2xhcmlzL29wZW5n
cm9rL21hbmFnZW1lbnQvQWdlbnRJbmRleFJ1bm5lci5qYXZhCi0tLSBhL3NyYy9vcmcvb3BlbnNv
bGFyaXMvb3Blbmdyb2svbWFuYWdlbWVudC9BZ2VudEluZGV4UnVubmVyLmphdmEJU3VuIEZlYiAx
MiAwNDozNzozNiAyMDEyICswMTAwCisrKyBiL3NyYy9vcmcvb3BlbnNvbGFyaXMvb3Blbmdyb2sv
bWFuYWdlbWVudC9BZ2VudEluZGV4UnVubmVyLmphdmEJTW9uIEZlYiAxMyAwNjoxMjo0NyAyMDEy
ICswMTAwCkBAIC01MSw2ICs1MSw3IEBACiBwdWJsaWMgZmluYWwgY2xhc3MgQWdlbnRJbmRleFJ1
bm5lciBpbXBsZW1lbnRzIEFnZW50SW5kZXhSdW5uZXJNQmVhbiwgTm90aWZpY2F0aW9uTGlzdGVu
ZXIsCiAgICAgICAgIE1CZWFuUmVnaXN0cmF0aW9uLCBSdW5uYWJsZSwgSW5kZXhDaGFuZ2VkTGlz
dGVuZXIsIE5vdGlmaWNhdGlvbkVtaXR0ZXIgewogCisgICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwg
TG9nZ2VyIGxvZyA9IExvZ2dlci5nZXRMb2dnZXIoQWdlbnRJbmRleFJ1bm5lci5jbGFzcy5nZXRO
YW1lKCkpOwogICAgIHByaXZhdGUgdHJhbnNpZW50IHN0YXRpYyBBZ2VudEluZGV4UnVubmVyIGlu
ZGV4ZXJJbnN0YW5jZSA9IG51bGw7CiAgICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgU3RyaW5nIE5P
VElGSUNBVElPTkFDVElPTlRZUEUgPSAib2dhYWN0aW9uIjsKICAgICBwcml2YXRlIHN0YXRpYyBm
aW5hbCBTdHJpbmcgTk9USUZJQ0FUSU9ORVhDRVBUSU9OVFlQRSA9ICJvZ2FleGNlcHRpb24iOwpA
QCAtNTgsNyArNTksNiBAQAogICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIFN0cmluZyBOT1RJRklD
QVRJT05JTkZPTE9OR1RZUEUgPSAib2dhaW5mb2xvbmciOwogICAgIHByaXZhdGUgYm9vbGVhbiBl
bmFibGVkOwogICAgIHByaXZhdGUgdHJhbnNpZW50IFRocmVhZCBpbmRleFRocmVhZCA9IG51bGw7
Ci0gICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgTG9nZ2VyIGxvZyA9IExvZ2dlci5nZXRMb2dnZXIo
Im9yZy5vcGVuc29sYXJpcy5vcGVuZ3JvayIpOwogICAgIHByaXZhdGUgUnVudGltZUVudmlyb25t
ZW50IGVudiA9IG51bGw7CiAgICAgcHJpdmF0ZSBsb25nIGxhc3RJbmRleFN0YXJ0ID0gMDsKICAg
ICBwcml2YXRlIGxvbmcgbGFzdEluZGV4RmluaXNoID0gMDsKQEAgLTEyNSw3ICsxMjUsNyBAQAog
ICAgICAgICAgICAgRmlsZSBjZmdGaWxlID0gbmV3IEZpbGUoY29uZmlnZmlsZSk7CiAgICAgICAg
ICAgICBpZiAoY2ZnRmlsZS5leGlzdHMoKSkgewogICAgICAgICAgICAgICAgIGVudiA9IFJ1bnRp
bWVFbnZpcm9ubWVudC5nZXRJbnN0YW5jZSgpOwotICAgICAgICAgICAgICAgIGxvZy5sb2coTGV2
ZWwuSU5GTywgIlJ1bm5pbmcgaW5kZXhlciB3aXRoIGNvbmZpZ3VyYXRpb24gezB9IiwgY29uZmln
ZmlsZSk7CisgICAgICAgICAgICAgICAgbG9nLmxvZyhMZXZlbC5JTkZPLCAiUnVubmluZyBpbmRl
eGVyIHdpdGggY29uZmlndXJhdGlvbiAnJ3swfScnIiwgY29uZmlnZmlsZSk7CiAgICAgICAgICAg
ICAgICAgZW52LnJlYWRDb25maWd1cmF0aW9uKGNmZ0ZpbGUpOwogCiAgICAgICAgICAgICAgICAg
SW5kZXhlciBpbmRleCA9IEluZGV4ZXIuZ2V0SW5zdGFuY2UoKTsKQEAgLTE1MiwxMiArMTUyLDEy
IEBACiAKIAogICAgICAgICAgICAgfSBlbHNlIHsKLSAgICAgICAgICAgICAgICBsb2cubG9nKExl
dmVsLldBUk5JTkcsICJDYW5ub3QgUnVuIGluZGV4aW5nIHdpdGhvdXQgcHJvcGVyIGNvbmZpZ3Vy
YXRpb24gZmlsZSB7MH0iLCBjb25maWdmaWxlKTsKKyAgICAgICAgICAgICAgICBsb2cubG9nKExl
dmVsLldBUk5JTkcsICJDYW5ub3QgUnVuIGluZGV4aW5nIHdpdGhvdXQgcHJvcGVyIGNvbmZpZ3Vy
YXRpb24gZmlsZSAnJ3swfScnIiwgY29uZmlnZmlsZSk7CiAgICAgICAgICAgICAgICAgZG9Ob3Rp
ZnkoTk9USUZJQ0FUSU9ORVhDRVBUSU9OVFlQRSwgIkNvbmZpZ3VyYXRpb24gZmlsZSBub3QgdmFs
aWQiLCBjb25maWdmaWxlKTsKICAgICAgICAgICAgIH0KICAgICAgICAgfSBjYXRjaCAoRXhjZXB0
aW9uIGUpIHsKLSAgICAgICAgICAgIGxvZy5sb2coTGV2ZWwuU0VWRVJFLAotICAgICAgICAgICAg
ICAgICAgICAiRXhjZXB0aW9uIHJ1bm5pbmcgaW5kZXhpbmcgIiwgZSk7CisgICAgICAgICAgICBs
b2cud2FybmluZygiRXhjZXB0aW9uIHJ1bm5pbmcgaW5kZXhpbmc6ICIgKyBlLmdldE1lc3NhZ2Uo
KSk7CisgICAgICAgICAgICBsb2cubG9nKExldmVsLkZJTkUsICJydW4iLCBlKTsKICAgICAgICAg
ICAgIGxhc3RFeGNlcHRpb24gPSBlOwogICAgICAgICB9CiAgICAgfQpAQCAtMTkyLDcgKzE5Miw3
IEBACiAgICAgICAgICAgICAgICAgbG9nLmluZm8oIkluZGV4aW5nIGlzIGRpc2FibGVkLCBkb2lu
ZyBub3RoaW5nIik7CiAgICAgICAgICAgICB9CiAgICAgICAgIH0gZWxzZSB7Ci0gICAgICAgICAg
ICBsb2cubG9nKExldmVsLldBUk5JTkcsICJSZWNlaXZlZCB1bmtub3duIG5vdGlmaWNhdGlvbiB0
eXBlOiB7MH0iLCBuLmdldFR5cGUoKSk7CisgICAgICAgICAgICBsb2cubG9nKExldmVsLldBUk5J
TkcsICJSZWNlaXZlZCB1bmtub3duIG5vdGlmaWNhdGlvbiB0eXBlICcnezB9JyciLCBuLmdldFR5
cGUoKSk7CiAgICAgICAgIH0KICAgICB9CiAKQEAgLTIyMywxMiArMjIzLDEzIEBACiAgICAgICAg
ICAgICAgICAgaWYgKCF3YWl0Rm9yRmluaXNoZWQpIHsKICAgICAgICAgICAgICAgICAgICAgcmV0
dXJuOwogICAgICAgICAgICAgICAgIH0KLSAgICAgICAgICAgICAgICBsb2cuZmluZSgiV2FpdGlu
ZyBmb3IgaW5kZXhlciB0byBmaW5pc2guLi4iKTsKKyAgICAgICAgICAgICAgICBsb2cuZmluZSgi
V2FpdGluZyBmb3IgaW5kZXhlciB0byBmaW5pc2ggLi4uIik7CiAgICAgICAgICAgICAgICAgaW5k
ZXhUaHJlYWQuam9pbigpOwogICAgICAgICAgICAgICAgIGxvZy5maW5lKCJpbmRleGVyIGZpbmlz
aGVkLiIpOwogICAgICAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKLSAgICAgICAgICAg
ICAgICBsb2cubG9nKExldmVsLlNFVkVSRSwKLSAgICAgICAgICAgICAgICAgICAgICAgICJDYXVn
aHQgRXhjZXB0aW9uIHdoaWxlIHdhaXRpbmcgZm9yIGluZGV4aW5nIHRvIGZpbmlzaC4iLCBlKTsK
KyAgICAgICAgICAgICAgICBsb2cud2FybmluZygiQ2F1Z2h0IEV4Y2VwdGlvbiB3aGlsZSB3YWl0
aW5nIGZvciBpbmRleGluZyB0byBmaW5pc2g6ICIgCisgICAgICAgICAgICAgICAgICAgICsgZS5n
ZXRNZXNzYWdlKCkpOworICAgICAgICAgICAgICAgIGxvZy5sb2coTGV2ZWwuRklORSwgImluZGV4
IiwgZSk7CiAgICAgICAgICAgICB9CiAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgIH0KQEAg
LTIzNiwzMCArMjM3LDMwIEBACiAKICAgICBAT3ZlcnJpZGUKICAgICBwdWJsaWMgdm9pZCBmaWxl
QWRkKFN0cmluZyBwYXRoLCBTdHJpbmcgYW5hbHl6ZXIpIHsKLSAgICAgICAgbG9nLmxvZyhMZXZl
bC5JTkZPLCAiQWRkIHswfSBhbmFseXplciB7MX0iLCBuZXcgT2JqZWN0W117cGF0aCwgYW5hbHl6
ZXJ9KTsKKyAgICAgICAgbG9nLmxvZyhMZXZlbC5GSU5FLCAiQWRkICcnezB9JycgYW5hbHl6ZXIg
ezF9IiwgbmV3IE9iamVjdFtde3BhdGgsIGFuYWx5emVyfSk7CiAgICAgfQogCiAgICAgQE92ZXJy
aWRlCiAgICAgcHVibGljIHZvaWQgZmlsZVJlbW92ZShTdHJpbmcgcGF0aCkgewotICAgICAgICBs
b2cubG9nKExldmVsLklORk8sICJGaWxlIHJlbW92ZSB7MH0iLCBwYXRoKTsKKyAgICAgICAgbG9n
LmxvZyhMZXZlbC5GSU5FLCAiRmlsZSByZW1vdmUgJyd7MH0nJyIsIHBhdGgpOwogICAgIH0KIAog
ICAgIEBPdmVycmlkZQogICAgIHB1YmxpYyB2b2lkIGZpbGVVcGRhdGUoU3RyaW5nIHBhdGgpIHsK
LSAgICAgICAgbG9nLmxvZyhMZXZlbC5JTkZPLCAiRmlsZSB1cGRhdGVkIHswfSIsIHBhdGgpOwor
ICAgICAgICBsb2cubG9nKExldmVsLkZJTkUsICJGaWxlIHVwZGF0ZWQgJyd7MH0nJyIsIHBhdGgp
OwogICAgICAgICBhZGRGaWxlQWN0aW9uKCJVOiIsIHBhdGgpOwogICAgIH0KIAogCiAgICAgQE92
ZXJyaWRlCiAgICAgcHVibGljIHZvaWQgZmlsZUFkZGVkKFN0cmluZyBwYXRoLCBTdHJpbmcgYW5h
bHl6ZXIpIHsKLSAgICAgICAgbG9nLmxvZyhMZXZlbC5JTkZPLCAiQWRkZWQgezB9IGFuYWx5emVy
IHsxfSIsIG5ldyBPYmplY3RbXXtwYXRoLCBhbmFseXplcn0pOworICAgICAgICBsb2cubG9nKExl
dmVsLkZJTkUsICJBZGRlZCAnJ3swfScnIGFuYWx5emVyIHsxfSIsIG5ldyBPYmplY3RbXXtwYXRo
LCBhbmFseXplcn0pOwogICAgICAgICBhZGRGaWxlQWN0aW9uKCJBOiIsIHBhdGgpOwogICAgIH0K
IAogICAgIEBPdmVycmlkZQogICAgIHB1YmxpYyB2b2lkIGZpbGVSZW1vdmVkKFN0cmluZyBwYXRo
KSB7Ci0gICAgICAgIGxvZy5sb2coTGV2ZWwuSU5GTywgIkZpbGUgcmVtb3ZlZCB7MH0iLCBwYXRo
KTsKKyAgICAgICAgbG9nLmxvZyhMZXZlbC5GSU5FLCAiRmlsZSByZW1vdmVkICcnezB9JyciLCBw
YXRoKTsKICAgICAgICAgYWRkRmlsZUFjdGlvbigiUjoiLCBwYXRoKTsKICAgICB9CiAKQEAgLTMw
MSw3ICszMDIsNyBAQAogCiAgICAgQE92ZXJyaWRlCiAgICAgcHVibGljIHZvaWQgYWRkTm90aWZp
Y2F0aW9uTGlzdGVuZXIoTm90aWZpY2F0aW9uTGlzdGVuZXIgbm90aWZsaXN0ZW5lciwgTm90aWZp
Y2F0aW9uRmlsdGVyIG5vdGZpbHQsIE9iamVjdCBvYmopIHRocm93cyBJbGxlZ2FsQXJndW1lbnRF
eGNlcHRpb24gewotICAgICAgICBsb2cubG9nKExldmVsLkNPTkZJRywgIkFkZHMgYSBub3RpZmxp
c3RuZXIsIHdpdGggb2JqIHswfSIsIG9iai50b1N0cmluZygpKTsKKyAgICAgICAgbG9nLmxvZyhM
ZXZlbC5DT05GSUcsICJBZGRzIGEgbm90aWZ5IGxpc3RlbmVyLCB3aXRoIG9iaiB7MH0iLCBvYmou
dG9TdHJpbmcoKSk7CiAgICAgICAgIGlmIChub3RpZmxpc3RlbmVyID09IG51bGwpIHsKICAgICAg
ICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24oIk11c3QgaGF2ZSBsZWdh
bCBOb3RpZmljYXRpb25MaXN0ZW5lciIpOwogICAgICAgICB9CkBAIC0zMTIsNyArMzEzLDcgQEAK
IAogICAgIEBPdmVycmlkZQogICAgIHB1YmxpYyB2b2lkIHJlbW92ZU5vdGlmaWNhdGlvbkxpc3Rl
bmVyKE5vdGlmaWNhdGlvbkxpc3RlbmVyIG5vdGlmbGlzdGVuZXIpIHRocm93cyBMaXN0ZW5lck5v
dEZvdW5kRXhjZXB0aW9uIHsKLSAgICAgICAgbG9nLmluZm8oInJlbW92ZXMgYSBub3RpZmxpc3Rl
bmVyLCBubyBvYmoiKTsKKyAgICAgICAgbG9nLmluZm8oInJlbW92ZXMgYSBub3RpZnkgbGlzdGVu
ZXIsIG5vIG9iaiIpOwogICAgICAgICBib29sZWFuIHJlbW92ZWQgPSBmYWxzZTsKICAgICAgICAg
c3luY2hyb25pemVkIChub3RpZkxpc3RlbmVycykgewogICAgICAgICAgICAgSXRlcmF0b3I8Tm90
aWZpY2F0aW9uSG9sZGVyPiBpdCA9IG5vdGlmTGlzdGVuZXJzLml0ZXJhdG9yKCk7CkBAIC0zMzEs
NyArMzMyLDcgQEAKIAogICAgIEBPdmVycmlkZQogICAgIHB1YmxpYyB2b2lkIHJlbW92ZU5vdGlm
aWNhdGlvbkxpc3RlbmVyKE5vdGlmaWNhdGlvbkxpc3RlbmVyIG5vdGlmbGlzdGVuZXIsIE5vdGlm
aWNhdGlvbkZpbHRlciBmaWx0LCBPYmplY3Qgb2JqKSB0aHJvd3MgTGlzdGVuZXJOb3RGb3VuZEV4
Y2VwdGlvbiB7Ci0gICAgICAgIGxvZy5sb2coTGV2ZWwuQ09ORklHLCAicmVtb3ZlcyBhIG5vdGlm
bGlzdGVuZXIgb2JqIHswfSIsIG9iaik7CisgICAgICAgIGxvZy5sb2coTGV2ZWwuQ09ORklHLCAi
cmVtb3ZlcyBhIG5vdGlmeSBsaXN0ZW5lciBvYmogezB9Iiwgb2JqKTsKICAgICAgICAgYm9vbGVh
biByZW1vdmVkID0gZmFsc2U7CiAgICAgICAgIHN5bmNocm9uaXplZCAobm90aWZMaXN0ZW5lcnMp
IHsKICAgICAgICAgICAgIEl0ZXJhdG9yPE5vdGlmaWNhdGlvbkhvbGRlcj4gaXQgPSBub3RpZkxp
c3RlbmVycy5pdGVyYXRvcigpOwpAQCAtMzg3LDkgKzM4OCw4IEBACiAgICAgICAgICAgICAgICAg
fQogICAgICAgICAgICAgfQogICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZXgpIHsKLSAgICAg
ICAgICAgIGxvZy5sb2coTGV2ZWwuU0VWRVJFLAotICAgICAgICAgICAgICAgICAgICAiRXhjZXB0
aW9uIGR1cmluZyBub3RpZmljYXRpb24gc2VuZGluZzogIiArIGV4LmdldE1lc3NhZ2UoKSwKLSAg
ICAgICAgICAgICAgICAgICAgZXgpOworICAgICAgICAgICAgbG9nLndhcm5pbmcoIkV4Y2VwdGlv
biBkdXJpbmcgbm90aWZpY2F0aW9uIHNlbmRpbmc6ICIgKyBleC5nZXRNZXNzYWdlKCkpOworICAg
ICAgICAgICAgbG9nLmxvZyhMZXZlbC5GSU5FLCAiZG9Ob3RpZnkiLCBleCk7CiAgICAgICAgIH0K
ICAgICB9CiB9CmRpZmYgLXIgNjE1NDkwMjZhYWZlIC1yIDI2MTExNjUwN2M3YSBzcmMvb3JnL29w
ZW5zb2xhcmlzL29wZW5ncm9rL21hbmFnZW1lbnQvSk1YQ29uZmlndXJhdGlvbi5qYXZhCi0tLSBh
L3NyYy9vcmcvb3BlbnNvbGFyaXMvb3Blbmdyb2svbWFuYWdlbWVudC9KTVhDb25maWd1cmF0aW9u
LmphdmEJU3VuIEZlYiAxMiAwNDozNzozNiAyMDEyICswMTAwCisrKyBiL3NyYy9vcmcvb3BlbnNv
bGFyaXMvb3Blbmdyb2svbWFuYWdlbWVudC9KTVhDb25maWd1cmF0aW9uLmphdmEJTW9uIEZlYiAx
MyAwNjoxMjo0NyAyMDEyICswMTAwCkBAIC0yNiw4ICsyNiw3IEBACiAKIGltcG9ydCBqYXZhLmlv
LkZpbGU7CiBpbXBvcnQgamF2YS5pby5JT0V4Y2VwdGlvbjsKLWltcG9ydCBqYXZhLnV0aWwubG9n
Z2luZy5MZXZlbDsKLWltcG9ydCBvcmcub3BlbnNvbGFyaXMub3Blbmdyb2suT3Blbkdyb2tMb2dn
ZXI7CisKIGltcG9ydCBvcmcub3BlbnNvbGFyaXMub3Blbmdyb2suY29uZmlndXJhdGlvbi5Db25m
aWd1cmF0aW9uOwogaW1wb3J0IG9yZy5vcGVuc29sYXJpcy5vcGVuZ3Jvay5jb25maWd1cmF0aW9u
LlJ1bnRpbWVFbnZpcm9ubWVudDsKIApAQCAtNTAsMTYgKzQ5LDEyIEBACiAgICAgICAgIHRyeSAg
ewogICAgICAgICAgICAgRmlsZSBmaWxlID0gbmV3IEZpbGUoY29uZmlnZmlsZSk7CiAgICAgICAg
ICAgICBpZiAoIWZpbGUuZXhpc3RzKCkpIHsKLSAgICAgICAgICAgICAgICBpZiAoIWZpbGUuY3Jl
YXRlTmV3RmlsZSgpKSB7Ci0gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBJT0V4Y2VwdGlv
bigiQ291bGQgbm90IGNyZWF0ZSBjb25maWd1cmF0aW9uIGZpbGU6ICciICsgY29uZmlnZmlsZSAr
ICInIik7Ci0gICAgICAgICAgICAgICAgfQorICAgICAgICAgICAgICAgIGZpbGUuY3JlYXRlTmV3
RmlsZSgpOwogICAgICAgICAgICAgfQogICAgICAgICAgICAgUnVudGltZUVudmlyb25tZW50Lmdl
dEluc3RhbmNlKCkud3JpdGVDb25maWd1cmF0aW9uKGZpbGUpOwogICAgICAgICB9IGNhdGNoIChJ
T0V4Y2VwdGlvbiBvcmlnKSB7Ci0gICAgICAgICAgICBJT0V4Y2VwdGlvbiBpb2V4ID0gbmV3IElP
RXhjZXB0aW9uKCJDb3VsZCBub3QgY3JlYXRlIGNvbmZpZ3VyYXRpb24gZmlsZSAiICsgY29uZmln
ZmlsZSk7Ci0gICAgICAgICAgICBpb2V4LmluaXRDYXVzZShvcmlnKTsKLSAgICAgICAgICAgIE9w
ZW5Hcm9rTG9nZ2VyLmdldExvZ2dlcigpLmxvZyhMZXZlbC5TRVZFUkUsIkNvdWxkIG5vdCBjcmVh
dGUgY29uZmlnZmlsZSAiICsgY29uZmlnZmlsZSwgaW9leCk7Ci0gICAgICAgICAgICB0aHJvdyBp
b2V4OworICAgICAgICAgICAgdGhyb3cgbmV3IElPRXhjZXB0aW9uKCJDb3VsZCBub3QgY3JlYXRl
IGNvbmZpZ3VyYXRpb24gZmlsZSAnIiAKKyAgICAgICAgICAgICAgICArIGNvbmZpZ2ZpbGUgKyAi
JyIsIG9yaWcpOwogICAgICAgICB9CiAgICAgfQogfQpkaWZmIC1yIDYxNTQ5MDI2YWFmZSAtciAy
NjExMTY1MDdjN2Egc3JjL29yZy9vcGVuc29sYXJpcy9vcGVuZ3Jvay9tYW5hZ2VtZW50L01hbmFn
ZW1lbnQuamF2YQotLS0gYS9zcmMvb3JnL29wZW5zb2xhcmlzL29wZW5ncm9rL21hbmFnZW1lbnQv
TWFuYWdlbWVudC5qYXZhCVN1biBGZWIgMTIgMDQ6Mzc6MzYgMjAxMiArMDEwMAorKysgYi9zcmMv
b3JnL29wZW5zb2xhcmlzL29wZW5ncm9rL21hbmFnZW1lbnQvTWFuYWdlbWVudC5qYXZhCU1vbiBG
ZWIgMTMgMDY6MTI6NDcgMjAxMiArMDEwMApAQCAtMzYsOCArMzYsOCBAQAogCiBwdWJsaWMgZmlu
YWwgY2xhc3MgTWFuYWdlbWVudCBpbXBsZW1lbnRzIE1hbmFnZW1lbnRNQmVhbiwgTUJlYW5SZWdp
c3RyYXRpb24gewogCisgICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgTG9nZ2VyIGxvZyA9IExvZ2dl
ci5nZXRMb2dnZXIoTWFuYWdlbWVudC5jbGFzcy5nZXROYW1lKCkpOwogICAgIHByaXZhdGUgc3Rh
dGljIE1hbmFnZW1lbnQgbWFuYWdlbWVudEluc3RhbmNlID0gbnVsbDsKLSAgICBwcml2YXRlIHN0
YXRpYyBmaW5hbCBMb2dnZXIgbG9nID0gTG9nZ2VyLmdldExvZ2dlcigib3JnLm9wZW5zb2xhcmlz
Lm9wZW5ncm9rIik7CiAgICAgcHJpdmF0ZSBmaW5hbCBQcm9wZXJ0aWVzIG9nYVByb3BlcnRpZXM7
CiAgICAgcHJpdmF0ZSBmaW5hbCBsb25nIHN0YXJ0VGltZTsgLy8gU3RvcmVzIHRoZSB0aW1lIHRo
aXMgYmVhbiBpcyBjcmVhdGVkCiAgICAgcHJpdmF0ZSBCb29sZWFuIHVwZGF0ZSA9IEJvb2xlYW4u
RkFMU0U7CmRpZmYgLXIgNjE1NDkwMjZhYWZlIC1yIDI2MTExNjUwN2M3YSBzcmMvb3JnL29wZW5z
b2xhcmlzL29wZW5ncm9rL21hbmFnZW1lbnQvT0dBZ2VudC5qYXZhCi0tLSBhL3NyYy9vcmcvb3Bl
bnNvbGFyaXMvb3Blbmdyb2svbWFuYWdlbWVudC9PR0FnZW50LmphdmEJU3VuIEZlYiAxMiAwNDoz
NzozNiAyMDEyICswMTAwCisrKyBiL3NyYy9vcmcvb3BlbnNvbGFyaXMvb3Blbmdyb2svbWFuYWdl
bWVudC9PR0FnZW50LmphdmEJTW9uIEZlYiAxMyAwNjoxMjo0NyAyMDEyICswMTAwCkBAIC02Miw3
ICs2Miw3IEBACiBmaW5hbCBwdWJsaWMgY2xhc3MgT0dBZ2VudCB7CiAgICAgUHJvcGVydGllcyBw
cm9wczsKIAotICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIExvZ2dlciBsb2cgPSBMb2dnZXIuZ2V0
TG9nZ2VyKCJvcmcub3BlbnNvbGFyaXMub3Blbmdyb2siKTsKKyAgICBwcml2YXRlIHN0YXRpYyBm
aW5hbCBMb2dnZXIgbG9nID0gTG9nZ2VyLmdldExvZ2dlcihPR0FnZW50LmNsYXNzLmdldE5hbWUo
KSk7CiAgICAgcHJpdmF0ZSBNQmVhblNlcnZlciBzZXJ2ZXIgPSBudWxsOwogCiAKQEAgLTc3LDgg
Kzc3LDggQEAKICAgICAgICAgICAgIHByb3BzLmxvYWQoc3RyZWFtKTsKICAgICAgICAgICAgIHJl
dCA9IHRydWU7CiAgICAgICAgIH0gY2F0Y2ggKElPRXhjZXB0aW9uIGUpIHsKLSAgICAgICAgICAg
IFN5c3RlbS5lcnIucHJpbnRsbigiRmFpbGVkIHRvIHJlYWQgY29uZmlndXJhdGlvbiIpOwotICAg
ICAgICAgICAgZS5wcmludFN0YWNrVHJhY2UoU3lzdGVtLmVycik7CisgICAgICAgICAgICBsb2cu
d2FybmluZygiRmFpbGVkIHRvIHJlYWQgY29uZmlndXJhdGlvbjogIiArIGUuZ2V0TWVzc2FnZSgp
KTsKKyAgICAgICAgICAgIGxvZy5sb2coTGV2ZWwuRklORSwgImxvYWRQcm9wZXJ0aWVzIiwgZSk7
CiAgICAgICAgICAgICByZXQgPSBmYWxzZTsKICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAg
ICAgIElPVXRpbHMuY2xvc2Uoc3RyZWFtKTsKQEAgLTExMSw3ICsxMTEsNyBAQAogICAgICAgICAg
ICAgICAgICAgICBzdWNjZXNzID0gbG9hZFByb3BlcnRpZXMoZmlsZSwgbnVsbCwgcHJvcHMpOwog
ICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3MgPSBm
YWxzZTsKLSAgICAgICAgICAgICAgICAgICAgU3lzdGVtLmVyci5wcmludGxuKCJDYW5ub3QgbG9h
ZCBmaWxlIFwiIiArIGZpbGUuZ2V0QWJzb2x1dGVQYXRoKCkgKyAiXCI6IE5vIHN1Y2ggZmlsZSIp
OworICAgICAgICAgICAgICAgICAgICBsb2cuc2V2ZXJlKCJDYW5ub3QgbG9hZCBmaWxlICciICsg
ZmlsZS5nZXRBYnNvbHV0ZVBhdGgoKSArICInOiBObyBzdWNoIGZpbGUiKTsKICAgICAgICAgICAg
ICAgICB9CiAgICAgICAgICAgICB9CiAgICAgICAgIH0KQEAgLTEyMiw4ICsxMjIsOCBAQAogICAg
ICAgICAgICAgICAgIHVyaSA9IG5ldyBVUkkocHJvcHMuZ2V0UHJvcGVydHkoImFnZW50IikpOwog
ICAgICAgICAgICAgfSBjYXRjaCAoVVJJU3ludGF4RXhjZXB0aW9uIGV4KSB7CiAgICAgICAgICAg
ICAgICAgc3VjY2VzcyA9IGZhbHNlOwotICAgICAgICAgICAgICAgIFN5c3RlbS5lcnIucHJpbnRs
bigiRmFpbGVkIHRvIGRlY29kZSBhZ2VudCB1cmwiKTsKLSAgICAgICAgICAgICAgICBleC5wcmlu
dFN0YWNrVHJhY2UoU3lzdGVtLmVycik7CisgICAgICAgICAgICAgICAgbG9nLnNldmVyZSgiRmFp
bGVkIHRvIGRlY29kZSBhZ2VudCB1cmw6ICIgKyBleC5nZXRNZXNzYWdlKCkpOworICAgICAgICAg
ICAgICAgIGxvZy5sb2coTGV2ZWwuRklORSwgIm1haW4iLCBleCk7CiAgICAgICAgICAgICB9CiAg
ICAgICAgIH0KIApAQCAtMTU0LDEzICsxNTQsMTYgQEAKICAgICAgICAgICAgIHRyeSB7CiAgICAg
ICAgICAgICAgICAgb2dhLnJ1bk9HQSgpOwogICAgICAgICAgICAgfSBjYXRjaCAoTWFsZm9ybWVk
VVJMRXhjZXB0aW9uIGUpIHsKLSAgICAgICAgICAgICAgICBsb2cubG9nKExldmVsLlNFVkVSRSwg
IkNvdWxkIG5vdCBjcmVhdGUgY29ubmVjdG9yIHNlcnZlcjogIiArIGUsIGUpOworICAgICAgICAg
ICAgICAgIGxvZy5zZXZlcmUoIkNvdWxkIG5vdCBjcmVhdGUgY29ubmVjdG9yIHNlcnZlcjogIiAr
IGUuZ2V0TWVzc2FnZSgpKTsKKyAgICAgICAgICAgICAgICBsb2cubG9nKExldmVsLkZJTkUsICJt
YWluIiwgZSk7CiAgICAgICAgICAgICAgICAgU3lzdGVtLmV4aXQoMSk7CiAgICAgICAgICAgICB9
IGNhdGNoIChJT0V4Y2VwdGlvbiBlKSB7Ci0gICAgICAgICAgICAgICAgbG9nLmxvZyhMZXZlbC5T
RVZFUkUsICJDb3VsZCBub3Qgc3RhcnQgY29ubmVjdG9yIHNlcnZlcjogIiArIGUsIGUpOworICAg
ICAgICAgICAgICAgIGxvZy5zZXZlcmUoIkNvdWxkIG5vdCBzdGFydCBjb25uZWN0b3Igc2VydmVy
OiAiICsgZS5nZXRNZXNzYWdlKCkpOworICAgICAgICAgICAgICAgIGxvZy5sb2coTGV2ZWwuRklO
RSwgIm1haW4iLCBlKTsKICAgICAgICAgICAgICAgICBTeXN0ZW0uZXhpdCgyKTsKICAgICAgICAg
ICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBleCkgewotICAgICAgICAgICAgICAgIExvZ2dlci5nZXRM
b2dnZXIoT0dBZ2VudC5jbGFzcy5nZXROYW1lKCkpLmxvZyhMZXZlbC5TRVZFUkUsIG51bGwsIGV4
KTsKKyAgICAgICAgICAgICAgICBsb2cuc2V2ZXJlKGV4LmdldE1lc3NhZ2UoKSk7CisgICAgICAg
ICAgICAgICAgbG9nLmxvZyhMZXZlbC5GSU5FLCAibWFpbiIsIGV4KTsKICAgICAgICAgICAgICAg
ICBTeXN0ZW0uZXhpdCgxKTsKICAgICAgICAgICAgIH0KICAgICAgICAgfSBlbHNlIHsKQEAgLTI4
OSw3ICsyOTIsNyBAQAogICAgICAgICB0cnkgewogICAgICAgICAgICAgT3Blbkdyb2tMb2dnZXIu
c2V0dXBMb2dnZXIoT0dBbG9ncGF0aCwgbG9nbGV2ZWwsIGNvbnNvbGVsb2dsZXZlbCk7CiAgICAg
ICAgIH0gY2F0Y2ggKElPRXhjZXB0aW9uIGV4KSB7Ci0gICAgICAgICAgICBTeXN0ZW0uZXJyLnBy
aW50bG4oIk9HQWdlbnQgZmFpbGVkIHNldCB1cCBsb2dnaW5nOiAiICsgZXgpOworICAgICAgICAg
ICAgbG9nLndhcm5pbmcoIk9HQWdlbnQgZmFpbGVkIHNldCB1cCBsb2dnaW5nOiAiICsgZXguZ2V0
TWVzc2FnZSgpKTsKICAgICAgICAgICAgIHJldCA9IGZhbHNlOwogICAgICAgICB9CiAKZGlmZiAt
ciA2MTU0OTAyNmFhZmUgLXIgMjYxMTE2NTA3YzdhIHNyYy9vcmcvb3BlbnNvbGFyaXMvb3Blbmdy
b2svbWFuYWdlbWVudC9jbGllbnQvQWdlbnRDb25uZWN0aW9uLmphdmEKLS0tIGEvc3JjL29yZy9v
cGVuc29sYXJpcy9vcGVuZ3Jvay9tYW5hZ2VtZW50L2NsaWVudC9BZ2VudENvbm5lY3Rpb24uamF2
YQlTdW4gRmViIDEyIDA0OjM3OjM2IDIwMTIgKzAxMDAKKysrIGIvc3JjL29yZy9vcGVuc29sYXJp
cy9vcGVuZ3Jvay9tYW5hZ2VtZW50L2NsaWVudC9BZ2VudENvbm5lY3Rpb24uamF2YQlNb24gRmVi
IDEzIDA2OjEyOjQ3IDIwMTIgKzAxMDAKQEAgLTQ5LDcgKzQ5LDcgQEAKICAgICBwcml2YXRlIE1C
ZWFuU2VydmVyQ29ubmVjdGlvbiBzZXJ2ZXIgPSBudWxsOwogICAgIHByaXZhdGUgZmluYWwgT2Jq
ZWN0TmFtZSBvYmpOYW1lOwogICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIFN0cmluZyBvYmpTdHJO
YW1lID0gIk9HQTpuYW1lPUFnZW50SW5kZXhSdW5uZXIsc291cmNlPXRpbWVyIjsKLSAgICBwcml2
YXRlIHN0YXRpYyBmaW5hbCBMb2dnZXIgbG9nZ2VyID0gTG9nZ2VyLmdldExvZ2dlcigib3JnLm9w
ZW5zb2xhcmlzLm9wZW5ncm9rIik7CisgICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgTG9nZ2VyIGxv
Z2dlciA9IExvZ2dlci5nZXRMb2dnZXIoQWdlbnRDb25uZWN0aW9uLmNsYXNzLmdldE5hbWUoKSk7
CiAgICAgcHJpdmF0ZSBTdHJpbmcgYWdlbnR1cmwgPSAiIjsKICAgICBwcml2YXRlIEpNWENvbm5l
Y3RvciBqbXhjb25uID0gbnVsbDsKICAgICBwcml2YXRlIGJvb2xlYW4gY29ubmVjdGVkID0gZmFs
c2U7CkBAIC04MSw3ICs4MSw4IEBACiAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAg
IHJlY29ubmVjdCgxKTsKICAgICAgICAgICAgIH0gY2F0Y2ggKElPRXhjZXB0aW9uIGV4KSB7Ci0g
ICAgICAgICAgICAgICAgTG9nZ2VyLmdldExvZ2dlcihBZ2VudENvbm5lY3Rpb24uY2xhc3MuZ2V0
TmFtZSgpKS5sb2coTGV2ZWwuU0VWRVJFLCBudWxsLCBleCk7CisgICAgICAgICAgICAgICAgbG9n
Z2VyLmxvZyhMZXZlbC5TRVZFUkUsIGV4LmdldE1lc3NhZ2UoKSk7CisgICAgICAgICAgICAgICAg
bG9nZ2VyLmxvZyhMZXZlbC5GSU5FLCAiZ2V0TUJlYW5TZXJ2ZXJDb25uZWN0aW9uIiwgZXgpOwog
ICAgICAgICAgICAgfQogICAgICAgICB9CiAgICAgICAgIHJldHVybiBzZXJ2ZXI7CkBAIC0xODUs
MTQgKzE4NiwxNCBAQAogCiAgICAgcHVibGljIHZvaWQgcmVnaXN0ZXJMaXN0ZW5lcigpIHRocm93
cyBJT0V4Y2VwdGlvbiwKICAgICAgICAgICAgIEluc3RhbmNlTm90Rm91bmRFeGNlcHRpb24gewot
ICAgICAgICBsb2dnZXIuZmluZSgiUmVnaXN0ZXJpbmcgbGlzdGVuZXI6ICIgKyB0aGlzLmdldENs
YXNzKCkuZ2V0TmFtZSgpICsgIiBmb3IgT2JqZWN0TmFtZTogIiArIG9iak5hbWUpOworICAgICAg
ICBsb2dnZXIuZmluZSgiUmVnaXN0ZXJpbmcgbGlzdGVuZXIgIiArIHRoaXMuZ2V0Q2xhc3MoKS5n
ZXROYW1lKCkgKyAiIGZvciBPYmplY3ROYW1lICIgKyBvYmpOYW1lKTsKICAgICAgICAgc2VydmVy
LmFkZE5vdGlmaWNhdGlvbkxpc3RlbmVyKG9iak5hbWUsIHRoaXMsIG51bGwsIG9iak5hbWUpOwog
ICAgICAgICBsb2dnZXIuZmluZSgiTGlzdGVuZXIgUmVnaXN0ZXJlZCIpOwogICAgICAgICBsaXN0
ZW5lclJlZ2lzdGVyZWQgPSB0cnVlOwogICAgIH0KIAogICAgIHB1YmxpYyB2b2lkIHJlY29ubmVj
dChpbnQgcmV0cnl0aW1lcykgdGhyb3dzIE1hbGZvcm1lZFVSTEV4Y2VwdGlvbiwgSU9FeGNlcHRp
b24gewotICAgICAgICBsb2dnZXIuZmluZSgiRG9pbmcgcmVjb25uZWN0IG9uICciICsgYWdlbnR1
cmwgKyAiJyIpOworICAgICAgICBsb2dnZXIuZmluZSgiRG9pbmcgcmVjb25uZWN0IG9uICIgKyBh
Z2VudHVybCk7CiAgICAgICAgIGJvb2xlYW4gbm90Y29ubmVjdGVkID0gdHJ1ZTsKICAgICAgICAg
aW50IHRyaWVkbnVtdGltZXMgPSAwOwogICAgICAgICB3aGlsZSAobm90Y29ubmVjdGVkKSB7CkBA
IC0yMDEsNyArMjAyLDcgQEAKICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAg
ICAgICBqbXhjb25uLmNsb3NlKCk7CiAgICAgICAgICAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9u
IGV4KSB7Ci0gICAgICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKCJFeGNlcHRpb24gZHVy
aW5nIGNsb3NlICIgKyBleCk7CisgICAgICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKCJF
eGNlcHRpb24gZHVyaW5nIGNsb3NlICIgKyBleC5nZXRNZXNzYWdlKCkpOwogICAgICAgICAgICAg
ICAgIH0KICAgICAgICAgICAgIH0KICAgICAgICAgICAgIHRyeSB7CkBAIC0yMjIsNyArMjIzLDcg
QEAKICAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgIFRo
cmVhZC5zbGVlcChSRUNPTk5FQ1RfU0xFRVBUSU1FKTsKICAgICAgICAgICAgICAgICAgICAgfSBj
YXRjaCAoRXhjZXB0aW9uIHNsZWVwZXgpIHsKLSAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dl
ci5maW5lc3QoIlRocmVhZC5zbGVlcCBleGNlcHRpb24gIiArIHNsZWVwZXgpOworICAgICAgICAg
ICAgICAgICAgICAgICAgbG9nZ2VyLmZpbmVzdCgicmVjb25uZWN0OiAiICsgc2xlZXBleC5nZXRN
ZXNzYWdlKCkpOwogICAgICAgICAgICAgICAgICAgICB9CiAKICAgICAgICAgICAgICAgICB9IGVs
c2UgewpAQCAtMjUxLDExICsyNTIsMTEgQEAKICAgICBwdWJsaWMgdm9pZCB1bnJlZ2lzdGVyKCkg
ewogICAgICAgICBpZiAoKHNlcnZlciAhPSBudWxsKSAmJiAob2JqTmFtZSAhPSBudWxsKSAmJiBs
aXN0ZW5lclJlZ2lzdGVyZWQpIHsKICAgICAgICAgICAgIHRyeSB7Ci0gICAgICAgICAgICAgICAg
bG9nZ2VyLmZpbmUoIlVucmVnaXN0ZXJpbmcgbGlzdGVuZXI6ICIgKyB0aGlzLmdldENsYXNzKCku
Z2V0TmFtZSgpICsgIiBmb3IgT2JqZWN0TmFtZTogIiArIG9iak5hbWUpOworICAgICAgICAgICAg
ICAgIGxvZ2dlci5maW5lKCJVbnJlZ2lzdGVyaW5nIGxpc3RlbmVyICIgKyB0aGlzLmdldENsYXNz
KCkuZ2V0TmFtZSgpICsgIiBmb3IgT2JqZWN0TmFtZSAiICsgb2JqTmFtZSk7CiAgICAgICAgICAg
ICAgICAgc2VydmVyLnJlbW92ZU5vdGlmaWNhdGlvbkxpc3RlbmVyKG9iak5hbWUsIHRoaXMsIG51
bGwsIG9iak5hbWUpOwogICAgICAgICAgICAgICAgIGxpc3RlbmVyUmVnaXN0ZXJlZCA9IGZhbHNl
OwogICAgICAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIHJlbW5sZXgpIHsKLSAgICAgICAgICAg
ICAgICBsb2dnZXIuc2V2ZXJlKCJFeGNlcHRpb24gdW5yZWdpc3RlciBub3RpZiBsaXN0ZW5lcjog
JyIgKyB0aGlzLmdldENsYXNzKCkuZ2V0TmFtZSgpICsgIicgZm9yIE9iamVjdE5hbWU6ICIgKyBv
YmpOYW1lICsgIiciKTsKKyAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZygiRXhjZXB0aW9u
IHVucmVnaXN0ZXIgbm90aWYgbGlzdGVuZXIgIiArIHRoaXMuZ2V0Q2xhc3MoKS5nZXROYW1lKCkg
KyAiIGZvciBPYmplY3ROYW1lICIgKyBvYmpOYW1lKTsKICAgICAgICAgICAgIH0KICAgICAgICAg
fQogCkBAIC0yNjgsNyArMjY5LDggQEAKICAgICAgICAgICAgICAgICBzZXJ2ZXIgPSBudWxsOwog
ICAgICAgICAgICAgfQogICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewotICAgICAgICAg
ICAgbG9nZ2VyLmxvZyhMZXZlbC5TRVZFUkUsICJFeGNlcHRpb24gZGlzY29ubmVjdGluZyAiICsg
ZS5nZXRNZXNzYWdlKCksIGUpOworICAgICAgICAgICAgbG9nZ2VyLmxvZyhMZXZlbC5XQVJOSU5H
LCAiZGlzY29ubmVjdDogIiArIGUuZ2V0TWVzc2FnZSgpKTsKKyAgICAgICAgICAgIGxvZ2dlci5s
b2coTGV2ZWwuRklORSwgInVucmVnaXN0ZXIiLCBlKTsKICAgICAgICAgfQogCiAgICAgfQpkaWZm
IC1yIDYxNTQ5MDI2YWFmZSAtciAyNjExMTY1MDdjN2Egc3JjL29yZy9vcGVuc29sYXJpcy9vcGVu
Z3Jvay9tYW5hZ2VtZW50L2NsaWVudC9Db25maWd1cmF0aW9uc0ZyYW1lLmphdmEKLS0tIGEvc3Jj
L29yZy9vcGVuc29sYXJpcy9vcGVuZ3Jvay9tYW5hZ2VtZW50L2NsaWVudC9Db25maWd1cmF0aW9u
c0ZyYW1lLmphdmEJU3VuIEZlYiAxMiAwNDozNzozNiAyMDEyICswMTAwCisrKyBiL3NyYy9vcmcv
b3BlbnNvbGFyaXMvb3Blbmdyb2svbWFuYWdlbWVudC9jbGllbnQvQ29uZmlndXJhdGlvbnNGcmFt
ZS5qYXZhCU1vbiBGZWIgMTMgMDY6MTI6NDcgMjAxMiArMDEwMApAQCAtMjksNiArMjksNyBAQAog
aW1wb3J0IGphdmEudXRpbC5MaXN0OwogaW1wb3J0IGphdmEudXRpbC5sb2dnaW5nLkxldmVsOwog
aW1wb3J0IGphdmEudXRpbC5sb2dnaW5nLkxvZ2dlcjsKKwogaW1wb3J0IGphdmF4Lm1hbmFnZW1l
bnQuQXR0cmlidXRlOwogaW1wb3J0IGphdmF4Lm1hbmFnZW1lbnQuQXR0cmlidXRlTm90Rm91bmRF
eGNlcHRpb247CiBpbXBvcnQgamF2YXgubWFuYWdlbWVudC5JbnN0YW5jZU5vdEZvdW5kRXhjZXB0
aW9uOwpAQCAtMzgsNyArMzksNyBAQAogaW1wb3J0IGphdmF4Lm1hbmFnZW1lbnQuT2JqZWN0TmFt
ZTsKIGltcG9ydCBqYXZheC5tYW5hZ2VtZW50LlJlZmxlY3Rpb25FeGNlcHRpb247CiBpbXBvcnQg
amF2YXguc3dpbmcudGFibGUuRGVmYXVsdFRhYmxlTW9kZWw7Ci1pbXBvcnQgb3JnLm9wZW5zb2xh
cmlzLm9wZW5ncm9rLk9wZW5Hcm9rTG9nZ2VyOworCiBpbXBvcnQgb3JnLm9wZW5zb2xhcmlzLm9w
ZW5ncm9rLmNvbmZpZ3VyYXRpb24uQ29uZmlndXJhdGlvbjsKIGltcG9ydCBvcmcub3BlbnNvbGFy
aXMub3Blbmdyb2suY29uZmlndXJhdGlvbi5Qcm9qZWN0OwogaW1wb3J0IG9yZy5vcGVuc29sYXJp
cy5vcGVuZ3Jvay5oaXN0b3J5LlJlcG9zaXRvcnlJbmZvOwpAQCAtNTIsOCArNTMsOCBAQAogQFN1
cHByZXNzV2FybmluZ3MoIlBNRC5TaW5ndWxhckZpZWxkIikKIHB1YmxpYyBjbGFzcyBDb25maWd1
cmF0aW9uc0ZyYW1lIGV4dGVuZHMgamF2YXguc3dpbmcuSkZyYW1lIHsKIAorICAgIHByaXZhdGUg
c3RhdGljIGZpbmFsIExvZ2dlciBsb2dnZXIgPSBMb2dnZXIuZ2V0TG9nZ2VyKENvbmZpZ3VyYXRp
b25zRnJhbWUuY2xhc3MuZ2V0TmFtZSgpKTsKICAgICBBZ2VudENvbm5lY3Rpb24gY29uOwotICAg
IHByaXZhdGUgc3RhdGljIGZpbmFsIExvZ2dlciBsb2dnZXIgPSBPcGVuR3Jva0xvZ2dlci5nZXRM
b2dnZXIoKTsKICAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBMZXZlbFtdIGxldmVscyA9IG5ldyBM
ZXZlbFtde0xldmVsLkFMTCwKICAgICBMZXZlbC5DT05GSUcsIExldmVsLkZJTkUsTGV2ZWwuRklO
RVIsTGV2ZWwuRklORVNULExldmVsLklORk8sTGV2ZWwuT0ZGLAogICAgIExldmVsLlNFVkVSRSwg
TGV2ZWwuV0FSTklOR307CkBAIC0xMzAsMTUgKzEzMSwyMCBAQAogICAgICAgICAgICAgICAgY29u
ZmlnID0gQ29uZmlndXJhdGlvbi5tYWtlWE1MU3RyaW5nQXNDb25maWd1cmF0aW9uKHhtbGNvbmZp
Zyk7CiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZUNvbmZpZ0ZpZWxkc0Zyb21Db25maWcoKTsK
ICAgICAgICAgICAgIH0gY2F0Y2ggKE1CZWFuRXhjZXB0aW9uIGV4KSB7Ci0gICAgICAgICAgICAg
ICAgbG9nZ2VyLmxvZyhMZXZlbC5TRVZFUkUsICIiLCBleCk7CisgICAgICAgICAgICAgICAgbG9n
Z2VyLndhcm5pbmcoZXguZ2V0TWVzc2FnZSgpKTsKKyAgICAgICAgICAgICAgICBsb2dnZXIubG9n
KExldmVsLkZJTkUsICJnZXRDb25maWdzRnJvbUFnZW50IiwgZXgpOwogICAgICAgICAgICAgfSBj
YXRjaCAoQXR0cmlidXRlTm90Rm91bmRFeGNlcHRpb24gZXgpIHsKLSAgICAgICAgICAgICAgICBM
b2dnZXIuZ2V0TG9nZ2VyKENvbmZpZ3VyYXRpb25zRnJhbWUuY2xhc3MuZ2V0TmFtZSgpKS5sb2co
TGV2ZWwuU0VWRVJFLCBudWxsLCBleCk7CisgICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmco
ZXguZ2V0TWVzc2FnZSgpKTsKKyAgICAgICAgICAgICAgICBsb2dnZXIubG9nKExldmVsLkZJTkUs
ICJnZXRDb25maWdzRnJvbUFnZW50IiwgZXgpOwogICAgICAgICAgICAgfSBjYXRjaCAoSW5zdGFu
Y2VOb3RGb3VuZEV4Y2VwdGlvbiBleCkgewotICAgICAgICAgICAgICAgIExvZ2dlci5nZXRMb2dn
ZXIoQ29uZmlndXJhdGlvbnNGcmFtZS5jbGFzcy5nZXROYW1lKCkpLmxvZyhMZXZlbC5TRVZFUkUs
IG51bGwsIGV4KTsKKyAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZyhleC5nZXRNZXNzYWdl
KCkpOworICAgICAgICAgICAgICAgIGxvZ2dlci5sb2coTGV2ZWwuRklORSwgImdldENvbmZpZ3NG
cm9tQWdlbnQiLCBleCk7CiAgICAgICAgICAgICB9IGNhdGNoIChSZWZsZWN0aW9uRXhjZXB0aW9u
IGV4KSB7Ci0gICAgICAgICAgICAgICAgTG9nZ2VyLmdldExvZ2dlcihDb25maWd1cmF0aW9uc0Zy
YW1lLmNsYXNzLmdldE5hbWUoKSkubG9nKExldmVsLlNFVkVSRSwgbnVsbCwgZXgpOworICAgICAg
ICAgICAgICAgIGxvZ2dlci53YXJuaW5nKGV4LmdldE1lc3NhZ2UoKSk7CisgICAgICAgICAgICAg
ICAgbG9nZ2VyLmxvZyhMZXZlbC5GSU5FLCAiZ2V0Q29uZmlnc0Zyb21BZ2VudCIsIGV4KTsKICAg
ICAgICAgICAgIH0gY2F0Y2ggKElPRXhjZXB0aW9uIGV4KSB7Ci0gICAgICAgICAgICAgICAgTG9n
Z2VyLmdldExvZ2dlcihDb25maWd1cmF0aW9uc0ZyYW1lLmNsYXNzLmdldE5hbWUoKSkubG9nKExl
dmVsLlNFVkVSRSwgbnVsbCwgZXgpOworICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKGV4
LmdldE1lc3NhZ2UoKSk7CisgICAgICAgICAgICAgICAgbG9nZ2VyLmxvZyhMZXZlbC5GSU5FLCAi
Z2V0Q29uZmlnc0Zyb21BZ2VudCIsIGV4KTsKICAgICAgICAgICAgIH0KICAgICAgICAgfQogICAg
IH0KQEAgLTg1NSw3ICs4NjEsOCBAQAogICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAg
ICAgICAgICAgIG5ldyBDb25maWd1cmF0aW9uc0ZyYW1lKG51bGwpLnNldFZpc2libGUodHJ1ZSk7
CiAgICAgICAgICAgICAgICAgfSBjYXRjaCAoSU9FeGNlcHRpb24gZXgpIHsKLSAgICAgICAgICAg
ICAgICAgICAgTG9nZ2VyLmdldExvZ2dlcihDb25maWd1cmF0aW9uc0ZyYW1lLmNsYXNzLmdldE5h
bWUoKSkubG9nKExldmVsLlNFVkVSRSwgbnVsbCwgZXgpOworICAgICAgICAgICAgICAgICAgICBs
b2dnZXIud2FybmluZyhleC5nZXRNZXNzYWdlKCkpOworICAgICAgICAgICAgICAgICAgICBsb2dn
ZXIubG9nKExldmVsLkZJTkUsICJtYWluIiwgZXgpOwogICAgICAgICAgICAgICAgIH0KICAgICAg
ICAgICAgIH0KICAgICAgICAgfSk7CmRpZmYgLXIgNjE1NDkwMjZhYWZlIC1yIDI2MTExNjUwN2M3
YSBzcmMvb3JnL29wZW5zb2xhcmlzL29wZW5ncm9rL21hbmFnZW1lbnQvY2xpZW50L09wZW5Hcm9r
VHJheUFwcC5qYXZhCi0tLSBhL3NyYy9vcmcvb3BlbnNvbGFyaXMvb3Blbmdyb2svbWFuYWdlbWVu
dC9jbGllbnQvT3Blbkdyb2tUcmF5QXBwLmphdmEJU3VuIEZlYiAxMiAwNDozNzozNiAyMDEyICsw
MTAwCisrKyBiL3NyYy9vcmcvb3BlbnNvbGFyaXMvb3Blbmdyb2svbWFuYWdlbWVudC9jbGllbnQv
T3Blbkdyb2tUcmF5QXBwLmphdmEJTW9uIEZlYiAxMyAwNjoxMjo0NyAyMDEyICswMTAwCkBAIC0z
NSw2ICszNSw3IEBACiBpbXBvcnQgamF2YS5pby5JT0V4Y2VwdGlvbjsKIGltcG9ydCBqYXZhLnV0
aWwubG9nZ2luZy5MZXZlbDsKIGltcG9ydCBqYXZhLnV0aWwubG9nZ2luZy5Mb2dnZXI7CisKIGlt
cG9ydCBvcmcub3BlbnNvbGFyaXMub3Blbmdyb2suT3Blbkdyb2tMb2dnZXI7CiAKIC8qKgpAQCAt
NDMsMTAgKzQ0LDEwIEBACiAgKi8KIHB1YmxpYyBjbGFzcyBPcGVuR3Jva1RyYXlBcHAgewogCisg
ICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgTG9nZ2VyIGxvZyA9IExvZ2dlci5nZXRMb2dnZXIoT3Bl
bkdyb2tUcmF5QXBwLmNsYXNzLmdldE5hbWUoKSk7CiAgICAgcHJpdmF0ZSBzdGF0aWMgVHJheUlj
b24gdHJheUljb247CiAgICAgcHJpdmF0ZSBzdGF0aWMgU3RyaW5nIGNmZ2ZpbGU7CiAgICAgcHJp
dmF0ZSBmaW5hbCBTZXR0aW5nc1BlcnNpc3RlbmNlIHNldHRpbmdzOwotICAgIHByaXZhdGUgc3Rh
dGljIGZpbmFsIExvZ2dlciBsb2cgPSBPcGVuR3Jva0xvZ2dlci5nZXRMb2dnZXIoKTsKICAgICBw
dWJsaWMgc3RhdGljIGZpbmFsIFN0cmluZyBPUEVOR1JPS0lDT05VUkwgPSAib3Blbmdyb2suZ2lm
IjsKICAgICBwdWJsaWMgc3RhdGljIGZpbmFsIFN0cmluZyBJTkRFWFdBUk5JTkdJQ09OVVJMID0g
Im9wZW5ncm9rX2luZGV4d2FybmluZy5naWYiOwogICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgU3Ry
aW5nIE5PQ09OTkVDVElPTklDT05VUkwgPSAib3Blbmdyb2tfbm9jb25uZWN0aW9uLmdpZiI7CkBA
IC03Niw3ICs3Nyw4IEBACiAgICAgICAgICAgICBPcGVuR3Jva1RyYXlBcHAgb2d0YSA9IG5ldyBP
cGVuR3Jva1RyYXlBcHAoY2ZnZmlsZSk7CiAgICAgICAgICAgICBvZ3RhLmVuYWJsZVN5c3RlbVRy
YXkoKTsKICAgICAgICAgfSBjYXRjaCAoSU9FeGNlcHRpb24gZXgpIHsKLSAgICAgICAgICAgIGxv
Zy5sb2coTGV2ZWwuU0VWRVJFLCAiRXhjZXB0aW9uIHN0YXJ0aW5nICIsIGV4KTsKKyAgICAgICAg
ICAgIGxvZy5zZXZlcmUoZXguZ2V0TWVzc2FnZSgpKTsKKyAgICAgICAgICAgIGxvZy5sb2coTGV2
ZWwuRklORSwgIm1haW4iLCBleCk7CiAgICAgICAgIH0KICAgICB9CiAKQEAgLTEzNCw4ICsxMzYs
OCBAQAogICAgICAgICAgICAgICAgICAgICBzZiA9IG5ldyBDb25maWd1cmF0aW9uc0ZyYW1lKGFn
ZW50KTsKICAgICAgICAgICAgICAgICAgICAgc2Yuc2V0VmlzaWJsZSh0cnVlKTsKICAgICAgICAg
ICAgICAgICB9IGNhdGNoIChJT0V4Y2VwdGlvbiBleCkgewotICAgICAgICAgICAgICAgICAgICBM
b2dnZXIuZ2V0TG9nZ2VyKE9wZW5Hcm9rVHJheUFwcC5jbGFzcy5nZXROYW1lKCkpLmxvZyhMZXZl
bC5TRVZFUkUsIG51bGwsIGV4KTsKLQorICAgICAgICAgICAgICAgICAgICBsb2cud2FybmluZyhl
eC5nZXRMb2NhbGl6ZWRNZXNzYWdlKCkpOworICAgICAgICAgICAgICAgICAgICBsb2cubG9nKExl
dmVsLkZJTkUsICJhY3Rpb25QZXJmb3JtZWQiLCBlKTsKICAgICAgICAgICAgICAgICB9CiAKICAg
ICAgICAgICAgICAgICBsb2cuZmluZXIoIkRvbmUgY29uZmlnIik7CkBAIC0zODIsNyArMzg0LDgg
QEAKICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgdHJheS5hZGQodHJheUljb24p
OwogICAgICAgICAgICAgfSBjYXRjaCAoQVdURXhjZXB0aW9uIGUpIHsKLSAgICAgICAgICAgICAg
ICBsb2cubG9nKExldmVsLldBUk5JTkcsICJUcmF5SWNvbiBjb3VsZCBub3QgYmUgYWRkZWQuIiwg
ZSk7CisgICAgICAgICAgICAgICAgbG9nLmxvZyhMZXZlbC5XQVJOSU5HLCAiVHJheUljb24gY291
bGQgbm90IGJlIGFkZGVkOiAiICsgZS5nZXRNZXNzYWdlKCkpOworICAgICAgICAgICAgICAgIGxv
Zy5sb2coTGV2ZWwuRklORSwgImVuYWJsZVN5c3RlbVRyYXkiLCBlKTsKICAgICAgICAgICAgIH0K
ICAgICAgICAgICAgIGxvZy5pbmZvKCJDcmVhdGVkLCByZWFkeSBmb3IgYWN0aW9uIik7CiAKZGlm
ZiAtciA2MTU0OTAyNmFhZmUgLXIgMjYxMTE2NTA3YzdhIHNyYy9vcmcvb3BlbnNvbGFyaXMvb3Bl
bmdyb2svbWFuYWdlbWVudC9jbGllbnQvU2V0dGluZ3NGcmFtZS5qYXZhCi0tLSBhL3NyYy9vcmcv
b3BlbnNvbGFyaXMvb3Blbmdyb2svbWFuYWdlbWVudC9jbGllbnQvU2V0dGluZ3NGcmFtZS5qYXZh
CVN1biBGZWIgMTIgMDQ6Mzc6MzYgMjAxMiArMDEwMAorKysgYi9zcmMvb3JnL29wZW5zb2xhcmlz
L29wZW5ncm9rL21hbmFnZW1lbnQvY2xpZW50L1NldHRpbmdzRnJhbWUuamF2YQlNb24gRmViIDEz
IDA2OjEyOjQ3IDIwMTIgKzAxMDAKQEAgLTkwLDcgKzkwLDYgQEAKICAgICAgKiBXQVJOSU5HOiBE
byBOT1QgbW9kaWZ5IHRoaXMgY29kZS4gVGhlIGNvbnRlbnQgb2YgdGhpcyBtZXRob2QgaXMKICAg
ICAgKiBhbHdheXMgcmVnZW5lcmF0ZWQgYnkgdGhlIEZvcm0gRWRpdG9yLgogICAgICAqLwotICAg
IEBTdXBwcmVzc1dhcm5pbmdzKCJ1bmNoZWNrZWQiKQogICAgIC8vIDxlZGl0b3ItZm9sZCBkZWZh
dWx0c3RhdGU9ImNvbGxhcHNlZCIgZGVzYz0iR2VuZXJhdGVkIENvZGUiPi8vR0VOLUJFR0lOOmlu
aXRDb21wb25lbnRzCiAgICAgcHJpdmF0ZSB2b2lkIGluaXRDb21wb25lbnRzKCkgewogCkBAIC0y
NzYsMTEgKzI3NSwxNCBAQAogICAgICovCiAgICAgcHVibGljIHN0YXRpYyB2b2lkIG1haW4oU3Ry
aW5nIGFyZ3NbXSkgewogICAgICAgICBqYXZhLmF3dC5FdmVudFF1ZXVlLmludm9rZUxhdGVyKG5l
dyBSdW5uYWJsZSgpIHsKKyAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICAgcHVibGlj
IHZvaWQgcnVuKCkgewogICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIG5ldyBTZXR0
aW5nc0ZyYW1lKG5ldyBTZXR0aW5nc1BlcnNpc3RlbmNlKG51bGwpKS5zZXRWaXNpYmxlKHRydWUp
OwogICAgICAgICAgICAgfSBjYXRjaCAoSU9FeGNlcHRpb24gZXgpIHsKLSAgICAgICAgICAgICAg
IExvZ2dlci5nZXRMb2dnZXIoU2V0dGluZ3NGcmFtZS5jbGFzcy5nZXROYW1lKCkpLmxvZyhMZXZl
bC5TRVZFUkUsIG51bGwsIGV4KTsKKyAgICAgICAgICAgICAgIExvZ2dlciBsb2dnZXIgPSBMb2dn
ZXIuZ2V0TG9nZ2VyKFNldHRpbmdzRnJhbWUuY2xhc3MuZ2V0TmFtZSgpKTsKKyAgICAgICAgICAg
ICAgIGxvZ2dlci5zZXZlcmUoZXguZ2V0TWVzc2FnZSgpKTsKKyAgICAgICAgICAgICAgIGxvZ2dl
ci5sb2coTGV2ZWwuRklORSwgInJ1biIsIGV4KTsKICAgICAgICAgICAgIH0KICAgICAgICAgICAg
IH0KICAgICAgICAgfSk7CmRpZmYgLXIgNjE1NDkwMjZhYWZlIC1yIDI2MTExNjUwN2M3YSBzcmMv
b3JnL29wZW5zb2xhcmlzL29wZW5ncm9rL21hbmFnZW1lbnQvY2xpZW50L1Nob3dFcnJvckZvcm0u
amF2YQotLS0gYS9zcmMvb3JnL29wZW5zb2xhcmlzL29wZW5ncm9rL21hbmFnZW1lbnQvY2xpZW50
L1Nob3dFcnJvckZvcm0uamF2YQlTdW4gRmViIDEyIDA0OjM3OjM2IDIwMTIgKzAxMDAKKysrIGIv
c3JjL29yZy9vcGVuc29sYXJpcy9vcGVuZ3Jvay9tYW5hZ2VtZW50L2NsaWVudC9TaG93RXJyb3JG
b3JtLmphdmEJTW9uIEZlYiAxMyAwNjoxMjo0NyAyMDEyICswMTAwCkBAIC0xMzcsOSArMTM3LDEx
IEBACiAgICAgKi8KICAgICBwdWJsaWMgc3RhdGljIHZvaWQgbWFpbihTdHJpbmcgYXJnc1tdKSB7
CiAgICAgICAgIGphdmEuYXd0LkV2ZW50UXVldWUuaW52b2tlTGF0ZXIobmV3IFJ1bm5hYmxlKCkg
eworICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgICBwdWJsaWMgdm9pZCBydW4oKSB7
CiAgICAgICAgICAgICAgICAgU2hvd0Vycm9yRm9ybSBkaWFsb2cgPSBuZXcgU2hvd0Vycm9yRm9y
bShuZXcgamF2YXguc3dpbmcuSkZyYW1lKCksIHRydWUsIlRlc3QgTWVzc2FnZSIpOwogICAgICAg
ICAgICAgICAgIGRpYWxvZy5hZGRXaW5kb3dMaXN0ZW5lcihuZXcgamF2YS5hd3QuZXZlbnQuV2lu
ZG93QWRhcHRlcigpIHsKKyAgICAgICAgICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAg
ICAgICAgICAgIHB1YmxpYyB2b2lkIHdpbmRvd0Nsb3NpbmcoamF2YS5hd3QuZXZlbnQuV2luZG93
RXZlbnQgZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgU3lzdGVtLmV4aXQoMCk7CiAgICAg
ICAgICAgICAgICAgICAgIH0KZGlmZiAtciA2MTU0OTAyNmFhZmUgLXIgMjYxMTE2NTA3YzdhIHNy
Yy9vcmcvb3BlbnNvbGFyaXMvb3Blbmdyb2svc2VhcmNoL1Jlc3VsdHMuamF2YQotLS0gYS9zcmMv
b3JnL29wZW5zb2xhcmlzL29wZW5ncm9rL3NlYXJjaC9SZXN1bHRzLmphdmEJU3VuIEZlYiAxMiAw
NDozNzozNiAyMDEyICswMTAwCisrKyBiL3NyYy9vcmcvb3BlbnNvbGFyaXMvb3Blbmdyb2svc2Vh
cmNoL1Jlc3VsdHMuamF2YQlNb24gRmViIDEzIDA2OjEyOjQ3IDIwMTIgKzAxMDAKQEAgLTM1LDE0
ICszNSwxNCBAQAogaW1wb3J0IGphdmEudXRpbC5MaW5rZWRIYXNoTWFwOwogaW1wb3J0IGphdmEu
dXRpbC5NYXA7CiBpbXBvcnQgamF2YS51dGlsLmxvZ2dpbmcuTGV2ZWw7CitpbXBvcnQgamF2YS51
dGlsLmxvZ2dpbmcuTG9nZ2VyOwogaW1wb3J0IGphdmEudXRpbC56aXAuR1pJUElucHV0U3RyZWFt
OwogCiBpbXBvcnQgb3JnLmFwYWNoZS5sdWNlbmUuZG9jdW1lbnQuRG9jdW1lbnQ7CiBpbXBvcnQg
b3JnLmFwYWNoZS5sdWNlbmUuZG9jdW1lbnQuRmllbGRhYmxlOwogaW1wb3J0IG9yZy5hcGFjaGUu
bHVjZW5lLmluZGV4LkNvcnJ1cHRJbmRleEV4Y2VwdGlvbjsKK2ltcG9ydCBvcmcuYXBhY2hlLmx1
Y2VuZS5zZWFyY2guSW5kZXhTZWFyY2hlcjsKIGltcG9ydCBvcmcuYXBhY2hlLmx1Y2VuZS5zZWFy
Y2guU2NvcmVEb2M7Ci1pbXBvcnQgb3JnLmFwYWNoZS5sdWNlbmUuc2VhcmNoLkluZGV4U2VhcmNo
ZXI7Ci1pbXBvcnQgb3JnLm9wZW5zb2xhcmlzLm9wZW5ncm9rLk9wZW5Hcm9rTG9nZ2VyOwogaW1w
b3J0IG9yZy5vcGVuc29sYXJpcy5vcGVuZ3Jvay5hbmFseXNpcy5EZWZpbml0aW9uczsKIGltcG9y
dCBvcmcub3BlbnNvbGFyaXMub3Blbmdyb2suYW5hbHlzaXMuRmlsZUFuYWx5emVyLkdlbnJlOwog
aW1wb3J0IG9yZy5vcGVuc29sYXJpcy5vcGVuZ3Jvay5hbmFseXNpcy5UYWdGaWx0ZXI7CkBAIC01
Niw2ICs1Niw3IEBACiAgKiBAYXV0aG9yIENoYW5kYW4gc2xpZ2h0bHkgcmV3cml0dGVuIGJ5IEx1
Ym9zIEtvc2NvCiAgKi8KIHB1YmxpYyBmaW5hbCBjbGFzcyBSZXN1bHRzIHsKKyAgICBwcml2YXRl
IHN0YXRpYyBmaW5hbCBMb2dnZXIgbG9nZ2VyID0gTG9nZ2VyLmdldExvZ2dlcihSZXN1bHRzLmNs
YXNzLmdldE5hbWUoKSk7CiAgICAgcHJpdmF0ZSBSZXN1bHRzKCkgewogICAgICAgICAvLyBVdGls
IGNsYXNzLCBzaG91bGQgbm90IGJlIGNvbnN0cnVjdGVkCiAgICAgfQpAQCAtMTExLDkgKzExMiw5
IEBACiAgICAgICAgICAgICBpbnQgbGVuID0gci5yZWFkKGNvbnRlbnQpOwogICAgICAgICAgICAg
cmV0dXJuIG5ldyBTdHJpbmcoY29udGVudCwgMCwgbGVuKTsKICAgICAgICAgfSBjYXRjaCAoRXhj
ZXB0aW9uIGUpIHsKLSAgICAgICAgICAgIE9wZW5Hcm9rTG9nZ2VyLmdldExvZ2dlcigpLmxvZygK
LSAgICAgICAgICAgICAgICBMZXZlbC5XQVJOSU5HLCAiQW4gZXJyb3IgcmVhZGluZyB0YWdzIGZy
b20gIiArIGJhc2VkaXIgKyBwYXRoCi0gICAgICAgICAgICAgICAgICAgICsgKGNvbXByZXNzZWQg
PyAiLmd6IiA6ICIiKSwgZSk7CisgICAgICAgICAgICBsb2dnZXIud2FybmluZygiQW4gZXJyb3Ig
cmVhZGluZyB0YWdzIGZyb20gJyIgKyBiYXNlZGlyICsgcGF0aAorICAgICAgICAgICAgICAgICAg
ICArIChjb21wcmVzc2VkID8gIi5neic6ICIgOiAiJzogIikgKyBlLmdldE1lc3NhZ2UoKSk7Cisg
ICAgICAgICAgICBsb2dnZXIubG9nKExldmVsLkZJTkUsICJnZXRUYWdzIiwgZSk7CiAgICAgICAg
IH0gZmluYWxseSB7CiAgICAgICAgICAgICBJT1V0aWxzLmNsb3NlKHIpOwogICAgICAgICAgICAg
SU9VdGlscy5jbG9zZShnaXMpOwpkaWZmIC1yIDYxNTQ5MDI2YWFmZSAtciAyNjExMTY1MDdjN2Eg
c3JjL29yZy9vcGVuc29sYXJpcy9vcGVuZ3Jvay9zZWFyY2gvU2VhcmNoRW5naW5lLmphdmEKLS0t
IGEvc3JjL29yZy9vcGVuc29sYXJpcy9vcGVuZ3Jvay9zZWFyY2gvU2VhcmNoRW5naW5lLmphdmEJ
U3VuIEZlYiAxMiAwNDozNzozNiAyMDEyICswMTAwCisrKyBiL3NyYy9vcmcvb3BlbnNvbGFyaXMv
b3Blbmdyb2svc2VhcmNoL1NlYXJjaEVuZ2luZS5qYXZhCU1vbiBGZWIgMTMgMDY6MTI6NDcgMjAx
MiArMDEwMApAQCAtMjQsMTMgKzI0LDIyIEBACiAKIHBhY2thZ2Ugb3JnLm9wZW5zb2xhcmlzLm9w
ZW5ncm9rLnNlYXJjaDsKIAotaW1wb3J0IGphdmEuaW8uKjsKK2ltcG9ydCBqYXZhLmlvLkJ1ZmZl
cmVkUmVhZGVyOworaW1wb3J0IGphdmEuaW8uRmlsZTsKK2ltcG9ydCBqYXZhLmlvLkZpbGVJbnB1
dFN0cmVhbTsKK2ltcG9ydCBqYXZhLmlvLkZpbGVOb3RGb3VuZEV4Y2VwdGlvbjsKK2ltcG9ydCBq
YXZhLmlvLkZpbGVSZWFkZXI7CitpbXBvcnQgamF2YS5pby5JT0V4Y2VwdGlvbjsKK2ltcG9ydCBq
YXZhLmlvLklucHV0U3RyZWFtUmVhZGVyOworaW1wb3J0IGphdmEuaW8uUmVhZGVyOwogaW1wb3J0
IGphdmEudXRpbC5BcnJheUxpc3Q7CiBpbXBvcnQgamF2YS51dGlsLkxpc3Q7CiBpbXBvcnQgamF2
YS51dGlsLmNvbmN1cnJlbnQuRXhlY3V0b3JTZXJ2aWNlOwogaW1wb3J0IGphdmEudXRpbC5jb25j
dXJyZW50LkV4ZWN1dG9yczsKIGltcG9ydCBqYXZhLnV0aWwubG9nZ2luZy5MZXZlbDsKK2ltcG9y
dCBqYXZhLnV0aWwubG9nZ2luZy5Mb2dnZXI7CiBpbXBvcnQgamF2YS51dGlsLnppcC5HWklQSW5w
dXRTdHJlYW07CisKIGltcG9ydCBvcmcuYXBhY2hlLmx1Y2VuZS5kb2N1bWVudC5Eb2N1bWVudDsK
IGltcG9ydCBvcmcuYXBhY2hlLmx1Y2VuZS5kb2N1bWVudC5GaWVsZGFibGU7CiBpbXBvcnQgb3Jn
LmFwYWNoZS5sdWNlbmUuaW5kZXguSW5kZXhSZWFkZXI7CkBAIC00MSw3ICs1MCw2IEBACiBpbXBv
cnQgb3JnLmFwYWNoZS5sdWNlbmUuc2VhcmNoLlRvcFNjb3JlRG9jQ29sbGVjdG9yOwogaW1wb3J0
IG9yZy5hcGFjaGUubHVjZW5lLnN0b3JlLkZTRGlyZWN0b3J5OwogaW1wb3J0IG9yZy5hcGFjaGUu
bHVjZW5lLnV0aWwuVmVyc2lvbjsKLWltcG9ydCBvcmcub3BlbnNvbGFyaXMub3Blbmdyb2suT3Bl
bkdyb2tMb2dnZXI7CiBpbXBvcnQgb3JnLm9wZW5zb2xhcmlzLm9wZW5ncm9rLmFuYWx5c2lzLkNv
bXBhdGlibGVBbmFseXNlcjsKIGltcG9ydCBvcmcub3BlbnNvbGFyaXMub3Blbmdyb2suYW5hbHlz
aXMuRGVmaW5pdGlvbnM7CiBpbXBvcnQgb3JnLm9wZW5zb2xhcmlzLm9wZW5ncm9rLmFuYWx5c2lz
LkZpbGVBbmFseXplci5HZW5yZTsKQEAgLTYzLDYgKzcxLDcgQEAKICAqIEBhdXRob3IgTHVib3Mg
S29zY28gMjAxMSAtIHVwZ3JhZGUgdG8gbHVjZW5lIDMuNS4wCiAgKi8KIHB1YmxpYyBjbGFzcyBT
ZWFyY2hFbmdpbmUgeworICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIExvZ2dlciBsb2dnZXIgPSBM
b2dnZXIuZ2V0TG9nZ2VyKFNlYXJjaEVuZ2luZS5jbGFzcy5nZXROYW1lKCkpOwogICAgIC8qKiBN
ZXNzYWdlIHRleHQgdXNlZCB3aGVuIGxvZ2dpbmcgZXhjZXB0aW9ucyB0aHJvd24gd2hlbiBzZWFy
Y2hpbmcuICovCiAgICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgU3RyaW5nIFNFQVJDSF9FWENFUFRJ
T05fTVNHID0gIkV4Y2VwdGlvbiBzZWFyY2hpbmciOwogCkBAIC0yNDksOCArMjU4LDggQEAKICAg
ICAgICAgICAgICAgICB9CiAgICAgICAgICAgICB9CiAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlv
biBlKSB7Ci0gICAgICAgICAgICBPcGVuR3Jva0xvZ2dlci5nZXRMb2dnZXIoKS5sb2coCi0gICAg
ICAgICAgICAgICAgICAgIExldmVsLldBUk5JTkcsIFNFQVJDSF9FWENFUFRJT05fTVNHLCBlKTsK
KyAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKFNFQVJDSF9FWENFUFRJT05fTVNHICsgIjogIiAr
IGUuZ2V0TWVzc2FnZSgpKTsKKyAgICAgICAgICAgIGxvZ2dlci5sb2coTGV2ZWwuRklORSwgInNl
YXJjaCIsIGUpOwogICAgICAgICB9CiAKICAgICAgICAgaWYgKCFkb2NzLmlzRW1wdHkoKSkgewpA
QCAtMjYzLDcgKzI3Miw5IEBACiAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgIHN1
bW1hcml6ZXIgPSBuZXcgU3VtbWFyaXplcihxdWVyeSwgYW5hbHl6ZXIpOwogICAgICAgICAgICAg
fSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKLSAgICAgICAgICAgICAgICBPcGVuR3Jva0xvZ2dlci5n
ZXRMb2dnZXIoKS5sb2coTGV2ZWwuV0FSTklORywgIkFuIGVycm9yIG9jY3VyZWQgd2hpbGUgY3Jl
YXRpbmcgc3VtbWFyeSIsIGUpOworICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKCJBbiBl
cnJvciBvY2N1cmVkIHdoaWxlIGNyZWF0aW5nIHN1bW1hcnk6ICIgCisgICAgICAgICAgICAgICAg
ICAgICsgZS5nZXRNZXNzYWdlKCkpOworICAgICAgICAgICAgICAgIGxvZ2dlci5sb2coTGV2ZWwu
RklORSwgInNlYXJjaCIsIGUpOwogICAgICAgICAgICAgfQogCiAgICAgICAgICAgICBoaXN0b3J5
Q29udGV4dCA9IG51bGw7CkBAIC0yNzMsNyArMjg0LDkgQEAKICAgICAgICAgICAgICAgICAgICAg
aGlzdG9yeUNvbnRleHQgPSBudWxsOwogICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgIH0g
Y2F0Y2ggKEV4Y2VwdGlvbiBlKSB7Ci0gICAgICAgICAgICAgICAgT3Blbkdyb2tMb2dnZXIuZ2V0
TG9nZ2VyKCkubG9nKExldmVsLldBUk5JTkcsICJBbiBlcnJvciBvY2N1cmVkIHdoaWxlIGdldHRp
bmcgaGlzdG9yeSBjb250ZXh0IiwgZSk7CisgICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmco
IkFuIGVycm9yIG9jY3VyZWQgd2hpbGUgZ2V0dGluZyBoaXN0b3J5IGNvbnRleHQ6ICIgCisgICAg
ICAgICAgICAgICAgICAgICsgZS5nZXRNZXNzYWdlKCkpOworICAgICAgICAgICAgICAgIGxvZ2dl
ci5sb2coTGV2ZWwuRklORSwgInNlYXJjaCIsIGUpOwogICAgICAgICAgICAgfQogICAgICAgICB9
CiAgICAgICAgIGludCBjb3VudD1oaXRzPT1udWxsPzA6aGl0cy5sZW5ndGg7CkBAIC0zMDYsOCAr
MzE5LDggQEAKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgc2VhcmNoZXIuc2VhcmNoKHF1
ZXJ5LGNvbGxlY3Rvcik7CiAgICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgeyAvLyB0aGlz
IGV4Y2VwdGlvbiBzaG91bGQgbmV2ZXIgYmUgaGl0LCBzaW5jZSBzZWFyY2goKSB3aWxsIGhpdCB0
aGlzIGJlZm9yZQotICAgICAgICAgICAgICAgICBPcGVuR3Jva0xvZ2dlci5nZXRMb2dnZXIoKS5s
b2coCi0gICAgICAgICAgICAgICAgICAgICAgICAgTGV2ZWwuV0FSTklORywgU0VBUkNIX0VYQ0VQ
VElPTl9NU0csIGUpOworICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKFNFQVJDSF9FWENFUFRJ
T05fTVNHICsgIjogIiArIGUuZ2V0TWVzc2FnZSgpKTsKKyAgICAgICAgICAgICBsb2dnZXIubG9n
KExldmVsLkZJTkUsICJyZXN1bHRzIiwgZSk7ICAgIAogICAgICAgICAgfQogICAgICAgICAgaGl0
cyA9IGNvbGxlY3Rvci50b3BEb2NzKCkuc2NvcmVEb2NzOwogICAgICAgICAgRG9jdW1lbnQgZD1u
dWxsOwpAQCAtMzE2LDggKzMyOSw4IEBACiAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAg
ICAgICAgZCA9IHNlYXJjaGVyLmRvYyhkb2NJZCk7CiAgICAgICAgICAgICAgfSAgY2F0Y2ggKEV4
Y2VwdGlvbiBlKSB7Ci0gICAgICAgICAgICAgICAgIE9wZW5Hcm9rTG9nZ2VyLmdldExvZ2dlcigp
LmxvZygKLSAgICAgICAgICAgICAgICAgICAgICAgICBMZXZlbC5TRVZFUkUsIFNFQVJDSF9FWENF
UFRJT05fTVNHLCBlKTsKKyAgICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoU0VBUkNIX0VY
Q0VQVElPTl9NU0cgKyAiOiAiICsgZS5nZXRNZXNzYWdlKCkpOworICAgICAgICAgICAgICAgICBs
b2dnZXIubG9nKExldmVsLkZJTkUsICJyZXN1bHRzIiwgZSk7CiAgICAgICAgICAgICAgfQogICAg
ICAgICAgICAgIGRvY3MuYWRkKGQpOwogICAgICAgICAgfQpAQCAtMzczLDExICszODYsMTMgQEAK
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7Ci0gICAgICAgICAgICAg
ICAgICAgICAgICAgICAgT3Blbkdyb2tMb2dnZXIuZ2V0TG9nZ2VyKCkud2FybmluZygiVW5rbm93
biBnZW5yZTogIiArIGdlbnJlICsgIiBmb3IgIitmaWxlbmFtZSk7CisgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoIlVua25vd24gZ2VucmUgJyIgKyBnZW5yZSArICIn
IGZvciAnIgorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICArIGZpbGVuYW1lICsgIici
KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoYXNDb250ZXh0IHw9IHNvdXJjZUNvbnRl
eHQuZ2V0Q29udGV4dChudWxsLCBudWxsLCBudWxsLCBudWxsLCBmaWxlbmFtZSwgdGFncywgZmFs
c2UsIHJldCk7CiAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAg
IH0gY2F0Y2ggKEZpbGVOb3RGb3VuZEV4Y2VwdGlvbiBleHApIHsKLSAgICAgICAgICAgICAgICAg
ICAgICAgIE9wZW5Hcm9rTG9nZ2VyLmdldExvZ2dlcigpLndhcm5pbmcoIkNvdWxkbid0IHJlYWQg
c3VtbWFyeSBmcm9tICIrZmlsZW5hbWUrIiAoIitleHAuZ2V0TWVzc2FnZSgpKyIpIik7CisgICAg
ICAgICAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZygiQ291bGRuJ3QgcmVhZCBzdW1tYXJ5
IGZyb20gJyIKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICArIGZpbGVuYW1lICsgIic6ICIg
KyBleHAuZ2V0TWVzc2FnZSgpKTsKICAgICAgICAgICAgICAgICAgICAgICAgIGhhc0NvbnRleHQg
fD0gc291cmNlQ29udGV4dC5nZXRDb250ZXh0KG51bGwsIG51bGwsIG51bGwsIG51bGwsIGZpbGVu
YW1lLCB0YWdzLCBmYWxzZSwgcmV0KTsKICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAg
ICAgICAgIH0KQEAgLTM4OCwxNCArNDAzLDE0IEBACiAgICAgICAgICAgICAgICAgICAgIHJldC5h
ZGQobmV3IEhpdChmaWxlbmFtZSwgIi4uLiIsICIiLCBmYWxzZSwgYWx0KSk7CiAgICAgICAgICAg
ICAgICAgfQogICAgICAgICAgICAgfSBjYXRjaCAoSU9FeGNlcHRpb24gZSkgewotICAgICAgICAg
ICAgICAgIE9wZW5Hcm9rTG9nZ2VyLmdldExvZ2dlcigpLmxvZygKLSAgICAgICAgICAgICAgICAg
ICAgICAgIExldmVsLldBUk5JTkcsIFNFQVJDSF9FWENFUFRJT05fTVNHLCBlKTsKKyAgICAgICAg
ICAgICAgICBsb2dnZXIud2FybmluZyhTRUFSQ0hfRVhDRVBUSU9OX01TRyArICI6ICIgKyBlLmdl
dE1lc3NhZ2UoKSk7CisgICAgICAgICAgICAgICAgbG9nZ2VyLmxvZyhMZXZlbC5GSU5FLCAicmVz
dWx0cyIsIGUpOwogICAgICAgICAgICAgfSBjYXRjaCAoQ2xhc3NOb3RGb3VuZEV4Y2VwdGlvbiBl
KSB7Ci0gICAgICAgICAgICAgICAgT3Blbkdyb2tMb2dnZXIuZ2V0TG9nZ2VyKCkubG9nKAotICAg
ICAgICAgICAgICAgICAgICAgICAgTGV2ZWwuV0FSTklORywgU0VBUkNIX0VYQ0VQVElPTl9NU0cs
IGUpOworICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKFNFQVJDSF9FWENFUFRJT05fTVNH
ICsgIjogIiArIGUuZ2V0TWVzc2FnZSgpKTsKKyAgICAgICAgICAgICAgICBsb2dnZXIubG9nKExl
dmVsLkZJTkUsICJyZXN1bHRzIiwgZSk7CiAgICAgICAgICAgICB9IGNhdGNoIChIaXN0b3J5RXhj
ZXB0aW9uIGUpIHsKLSAgICAgICAgICAgICAgICBPcGVuR3Jva0xvZ2dlci5nZXRMb2dnZXIoKS5s
b2coCi0gICAgICAgICAgICAgICAgICAgICAgICBMZXZlbC5XQVJOSU5HLCBTRUFSQ0hfRVhDRVBU
SU9OX01TRywgZSk7CisgICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoU0VBUkNIX0VYQ0VQ
VElPTl9NU0cgKyAiOiAiICsgZS5nZXRNZXNzYWdlKCkpOworICAgICAgICAgICAgICAgIGxvZ2dl
ci5sb2coTGV2ZWwuRklORSwgInJlc3VsdHMiLCBlKTsKICAgICAgICAgICAgIH0KICAgICAgICAg
fQogCmRpZmYgLXIgNjE1NDkwMjZhYWZlIC1yIDI2MTExNjUwN2M3YSBzcmMvb3JnL29wZW5zb2xh
cmlzL29wZW5ncm9rL3NlYXJjaC9jb250ZXh0L0NvbnRleHQuamF2YQotLS0gYS9zcmMvb3JnL29w
ZW5zb2xhcmlzL29wZW5ncm9rL3NlYXJjaC9jb250ZXh0L0NvbnRleHQuamF2YQlTdW4gRmViIDEy
IDA0OjM3OjM2IDIwMTIgKzAxMDAKKysrIGIvc3JjL29yZy9vcGVuc29sYXJpcy9vcGVuZ3Jvay9z
ZWFyY2gvY29udGV4dC9Db250ZXh0LmphdmEJTW9uIEZlYiAxMyAwNjoxMjo0NyAyMDEyICswMTAw
CkBAIC0zNyw4ICszNyw5IEBACiBpbXBvcnQgamF2YS51dGlsLk1hcDsKIGltcG9ydCBqYXZhLnV0
aWwuVHJlZU1hcDsKIGltcG9ydCBqYXZhLnV0aWwubG9nZ2luZy5MZXZlbDsKK2ltcG9ydCBqYXZh
LnV0aWwubG9nZ2luZy5Mb2dnZXI7CisKIGltcG9ydCBvcmcuYXBhY2hlLmx1Y2VuZS5zZWFyY2gu
UXVlcnk7Ci1pbXBvcnQgb3JnLm9wZW5zb2xhcmlzLm9wZW5ncm9rLk9wZW5Hcm9rTG9nZ2VyOwog
aW1wb3J0IG9yZy5vcGVuc29sYXJpcy5vcGVuZ3Jvay5hbmFseXNpcy5EZWZpbml0aW9uczsKIGlt
cG9ydCBvcmcub3BlbnNvbGFyaXMub3Blbmdyb2suY29uZmlndXJhdGlvbi5SdW50aW1lRW52aXJv
bm1lbnQ7CiBpbXBvcnQgb3JnLm9wZW5zb2xhcmlzLm9wZW5ncm9rLnNlYXJjaC5IaXQ7CkBAIC00
Nyw2ICs0OCw3IEBACiAKIHB1YmxpYyBjbGFzcyBDb250ZXh0IHsKIAorICAgIHByaXZhdGUgc3Rh
dGljIGZpbmFsIExvZ2dlciBsb2dnZXIgPSBMb2dnZXIuZ2V0TG9nZ2VyKENvbnRleHQuY2xhc3Mu
Z2V0TmFtZSgpKTsKICAgICBwcml2YXRlIGZpbmFsIExpbmVNYXRjaGVyW10gbTsKICAgICBzdGF0
aWMgZmluYWwgaW50IE1BWEZJTEVSRUFEID0gMTAyNCAqIDEwMjQ7CiAgICAgcHJpdmF0ZSBjaGFy
W10gYnVmZmVyOwpAQCAtMTg3LDcgKzE4OSw5IEBACiAgICAgICAgICAgICB9IGNhdGNoIChFeGNl
cHRpb24gZSkgewogICAgICAgICAgICAgICAgIGlmIChoaXRzICE9IG51bGwpIHsKICAgICAgICAg
ICAgICAgICAgICAgLy8gQHRvZG8gdmVyaWZ5IHdoeSB3ZSBpZ25vcmUgYWxsIGV4Y2VwdGlvbnM/
Ci0gICAgICAgICAgICAgICAgICAgIE9wZW5Hcm9rTG9nZ2VyLmdldExvZ2dlcigpLmxvZyhMZXZl
bC5XQVJOSU5HLCAiQ291bGQgbm90IGdldCBjb250ZXh0IGZvciAiICsgcGF0aCwgZSk7CisgICAg
ICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKCJDb3VsZCBub3QgZ2V0IGNvbnRleHQgZm9y
ICciICsgcGF0aCArICInOiAiIAorICAgICAgICAgICAgICAgICAgICAgICAgKyBlLmdldE1lc3Nh
Z2UoKSk7CisgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5sb2coTGV2ZWwuRklORSwgImdldENv
bnRleHQiLCBlKTsKICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICB9CiAgICAgICAgIH0K
QEAgLTIyMyw3ICsyMjcsOCBAQAogICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg
ICAgfQogICAgICAgICAgICAgfSBjYXRjaCAoSU9FeGNlcHRpb24gZSkgewotICAgICAgICAgICAg
ICAgIE9wZW5Hcm9rTG9nZ2VyLmdldExvZ2dlcigpLmxvZyhMZXZlbC5XQVJOSU5HLCAiQW4gZXJy
b3Igb2NjdXJlZCB3aGlsZSByZWFkaW5nIGRhdGEiLCBlKTsKKyAgICAgICAgICAgICAgICBsb2dn
ZXIud2FybmluZygiQW4gZXJyb3Igb2NjdXJlZCB3aGlsZSByZWFkaW5nIGRhdGE6ICIgKyBlLmdl
dE1lc3NhZ2UoKSk7CisgICAgICAgICAgICAgICAgbG9nZ2VyLmxvZyhMZXZlbC5GSU5FLCAiZ2V0
Q29udGV4dCIsIGUpOwogICAgICAgICAgICAgICAgIHJldHVybiBhbnl0aGluZzsKICAgICAgICAg
ICAgIH0KICAgICAgICAgICAgIGlmIChjaGFyc1JlYWQgPT0gMCkgewpAQCAtMjY2LDE1ICsyNzEs
MTggQEAKICAgICAgICAgICAgICAgICBvdXQud3JpdGUoIjxhIGhyZWY9XCIiICsgVXRpbC5VUklF
bmNvZGVQYXRoKG1vcmVQcmVmaXgpICsgcGF0aEUgKyAiPyIgKyBxdWVyeUFzVVJJICsgIlwiPlth
bGwuLi5dPC9hPiIpOwogICAgICAgICAgICAgfQogICAgICAgICB9IGNhdGNoIChJT0V4Y2VwdGlv
biBlKSB7Ci0gICAgICAgICAgICBPcGVuR3Jva0xvZ2dlci5nZXRMb2dnZXIoKS5sb2coTGV2ZWwu
V0FSTklORywgIkNvdWxkIG5vdCBnZXQgY29udGV4dCBmb3IgIiArIHBhdGgsIGUpOworICAgICAg
ICAgICAgbG9nZ2VyLndhcm5pbmcoIkNvdWxkIG5vdCBnZXQgY29udGV4dCBmb3IgJyIgKyBwYXRo
ICsgIic6ICIgCisgICAgICAgICAgICAgICAgKyBlLmdldE1lc3NhZ2UoKSk7CisgICAgICAgICAg
ICBsb2dnZXIubG9nKExldmVsLkZJTkUsICJnZXRDb250ZXh0IiwgZSk7CiAgICAgICAgIH0gZmlu
YWxseSB7CiAgICAgICAgICAgICBJT1V0aWxzLmNsb3NlKGluKTsKLSAgICAgICAgICAgIAorICAg
ICAgICAgICAgLy8gZG9uJ3QgY2xvc2UKICAgICAgICAgICAgIGlmIChvdXQgIT0gbnVsbCkgewog
ICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgIG91dC5mbHVzaCgpOwog
ICAgICAgICAgICAgICAgIH0gY2F0Y2ggKElPRXhjZXB0aW9uIGUpIHsKLSAgICAgICAgICAgICAg
ICAgICAgT3Blbkdyb2tMb2dnZXIuZ2V0TG9nZ2VyKCkubG9nKExldmVsLldBUk5JTkcsICJGYWls
ZWQgdG8gZmx1c2ggc3RyZWFtOiAiLCBlKTsKKyAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLndh
cm5pbmcoIkZhaWxlZCB0byBmbHVzaCBzdHJlYW06ICIgKyBlLmdldE1lc3NhZ2UoKSk7CisgICAg
ICAgICAgICAgICAgICAgIGxvZ2dlci5sb2coTGV2ZWwuRklORSwgImdldENvbnRleHQiLCBlKTsK
ICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICB9CiAgICAgICAgIH0KZGlmZiAtciA2MTU0
OTAyNmFhZmUgLXIgMjYxMTE2NTA3YzdhIHNyYy9vcmcvb3BlbnNvbGFyaXMvb3Blbmdyb2svc2Vh
cmNoL2NvbnRleHQvSGlzdG9yeUNvbnRleHQuamF2YQotLS0gYS9zcmMvb3JnL29wZW5zb2xhcmlz
L29wZW5ncm9rL3NlYXJjaC9jb250ZXh0L0hpc3RvcnlDb250ZXh0LmphdmEJU3VuIEZlYiAxMiAw
NDozNzozNiAyMDEyICswMTAwCisrKyBiL3NyYy9vcmcvb3BlbnNvbGFyaXMvb3Blbmdyb2svc2Vh
cmNoL2NvbnRleHQvSGlzdG9yeUNvbnRleHQuamF2YQlNb24gRmViIDEzIDA2OjEyOjQ3IDIwMTIg
KzAxMDAKQEAgLTMxLDkgKzMxLDkgQEAKIGltcG9ydCBqYXZhLnV0aWwuSXRlcmF0b3I7CiBpbXBv
cnQgamF2YS51dGlsLkxpc3Q7CiBpbXBvcnQgamF2YS51dGlsLk1hcDsKLWltcG9ydCBqYXZhLnV0
aWwubG9nZ2luZy5MZXZlbDsKK2ltcG9ydCBqYXZhLnV0aWwubG9nZ2luZy5Mb2dnZXI7CisKIGlt
cG9ydCBvcmcuYXBhY2hlLmx1Y2VuZS5zZWFyY2guUXVlcnk7Ci1pbXBvcnQgb3JnLm9wZW5zb2xh
cmlzLm9wZW5ncm9rLk9wZW5Hcm9rTG9nZ2VyOwogaW1wb3J0IG9yZy5vcGVuc29sYXJpcy5vcGVu
Z3Jvay5oaXN0b3J5Lkhpc3Rvcnk7CiBpbXBvcnQgb3JnLm9wZW5zb2xhcmlzLm9wZW5ncm9rLmhp
c3RvcnkuSGlzdG9yeUVudHJ5OwogaW1wb3J0IG9yZy5vcGVuc29sYXJpcy5vcGVuZ3Jvay5oaXN0
b3J5Lkhpc3RvcnlFeGNlcHRpb247CkBAIC00Niw2ICs0Niw3IEBACiAgKiBzaW5jZSBsdWNlbmUg
ZG9lcyBub3QgZWFzaWx5IGdpdmUgdGhlIG1hdGNoIGNvbnRleHQuCiAgKi8KIHB1YmxpYyBjbGFz
cyBIaXN0b3J5Q29udGV4dCB7CisgICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgTG9nZ2VyIGxvZ2dl
ciA9IExvZ2dlci5nZXRMb2dnZXIoSGlzdG9yeUNvbnRleHQuY2xhc3MuZ2V0TmFtZSgpKTsKICAg
ICBwcml2YXRlIGZpbmFsIExpbmVNYXRjaGVyW10gbTsKICAgICBIaXN0b3J5TGluZVRva2VuaXpl
ciB0b2tlbnM7CiAKQEAgLTE3OSw3ICsxODAsOCBAQAogICAgICAgICAgICAgICAgIH0KICAgICAg
ICAgICAgIH0KICAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKLSAgICAgICAgICAgIE9w
ZW5Hcm9rTG9nZ2VyLmdldExvZ2dlcigpLmxvZyhMZXZlbC5XQVJOSU5HLCAiQ291bGQgbm90IGdl
dCBoaXN0b3J5IGNvbnRleHQgZm9yICIgKyBwYXRoLCBlKTsKKyAgICAgICAgICAgIGxvZ2dlci53
YXJuaW5nKCJDb3VsZCBub3QgZ2V0IGhpc3RvcnkgY29udGV4dCBmb3IgJyIgKyBwYXRoICsgIic6
ICIgCisgICAgICAgICAgICAgICAgKyBlLmdldE1lc3NhZ2UoKSk7CiAgICAgICAgIH0KICAgICAg
ICAgcmV0dXJuIG1hdGNoZWRMaW5lcyA+IDA7CiAgICAgfQpkaWZmIC1yIDYxNTQ5MDI2YWFmZSAt
ciAyNjExMTY1MDdjN2Egc3JjL29yZy9vcGVuc29sYXJpcy9vcGVuZ3Jvay91dGlsL0V4ZWN1dG9y
LmphdmEKLS0tIGEvc3JjL29yZy9vcGVuc29sYXJpcy9vcGVuZ3Jvay91dGlsL0V4ZWN1dG9yLmph
dmEJU3VuIEZlYiAxMiAwNDozNzozNiAyMDEyICswMTAwCisrKyBiL3NyYy9vcmcvb3BlbnNvbGFy
aXMvb3Blbmdyb2svdXRpbC9FeGVjdXRvci5qYXZhCU1vbiBGZWIgMTMgMDY6MTI6NDcgMjAxMiAr
MDEwMApAQCAtMzYsOCArMzYsNiBAQAogaW1wb3J0IGphdmEudXRpbC5sb2dnaW5nLkxldmVsOwog
aW1wb3J0IGphdmEudXRpbC5sb2dnaW5nLkxvZ2dlcjsKIAotaW1wb3J0IG9yZy5vcGVuc29sYXJp
cy5vcGVuZ3Jvay5PcGVuR3Jva0xvZ2dlcjsKLQogLyoqCiAgKiBXcmFwcGVyIHRvIEphdmEgUHJv
Y2VzcyBBUEkKICAqCkBAIC0xMTksOCArMTE3LDcgQEAKICAgICAgICAgICAgIH0KICAgICAgICAg
fQogCi0gICAgICAgIE9wZW5Hcm9rTG9nZ2VyLmdldExvZ2dlcigpLmxvZyhMZXZlbC5GSU5FLAot
ICAgICAgICAgICAgICAgICJFeGVjdXRpbmcgY29tbWFuZCB7MH0gaW4gZGlyZWN0b3J5IHsxfSIs
CisgICAgICAgIGxvZy5sb2coTGV2ZWwuRklORSwgIkV4ZWN1dGluZyBjb21tYW5kIFt7MH1dIGlu
IGRpcmVjdG9yeSAnJ3sxfScnIiwKICAgICAgICAgICAgICAgICBuZXcgT2JqZWN0W10gewogICAg
ICAgICAgICAgICAgICAgICBwcm9jZXNzQnVpbGRlci5jb21tYW5kKCksCiAgICAgICAgICAgICAg
ICAgICAgIHByb2Nlc3NCdWlsZGVyLmRpcmVjdG9yeSgpLApAQCAtMTQwLDggKzEzNyw5IEBACiAg
ICAgICAgICAgICAgICAgICAgICAgICBlcnIucHJvY2Vzc1N0cmVhbShlcnJvclN0cmVhbSk7CiAg
ICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKElPRXhjZXB0aW9uIGV4KSB7CiAgICAgICAgICAg
ICAgICAgICAgICAgICBpZiAocmVwb3J0RXhjZXB0aW9ucykgewotICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIE9wZW5Hcm9rTG9nZ2VyLmdldExvZ2dlcigpLmxvZyhMZXZlbC5TRVZFUkUsCi0g
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiRXJyb3IgZHVyaW5nIHByb2Nlc3Mg
cGlwZSBsaXN0ZW5pbmciLCBleCk7CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nLndh
cm5pbmcoIkVycm9yIGR1cmluZyBwcm9jZXNzIHBpcGUgbGlzdGVuaW5nOiAiIAorICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICArIGV4LmdldE1lc3NhZ2UoKSk7CisgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgbG9nLmxvZyhMZXZlbC5GSU5FLCAicnVuIiwgZXgpOwogICAgICAgICAg
ICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAg
fQpAQCAtMTU2LDEzICsxNTQsMTUgQEAKICAgICAgICAgICAgIHN0ZGVyciA9IGVyci5nZXRCeXRl
cygpOwogICAgICAgICB9IGNhdGNoIChJT0V4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICBpZiAo
cmVwb3J0RXhjZXB0aW9ucykgewotICAgICAgICAgICAgICAgIE9wZW5Hcm9rTG9nZ2VyLmdldExv
Z2dlcigpLmxvZyhMZXZlbC5TRVZFUkUsCi0gICAgICAgICAgICAgICAgICAgICAgICAiRmFpbGVk
IHRvIHJlYWQgZnJvbSBwcm9jZXNzOiAiICsgY21kTGlzdC5nZXQoMCksIGUpOworICAgICAgICAg
ICAgICAgIGxvZy53YXJuaW5nKCJGYWlsZWQgdG8gcmVhZCBmcm9tIHByb2Nlc3MgIiArIGNtZExp
c3QuZ2V0KDApCisgICAgICAgICAgICAgICAgICAgICsgIjogIiArIGUuZ2V0TWVzc2FnZSgpKTsK
KyAgICAgICAgICAgICAgICBsb2cubG9nKExldmVsLkZJTkUsICJleGVjIiwgZSk7CiAgICAgICAg
ICAgICB9CiAgICAgICAgIH0gY2F0Y2ggKEludGVycnVwdGVkRXhjZXB0aW9uIGUpIHsKICAgICAg
ICAgICAgIGlmIChyZXBvcnRFeGNlcHRpb25zKSB7Ci0gICAgICAgICAgICAgICAgT3Blbkdyb2tM
b2dnZXIuZ2V0TG9nZ2VyKCkubG9nKExldmVsLlNFVkVSRSwKLSAgICAgICAgICAgICAgICAgICAg
ICAgICJXYWl0aW5nIGZvciBwcm9jZXNzIGludGVycnVwdGVkOiAiICsgY21kTGlzdC5nZXQoMCks
IGUpOworICAgICAgICAgICAgICAgIGxvZy53YXJuaW5nKCJXYWl0aW5nIGZvciBwcm9jZXNzIGlu
dGVycnVwdGVkOiAiICsgY21kTGlzdC5nZXQoMCkKKyAgICAgICAgICAgICAgICAgICAgKyAiOiAi
ICsgZS5nZXRNZXNzYWdlKCkpOworICAgICAgICAgICAgICAgIGxvZy5sb2coTGV2ZWwuRklORSwg
ImV4ZWMiLCBlKTsKICAgICAgICAgICAgIH0KICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAg
ICAgIHRyeSB7CkBAIC0xNzcsOSArMTc3LDkgQEAKICAgICAgICAgaWYgKHJldCAhPSAwICYmIHJl
cG9ydEV4Y2VwdGlvbnMpIHsKICAgICAgICAgICAgIGludCBNQVhfTVNHX1NaID0gNTEyOyAvKiBs
aW1pdCB0byBhdm9pZCBmbG9vZGRpbmcgdGhlIGxvZ3MgKi8KICAgICAgICAgICAgIFN0cmluZ0J1
aWxkZXIgbXNnID0gbmV3IFN0cmluZ0J1aWxkZXIoIk5vbi16ZXJvIGV4aXQgc3RhdHVzICIpCi0g
ICAgICAgICAgICAgICAgICAgIC5hcHBlbmQocmV0KS5hcHBlbmQoIiBmcm9tIGNvbW1hbmQgIikK
KyAgICAgICAgICAgICAgICAgICAgLmFwcGVuZChyZXQpLmFwcGVuZCgiIGZyb20gY29tbWFuZCBb
IikKICAgICAgICAgICAgICAgICAgICAgLmFwcGVuZChwcm9jZXNzQnVpbGRlci5jb21tYW5kKCku
dG9TdHJpbmcoKSkKLSAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCgiIGluIGRpcmVjdG9yeSAi
KTsKKyAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCgiXSBpbiBkaXJlY3RvcnkgJyIpOwogICAg
ICAgICAgICAgRmlsZSBjd2QgPSBwcm9jZXNzQnVpbGRlci5kaXJlY3RvcnkoKTsKICAgICAgICAg
ICAgIGlmIChjd2QgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgIG1zZy5hcHBlbmQoU3lzdGVt
LmdldFByb3BlcnR5KCJ1c2VyLmRpciIpKTsKQEAgLTE4NywxNCArMTg3LDE2IEBACiAgICAgICAg
ICAgICAgICAgbXNnLmFwcGVuZChjd2QudG9TdHJpbmcoKSk7CiAgICAgICAgICAgICB9CiAgICAg
ICAgICAgICBpZiAoc3RkZXJyICE9IG51bGwgJiYgc3RkZXJyLmxlbmd0aCA+IDApIHsKLSAgICAg
ICAgICAgICAgICAgICAgbXNnLmFwcGVuZCgiOiAiKTsKKyAgICAgICAgICAgICAgICAgICAgbXNn
LmFwcGVuZCgiJzogIik7CiAgICAgICAgICAgICAgICAgICAgIGlmIChzdGRlcnIubGVuZ3RoID4g
TUFYX01TR19TWikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1zZy5hcHBlbmQobmV3
IFN0cmluZyhzdGRlcnIsIDAsIE1BWF9NU0dfU1opKS5hcHBlbmQoIi4uLiIpOwogICAgICAgICAg
ICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1zZy5hcHBl
bmQobmV3IFN0cmluZyhzdGRlcnIpKTsKICAgICAgICAgICAgICAgICAgICAgfQorICAgICAgICAg
ICAgfSBlbHNlIHsKKyAgICAgICAgICAgICAgICBtc2cuYXBwZW5kKCInIik7CiAgICAgICAgICAg
ICB9Ci0gICAgICAgICAgICBPcGVuR3Jva0xvZ2dlci5nZXRMb2dnZXIoKS5sb2coTGV2ZWwuV0FS
TklORywgbXNnLnRvU3RyaW5nKCkpOworICAgICAgICAgICAgbG9nLndhcm5pbmcobXNnLnRvU3Ry
aW5nKCkpOwogICAgICAgICB9CiAKICAgICAgICAgcmV0dXJuIHJldDsKQEAgLTMwMywxMyArMzA1
LDE2IEBACiAgICAgfQogICAgIAogICAgIHB1YmxpYyBzdGF0aWMgdm9pZCByZWdpc3RlckVycm9y
SGFuZGxlcigpIHsKKyAgICAgICAgVGhyZWFkLmN1cnJlbnRUaHJlYWQoKTsKICAgICAgICAgVW5j
YXVnaHRFeGNlcHRpb25IYW5kbGVyIGR1ZWggPQotICAgICAgICAgICAgVGhyZWFkLmN1cnJlbnRU
aHJlYWQoKS5nZXREZWZhdWx0VW5jYXVnaHRFeGNlcHRpb25IYW5kbGVyKCk7CisgICAgICAgICAg
ICBUaHJlYWQuZ2V0RGVmYXVsdFVuY2F1Z2h0RXhjZXB0aW9uSGFuZGxlcigpOwogICAgICAgICBp
ZiAoZHVlaCA9PSBudWxsKSB7CiAgICAgICAgICAgICBsb2cuZmluZSgiSW5zdGFsbGluZyBkZWZh
dWx0IHVuY2F1Z2h0IGV4Y2VwdGlvbiBoYW5kbGVyIik7CiAgICAgICAgICAgICBUaHJlYWQuc2V0
RGVmYXVsdFVuY2F1Z2h0RXhjZXB0aW9uSGFuZGxlcihuZXcgVW5jYXVnaHRFeGNlcHRpb25IYW5k
bGVyKCkgewogICAgICAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICAgICAgIHB1Ymxp
YyB2b2lkIHVuY2F1Z2h0RXhjZXB0aW9uKFRocmVhZCB0LCBUaHJvd2FibGUgZSkgeworICAgICAg
ICAgICAgICAgICAgICAvLyB0aGlzIHNob3VsZCBiZSB0aGUgb25seSBvbmUgY2FzZSwgd2hlcmUg
YW4gZXhjZXB0aW9uIAorICAgICAgICAgICAgICAgICAgICAvLyBzdGFjayB0cmFjZSBnZXRzIGxv
Z2dlZCB3aXRoIGEgTGV2ZWwgPiBGSU5FICEhIQogICAgICAgICAgICAgICAgICAgICBsb2cubG9n
KExldmVsLlNFVkVSRSwgIlVuY2F1Z2h0IGV4Y2VwdGlvbiBpbiB0aHJlYWQgIiAKICAgICAgICAg
ICAgICAgICAgICAgICAgICsgdC5nZXROYW1lKCkgKyAiIHdpdGggSUQgIiArIHQuZ2V0SWQoKSAr
ICI6ICIKICAgICAgICAgICAgICAgICAgICAgICAgICsgZS5nZXRNZXNzYWdlKCksIGUpOwpkaWZm
IC1yIDYxNTQ5MDI2YWFmZSAtciAyNjExMTY1MDdjN2Egc3JjL29yZy9vcGVuc29sYXJpcy9vcGVu
Z3Jvay91dGlsL0lPVXRpbHMuamF2YQotLS0gYS9zcmMvb3JnL29wZW5zb2xhcmlzL29wZW5ncm9r
L3V0aWwvSU9VdGlscy5qYXZhCVN1biBGZWIgMTIgMDQ6Mzc6MzYgMjAxMiArMDEwMAorKysgYi9z
cmMvb3JnL29wZW5zb2xhcmlzL29wZW5ncm9rL3V0aWwvSU9VdGlscy5qYXZhCU1vbiBGZWIgMTMg
MDY6MTI6NDcgMjAxMiArMDEwMApAQCAtNDQsMzIgKzQ0LDUwIEBACiAgICAgICAgIC8vIHNpbmds
ZXRvbgogICAgIH0KIAotICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBjbG9zZShDbG9zZWFibGUgYykg
eworICAgIC8qKgorICAgICAqIFRyeSB0byBjbG9zZSB0aGUgZ2l2ZW4gb2JqZWN0IGlmIG5vdCB7
QGNvZGUgbnVsbH0gYW5kIGxvZyBlcnJvcnMgaWYgYW4gCisgICAgICogZXhjZXB0aW9uICBvY2N1
cmVzLgorICAgICAqIEBwYXJhbSBjIG9iamVjdCB0byBjbG9zZS4KKyAgICAgKi8KKyAgICBwdWJs
aWMgc3RhdGljIGZpbmFsIHZvaWQgY2xvc2UoQ2xvc2VhYmxlIGMpIHsKICAgICAgICAgaWYgKGMg
IT0gbnVsbCkgewogICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICBjLmNsb3NlKCk7
CiAgICAgICAgICAgICB9IGNhdGNoIChJT0V4Y2VwdGlvbiBlKSB7Ci0gICAgICAgICAgICAgICAg
bG9nLmxvZyhMZXZlbC5XQVJOSU5HLCAiRmFpbGVkIHRvIGNsb3NlIHJlc291cmNlOiAiLCBlKTsK
KyAgICAgICAgICAgICAgICBsb2cud2FybmluZygiRmFpbGVkIHRvIGNsb3NlIHJlc291cmNlOiAi
ICsgZS5nZXRNZXNzYWdlKCkpOworICAgICAgICAgICAgICAgIGxvZy5sb2coTGV2ZWwuRklORSwg
ImNsb3NlIiwgZSk7CiAgICAgICAgICAgICB9CiAgICAgICAgIH0KICAgICB9CiAKLSAgICBwdWJs
aWMgc3RhdGljIHZvaWQgY2xvc2UoU2VydmVyU29ja2V0IHNvY2spIHsKKyAgICAvKioKKyAgICAg
KiBUcnkgdG8gY2xvc2UgdGhlIGdpdmVuIHNvY2tldCBpZiBub3Qge0Bjb2RlIG51bGx9IGFuZCBs
b2cgZXJyb3JzIGlmIGFuIAorICAgICAqIGV4Y2VwdGlvbiAgb2NjdXJlcy4KKyAgICAgKiBAcGFy
YW0gc29jayBzb2NrZXQgdG8gY2xvc2UuCisgICAgICovCisgICAgcHVibGljIHN0YXRpYyBmaW5h
bCB2b2lkIGNsb3NlKFNlcnZlclNvY2tldCBzb2NrKSB7CiAgICAgICAgIGlmIChzb2NrICE9IG51
bGwpIHsKICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgc29jay5jbG9zZSgpOwog
ICAgICAgICAgICAgfSBjYXRjaCAoSU9FeGNlcHRpb24gZSkgewotICAgICAgICAgICAgICAgIGxv
Zy5sb2coTGV2ZWwuV0FSTklORywgIkZhaWxlZCB0byBjbG9zZSBzb2NrZXQ6ICIsIGUpOworICAg
ICAgICAgICAgICAgIGxvZy53YXJuaW5nKCJGYWlsZWQgdG8gY2xvc2Ugc29ja2V0OiAiICsgZS5n
ZXRNZXNzYWdlKCkpOworICAgICAgICAgICAgICAgIGxvZy5sb2coTGV2ZWwuRklORSwgImNsb3Nl
IiwgZSk7CiAgICAgICAgICAgICB9CiAgICAgICAgIH0KICAgICB9CiAKLSAgICBwdWJsaWMgc3Rh
dGljIHZvaWQgY2xvc2UoU29ja2V0IHNvY2spIHsKKyAgICAvKioKKyAgICAgKiBUcnkgdG8gY2xv
c2UgdGhlIGdpdmVuIHNvY2tldCBpZiBub3Qge0Bjb2RlIG51bGx9IGFuZCBsb2cgZXJyb3JzIGlm
IGFuIAorICAgICAqIGV4Y2VwdGlvbiAgb2NjdXJlcy4KKyAgICAgKiBAcGFyYW0gc29jayBzb2Nr
ZXQgdG8gY2xvc2UuCisgICAgICovCisgICAgcHVibGljIHN0YXRpYyBmaW5hbCB2b2lkIGNsb3Nl
KFNvY2tldCBzb2NrKSB7CiAgICAgICAgIGlmIChzb2NrICE9IG51bGwpIHsKICAgICAgICAgICAg
IHRyeSB7CiAgICAgICAgICAgICAgICAgc29jay5jbG9zZSgpOwogICAgICAgICAgICAgfSBjYXRj
aCAoSU9FeGNlcHRpb24gZSkgewotICAgICAgICAgICAgICAgIGxvZy5sb2coTGV2ZWwuV0FSTklO
RywgIkZhaWxlZCB0byBjbG9zZSBzb2NrZXQ6ICIsIGUpOworICAgICAgICAgICAgICAgIGxvZy53
YXJuaW5nKCJGYWlsZWQgdG8gY2xvc2Ugc29ja2V0OiAiICsgZS5nZXRNZXNzYWdlKCkpOworICAg
ICAgICAgICAgICAgIGxvZy5sb2coTGV2ZWwuRklORSwgImNsb3NlIiwgZSk7CiAgICAgICAgICAg
ICB9CiAgICAgICAgIH0KICAgICB9CmRpZmYgLXIgNjE1NDkwMjZhYWZlIC1yIDI2MTExNjUwN2M3
YSBzcmMvb3JnL29wZW5zb2xhcmlzL29wZW5ncm9rL3dlYi9FZnRhckZpbGUuamF2YQotLS0gYS9z
cmMvb3JnL29wZW5zb2xhcmlzL29wZW5ncm9rL3dlYi9FZnRhckZpbGUuamF2YQlTdW4gRmViIDEy
IDA0OjM3OjM2IDIwMTIgKzAxMDAKKysrIGIvc3JjL29yZy9vcGVuc29sYXJpcy9vcGVuZ3Jvay93
ZWIvRWZ0YXJGaWxlLmphdmEJTW9uIEZlYiAxMyAwNjoxMjo0NyAyMDEyICswMTAwCkBAIC0zNiw3
ICszNiw4IEBACiBpbXBvcnQgamF2YS51dGlsLlN0cmluZ1Rva2VuaXplcjsKIGltcG9ydCBqYXZh
LnV0aWwuVHJlZU1hcDsKIGltcG9ydCBqYXZhLnV0aWwubG9nZ2luZy5MZXZlbDsKLWltcG9ydCBv
cmcub3BlbnNvbGFyaXMub3Blbmdyb2suT3Blbkdyb2tMb2dnZXI7CitpbXBvcnQgamF2YS51dGls
LmxvZ2dpbmcuTG9nZ2VyOworCiBpbXBvcnQgb3JnLm9wZW5zb2xhcmlzLm9wZW5ncm9rLnV0aWwu
SU9VdGlsczsKIAogLyoqCkBAIC0yNjUsNyArMjY2LDkgQEAKICAgICAgICAgICAgIEVmdGFyRmls
ZSBlZiA9IG5ldyBFZnRhckZpbGUoKTsKICAgICAgICAgICAgIGVmLmNyZWF0ZShhcmdzKTsKICAg
ICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKLSAgICAgICAgICAgIE9wZW5Hcm9rTG9nZ2Vy
LmdldExvZ2dlcigpLmxvZyhMZXZlbC5XQVJOSU5HLCAiRWZ0YXJGaWxlIGVycm9yIiwgZSk7Cisg
ICAgICAgICAgICBMb2dnZXIgbG9nZ2VyID0gTG9nZ2VyLmdldExvZ2dlcihFZnRhckZpbGUuY2xh
c3MuZ2V0TmFtZSgpKTsKKyAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKCJFZnRhckZpbGUgZXJy
b3I6ICIgKyBlLmdldE1lc3NhZ2UoKSk7CisgICAgICAgICAgICBsb2dnZXIubG9nKExldmVsLkZJ
TkUsICJtYWluIiwgZSk7CiAgICAgICAgIH0KICAgICB9CiAKZGlmZiAtciA2MTU0OTAyNmFhZmUg
LXIgMjYxMTE2NTA3YzdhIHNyYy9vcmcvb3BlbnNvbGFyaXMvb3Blbmdyb2svd2ViL0VmdGFyRmls
ZVJlYWRlci5qYXZhCi0tLSBhL3NyYy9vcmcvb3BlbnNvbGFyaXMvb3Blbmdyb2svd2ViL0VmdGFy
RmlsZVJlYWRlci5qYXZhCVN1biBGZWIgMTIgMDQ6Mzc6MzYgMjAxMiArMDEwMAorKysgYi9zcmMv
b3JnL29wZW5zb2xhcmlzL29wZW5ncm9rL3dlYi9FZnRhckZpbGVSZWFkZXIuamF2YQlNb24gRmVi
IDEzIDA2OjEyOjQ3IDIwMTIgKzAxMDAKQEAgLTQzLDcgKzQzLDYgQEAKIAogICAgIHByaXZhdGUg
ZmluYWwgUmFuZG9tQWNjZXNzRmlsZSBmOwogICAgIHByaXZhdGUgYm9vbGVhbiBpc09wZW47Ci0g
ICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgTG9nZ2VyIGxvZyA9IExvZ2dlci5nZXRMb2dnZXIoRWZ0
YXJGaWxlUmVhZGVyLmNsYXNzLmdldE5hbWUoKSk7CiAKICAgICBwdWJsaWMgY2xhc3MgRk5vZGUg
ewogCkBAIC0xMjgsNyArMTI3LDkgQEAKICAgICAgICAgICAgIH0gY2F0Y2ggKEVPRkV4Y2VwdGlv
biBlKSB7IC8vIE5PUE1ECiAgICAgICAgICAgICAgICAgLy8gaWdub3JlCiAgICAgICAgICAgICB9
IGNhdGNoIChJT0V4Y2VwdGlvbiBlKSB7Ci0gICAgICAgICAgICAgICAgbG9nLmxvZyhMZXZlbC5X
QVJOSU5HLCAiR290IGV4Y3B0aW9uIHdoaWxlIGdldHRpbmcgdGhlIHRhZzogIiwgZSk7CisgICAg
ICAgICAgICAgICAgTG9nZ2VyIGxvZyA9IExvZ2dlci5nZXRMb2dnZXIoRWZ0YXJGaWxlUmVhZGVy
LmNsYXNzLmdldE5hbWUoKSk7CisgICAgICAgICAgICAgICAgbG9nLndhcm5pbmcoIkdvdCBleGNl
cHRpb24gd2hpbGUgZ2V0dGluZyB0aGUgdGFnOiAiICsgZS5nZXRNZXNzYWdlKCkpOworICAgICAg
ICAgICAgICAgIGxvZy5sb2coTGV2ZWwuRklORSwgInRvU3RyaW5nIiwgZSk7CiAgICAgICAgICAg
ICB9CiAgICAgICAgICAgICByZXR1cm4gIkhbIiArIGhhc2ggKyAiXSBudW0gPSAiICsgbnVtQ2hp
bGRyZW4gKyAiIHRhZyA9ICIgKyB0YWdTdHJpbmc7CiAgICAgICAgIH0KZGlmZiAtciA2MTU0OTAy
NmFhZmUgLXIgMjYxMTE2NTA3YzdhIHNyYy9vcmcvb3BlbnNvbGFyaXMvb3Blbmdyb2svd2ViL1Bh
Z2VDb25maWcuamF2YQotLS0gYS9zcmMvb3JnL29wZW5zb2xhcmlzL29wZW5ncm9rL3dlYi9QYWdl
Q29uZmlnLmphdmEJU3VuIEZlYiAxMiAwNDozNzozNiAyMDEyICswMTAwCisrKyBiL3NyYy9vcmcv
b3BlbnNvbGFyaXMvb3Blbmdyb2svd2ViL1BhZ2VDb25maWcuamF2YQlNb24gRmViIDEzIDA2OjEy
OjQ3IDIwMTIgKzAxMDAKQEAgLTIzNiw3ICsyMzYsOCBAQAogICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIGZpbGVwYXRoW2ldICsgIkAiICsgZGF0YS5yZXZbaV0sIG51bGwpOwogICAgICAgICAg
ICAgICAgICAgICBkYXRhLnBhcmFtW2ldID0gdS5nZXRSYXdRdWVyeSgpOwogICAgICAgICAgICAg
ICAgIH0gY2F0Y2ggKFVSSVN5bnRheEV4Y2VwdGlvbiBlKSB7Ci0gICAgICAgICAgICAgICAgICAg
IGxvZy5sb2coTGV2ZWwuV0FSTklORywgIkZhaWxlZCB0byBjcmVhdGUgVVJJOiAiLCBlKTsKKyAg
ICAgICAgICAgICAgICAgICAgbG9nLndhcm5pbmcoIkZhaWxlZCB0byBjcmVhdGUgVVJJOiAiICsg
ZS5nZXRNZXNzYWdlKCkpOworICAgICAgICAgICAgICAgICAgICBsb2cubG9nKExldmVsLkZJTkUs
ICJnZXREaWZmRGF0YSIsIGUpOwogICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgIH0KICAg
ICAgICAgICAgIGRhdGEuZnVsbCA9IGZ1bGxEaWZmKCk7CkBAIC0zNzYsNyArMzc3LDggQEAKICAg
ICAgICAgICAgICAgICAgICAgcmV0ID0geDsKICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg
ICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewotICAgICAgICAgICAgICAgIGxvZy5sb2coTGV2ZWwu
SU5GTywgIkZhaWxlZCB0byBwYXJzZSBpbnRlZ2VyICIgKyBzLCBlKTsKKyAgICAgICAgICAgICAg
ICBsb2cuaW5mbygiRmFpbGVkIHRvIHBhcnNlIGludGVnZXIgIiArIHMpOworICAgICAgICAgICAg
ICAgIGxvZy5sb2coTGV2ZWwuRklORSwgImdldEludFBhcmFtIiwgZSk7CiAgICAgICAgICAgICB9
CiAgICAgICAgIH0KICAgICAgICAgcmV0dXJuIHJldDsKQEAgLTQ4MCw3ICs0ODIsNyBAQAogICAg
ICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgIGVmdGFyUmVhZGVyID0gbmV3
IEVmdGFyRmlsZVJlYWRlcihmKTsKICAgICAgICAgICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24g
ZSkgewotICAgICAgICAgICAgICAgICAgICBsb2cubG9nKExldmVsLkZJTkUsICJGYWlsZWQgdG8g
Y3JlYXRlIEVmdGFyRmlsZVJlYWRlcjogIiwgZSk7CisgICAgICAgICAgICAgICAgICAgIGxvZy5s
b2coTGV2ZWwuRklORSwgIkZhaWxlZCB0byBjcmVhdGUgRWZ0YXJGaWxlUmVhZGVyIiwgZSk7CiAg
ICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgfQogICAgICAgICB9CkBAIC01MDEsNyArNTAz
LDggQEAKICAgICAgICAgICAgICAgICBkdGFnID0gZWZ0YXJSZWFkZXIuZ2V0KGdldFBhdGgoKSk7
CiAgICAgICAgICAgICAgICAgLy8gY2ZnLmdldFByZWZpeCgpICE9IFByZWZpeC5YUkVGX1MpIHsK
ICAgICAgICAgICAgIH0gY2F0Y2ggKElPRXhjZXB0aW9uIGUpIHsKLSAgICAgICAgICAgICAgICBs
b2cubG9nKExldmVsLklORk8sICJGYWlsZWQgdG8gZ2V0IGVudHJ5IGZyb20gZWZ0YXIgcmVhZGVy
OiAiLCBlKTsKKyAgICAgICAgICAgICAgICBsb2cuaW5mbygiRmFpbGVkIHRvIGdldCBlbnRyeSBm
cm9tIGVmdGFyIHJlYWRlcjogIiArIGUuZ2V0TWVzc2FnZSgpKTsKKyAgICAgICAgICAgICAgICBs
b2cubG9nKExldmVsLkZJTkUsICJnZXREZWZpbmVUYWdzSW5kZXgiLCBlKTsKICAgICAgICAgICAg
IH0KICAgICAgICAgfQogICAgICAgICBpZiAoZHRhZyA9PSBudWxsKSB7CkBAIC01NzQsNyArNTc3
LDggQEAKICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgIGFubm90YXRpb24gPSBIaXN0b3J5R3Vy
dS5nZXRJbnN0YW5jZSgpLmFubm90YXRlKHJlc291cmNlRmlsZSwgcmV2LmlzRW1wdHkoKSA/IG51
bGwgOiByZXYuc3Vic3RyaW5nKDIpKTsKICAgICAgICAgfSBjYXRjaCAoSU9FeGNlcHRpb24gZSkg
ewotICAgICAgICAgICAgbG9nLmxvZyhMZXZlbC5XQVJOSU5HLCAiRmFpbGVkIHRvIGdldCBhbm5v
dGF0aW9uczogIiwgZSk7CisgICAgICAgICAgICBsb2cud2FybmluZygiRmFpbGVkIHRvIGdldCBh
bm5vdGF0aW9uczogIiArIGUuZ2V0TWVzc2FnZSgpKTsKKyAgICAgICAgICAgIGxvZy5sb2coTGV2
ZWwuRklORSwgImdldEFubm90YXRpb24iLCBlKTsKICAgICAgICAgICAgIC8qIGlnbm9yZSAqLwog
ICAgICAgICB9CiAgICAgICAgIHJldHVybiBhbm5vdGF0aW9uOwpkaWZmIC1yIDYxNTQ5MDI2YWFm
ZSAtciAyNjExMTY1MDdjN2Egc3JjL29yZy9vcGVuc29sYXJpcy9vcGVuZ3Jvay93ZWIvU2VhcmNo
SGVscGVyLmphdmEKLS0tIGEvc3JjL29yZy9vcGVuc29sYXJpcy9vcGVuZ3Jvay93ZWIvU2VhcmNo
SGVscGVyLmphdmEJU3VuIEZlYiAxMiAwNDozNzozNiAyMDEyICswMTAwCisrKyBiL3NyYy9vcmcv
b3BlbnNvbGFyaXMvb3Blbmdyb2svd2ViL1NlYXJjaEhlbHBlci5qYXZhCU1vbiBGZWIgMTMgMDY6
MTI6NDcgMjAxMiArMDEwMApAQCAtMzUsMTQgKzM1LDIzIEBACiBpbXBvcnQgamF2YS51dGlsLmxv
Z2dpbmcuTGV2ZWw7CiBpbXBvcnQgamF2YS51dGlsLmxvZ2dpbmcuTG9nZ2VyOwogaW1wb3J0IGph
dmEudXRpbC5yZWdleC5QYXR0ZXJuOworCiBpbXBvcnQgb3JnLmFwYWNoZS5sdWNlbmUuZG9jdW1l
bnQuRG9jdW1lbnQ7CiBpbXBvcnQgb3JnLmFwYWNoZS5sdWNlbmUuaW5kZXguSW5kZXhSZWFkZXI7
CiBpbXBvcnQgb3JnLmFwYWNoZS5sdWNlbmUuaW5kZXguTXVsdGlSZWFkZXI7CiBpbXBvcnQgb3Jn
LmFwYWNoZS5sdWNlbmUucXVlcnlQYXJzZXIuUGFyc2VFeGNlcHRpb247Ci1pbXBvcnQgb3JnLmFw
YWNoZS5sdWNlbmUuc2VhcmNoLio7CitpbXBvcnQgb3JnLmFwYWNoZS5sdWNlbmUuc2VhcmNoLkJv
b2xlYW5RdWVyeTsKK2ltcG9ydCBvcmcuYXBhY2hlLmx1Y2VuZS5zZWFyY2guSW5kZXhTZWFyY2hl
cjsKK2ltcG9ydCBvcmcuYXBhY2hlLmx1Y2VuZS5zZWFyY2guTXVsdGlTZWFyY2hlcjsKK2ltcG9y
dCBvcmcuYXBhY2hlLmx1Y2VuZS5zZWFyY2guUGFyYWxsZWxNdWx0aVNlYXJjaGVyOworaW1wb3J0
IG9yZy5hcGFjaGUubHVjZW5lLnNlYXJjaC5RdWVyeTsKK2ltcG9ydCBvcmcuYXBhY2hlLmx1Y2Vu
ZS5zZWFyY2guU2NvcmVEb2M7CitpbXBvcnQgb3JnLmFwYWNoZS5sdWNlbmUuc2VhcmNoLlNvcnQ7
CitpbXBvcnQgb3JnLmFwYWNoZS5sdWNlbmUuc2VhcmNoLlNvcnRGaWVsZDsKK2ltcG9ydCBvcmcu
YXBhY2hlLmx1Y2VuZS5zZWFyY2guVGVybVF1ZXJ5OworaW1wb3J0IG9yZy5hcGFjaGUubHVjZW5l
LnNlYXJjaC5Ub3BGaWVsZERvY3M7CiBpbXBvcnQgb3JnLmFwYWNoZS5sdWNlbmUuc2VhcmNoLnNw
ZWxsLlNwZWxsQ2hlY2tlcjsKIGltcG9ydCBvcmcuYXBhY2hlLmx1Y2VuZS5zdG9yZS5GU0RpcmVj
dG9yeTsKLWltcG9ydCBvcmcub3BlbnNvbGFyaXMub3Blbmdyb2suT3Blbkdyb2tMb2dnZXI7CiBp
bXBvcnQgb3JnLm9wZW5zb2xhcmlzLm9wZW5ncm9rLmFuYWx5c2lzLkNvbXBhdGlibGVBbmFseXNl
cjsKIGltcG9ydCBvcmcub3BlbnNvbGFyaXMub3Blbmdyb2suYW5hbHlzaXMuRGVmaW5pdGlvbnM7
CiBpbXBvcnQgb3JnLm9wZW5zb2xhcmlzLm9wZW5ncm9rLnNlYXJjaC5RdWVyeUJ1aWxkZXI7CkBA
IC01OSw3ICs2OCw3IEBACiAgKiBAdmVyc2lvbiAkUmV2aXNpb24kCiAgKi8KIHB1YmxpYyBjbGFz
cyBTZWFyY2hIZWxwZXIgewotCisgICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgTG9nZ2VyIGxvZyA9
IExvZ2dlci5nZXRMb2dnZXIoU2VhcmNoSGVscGVyLmNsYXNzLmdldE5hbWUoKSk7CiAgICAgLyoq
IG9wZW5ncm9rJ3MgZGF0YSByb290OiB1c2VkIHRvIGZpbmQgdGhlIHNlYXJjaCBpbmRleCBmaWxl
ICovCiAgICAgcHVibGljIEZpbGUgZGF0YVJvb3Q7CiAgICAgLyoqIGNvbnRleHQgcGF0aCwgaS5l
LiB0aGUgYXBwbGljYXRpb25zIGNvbnRleHQgcGF0aCAodXN1YWxseSAvc291cmNlKSB0bwpAQCAt
MTE5LDggKzEyOCw2IEBACiAgICAgcHVibGljIEhpc3RvcnlDb250ZXh0IGhpc3RvcnlDb250ZXh0
OwogICAgIC8qKiBEZWZhdWx0IHF1ZXJ5IHBhcnNlIGVycm9yIG1lc3NhZ2UgcHJlZml4ICovCiAg
ICAgcHVibGljIHN0YXRpYyBmaW5hbCBTdHJpbmcgUEFSU0VfRVJST1JfTVNHID0gIlVuYWJsZSB0
byBwYXJzZSB5b3VyIHF1ZXJ5OiAiOwotCi0gICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgTG9nZ2Vy
IGxvZyA9IExvZ2dlci5nZXRMb2dnZXIoU2VhcmNoSGVscGVyLmNsYXNzLmdldE5hbWUoKSk7CiAg
ICAgCiAgICAgLyoqCiAgICAgICogQ3JlYXRlIHRoZSBzZWFyY2hlciB0byB1c2Ugd3J0LiB0byBj
dXJyZW50bHkgc2V0IHBhcmFtZXRlcnMgYW5kIHRoZSBnaXZlbgpAQCAtMzU4LDcgKzM2NSw5IEBA
CiAgICAgICAgICAgICAgICAgICAgIHJlcy5hZGQocyk7CiAgICAgICAgICAgICAgICAgfQogICAg
ICAgICAgICAgfSBjYXRjaCAoSU9FeGNlcHRpb24gZSkgewotICAgICAgICAgICAgICAgIGxvZy5s
b2coTGV2ZWwuV0FSTklORywgIkdvdCBleGNwdGlvbiB3aGlsZSBnZXR0aW5nIHNwZWxsaW5nIHN1
Z2dlc3Rpb25zOiAiLCBlKTsKKyAgICAgICAgICAgICAgICBsb2cud2FybmluZygiR290IGV4Y2Vw
dGlvbiB3aGlsZSBnZXR0aW5nIHNwZWxsaW5nIHN1Z2dlc3Rpb25zOiAiIAorICAgICAgICAgICAg
ICAgICAgICArIGUuZ2V0TWVzc2FnZSgpKTsKKyAgICAgICAgICAgICAgICBsb2cubG9nKExldmVs
LkZJTkUsICJnZXRTdWdnZXN0aW9ucyIsIGUpOwogICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAg
ICAgICAgICAgICAgICBpZiAoc3BlbGxEaXJlY3RvcnkgIT0gbnVsbCkgewogICAgICAgICAgICAg
ICAgICAgICBzcGVsbERpcmVjdG9yeS5jbG9zZSgpOwpAQCAtMzY3LDcgKzM3Niw5IEBACiAgICAg
ICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICBjaGVja2VyLmNs
b3NlKCk7CiAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiB4KSB7IAotICAg
ICAgICAgICAgICAgICAgICAgICAgbG9nLmxvZyhMZXZlbC5XQVJOSU5HLCAiR290IGV4Y3B0aW9u
IHdoaWxlIGNsb3Npbmcgc3BlbGxpbmcgc3VnZ2VzdGlvbnM6ICIsIHgpOworICAgICAgICAgICAg
ICAgICAgICAgICAgbG9nLndhcm5pbmcoIkdvdCBleGNlcHRpb24gd2hpbGUgY2xvc2luZyBzcGVs
bGluZyBzdWdnZXN0aW9uczogIiAKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICArIHguZ2V0
TWVzc2FnZSgpKTsKKyAgICAgICAgICAgICAgICAgICAgICAgIGxvZy5sb2coTGV2ZWwuRklORSwg
ImdldFN1Z2dlc3Rpb25zIiwgeCk7CiAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg
ICAgICB9CiAgICAgICAgICAgICB9CkBAIC00MDMsMTIgKzQxNCwxMiBAQAogICAgICAgICAgICAg
c291cmNlQ29udGV4dCA9IG5ldyBDb250ZXh0KHF1ZXJ5LCBidWlsZGVyLmdldFF1ZXJpZXMoKSk7
CiAgICAgICAgICAgICBzdW1tZXJpemVyID0gbmV3IFN1bW1hcml6ZXIocXVlcnksIG5ldyBDb21w
YXRpYmxlQW5hbHlzZXIoKSk7CiAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7Ci0gICAg
ICAgICAgICBPcGVuR3Jva0xvZ2dlci5nZXRMb2dnZXIoKS5sb2coTGV2ZWwuV0FSTklORywgIlN1
bW1lcml6ZXI6IHswfSIsIGUuZ2V0TWVzc2FnZSgpKTsKKyAgICAgICAgICAgIGxvZy53YXJuaW5n
KCJTdW1tZXJpemVyOiAiICsgZS5nZXRNZXNzYWdlKCkpOwogICAgICAgICB9CiAgICAgICAgIHRy
eSB7CiAgICAgICAgICAgICBoaXN0b3J5Q29udGV4dCA9IG5ldyBIaXN0b3J5Q29udGV4dChxdWVy
eSk7CiAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7Ci0gICAgICAgICAgICBPcGVuR3Jv
a0xvZ2dlci5nZXRMb2dnZXIoKS5sb2coTGV2ZWwuV0FSTklORywgIkhpc3RvcnlDb250ZXh0OiB7
MH0iLCBlLmdldE1lc3NhZ2UoKSk7CisgICAgICAgICAgICBsb2cud2FybmluZygiSGlzdG9yeUNv
bnRleHQ6ICIgKyBlLmdldE1lc3NhZ2UoKSk7CiAgICAgICAgIH0KICAgICAgICAgcmV0dXJuIHRo
aXM7CiAgICAgfQpkaWZmIC1yIDYxNTQ5MDI2YWFmZSAtciAyNjExMTY1MDdjN2Egc3JjL29yZy9v
cGVuc29sYXJpcy9vcGVuZ3Jvay93ZWIvVXRpbC5qYXZhCi0tLSBhL3NyYy9vcmcvb3BlbnNvbGFy
aXMvb3Blbmdyb2svd2ViL1V0aWwuamF2YQlTdW4gRmViIDEyIDA0OjM3OjM2IDIwMTIgKzAxMDAK
KysrIGIvc3JjL29yZy9vcGVuc29sYXJpcy9vcGVuZ3Jvay93ZWIvVXRpbC5qYXZhCU1vbiBGZWIg
MTMgMDY6MTI6NDcgMjAxMiArMDEwMApAQCAtNDUsNyArNDUsNiBAQAogaW1wb3J0IGphdmEudXRp
bC56aXAuR1pJUElucHV0U3RyZWFtOwogCiBpbXBvcnQgb3JnLm9wZW5zb2xhcmlzLm9wZW5ncm9r
LkluZm87Ci1pbXBvcnQgb3JnLm9wZW5zb2xhcmlzLm9wZW5ncm9rLk9wZW5Hcm9rTG9nZ2VyOwog
aW1wb3J0IG9yZy5vcGVuc29sYXJpcy5vcGVuZ3Jvay5jb25maWd1cmF0aW9uLlJ1bnRpbWVFbnZp
cm9ubWVudDsKIGltcG9ydCBvcmcub3BlbnNvbGFyaXMub3Blbmdyb2suaGlzdG9yeS5Bbm5vdGF0
aW9uOwogaW1wb3J0IG9yZy5vcGVuc29sYXJpcy5vcGVuZ3Jvay5oaXN0b3J5Lkhpc3RvcnlFeGNl
cHRpb247CkBAIC01Niw2ICs1NSw3IEBACiAgKiBDbGFzcyBmb3IgdXNlZnVsIGZ1bmN0aW9ucy4K
ICAqLwogcHVibGljIGZpbmFsIGNsYXNzIFV0aWwgeworICAgIHByaXZhdGUgc3RhdGljIGZpbmFs
IExvZ2dlciBsb2dnZXIgPSBMb2dnZXIuZ2V0TG9nZ2VyKFV0aWwuY2xhc3MuZ2V0TmFtZSgpKTsK
ICAgICBwcml2YXRlIFV0aWwoKSB7CiAgICAgICAgIC8vIHNpbmdsZXRvbgogICAgIH0KQEAgLTU2
Niw3ICs1NjYsOCBAQAogICAgICAgICAgICAgcmV0dXJuIHEgPT0gbnVsbCA/ICIiIDogVVJMRW5j
b2Rlci5lbmNvZGUocSwgIlVURi04Iik7CiAgICAgICAgIH0gY2F0Y2ggKFVuc3VwcG9ydGVkRW5j
b2RpbmdFeGNlcHRpb24gZSkgewogICAgICAgICAgICAgLy8gU2hvdWxkIG5vdCBoYXBwZW4uIFVU
Ri04IG11c3QgYmUgc3VwcG9ydGVkIGJ5IEpWTXMuCi0gICAgICAgICAgICBMb2dnZXIuZ2V0TG9n
Z2VyKEVmdGFyRmlsZVJlYWRlci5jbGFzcy5nZXROYW1lKCkpLmxvZyhMZXZlbC5XQVJOSU5HLCAi
RmFpbGVkIHRvIFVSTC1lbmNvZGUgVVRGLTg6ICIsIGUpOyAgICAgICAgICAgIAorICAgICAgICAg
ICAgbG9nZ2VyLndhcm5pbmcoIkZhaWxlZCB0byBVUkwtZW5jb2RlIFVURi04OiAiICsgZS5nZXRN
ZXNzYWdlKCkpOworICAgICAgICAgICAgbG9nZ2VyLmxvZyhMZXZlbC5GSU5FLCAiVVJJRW5jb2Rl
IiwgZSk7CiAgICAgICAgIH0KICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgfQpAQCAtNjAyLDgg
KzYwMyw4IEBACiAgICAgICAgICAgICBVUkkgdXJpID0gbmV3IFVSSShudWxsLCBudWxsLCBwYXRo
LCBudWxsKTsKICAgICAgICAgICAgIHJldHVybiB1cmkuZ2V0UmF3UGF0aCgpOwogICAgICAgICB9
IGNhdGNoIChVUklTeW50YXhFeGNlcHRpb24gZXgpIHsKLSAgICAgICAgICAgIE9wZW5Hcm9rTG9n
Z2VyLmdldExvZ2dlcigpLmxvZyhMZXZlbC5XQVJOSU5HLAotICAgICAgICAgICAgICAgICJDb3Vs
ZCBub3QgZW5jb2RlIHBhdGggIiArIHBhdGgsIGV4KTsKKyAgICAgICAgICAgIGxvZ2dlci53YXJu
aW5nKCJDb3VsZCBub3QgZW5jb2RlIHBhdGggJyIgKyBwYXRoICsgIic6ICIgKyBleC5nZXRNZXNz
YWdlKCkpOworICAgICAgICAgICAgbG9nZ2VyLmxvZyhMZXZlbC5GSU5FLCAiVVJJRW5jb2RlUGF0
aCIsIGV4KTsKICAgICAgICAgfQogICAgICAgICByZXR1cm4gIiI7CiAgICAgfQpAQCAtNzk4LDgg
Kzc5OSw5IEBACiAgICAgICAgICAgICBkdW1wKG91dCwgaW4pOwogICAgICAgICAgICAgcmV0dXJu
IHRydWU7CiAgICAgICAgIH0gY2F0Y2goSU9FeGNlcHRpb24gZSkgewotICAgICAgICAgICAgT3Bl
bkdyb2tMb2dnZXIuZ2V0TG9nZ2VyKCkubG9nKExldmVsLldBUk5JTkcsCi0gICAgICAgICAgICAg
ICAgIkFuIGVycm9yIG9jY3VyZWQgd2hpbGUgcGlwaW5nIGZpbGUgIiArIGZpbGUgKyAiOiAiLCBl
KTsKKyAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKCJBbiBlcnJvciBvY2N1cmVkIHdoaWxlIHBp
cGluZyBmaWxlICciICsgZmlsZSArICInOiAiIAorICAgICAgICAgICAgICAgICsgZS5nZXRNZXNz
YWdlKCkpOworICAgICAgICAgICAgbG9nZ2VyLmxvZyhMZXZlbC5GSU5FLCAiZHVtcCIsIGUpOwog
ICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgSU9VdGlscy5jbG9zZShpbik7CiAgICAg
ICAgICAgICBJT1V0aWxzLmNsb3NlKGdpcyk7CmRpZmYgLXIgNjE1NDkwMjZhYWZlIC1yIDI2MTEx
NjUwN2M3YSBzcmMvb3JnL29wZW5zb2xhcmlzL29wZW5ncm9rL3dlYi9XZWJhcHBMaXN0ZW5lci5q
YXZhCi0tLSBhL3NyYy9vcmcvb3BlbnNvbGFyaXMvb3Blbmdyb2svd2ViL1dlYmFwcExpc3RlbmVy
LmphdmEJU3VuIEZlYiAxMiAwNDozNzozNiAyMDEyICswMTAwCisrKyBiL3NyYy9vcmcvb3BlbnNv
bGFyaXMvb3Blbmdyb2svd2ViL1dlYmFwcExpc3RlbmVyLmphdmEJTW9uIEZlYiAxMyAwNjoxMjo0
NyAyMDEyICswMTAwCkBAIC0yOSwxMCArMjksMTIgQEAKIGltcG9ydCBqYXZhLm5ldC5Tb2NrZXRB
ZGRyZXNzOwogaW1wb3J0IGphdmEubmV0LlVua25vd25Ib3N0RXhjZXB0aW9uOwogaW1wb3J0IGph
dmEudXRpbC5sb2dnaW5nLkxldmVsOworaW1wb3J0IGphdmEudXRpbC5sb2dnaW5nLkxvZ2dlcjsK
KwogaW1wb3J0IGphdmF4LnNlcnZsZXQuU2VydmxldENvbnRleHQ7CiBpbXBvcnQgamF2YXguc2Vy
dmxldC5TZXJ2bGV0Q29udGV4dEV2ZW50OwogaW1wb3J0IGphdmF4LnNlcnZsZXQuU2VydmxldENv
bnRleHRMaXN0ZW5lcjsKLWltcG9ydCBvcmcub3BlbnNvbGFyaXMub3Blbmdyb2suT3Blbkdyb2tM
b2dnZXI7CisKIGltcG9ydCBvcmcub3BlbnNvbGFyaXMub3Blbmdyb2suY29uZmlndXJhdGlvbi5S
dW50aW1lRW52aXJvbm1lbnQ7CiAKIC8qKgpAQCAtNDEsNiArNDMsNyBAQAogICovCiBwdWJsaWMg
ZmluYWwgY2xhc3MgV2ViYXBwTGlzdGVuZXIgaW1wbGVtZW50cyBTZXJ2bGV0Q29udGV4dExpc3Rl
bmVyIHsKIAorICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIExvZ2dlciBsb2dnZXIgPSBMb2dnZXIu
Z2V0TG9nZ2VyKFdlYmFwcExpc3RlbmVyLmNsYXNzLmdldE5hbWUoKSk7CiAgICAgQE92ZXJyaWRl
CiAgICAgcHVibGljIHZvaWQgY29udGV4dEluaXRpYWxpemVkKGZpbmFsIFNlcnZsZXRDb250ZXh0
RXZlbnQgc2VydmxldENvbnRleHRFdmVudCkgewogICAgICAgICBTZXJ2bGV0Q29udGV4dCBjb250
ZXh0ID0gc2VydmxldENvbnRleHRFdmVudC5nZXRTZXJ2bGV0Q29udGV4dCgpOwpAQCAtNDgsMzUg
KzUxLDQyIEBACiAKICAgICAgICAgU3RyaW5nIGNvbmZpZyA9IGNvbnRleHQuZ2V0SW5pdFBhcmFt
ZXRlcigiQ09ORklHVVJBVElPTiIpOwogICAgICAgICBpZiAoY29uZmlnID09IG51bGwpIHsKLSAg
ICAgICAgICAgIE9wZW5Hcm9rTG9nZ2VyLmdldExvZ2dlcigpLnNldmVyZSgiQ09ORklHVVJBVElP
TiBzZWN0aW9uIG1pc3NpbmcgaW4gd2ViLnhtbCIpOworICAgICAgICAgICAgbG9nZ2VyLnNldmVy
ZSgiQ09ORklHVVJBVElPTiBzZWN0aW9uIG1pc3NpbmcgaW4gd2ViLnhtbCIpOwogICAgICAgICB9
IGVsc2UgewogICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICBlbnYucmVhZENvbmZp
Z3VyYXRpb24obmV3IEZpbGUoY29uZmlnKSk7CiAgICAgICAgICAgICB9IGNhdGNoIChJT0V4Y2Vw
dGlvbiBleCkgewotICAgICAgICAgICAgICAgIE9wZW5Hcm9rTG9nZ2VyLmdldExvZ2dlcigpLmxv
ZyhMZXZlbC5XQVJOSU5HLCAiT3Blbkdyb2sgQ29uZmlndXJhdGlvbiBlcnJvci4gRmFpbGVkIHRv
IHJlYWQgY29uZmlnIGZpbGU6ICIsIGV4KTsKKyAgICAgICAgICAgICAgICBsb2dnZXIud2Fybmlu
ZygiT3Blbkdyb2sgQ29uZmlndXJhdGlvbiBlcnJvci4gRmFpbGVkIHRvIHJlYWQgY29uZmlnIGZp
bGU6ICIgCisgICAgICAgICAgICAgICAgICAgICsgZXguZ2V0TWVzc2FnZSgpKTsKKyAgICAgICAg
ICAgICAgICBsb2dnZXIubG9nKExldmVsLkZJTkUsICJjb250ZXh0SW5pdGlhbGl6ZWQiLCBleCk7
CiAgICAgICAgICAgICB9CiAgICAgICAgIH0KIAogICAgICAgICBTdHJpbmcgYWRkcmVzcyA9IGNv
bnRleHQuZ2V0SW5pdFBhcmFtZXRlcigiQ29uZmlnQWRkcmVzcyIpOwogICAgICAgICBpZiAoYWRk
cmVzcyAhPSBudWxsICYmIGFkZHJlc3MubGVuZ3RoKCkgPiAwKSB7Ci0gICAgICAgICAgICBPcGVu
R3Jva0xvZ2dlci5nZXRMb2dnZXIoKS5sb2coTGV2ZWwuQ09ORklHLCAiV2lsbCBsaXN0ZW4gZm9y
IGNvbmZpZ3VyYXRpb24gb24gW3swfV0iLCBhZGRyZXNzKTsKKyAgICAgICAgICAgIGxvZ2dlci5s
b2coTGV2ZWwuQ09ORklHLCAiV2lsbCBsaXN0ZW4gZm9yIGNvbmZpZ3VyYXRpb24gb24gezB9Iiwg
YWRkcmVzcyk7CiAgICAgICAgICAgICBTdHJpbmdbXSBjZmcgPSBhZGRyZXNzLnNwbGl0KCI6Iik7
CiAgICAgICAgICAgICBpZiAoY2ZnLmxlbmd0aCA9PSAyKSB7CiAgICAgICAgICAgICAgICAgdHJ5
IHsKICAgICAgICAgICAgICAgICAgICAgU29ja2V0QWRkcmVzcyBhZGRyID0gbmV3IEluZXRTb2Nr
ZXRBZGRyZXNzKEluZXRBZGRyZXNzLmdldEJ5TmFtZShjZmdbMF0pLCBJbnRlZ2VyLnBhcnNlSW50
KGNmZ1sxXSkpOwogICAgICAgICAgICAgICAgICAgICBpZiAoIVJ1bnRpbWVFbnZpcm9ubWVudC5n
ZXRJbnN0YW5jZSgpLnN0YXJ0Q29uZmlndXJhdGlvbkxpc3RlbmVyVGhyZWFkKGFkZHIpKSB7Ci0g
ICAgICAgICAgICAgICAgICAgICAgICBPcGVuR3Jva0xvZ2dlci5nZXRMb2dnZXIoKS5sb2coTGV2
ZWwuU0VWRVJFLCAiT3Blbkdyb2s6IEZhaWxlZCB0byBzdGFydCBjb25maWd1cmF0aW9uIGxpc3Rl
bmVyIHRocmVhZCIpOworICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoIkZh
aWxlZCB0byBzdGFydCBjb25maWd1cmF0aW9uIGxpc3RlbmVyIHRocmVhZCIpOwogICAgICAgICAg
ICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgfSBjYXRjaCAoTnVtYmVyRm9ybWF0RXhjZXB0
aW9uIGV4KSB7Ci0gICAgICAgICAgICAgICAgICAgIE9wZW5Hcm9rTG9nZ2VyLmdldExvZ2dlcigp
LmxvZyhMZXZlbC5TRVZFUkUsICJPcGVuR3JvazogRmFpbGVkIHRvIHN0YXJ0IGNvbmZpZ3VyYXRp
b24gbGlzdGVuZXIgdGhyZWFkOiIsIGV4KTsKKyAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLndh
cm5pbmcoIkZhaWxlZCB0byBzdGFydCBjb25maWd1cmF0aW9uIGxpc3RlbmVyIHRocmVhZDogIiAK
KyAgICAgICAgICAgICAgICAgICAgICAgICsgZXguZ2V0TWVzc2FnZSgpKTsKKyAgICAgICAgICAg
ICAgICAgICAgbG9nZ2VyLmxvZyhMZXZlbC5GSU5FLCAiY29udGV4dEluaXRpYWxpemVkIiwgZXgp
OwogICAgICAgICAgICAgICAgIH0gY2F0Y2ggKFVua25vd25Ib3N0RXhjZXB0aW9uIGV4KSB7Ci0g
ICAgICAgICAgICAgICAgICAgIE9wZW5Hcm9rTG9nZ2VyLmdldExvZ2dlcigpLmxvZyhMZXZlbC5T
RVZFUkUsICJPcGVuR3JvazogRmFpbGVkIHRvIHN0YXJ0IGNvbmZpZ3VyYXRpb24gbGlzdGVuZXIg
dGhyZWFkOiIsIGV4KTsKKyAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoIkZhaWxl
ZCB0byBzdGFydCBjb25maWd1cmF0aW9uIGxpc3RlbmVyIHRocmVhZDoiICsgZXguZ2V0TWVzc2Fn
ZSgpKTsKKyAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmxvZyhMZXZlbC5GSU5FLCAiY29udGV4
dEluaXRpYWxpemVkIiwgZXgpOwogICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgIH0gZWxz
ZSB7Ci0gICAgICAgICAgICAgICAgT3Blbkdyb2tMb2dnZXIuZ2V0TG9nZ2VyKCkubG9nKExldmVs
LlNFVkVSRSwgIkluY29ycmVjdCBmb3JtYXQgZm9yIHRoZSBjb25maWd1cmF0aW9uIGFkZHJlc3M6
ICIpOworICAgICAgICAgICAgICAgIFN0cmluZ0J1aWxkZXIgc2IgPSBuZXcgU3RyaW5nQnVpbGRl
cigiSW5jb3JyZWN0IGZvcm1hdCBmb3IgdGhlIGNvbmZpZ3VyYXRpb24gYWRkcmVzcyAtICIpOwog
ICAgICAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgY2ZnLmxlbmd0aDsgKytpKSB7Ci0g
ICAgICAgICAgICAgICAgICAgIE9wZW5Hcm9rTG9nZ2VyLmdldExvZ2dlcigpLmxvZyhMZXZlbC5T
RVZFUkUsICJbezB9XSIsIGNmZ1tpXSk7CisgICAgICAgICAgICAgICAgICAgIHNiLmFwcGVuZCgn
WycpLmFwcGVuZChjZmdbaV0pLmFwcGVuZCgiXSwgIik7CiAgICAgICAgICAgICAgICAgfQorICAg
ICAgICAgICAgICAgIHNiLnNldExlbmd0aChzYi5sZW5ndGgoKS0yKTsKKyAgICAgICAgICAgICAg
ICBsb2dnZXIud2FybmluZyhzYi50b1N0cmluZygpKTsKICAgICAgICAgICAgIH0KICAgICAgICAg
fQogICAgIH0K
</data>

          </attachment>
      

    </bug>

</bugzilla>