<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "http://defect.opensolaris.org/bz/bugzilla.dtd">

<bugzilla version="3.6.5"
          urlbase="http://defect.opensolaris.org/bz/"
          
          maintainer="website-admin@opensolaris.org"
>

    <bug>
          <bug_id>16913</bug_id>
          
          <creation_ts>2010-08-25 09:31:00 +0000</creation_ts>
          <short_desc>Opengrok fails to use JDBC cache if -R option is specified</short_desc>
          <delta_ts>2010-08-27 18:28:45 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Development</classification>
          <product>opengrok</product>
          <component>indexer</component>
          <version>unspecified</version>
          <rep_platform>ANY/Generic</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>FIXED</resolution>
          
          
          
          
          
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>0.10</target_milestone>
          
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Martin Walsh">martin.walsh</reporter>
          <assigned_to name="Martin Walsh">martin.walsh</assigned_to>
          <cc>knut.hatlen</cc>
    
    <cc>opengrok-dev</cc>
          

      

      

      

          <long_desc isprivate="0">
            <commentid>76983</commentid>
            <who name="Martin Walsh">martin.walsh</who>
            <bug_when>2010-08-25 09:31:43 +0000</bug_when>
            <thetext>When indexing source code using the -D option to specify history cache uses a database, if the -R option is specified to read an existing configuration, the History is always generated to file not to database.

This is because the -R option is handled first,  reading in any existing configuration via the RuntimeEnvironment.  This in turn initialises the HistoryGuru, which checks the config to see which type of cache to use.  As the -D option has not been handled yet, it uses files.  This is then set permanently for the life of the application, as HistoryGuru is a singleton.  So when indexing commences, even though the config is correct, the HistoryGuru used is still setup using files, instead of the database.</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <commentid>76996</commentid>
            <who name="Knut Anders Hatlen">knut.hatlen</who>
            <bug_when>2010-08-25 14:37:29 +0000</bug_when>
            <thetext>I don&apos;t think we need to initialize the runtime environment as early as we currently do. It should be sufficient to read the configuration into a local variable with Configuration.read() and work on this object instead of the RuntimeEnvironment object when parsing the command line. Finally, after we&apos;ve parsed the command line and updated the local Configuration object, we can call RuntimeEnvironment.setConfiguration(), which will update both the runtime environment and HistoryGuru.</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <commentid>77119</commentid>
              <attachid>4284</attachid>
            <who name="Martin Walsh">martin.walsh</who>
            <bug_when>2010-08-27 15:11:25 +0000</bug_when>
            <thetext>Created attachment 4284
Possible fix

Updates the Indexer to use a local copy of the Configuration.  Setting up the RuntimeEnvironment afterwards.</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <commentid>77124</commentid>
            <who name="Knut Anders Hatlen">knut.hatlen</who>
            <bug_when>2010-08-27 18:28:45 +0000</bug_when>
            <thetext>Thanks for the patch, Martin! The suggested fix looks correct to me, so I pushed it to the repository.

changeset:   1088:9ce77830fd81
tag:         tip
user:        Martin Walsh &lt;martin.walsh@oracle.com&gt;
date:        Fri Aug 27 20:24:14 2010 +0200
summary:     Bug #16913: OpenGrok fails to use JDBC cache if -R option is specified</thetext>
          </long_desc>
      
          <attachment
              isobsolete="0"
              ispatch="1"
              isprivate="0"
              isurl="0"
          >
            <attachid>4284</attachid>
            <date>2010-08-27 15:11:00 +0000</date>
            <delta_ts>2010-08-27 15:11:25 +0000</delta_ts>
            <desc>Possible fix</desc>
            <filename>b16913.diff</filename>
            <type>text/plain</type>
            <size>15528</size>
            <attacher>martin.walsh</attacher>
            
              <data encoding="base64">ZGlmZiAtciAzMGY5M2IwZDk5MTggc3JjL29yZy9vcGVuc29sYXJpcy9vcGVuZ3Jvay9jb25maWd1
cmF0aW9uL1J1bnRpbWVFbnZpcm9ubWVudC5qYXZhCi0tLSBhL3NyYy9vcmcvb3BlbnNvbGFyaXMv
b3Blbmdyb2svY29uZmlndXJhdGlvbi9SdW50aW1lRW52aXJvbm1lbnQuamF2YQlUdWUgQXVnIDI0
IDIyOjMzOjA4IDIwMTAgKzAyMDAKKysrIGIvc3JjL29yZy9vcGVuc29sYXJpcy9vcGVuZ3Jvay9j
b25maWd1cmF0aW9uL1J1bnRpbWVFbnZpcm9ubWVudC5qYXZhCUZyaSBBdWcgMjcgMTY6MDk6Mzcg
MjAxMCArMDEwMApAQCAtNjgwLDggKzY4MCw4IEBACiAKICAgICBwdWJsaWMgdm9pZCBzZXRDb25m
aWd1cmF0aW9uKENvbmZpZ3VyYXRpb24gY29uZmlndXJhdGlvbikgewogICAgICAgICB0aGlzLmNv
bmZpZ3VyYXRpb24gPSBjb25maWd1cmF0aW9uOworICAgICAgICByZWdpc3RlcigpOwogICAgICAg
ICBIaXN0b3J5R3VydS5nZXRJbnN0YW5jZSgpLmludmFsaWRhdGVSZXBvc2l0b3JpZXMoY29uZmln
dXJhdGlvbi5nZXRSZXBvc2l0b3JpZXMoKSk7Ci0gICAgICAgIHJlZ2lzdGVyKCk7CiAgICAgfQog
CiAgICAgcHVibGljIENvbmZpZ3VyYXRpb24gZ2V0Q29uZmlndXJhdGlvbigpIHsKZGlmZiAtciAz
MGY5M2IwZDk5MTggc3JjL29yZy9vcGVuc29sYXJpcy9vcGVuZ3Jvay9pbmRleC9JbmRleGVyLmph
dmEKLS0tIGEvc3JjL29yZy9vcGVuc29sYXJpcy9vcGVuZ3Jvay9pbmRleC9JbmRleGVyLmphdmEJ
VHVlIEF1ZyAyNCAyMjozMzowOCAyMDEwICswMjAwCisrKyBiL3NyYy9vcmcvb3BlbnNvbGFyaXMv
b3Blbmdyb2svaW5kZXgvSW5kZXhlci5qYXZhCUZyaSBBdWcgMjcgMTY6MDk6MzcgMjAxMCArMDEw
MApAQCAtNDAsNiArNDAsNyBAQAogaW1wb3J0IG9yZy5vcGVuc29sYXJpcy5vcGVuZ3Jvay5JbmZv
OwogaW1wb3J0IG9yZy5vcGVuc29sYXJpcy5vcGVuZ3Jvay5PcGVuR3Jva0xvZ2dlcjsKIGltcG9y
dCBvcmcub3BlbnNvbGFyaXMub3Blbmdyb2suYW5hbHlzaXMuQW5hbHl6ZXJHdXJ1OworaW1wb3J0
IG9yZy5vcGVuc29sYXJpcy5vcGVuZ3Jvay5jb25maWd1cmF0aW9uLkNvbmZpZ3VyYXRpb247CiBp
bXBvcnQgb3JnLm9wZW5zb2xhcmlzLm9wZW5ncm9rLmNvbmZpZ3VyYXRpb24uUHJvamVjdDsKIGlt
cG9ydCBvcmcub3BlbnNvbGFyaXMub3Blbmdyb2suY29uZmlndXJhdGlvbi5SdW50aW1lRW52aXJv
bm1lbnQ7CiBpbXBvcnQgb3JnLm9wZW5zb2xhcmlzLm9wZW5ncm9rLmhpc3RvcnkuSGlzdG9yeUd1
cnU7CkBAIC03NCw3ICs3NSw2IEBACiAgICAgICovCiAgICAgQFN1cHByZXNzV2FybmluZ3MoIlBN
RC5Vc2VTdHJpbmdCdWZmZXJGb3JTdHJpbmdBcHBlbmRzIikKICAgICBwdWJsaWMgc3RhdGljIHZv
aWQgbWFpbihTdHJpbmcgYXJndltdKSB7Ci0gICAgICAgIFJ1bnRpbWVFbnZpcm9ubWVudCBlbnYg
PSBSdW50aW1lRW52aXJvbm1lbnQuZ2V0SW5zdGFuY2UoKTsKICAgICAgICAgYm9vbGVhbiBydW5J
bmRleCA9IHRydWU7CiAgICAgICAgIGJvb2xlYW4gdXBkYXRlID0gdHJ1ZTsKICAgICAgICAgYm9v
bGVhbiBvcHRpbWl6ZWRDaGFuZ2VkID0gZmFsc2U7CkBAIC0xMDksMTkgKzEwOSwyNCBAQAogICAg
ICAgICAgICAgfQogCiAgICAgICAgICAgICB0cnkgeworICAgICAgICAgICAgICAgIENvbmZpZ3Vy
YXRpb24gY2ZnID0gbnVsbDsKICAgICAgICAgICAgICAgICBpbnQgY21kOwogCiAgICAgICAgICAg
ICAgICAgLy8gV2UgbmVlZCB0byByZWFkIHRoZSBjb25maWd1cmF0aW9uIGZpbGUgZmlyc3QsIHNp
bmNlIHdlCiAgICAgICAgICAgICAgICAgLy8gd2lsbCB0cnkgdG8gb3ZlcndyaXRlIG9wdGlvbnMu
LgogICAgICAgICAgICAgICAgIHdoaWxlICgoY21kID0gZ2V0b3B0LmdldE9wdCgpKSAhPSAtMSkg
ewogICAgICAgICAgICAgICAgICAgICBpZiAoY21kID09ICdSJykgewotICAgICAgICAgICAgICAg
ICAgICAgICAgZW52LnJlYWRDb25maWd1cmF0aW9uKG5ldyBGaWxlKGdldG9wdC5nZXRPcHRhcmco
KSkpOworICAgICAgICAgICAgICAgICAgICAgICAgY2ZnID0gQ29uZmlndXJhdGlvbi5yZWFkKG5l
dyBGaWxlKGdldG9wdC5nZXRPcHRhcmcoKSkpOwogICAgICAgICAgICAgICAgICAgICAgICAgYnJl
YWs7CiAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICB9CiAKLSAgICAgICAg
ICAgICAgICBTdHJpbmcgZGF0YWJhc2VEcml2ZXIgPSBlbnYuZ2V0RGF0YWJhc2VEcml2ZXIoKTsK
LSAgICAgICAgICAgICAgICBTdHJpbmcgZGF0YWJhc2VVUkwgPSBlbnYuZ2V0RGF0YWJhc2VVcmwo
KTsKKyAgICAgICAgICAgICAgICBpZiAoY2ZnID09IG51bGwpIHsKKyAgICAgICAgICAgICAgICAg
ICAgY2ZnID0gbmV3IENvbmZpZ3VyYXRpb24oKTsKKyAgICAgICAgICAgICAgICB9CisKKyAgICAg
ICAgICAgICAgICBTdHJpbmcgZGF0YWJhc2VEcml2ZXIgPSBjZmcuZ2V0RGF0YWJhc2VEcml2ZXIo
KTsKKyAgICAgICAgICAgICAgICBTdHJpbmcgZGF0YWJhc2VVUkwgPSBjZmcuZ2V0RGF0YWJhc2VV
cmwoKTsKIAogICAgICAgICAgICAgICAgIC8vIE5vdyB3ZSBjYW4gaGFuZGxlIGFsbCB0aGUgb3Ro
ZXIgb3B0aW9ucy4uCiAgICAgICAgICAgICAgICAgZ2V0b3B0LnJlc2V0KCk7CkBAIC0xMzMsMTEg
KzEzOCwxMSBAQAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogCiAgICAgICAg
ICAgICAgICAgICAgICAgICBjYXNlICdxJzoKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICBl
bnYuc2V0VmVyYm9zZShmYWxzZSk7CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2ZnLnNl
dFZlcmJvc2UoZmFsc2UpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgIE9wZW5Hcm9rTG9n
Z2VyLnNldE9HQ29uc29sZUxvZ0xldmVsKExldmVsLldBUk5JTkcpOwogICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnZSc6Ci0g
ICAgICAgICAgICAgICAgICAgICAgICAgICAgZW52LnNldEdlbmVyYXRlSHRtbChmYWxzZSk7Cisg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgY2ZnLnNldEdlbmVyYXRlSHRtbChmYWxzZSk7CiAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAg
ICBjYXNlICdQJzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRQcm9qZWN0cyA9IHRy
dWU7CkBAIC0xNDYsNyArMTUxLDcgQEAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZh
dWx0UHJvamVjdCA9IGdldG9wdC5nZXRPcHRhcmcoKTsKICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ2MnOgotICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIGVudi5zZXRDdGFncyhnZXRvcHQuZ2V0T3B0YXJnKCkpOworICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIGNmZy5zZXRDdGFncyhnZXRvcHQuZ2V0T3B0YXJnKCkp
OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAg
ICAgICAgY2FzZSAndyc6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsKQEAgLTE1NSw5
ICsxNjAsOSBAQAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2ViYXBwID0g
Ii8iICsgd2ViYXBwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh3ZWJhcHAuZW5kc1dpdGgoIi8iKSkgewotICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW52LnNldFVybFByZWZpeCh3ZWJhcHAg
KyAicz8iKTsKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNmZy5zZXRVcmxQ
cmVmaXgod2ViYXBwICsgInM/Iik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0g
ZWxzZSB7Ci0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbnYuc2V0VXJsUHJl
Zml4KHdlYmFwcCArICIvcz8iKTsKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IGNmZy5zZXRVcmxQcmVmaXgod2ViYXBwICsgIi9zPyIpOwogICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIGJyZWFrOwpAQCAtMTgzLDcgKzE4OCw3IEBACiAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgcmVwb3NpdG9yaWVzLmFkZChnZXRvcHQuZ2V0T3B0YXJnKCkpOwogICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAg
Y2FzZSAnRCc6Ci0gICAgICAgICAgICAgICAgICAgICAgICAgICAgZW52LnNldFN0b3JlSGlzdG9y
eUNhY2hlSW5EQih0cnVlKTsKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICBjZmcuc2V0SGlz
dG9yeUNhY2hlSW5EQih0cnVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsK
ICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ2onOgogICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIGRhdGFiYXNlRHJpdmVyID0gZ2V0b3B0LmdldE9wdGFyZygpOwpAQCAtMjAyLDkgKzIw
Nyw5IEBACiAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdyJzoKICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZ2V0
b3B0LmdldE9wdGFyZygpLmVxdWFsc0lnbm9yZUNhc2UoT04pKSB7Ci0gICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICBlbnYuc2V0UmVtb3RlU2NtU3VwcG9ydGVkKHRydWUpOworICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2ZnLnNldFJlbW90ZVNjbVN1cHBvcnRl
ZCh0cnVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChnZXRv
cHQuZ2V0T3B0YXJnKCkuZXF1YWxzSWdub3JlQ2FzZShPRkYpKSB7Ci0gICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICBlbnYuc2V0UmVtb3RlU2NtU3VwcG9ydGVkKGZhbHNlKTsKKyAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNmZy5zZXRSZW1vdGVTY21TdXBwb3J0
ZWQoZmFsc2UpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU3lzdGVtLmVyci5wcmludGxuKCJFUlJP
UjogWW91IHNob3VsZCBwYXNzIGVpdGhlciBcIm9uXCIgb3IgXCJvZmZcIiBhcyBhcmd1bWVudCB0
byAtciIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU3lzdGVtLmVyci5w
cmludGxuKCIgICAgICAgRXg6IFwiLXIgb25cIiB3aWxsIGFsbG93IHJldHJpdmFsIGZvciByZW1v
dGUgU0NNIHN5c3RlbXMiKTsKQEAgLTIxNCwzMCArMjE5LDMwIEBACiAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdPJzoKICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgewotICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICBib29sZWFuIG9sZHZhbCA9IGVudi5pc09wdGltaXplRGF0YWJhc2UoKTsKKyAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgYm9vbGVhbiBvbGR2YWwgPSBjZmcuaXNPcHRpbWl6ZURh
dGFiYXNlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChnZXRvcHQuZ2V0
T3B0YXJnKCkuZXF1YWxzSWdub3JlQ2FzZShPTikpIHsKLSAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIGVudi5zZXRPcHRpbWl6ZURhdGFiYXNlKHRydWUpOworICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgY2ZnLnNldE9wdGltaXplRGF0YWJhc2UodHJ1ZSk7CiAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZ2V0b3B0LmdldE9wdGFy
ZygpLmVxdWFsc0lnbm9yZUNhc2UoT0ZGKSkgewotICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgZW52LnNldE9wdGltaXplRGF0YWJhc2UoZmFsc2UpOworICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgY2ZnLnNldE9wdGltaXplRGF0YWJhc2UoZmFsc2UpOwogICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgU3lzdGVtLmVyci5wcmludGxuKCJFUlJPUjogWW91IHNob3VsZCBw
YXNzIGVpdGhlciBcIm9uXCIgb3IgXCJvZmZcIiBhcyBhcmd1bWVudCB0byAtTyIpOwogICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU3lzdGVtLmVyci5wcmludGxuKCIgICAgICAg
RXg6IFwiLU8gb25cIiB3aWxsIG9wdGltaXplIHRoZSBkYXRhYmFzZSBhcyBwYXJ0IG9mIHRoZSBp
bmRleCBnZW5lcmF0aW9uIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBT
eXN0ZW0uZXJyLnByaW50bG4oIiAgICAgICAgICAgXCItTyBvZmZcIiBkaXNhYmxlIG9wdGltaXph
dGlvbiBvZiB0aGUgaW5kZXggZGF0YWJhc2UiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgfQotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAob2xkdmFsICE9IGVu
di5pc09wdGltaXplRGF0YWJhc2UoKSkgeworICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICBpZiAob2xkdmFsICE9IGNmZy5pc09wdGltaXplRGF0YWJhc2UoKSkgewogICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW1pemVkQ2hhbmdlZCA9IHRydWU7CiAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9
CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAg
ICAgICBjYXNlICd2JzoKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbnYuc2V0VmVyYm9z
ZSh0cnVlKTsKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICBjZmcuc2V0VmVyYm9zZSh0cnVl
KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICBPcGVuR3Jva0xvZ2dlci5zZXRPR0NvbnNv
bGVMb2dMZXZlbChMZXZlbC5JTkZPKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVh
azsKIAogICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAncyc6CiAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIHsKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW52LnNldFNv
dXJjZVJvb3QoZ2V0b3B0LmdldE9wdGFyZygpKTsKLSAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgRmlsZSBmaWxlID0gZW52LmdldFNvdXJjZVJvb3RGaWxlKCk7CisgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIGNmZy5zZXRTb3VyY2VSb290KGdldG9wdC5nZXRPcHRhcmcoKSk7
CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEZpbGUgZmlsZSA9IG5ldyBGaWxlKGNm
Zy5nZXRTb3VyY2VSb290KCkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAo
IWZpbGUuaXNEaXJlY3RvcnkoKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgU3lzdGVtLmVyci5wcmludGxuKCJFUlJPUjogc291cmNlIHJvb3QgbXVzdCBiZSBhIGRpcmVj
dG9yeTogIiArIGZpbGUudG9TdHJpbmcoKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBTeXN0ZW0uZXhpdCgxKTsKQEAgLTI0Niw4ICsyNTEsOCBAQAogICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnZCc6
CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsKLSAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgZW52LnNldERhdGFSb290KGdldG9wdC5nZXRPcHRhcmcoKSk7Ci0gICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIEZpbGUgZmlsZSA9IGVudi5nZXREYXRhUm9vdEZpbGUoKTsK
KyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2ZnLnNldERhdGFSb290KGdldG9wdC5n
ZXRPcHRhcmcoKSk7CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEZpbGUgZmlsZSA9
IG5ldyBGaWxlKGNmZy5nZXREYXRhUm9vdCgpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgaWYgKCFmaWxlLmlzRGlyZWN0b3J5KCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIFN5c3RlbS5lcnIucHJpbnRsbigiRVJST1I6IGRhdGEgcm9vdCBtdXN0IGJl
IGEgZGlyZWN0b3J5OiAiICsgZmlsZS50b1N0cmluZygpKTsKICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIFN5c3RlbS5leGl0KDEpOwpAQCAtMjU1LDE5ICsyNjAsMTkgQEAKICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
YnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdpJzoKLSAgICAgICAgICAgICAg
ICAgICAgICAgICAgICBlbnYuZ2V0SWdub3JlZE5hbWVzKCkuYWRkKGdldG9wdC5nZXRPcHRhcmco
KSk7CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2ZnLmdldElnbm9yZWROYW1lcygpLmFk
ZChnZXRvcHQuZ2V0T3B0YXJnKCkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFr
OwogICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnSSc6Ci0gICAgICAgICAgICAgICAgICAg
ICAgICAgICAgZW52LmdldEluY2x1ZGVkTmFtZXMoKS5hZGQoZ2V0b3B0LmdldE9wdGFyZygpKTsK
KyAgICAgICAgICAgICAgICAgICAgICAgICAgICBjZmcuZ2V0SW5jbHVkZWROYW1lcygpLmFkZChn
ZXRvcHQuZ2V0T3B0YXJnKCkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwog
ICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnUyc6CiAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgc2VhcmNoUmVwb3NpdG9yaWVzID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ1EnOgogICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIGlmIChnZXRvcHQuZ2V0T3B0YXJnKCkuZXF1YWxzSWdub3JlQ2Fz
ZShPTikpIHsKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW52LnNldFF1aWNrQ29u
dGV4dFNjYW4odHJ1ZSk7CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNmZy5zZXRR
dWlja0NvbnRleHRTY2FuKHRydWUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxz
ZSBpZiAoZ2V0b3B0LmdldE9wdGFyZygpLmVxdWFsc0lnbm9yZUNhc2UoT0ZGKSkgewotICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICBlbnYuc2V0UXVpY2tDb250ZXh0U2NhbihmYWxzZSk7
CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNmZy5zZXRRdWlja0NvbnRleHRTY2Fu
KGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICBTeXN0ZW0uZXJyLnByaW50bG4oIkVSUk9SOiBZb3Ugc2hv
dWxkIHBhc3MgZWl0aGVyIFwib25cIiBvciBcIm9mZlwiIGFzIGFyZ3VtZW50IHRvIC1RIik7CiAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFN5c3RlbS5lcnIucHJpbnRsbigiICAgICAg
IEV4OiBcIi1RIG9uXCIgd2lsbCBqdXN0IHNjYW4gYSBcImNodW5rXCIgb2YgdGhlIGZpbGUgYW5k
IGluc2VydCBcIlsuLmFsbC4uXVwiIik7CkBAIC0yNzcsNyArMjgyLDcgQEAKICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ20n
OiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHsKLSAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgZW52LnNldEluZGV4V29yZExpbWl0KEludGVnZXIucGFyc2VJbnQoZ2V0
b3B0LmdldE9wdGFyZygpKSk7CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNmZy5z
ZXRJbmRleFdvcmRMaW1pdChJbnRlZ2VyLnBhcnNlSW50KGdldG9wdC5nZXRPcHRhcmcoKSkpOwog
ICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKE51bWJlckZvcm1hdEV4Y2VwdGlv
biBleHApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU3lzdGVtLmVyci5wcmlu
dGxuKCJFUlJPUjogRmFpbGVkIHRvIHBhcnNlIGFyZ3VtZW50IHRvIFwiLW1cIjogIiArIGV4cC5n
ZXRNZXNzYWdlKCkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTeXN0ZW0uZXhp
dCgxKTsKQEAgLTI4Niw5ICsyOTEsOSBAQAogICAgICAgICAgICAgICAgICAgICAgICAgfQogICAg
ICAgICAgICAgICAgICAgICAgICAgY2FzZSAnYSc6CiAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgaWYgKGdldG9wdC5nZXRPcHRhcmcoKS5lcXVhbHNJZ25vcmVDYXNlKE9OKSkgewotICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICBlbnYuc2V0QWxsb3dMZWFkaW5nV2lsZGNhcmQodHJ1
ZSk7CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNmZy5zZXRBbGxvd0xlYWRpbmdX
aWxkY2FyZCh0cnVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGdl
dG9wdC5nZXRPcHRhcmcoKS5lcXVhbHNJZ25vcmVDYXNlKE9GRikpIHsKLSAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgZW52LnNldEFsbG93TGVhZGluZ1dpbGRjYXJkKGZhbHNlKTsKKyAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2ZnLnNldEFsbG93TGVhZGluZ1dpbGRjYXJk
KGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICBTeXN0ZW0uZXJyLnByaW50bG4oIkVSUk9SOiBZb3Ugc2hv
dWxkIHBhc3MgZWl0aGVyIFwib25cIiBvciBcIm9mZlwiIGFzIGFyZ3VtZW50IHRvIC1hIik7CiAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFN5c3RlbS5lcnIucHJpbnRsbigiICAgICAg
IEV4OiBcIi1hIG9uXCIgd2lsbCBhbGxvdyBhIHNlYXJjaCB0byBzdGFydCB3aXRoIGEgd2lsZGNh
cmQiKTsKQEAgLTMyOCw3ICszMzMsNyBAQAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0K
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAg
ICAgIGNhc2UgJ0wnOgotICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVudi5zZXRXZWJhcHBM
QUYoZ2V0b3B0LmdldE9wdGFyZygpKTsKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICBjZmcu
c2V0V2ViYXBwTEFGKGdldG9wdC5nZXRPcHRhcmcoKSk7CiAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdUJzoKICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICB0cnkgewpAQCAtMzQwLDcgKzM0NSw3IEBACiAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICd6
JzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnkgewotICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICBlbnYuc2V0U2Nhbm5pbmdEZXB0aChJbnRlZ2VyLnBhcnNlSW50KGdldG9w
dC5nZXRPcHRhcmcoKSkpOworICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjZmcuc2V0
U2Nhbm5pbmdEZXB0aChJbnRlZ2VyLnBhcnNlSW50KGdldG9wdC5nZXRPcHRhcmcoKSkpOwogICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKE51bWJlckZvcm1hdEV4Y2VwdGlvbiBl
eHApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU3lzdGVtLmVyci5wcmludGxu
KCJFUlJPUjogRmFpbGVkIHRvIHBhcnNlIGFyZ3VtZW50IHRvIFwiLXpcIjogIiArIGV4cC5nZXRN
ZXNzYWdlKCkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTeXN0ZW0uZXhpdCgx
KTsKQEAgLTM0OCw5ICszNTMsOSBAQAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFr
OwogICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnbCc6CiAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgaWYgKGdldG9wdC5nZXRPcHRhcmcoKS5lcXVhbHNJZ25vcmVDYXNlKE9OKSkgewot
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbnYuc2V0VXNpbmdMdWNlbmVMb2NraW5n
KHRydWUpOworICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjZmcuc2V0VXNpbmdMdWNl
bmVMb2NraW5nKHRydWUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAo
Z2V0b3B0LmdldE9wdGFyZygpLmVxdWFsc0lnbm9yZUNhc2UoT0ZGKSkgewotICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICBlbnYuc2V0VXNpbmdMdWNlbmVMb2NraW5nKGZhbHNlKTsKKyAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2ZnLnNldFVzaW5nTHVjZW5lTG9ja2luZyhm
YWxzZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgU3lzdGVtLmVyci5wcmludGxuKCJFUlJPUjogWW91IHNob3Vs
ZCBwYXNzIGVpdGhlciBcIm9uXCIgb3IgXCJvZmZcIiBhcyBhcmd1bWVudCB0byAtbCIpOwogICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTeXN0ZW0uZXJyLnByaW50bG4oIiAgICAgICBF
eDogXCItbCBvblwiIHdpbGwgZW5hYmxlIGxvY2tzIGluIEx1Y2VuZSIpOwpAQCAtMzgyLDEyICsz
ODcsMTIgQEAKICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgCiAgICAgICAgICAg
ICAgICAgLy9sb2dnaW5nIHN0YXJ0cyBoZXJlCi0gICAgICAgICAgICAgICAgaWYgKGVudi5pc1Zl
cmJvc2UoKSkgeworICAgICAgICAgICAgICAgIGlmIChjZmcuaXNWZXJib3NlKCkpIHsKICAgICAg
ICAgICAgICAgICAgIFN0cmluZyBmbj1Mb2dNYW5hZ2VyLmdldExvZ01hbmFnZXIoKS5nZXRQcm9w
ZXJ0eSgiamF2YS51dGlsLmxvZ2dpbmcuRmlsZUhhbmRsZXIucGF0dGVybiIpOwogICAgICAgICAg
ICAgICAgICAgaWYgKGZuIT1udWxsKSB7U3lzdGVtLm91dC5wcmludGxuKCJMb2dnaW5nIHRvIGZp
bGU6ICIrZm4pO30KICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgCi0gICAgICAg
ICAgICAgICAgaWYgKGVudi5zdG9yZUhpc3RvcnlDYWNoZUluREIoKSkgeworICAgICAgICAgICAg
ICAgIGlmIChjZmcuaXNIaXN0b3J5Q2FjaGVJbkRCKCkpIHsKICAgICAgICAgICAgICAgICAgICAg
Ly8gVGhlIGRlZmF1bHQgZGF0YWJhc2UgZHJpdmVyIGlzIERlcmJ5J3MgY2xpZW50IGRyaXZlci4K
ICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGFiYXNlRHJpdmVyID09IG51bGwpIHsKICAgICAg
ICAgICAgICAgICAgICAgICAgIGRhdGFiYXNlRHJpdmVyID0gREVSQllfQ0xJRU5UX0RSSVZFUjsK
QEAgLTM5OCw4ICs0MDMsNyBAQAogICAgICAgICAgICAgICAgICAgICAgICAgU3RyaW5nQnVpbGRl
ciBkZWZhdWx0VVJMID0gbmV3IFN0cmluZ0J1aWxkZXIoKTsKICAgICAgICAgICAgICAgICAgICAg
ICAgIGRlZmF1bHRVUkwuYXBwZW5kKCJqZGJjOmRlcmJ5OiIpOwogICAgICAgICAgICAgICAgICAg
ICAgICAgaWYgKGRhdGFiYXNlRHJpdmVyLmVxdWFscyhERVJCWV9FTUJFRERFRF9EUklWRVIpKSB7
Ci0gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdFVSTAotICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgLmFwcGVuZChlbnYuZ2V0RGF0YVJvb3RQYXRoKCkpCisgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdFVSTC5hcHBlbmQoY2ZnLmdldERhdGFSb290
KCkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKEZpbGUuc2Vw
YXJhdG9yKTsKICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgZGVmYXVsdFVSTC5hcHBlbmQoIi8vbG9jYWxob3N0LyIpOwpAQCAtNDA5
LDExICs0MTMsMTIgQEAKICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgIH0K
IAotICAgICAgICAgICAgICAgIGVudi5zZXREYXRhYmFzZURyaXZlcihkYXRhYmFzZURyaXZlcik7
Ci0gICAgICAgICAgICAgICAgZW52LnNldERhdGFiYXNlVXJsKGRhdGFiYXNlVVJMKTsKKyAgICAg
ICAgICAgICAgICBjZmcuc2V0RGF0YWJhc2VEcml2ZXIoZGF0YWJhc2VEcml2ZXIpOworICAgICAg
ICAgICAgICAgIGNmZy5zZXREYXRhYmFzZVVybChkYXRhYmFzZVVSTCk7CiAKICAgICAgICAgICAg
ICAgICAvLyBhdXRvbWF0aWNhbGx5IGFsbG93IHN5bWxpbmtzIHRoYXQgYXJlIGRpcmVjdGx5IGlu
IHNvdXJjZSByb290Ci0gICAgICAgICAgICAgICAgRmlsZSBzb3VyY2VSb290RmlsZSA9IGVudi5n
ZXRTb3VyY2VSb290RmlsZSgpOworICAgICAgICAgICAgICAgIFN0cmluZyBmaWxlID0gY2ZnLmdl
dFNvdXJjZVJvb3QoKTsKKyAgICAgICAgICAgICAgICBGaWxlIHNvdXJjZVJvb3RGaWxlID0gZmls
ZSAhPSBudWxsID8gbmV3IEZpbGUoZmlsZSkgOiBudWxsOwogICAgICAgICAgICAgICAgIGlmIChz
b3VyY2VSb290RmlsZSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgIEZpbGVbXSBwcm9q
ZWN0RGlycyA9IHNvdXJjZVJvb3RGaWxlLmxpc3RGaWxlcygpOwogICAgICAgICAgICAgICAgICAg
ICBpZiAocHJvamVjdERpcnMgIT0gbnVsbCkgewpAQCAtNDI1LDggKzQzMCwxMiBAQAogICAgICAg
ICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgIAotICAg
ICAgICAgICAgICAgIGFsbG93ZWRTeW1saW5rcy5hZGRBbGwoZW52LmdldEFsbG93ZWRTeW1saW5r
cygpKTsKLSAgICAgICAgICAgICAgICBlbnYuc2V0QWxsb3dlZFN5bWxpbmtzKGFsbG93ZWRTeW1s
aW5rcyk7CisgICAgICAgICAgICAgICAgYWxsb3dlZFN5bWxpbmtzLmFkZEFsbChjZmcuZ2V0QWxs
b3dlZFN5bWxpbmtzKCkpOworICAgICAgICAgICAgICAgIGNmZy5zZXRBbGxvd2VkU3ltbGlua3Mo
YWxsb3dlZFN5bWxpbmtzKTsKKworICAgICAgICAgICAgICAgIC8vU2V0IHVwZGF0ZWQgY29uZmln
dXJhdGlvbiBpbiBSdW50aW1lRW52aXJvbm1lbnQKKyAgICAgICAgICAgICAgICBSdW50aW1lRW52
aXJvbm1lbnQgZW52ID0gUnVudGltZUVudmlyb25tZW50LmdldEluc3RhbmNlKCk7CisgICAgICAg
ICAgICAgICAgZW52LnNldENvbmZpZ3VyYXRpb24oY2ZnKTsKIAogICAgICAgICAgICAgICAgIGdl
dEluc3RhbmNlKCkucHJlcGFyZUluZGV4ZXIoZW52LCBzZWFyY2hSZXBvc2l0b3JpZXMsIGFkZFBy
b2plY3RzLAogICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdFByb2plY3QsIGNvbmZpZ0Zp
bGVuYW1lLCByZWZyZXNoSGlzdG9yeSwK
</data>
<flag name="review"
          id="58"
          type_id="1"
          status="?"
          setter="martin.walsh"
    />
          </attachment>
      

    </bug>

</bugzilla>