<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "http://defect.opensolaris.org/bz/bugzilla.dtd">

<bugzilla version="3.6.5"
          urlbase="http://defect.opensolaris.org/bz/"
          
          maintainer="website-admin@opensolaris.org"
>

    <bug>
          <bug_id>17130</bug_id>
          
          <creation_ts>2010-09-28 13:29:00 +0000</creation_ts>
          <short_desc>SpellChecker instance in search.jsp not closed: IOException: Too many open files</short_desc>
          <delta_ts>2010-09-30 08:48:24 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Development</classification>
          <product>opengrok</product>
          <component>webapp</component>
          <version>unspecified</version>
          <rep_platform>ANY/Generic</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>DUPLICATE</resolution>
          <dup_id>17127</dup_id>
          
          
          
          
          <priority>P3</priority>
          <bug_severity>critical</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Horst Reiterer">horst.reiterer</reporter>
          <assigned_to name="Trond Norbye">trond.norbye</assigned_to>
          <cc>knut.hatlen</cc>
    
    <cc>opengrok-dev</cc>
    
    <cc>Ragesh.X.Nair</cc>
          

      

      

      

          <long_desc isprivate="0">
            <commentid>77951</commentid>
              <attachid>4314</attachid>
            <who name="Horst Reiterer">horst.reiterer</who>
            <bug_when>2010-09-28 13:29:23 +0000</bug_when>
            <thetext>Created attachment 4314
Delta to 0.9 - correct SpellChecker close()

In 0.9, the SpellChecker instance in search.jsp is not being closed. Consequently, a file descriptor representing the underlying index files read by the instance remains open until object finalization. Dependening on the usage pattern, this missing close() may cause a denial of service of the running instance after hitting the file descriptor limit (1024 on Linux).

The attached search.jsp modification adds the missing close. Please apply!</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <commentid>77953</commentid>
            <who name="Trond Norbye">trond.norbye</who>
            <bug_when>2010-09-28 13:45:54 +0000</bug_when>
            <thetext>

*** This bug has been marked as a duplicate of bug 17127 ***</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <commentid>77955</commentid>
            <who name="Horst Reiterer">horst.reiterer</who>
            <bug_when>2010-09-28 13:58:18 +0000</bug_when>
            <thetext>Judging from the trunk, it&apos;s not fixed! The issue might have occurred in other use-cases - I don&apos;t see a defect for this particular use-case, though!

Don&apos;t see a close() of the SpellChecker instance in the trunk version:
http://src.opensolaris.org/source/xref/opengrok/trunk/web/search.jsp</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <commentid>77957</commentid>
            <who name="Trond Norbye">trond.norbye</who>
            <bug_when>2010-09-28 14:02:08 +0000</bug_when>
            <thetext>Sorry, guess I was too fast there... I closed it as a duplicate because it sounded exactly what Knut Anders closed some hours ago ;-)</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <commentid>77958</commentid>
            <who name="Knut Anders Hatlen">knut.hatlen</who>
            <bug_when>2010-09-28 14:10:48 +0000</bug_when>
            <thetext>There is a small delay before src.opensolaris.org is updated with the latest changes. The fix was checked in earlier today, so I expect it to turn up there shortly. Thanks.</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <commentid>77981</commentid>
            <who name="Ragesh Nair">Ragesh.X.Nair</who>
            <bug_when>2010-09-29 01:26:59 +0000</bug_when>
            <thetext>I have taken the latest search.jsp yesterday and updated my source.war(s) but today I can see there are around 250 cfs files opened all of spellIndex.

I just used the download option in OpenGrok http://src.opensolaris.org/source/raw/opengrok/trunk/web/search.jsp and created the new war and deployed. Do I have to do anything more to apply the patch? Or is it the opengrok site still dont have the fix ?? From history I cant see any references to BUG 17127 or Bug 17130.</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <commentid>77985</commentid>
            <who name="Trond Norbye">trond.norbye</who>
            <bug_when>2010-09-29 06:42:13 +0000</bug_when>
            <thetext>I guess http://src.opensolaris.org/source isn&apos;t updated. I just looked at my personal OpenGrok server, and it&apos;s there:

http://source.norbye.org/source/history/opengrok/web/search.jsp

Your installation method is good.</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <commentid>77989</commentid>
            <who name="Knut Anders Hatlen">knut.hatlen</who>
            <bug_when>2010-09-29 07:47:08 +0000</bug_when>
            <thetext>Just for the record, http://src.opensolaris.org/source is not our source repository. The official way to get the latest sources is:

hg clone ssh://anon@hg.opensolaris.org/hg/opengrok/trunk

The changes will be visible there immediately after check-in.</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <commentid>77990</commentid>
            <who name="Ragesh Nair">Ragesh.X.Nair</who>
            <bug_when>2010-09-29 08:13:42 +0000</bug_when>
            <thetext>Thanks alot Trond and Anders!!! I hope I got the fix now. Yeah now I know the official way also but too lazy to try out as I suspect it wont be that easy as download from OpenGrok ;-)

I now applied the patch and restarted my server. So I have a 0 count for cfs and cfx files in lsof now. I will update tomorrow how it went on a day&apos;s run ....</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <commentid>78019</commentid>
            <who name="Ragesh Nair">Ragesh.X.Nair</who>
            <bug_when>2010-09-30 05:22:55 +0000</bug_when>
            <thetext>Happy to update that after 20+ hrs of run I have 0 count for CFS and CFX and the opened files are also very less.

Tomcat PID = 1361

lsof -p 1361 | wc -l
128

lsof  | grep cfx | wc -l
0

lsof  | grep cfs | wc -l
0

Thanks alot all for providing a quick fix. :-)</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <commentid>78025</commentid>
            <who name="Knut Anders Hatlen">knut.hatlen</who>
            <bug_when>2010-09-30 08:48:24 +0000</bug_when>
            <thetext>Thanks for verifying!

*** This bug has been marked as a duplicate of bug 17127 ***</thetext>
          </long_desc>
      
          <attachment
              isobsolete="0"
              ispatch="0"
              isprivate="0"
              isurl="0"
          >
            <attachid>4314</attachid>
            <date>2010-09-28 13:29:00 +0000</date>
            <delta_ts>2010-09-28 13:29:23 +0000</delta_ts>
            <desc>Delta to 0.9 - correct SpellChecker close()</desc>
            <filename>search.jsp</filename>
            <type>application/octet-stream</type>
            <size>25020</size>
            <attacher>horst.reiterer</attacher>
            
              <data encoding="base64">PCUtLSAKQ0RETCBIRUFERVIgU1RBUlQKClRoZSBjb250ZW50cyBvZiB0aGlzIGZpbGUgYXJlIHN1
YmplY3QgdG8gdGhlIHRlcm1zIG9mIHRoZQpDb21tb24gRGV2ZWxvcG1lbnQgYW5kIERpc3RyaWJ1
dGlvbiBMaWNlbnNlICh0aGUgIkxpY2Vuc2UiKS4gIApZb3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxl
IGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgpTZWUgTElDRU5TRS50eHQg
aW5jbHVkZWQgaW4gdGhpcyBkaXN0cmlidXRpb24gZm9yIHRoZSBzcGVjaWZpYwpsYW5ndWFnZSBn
b3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoK
V2hlbiBkaXN0cmlidXRpbmcgQ292ZXJlZCBDb2RlLCBpbmNsdWRlIHRoaXMgQ0RETCBIRUFERVIg
aW4gZWFjaApmaWxlIGFuZCBpbmNsdWRlIHRoZSBMaWNlbnNlIGZpbGUgYXQgTElDRU5TRS50eHQu
CklmIGFwcGxpY2FibGUsIGFkZCB0aGUgZm9sbG93aW5nIGJlbG93IHRoaXMgQ0RETCBIRUFERVIs
IHdpdGggdGhlCmZpZWxkcyBlbmNsb3NlZCBieSBicmFja2V0cyAiW10iIHJlcGxhY2VkIHdpdGgg
eW91ciBvd24gaWRlbnRpZnlpbmcKaW5mb3JtYXRpb246IFBvcnRpb25zIENvcHlyaWdodCBbeXl5
eV0gW25hbWUgb2YgY29weXJpZ2h0IG93bmVyXQoKQ0RETCBIRUFERVIgRU5ECgpDb3B5cmlnaHQg
MjAxMCBTdW4gTWljcm9zeXN0ZW1zLCBJbmMuICBBbGwgcmlnaHRzIHJlc2VydmVkLgpVc2UgaXMg
c3ViamVjdCB0byBsaWNlbnNlIHRlcm1zLgoKLS0lPjwlQCBwYWdlIGltcG9ydCA9ICJqYXZheC5z
ZXJ2bGV0LiosCmphdmEubGFuZy5JbnRlZ2VyLApqYXZheC5zZXJ2bGV0Lmh0dHAuKiwKamF2YS51
dGlsLkhhc2h0YWJsZSwKamF2YS51dGlsLlZlY3RvciwKamF2YS51dGlsLkRhdGUsCmphdmEudXRp
bC5BcnJheUxpc3QsCmphdmEudXRpbC5MaXN0LApqYXZhLmxhbmcuKiwKamF2YS5pby4qLApqYXZh
LmlvLlN0cmluZ1JlYWRlciwKb3JnLm9wZW5zb2xhcmlzLm9wZW5ncm9rLmFuYWx5c2lzLiosCm9y
Zy5vcGVuc29sYXJpcy5vcGVuZ3Jvay5pbmRleC5JbmRleERhdGFiYXNlLApvcmcub3BlbnNvbGFy
aXMub3Blbmdyb2suc2VhcmNoLiosCm9yZy5vcGVuc29sYXJpcy5vcGVuZ3Jvay53ZWIuKiwKb3Jn
Lm9wZW5zb2xhcmlzLm9wZW5ncm9rLnNlYXJjaC5jb250ZXh0LiosCm9yZy5vcGVuc29sYXJpcy5v
cGVuZ3Jvay5jb25maWd1cmF0aW9uLiosCm9yZy5hcGFjaGUubHVjZW5lLnNlYXJjaC5zcGVsbC5M
dWNlbmVEaWN0aW9uYXJ5LApvcmcuYXBhY2hlLmx1Y2VuZS5zZWFyY2guc3BlbGwuU3BlbGxDaGVj
a2VyLApvcmcuYXBhY2hlLmx1Y2VuZS5zZWFyY2guU29ydEZpZWxkLApvcmcuYXBhY2hlLmx1Y2Vu
ZS5zZWFyY2guVG9wU2NvcmVEb2NDb2xsZWN0b3IsCm9yZy5hcGFjaGUubHVjZW5lLnN0b3JlLkZT
RGlyZWN0b3J5LApvcmcuYXBhY2hlLmx1Y2VuZS5hbmFseXNpcy4qLApvcmcuYXBhY2hlLmx1Y2Vu
ZS5kb2N1bWVudC4qLApvcmcuYXBhY2hlLmx1Y2VuZS5pbmRleC4qLApvcmcuYXBhY2hlLmx1Y2Vu
ZS5zZWFyY2guKiwKb3JnLmFwYWNoZS5sdWNlbmUucXVlcnlQYXJzZXIuKiIKJT48JUAgcGFnZSBz
ZXNzaW9uPSJmYWxzZSIgJT48JUAgcGFnZSBlcnJvclBhZ2U9ImVycm9yLmpzcCIgJT48JQpEYXRl
IHN0YXJ0dGltZSA9IG5ldyBEYXRlKCk7ClN0cmluZyBxICAgID0gcmVxdWVzdC5nZXRQYXJhbWV0
ZXIoInEiKTsKU3RyaW5nIGRlZnMgPSByZXF1ZXN0LmdldFBhcmFtZXRlcigiZGVmcyIpOwpTdHJp
bmcgcmVmcyA9IHJlcXVlc3QuZ2V0UGFyYW1ldGVyKCJyZWZzIik7ClN0cmluZyBoaXN0ID0gcmVx
dWVzdC5nZXRQYXJhbWV0ZXIoImhpc3QiKTsKU3RyaW5nIHBhdGggPSByZXF1ZXN0LmdldFBhcmFt
ZXRlcigicGF0aCIpOwoKJT48JUAgaW5jbHVkZSBmaWxlPSJwcm9qZWN0cy5qc3BmIiAlPjwlClN0
cmluZyBzb3J0ID0gbnVsbDsKCmZpbmFsIFN0cmluZyBMQVNUTU9EVElNRSA9ICJsYXN0bW9kdGlt
ZSI7CmZpbmFsIFN0cmluZyBSRUxFVkFOQ1kgPSAicmVsZXZhbmN5IjsKZmluYWwgU3RyaW5nIEJZ
X1BBVEggPSAiZnVsbHBhdGgiOwpmaW5hbCBTb3J0RmllbGQgU19CWV9QQVRIID0gbmV3IFNvcnRG
aWVsZChCWV9QQVRILFNvcnRGaWVsZC5TVFJJTkcpOwoKQ29va2llW10gY29va2llcyA9IHJlcXVl
c3QuZ2V0Q29va2llcygpOwppZiAoY29va2llcyAhPSBudWxsKSB7CiAgICBmb3IgKENvb2tpZSBj
b29raWUgOiBjb29raWVzKSB7CiAgICAgICAgaWYgKGNvb2tpZS5nZXROYW1lKCkuZXF1YWxzKCJP
cGVuR3Jvay9zb3J0aW5nIikpIHsKICAgICAgICAgICAgc29ydCA9IGNvb2tpZS5nZXRWYWx1ZSgp
OwogICAgICAgICAgICBpZiAoIUxBU1RNT0RUSU1FLmVxdWFscyhzb3J0KSAmJiAhUkVMRVZBTkNZ
LmVxdWFscyhzb3J0KSAmJiAhQllfUEFUSC5lcXVhbHMoc29ydCkpIHsKICAgICAgICAgICAgICAg
IHNvcnQgPSBSRUxFVkFOQ1k7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYnJlYWs7CiAgICAg
ICAgfQogICAgfQp9CgpTdHJpbmcgc29ydFBhcmFtID0gcmVxdWVzdC5nZXRQYXJhbWV0ZXIoInNv
cnQiKTsKaWYgKHNvcnRQYXJhbSAhPSBudWxsKSB7CiAgICBpZiAoTEFTVE1PRFRJTUUuZXF1YWxz
KHNvcnRQYXJhbSkpIHsKICAgICAgICBzb3J0ID0gTEFTVE1PRFRJTUU7CiAgICB9IGVsc2UgaWYg
KFJFTEVWQU5DWS5lcXVhbHMoc29ydFBhcmFtKSkgewogICAgICAgIHNvcnQgPSBSRUxFVkFOQ1k7
CiAgICB9IGVsc2UgaWYgKEJZX1BBVEguZXF1YWxzKHNvcnRQYXJhbSkpIHsKICAgICAgICBzb3J0
ID0gQllfUEFUSDsKICAgIH0KICAgIGlmIChzb3J0ICE9IG51bGwpIHsKICAgICAgICBDb29raWUg
Y29va2llID0gbmV3IENvb2tpZSgiT3Blbkdyb2svc29ydGluZyIsIHNvcnQpOwogICAgICAgIHJl
c3BvbnNlLmFkZENvb2tpZShjb29raWUpOwogICAgfQp9IGVsc2UgeyBzb3J0ID0gUkVMRVZBTkNZ
OyB9CgovL0xpc3Q8b3JnLmFwYWNoZS5sdWNlbmUuZG9jdW1lbnQuRG9jdW1lbnQ+IGRvY3M9bmV3
IEFycmF5TGlzdDxvcmcuYXBhY2hlLmx1Y2VuZS5kb2N1bWVudC5Eb2N1bWVudD4oKTsKU3RyaW5n
IGVycm9yTXNnID0gbnVsbDsKCmlmKCBxIT0gbnVsbCAmJiBxLmVxdWFscygiIikpIHEgPSBudWxs
OwppZiggZGVmcyAhPSBudWxsICYmIGRlZnMuZXF1YWxzKCIiKSkgZGVmcyA9IG51bGw7CmlmKCBy
ZWZzICE9IG51bGwgJiYgcmVmcy5lcXVhbHMoIiIpKSByZWZzID0gbnVsbDsKaWYoIGhpc3QgIT0g
bnVsbCAmJiBoaXN0LmVxdWFscygiIikpIGhpc3QgPSBudWxsOwppZiggcGF0aCAhPSBudWxsICYm
IHBhdGguZXF1YWxzKCIiKSkgcGF0aCA9IG51bGw7CmlmIChwcm9qZWN0ICE9IG51bGwgJiYgcHJv
amVjdC5zaXplKCk8MSkgcHJvamVjdCA9IG51bGw7CgppZiAocSAhPSBudWxsIHx8IGRlZnMgIT0g
bnVsbCB8fCByZWZzICE9IG51bGwgfHwgaGlzdCAhPSBudWxsIHx8IHBhdGggIT0gbnVsbCkgewog
ICAgU2VhcmNoZXIgc2VhcmNoZXIgPSBudWxsOwkJICAgIC8vdGhlIHNlYXJjaGVyIHVzZWQgdG8g
b3Blbi9zZWFyY2ggdGhlIGluZGV4CiAgICBUb3BTY29yZURvY0NvbGxlY3RvciBjb2xsZWN0b3I9
bnVsbDsgICAgICAgICAvLyB0aGUgY29sbGVjdG9yIHVzZWQKICAgIFNjb3JlRG9jW10gaGl0cyA9
IG51bGw7ICAgICAgICAgICAgICAgICAvLyBsaXN0IG9mIGRvY3VtZW50cyB3aGljaCByZXN1bHQg
ZnJvbSB0aGUgcXVlcnkKICAgIEluZGV4UmVhZGVyIGlyZWFkZXIgPSBudWxsOyAJICAgIC8vdGhl
IHJlYWRlciB1c2VkIHRvIG9wZW4vc2VhcmNoIHRoZSBpbmRleAogICAgUXVlcnkgcXVlcnkgPSBu
dWxsOyAgICAgICAgIC8vdGhlIFF1ZXJ5IGNyZWF0ZWQgYnkgdGhlIFF1ZXJ5QnVpbGRlcgogICAg
Ym9vbGVhbiBhbGxDb2xsZWN0ZWQ9ZmFsc2U7CiAgICBpbnQgdG90YWxIaXRzPTA7CiAgICAKICAg
IGludCBzdGFydCA9IDA7CQkgICAgICAgLy90aGUgZmlyc3QgaW5kZXggZGlzcGxheWVkIG9uIHRo
aXMgcGFnZQogICAgLy9UT0RPIGRlcHJlY2F0ZSBtYXggdGhpcyBhbmQgbWVyZ2Ugd2l0aCBwYWdp
bmcgYW5kIHBhcmFtIG4gLSBURVNUIG5lZWRlZAogICAgLy9pbnQgbWF4ICAgID0gMjU7CQkJLy90
aGUgbWF4aW11bSBpdGVtcyBkaXNwbGF5ZWQgb24gdGhpcyBwYWdlCiAgICBpbnQgbWF4PVJ1bnRp
bWVFbnZpcm9ubWVudC5nZXRJbnN0YW5jZSgpLmdldEhpdHNQZXJQYWdlKCk7CgogICAgaW50IGhp
dHNQZXJQYWdlID0gUnVudGltZUVudmlyb25tZW50LmdldEluc3RhbmNlKCkuZ2V0SGl0c1BlclBh
Z2UoKTsKICAgIGludCBjYWNoZVBhZ2VzPSBSdW50aW1lRW52aXJvbm1lbnQuZ2V0SW5zdGFuY2Uo
KS5nZXRDYWNoZVBhZ2VzKCk7CiAgICBmaW5hbCBib29sZWFuIGRvY3NTY29yZWRJbk9yZGVyPWZh
bHNlOwoKICAgIGludCB0aGlzcGFnZSA9IDA7CQkJICAgIC8vdXNlZCBmb3IgdGhlIGZvci9uZXh0
IGVpdGhlciBtYXggb3IKCiAgICBRdWVyeUJ1aWxkZXIgcXVlcnlCdWlsZGVyID0KICAgICAgICAg
ICAgbmV3IFF1ZXJ5QnVpbGRlcigpCiAgICAgICAgICAgIC5zZXRGcmVldGV4dChxKS5zZXREZWZz
KGRlZnMpLnNldFJlZnMocmVmcykKICAgICAgICAgICAgLnNldFBhdGgocGF0aCkuc2V0SGlzdCho
aXN0KTsKCiAgICB0cnkgewogICAgICAgIFN0cmluZyBEQVRBX1JPT1QgPSBlbnYuZ2V0RGF0YVJv
b3RQYXRoKCk7CiAgICAgICAgaWYoREFUQV9ST09ULmVxdWFscygiIikpIHsKICAgICAgICAgICAg
dGhyb3cgbmV3IEV4Y2VwdGlvbigiREFUQV9ST09UIHBhcmFtZXRlciBpcyBub3QgY29uZmlndXJl
ZCBpbiB3ZWIueG1sISIpOwogICAgICAgIH0KICAgICAgICBGaWxlIGRhdGFfcm9vdCA9IG5ldyBG
aWxlKERBVEFfUk9PVCk7CiAgICAgICAgaWYoIWRhdGFfcm9vdC5pc0RpcmVjdG9yeSgpKSB7CiAg
ICAgICAgICAgIHRocm93IG5ldyBFeGNlcHRpb24oIkRBVEFfUk9PVCBwYXJhbWV0ZXIgaW4gd2Vi
LnhtbCBkb2VzIG5vdCBleGlzdCBvciBpcyBub3QgYSBkaXJlY3RvcnkhIik7CiAgICAgICAgfQog
ICAgICAgIC8vU3RyaW5nIGRhdGUgPSByZXF1ZXN0LmdldFBhcmFtZXRlcigiZGF0ZSIpOwogICAg
ICAgIHRyeSB7CiAgICAgICAgICAgIC8vVE9ETyBtZXJnZSBwYWdpbmcgaGl0c1BlclBhZ2Ugd2l0
aCBwYXJhbWV0ZXIgbiAoaGFzIHRvIHJlZmxlY3QgdGhlIHNlYXJjaCBpZiBjaGFuZ2VkIHNvIHBy
b3BlciBudW1iZXIgaXMgY2FjaGVkIGZpcnN0IHRpbWUpCiAgICAgICAgICAgIHN0YXJ0ID0gSW50
ZWdlci5wYXJzZUludChyZXF1ZXN0LmdldFBhcmFtZXRlcigic3RhcnQiKSk7CS8vcGFyc2UgdGhl
IG1heCByZXN1bHRzIGZpcnN0CiAgICAgICAgICAgIG1heCA9IEludGVnZXIucGFyc2VJbnQocmVx
dWVzdC5nZXRQYXJhbWV0ZXIoIm4iKSk7ICAgICAgLy90aGVuIHRoZSBzdGFydCBpbmRleAogICAg
ICAgICAgICBpZihtYXggPCAwIHx8IChtYXggJSAxMCAhPSAwKSB8fCBtYXggPiA1MCkgbWF4ID0g
MjU7CiAgICAgICAgICAgIGlmKHN0YXJ0IDwgMCApIHN0YXJ0ID0gMDsKICAgICAgICB9IGNhdGNo
IChFeGNlcHRpb24gZSkgeyAgfQoKICAgICAgICBxdWVyeSA9IHF1ZXJ5QnVpbGRlci5idWlsZCgp
OwogICAgICAgIAogICAgICAgIEZpbGUgcm9vdCA9IG5ldyBGaWxlKFJ1bnRpbWVFbnZpcm9ubWVu
dC5nZXRJbnN0YW5jZSgpLmdldERhdGFSb290RmlsZSgpLAogICAgICAgICAgICAgICAgImluZGV4
Iik7CgogICAgICAgIGlmIChSdW50aW1lRW52aXJvbm1lbnQuZ2V0SW5zdGFuY2UoKS5oYXNQcm9q
ZWN0cygpKSB7CiAgICAgICAgICAgIGlmIChwcm9qZWN0ID09IG51bGwpIHsKICAgICAgICAgICAg
ICAgIGVycm9yTXNnID0gIjxiPkVycm9yOjwvYj4gWW91IG11c3Qgc2VsZWN0IGEgcHJvamVjdCEi
OwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgaWYgKHByb2plY3Quc2l6ZSgp
ID4gMSkgeyAvL21vcmUgcHJvamVjdHMKICAgICAgICAgICAgICAgICAgICBJbmRleFNlYXJjaGVy
W10gc2VhcmNoYWJsZXMgPSBuZXcgSW5kZXhTZWFyY2hlcltwcm9qZWN0LnNpemUoKV07CiAgICAg
ICAgICAgICAgICAgICAgRmlsZSBkcm9vdCA9IG5ldyBGaWxlKFJ1bnRpbWVFbnZpcm9ubWVudC5n
ZXRJbnN0YW5jZSgpLmdldERhdGFSb290RmlsZSgpLCAiaW5kZXgiKTsKICAgICAgICAgICAgICAg
ICAgICBpbnQgaWkgPSAwOwogICAgICAgICAgICAgICAgICAgIC8vVE9ETyBtaWdodCBuZWVkIHRv
IHJld3JpdGUgdG8gUHJvamVjdCBpbnN0ZWFkIG9mIFN0cmluZyAsIG5lZWQgY2hhbmdlcyBpbiBw
cm9qZWN0cy5qc3BmIHRvbwogICAgICAgICAgICAgICAgICAgIGZvciAoU3RyaW5nIHByb2ogOiBw
cm9qZWN0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlyZWFkZXIgPSAoSW5kZXhSZWFkZXIu
b3BlbihGU0RpcmVjdG9yeS5vcGVuKG5ldyBGaWxlKGRyb290LCBwcm9qKSksdHJ1ZSkpOwogICAg
ICAgICAgICAgICAgICAgICAgICBzZWFyY2hhYmxlc1tpaSsrXSA9IG5ldyBJbmRleFNlYXJjaGVy
KGlyZWFkZXIpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAo
UnVudGltZS5nZXRSdW50aW1lKCkuYXZhaWxhYmxlUHJvY2Vzc29ycygpID4gMSkgewogICAgICAg
ICAgICAgICAgICAgICAgICBzZWFyY2hlciA9IG5ldyBQYXJhbGxlbE11bHRpU2VhcmNoZXIoc2Vh
cmNoYWJsZXMpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAg
ICAgICAgIHNlYXJjaGVyID0gbmV3IE11bHRpU2VhcmNoZXIoc2VhcmNoYWJsZXMpOwogICAgICAg
ICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSB7IC8vIGp1c3QgMSBwcm9qZWN0
IHNlbGVjdGVkCiAgICAgICAgICAgICAgICAgICAgcm9vdCA9IG5ldyBGaWxlKHJvb3QsIHByb2pl
Y3QuZ2V0KDApKTsKICAgICAgICAgICAgICAgICAgICBpcmVhZGVyID0gSW5kZXhSZWFkZXIub3Bl
bihGU0RpcmVjdG9yeS5vcGVuKHJvb3QpLHRydWUpOwogICAgICAgICAgICAgICAgICAgIHNlYXJj
aGVyID0gbmV3IEluZGV4U2VhcmNoZXIoaXJlYWRlcik7CiAgICAgICAgICAgICAgICB9CiAgICAg
ICAgICAgIH0KICAgICAgICB9IGVsc2UgeyAvL25vIHByb2plY3Qgc2V0dXAKICAgICAgICAgICAg
aXJlYWRlciA9IEluZGV4UmVhZGVyLm9wZW4oRlNEaXJlY3Rvcnkub3Blbihyb290KSx0cnVlKTsK
ICAgICAgICAgICAgc2VhcmNoZXIgPSBuZXcgSW5kZXhTZWFyY2hlcihpcmVhZGVyKTsKICAgICAg
ICAgICAgfQoKICAgICAgICAvL1RPRE8gY2hlY2sgaWYgYmVsb3cgaXMgc29tZWhvdyByZXVzaW5n
IHNlc3Npb25zIHNvIHdlIGRvbid0IHJlcXVlcnkgYWdhaW4gYW5kIGFnYWluLCBJIGd1ZXNzIDJt
aW4gdGltZW91dCBzZXNzaW9ucyBjb3VsZCBiZSB1c2VmdWxsLCBzaW5jZSB5b3UgY2xpY2sgb24g
dGhlIG5leHQgcGFnZSB3aXRoaW4gMm1pbnMsIGlmIG5vdCwgdGhlbiB3YWl0IDspCiAgICAgICAg
aWYgKGVycm9yTXNnID09IG51bGwpIHsgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAg
ICAgY29sbGVjdG9yID0gVG9wU2NvcmVEb2NDb2xsZWN0b3IuY3JlYXRlKGhpdHNQZXJQYWdlKmNh
Y2hlUGFnZXMsZG9jc1Njb3JlZEluT3JkZXIpOwogICAgICAgICAgICBpZiAoTEFTVE1PRFRJTUUu
ZXF1YWxzKHNvcnQpKSB7CiAgICAgICAgICAgICAgICBTb3J0IHNvcnRmID0gbmV3IFNvcnQobmV3
IFNvcnRGaWVsZCgiZGF0ZSIsU29ydEZpZWxkLlNUUklORyx0cnVlKSk7CiAgICAgICAgICAgICAg
ICBUb3BGaWVsZERvY3MgZmRvY3M9c2VhcmNoZXIuc2VhcmNoKHF1ZXJ5LCBudWxsLGhpdHNQZXJQ
YWdlKmNhY2hlUGFnZXMsIHNvcnRmKTsKICAgICAgICAgICAgICAgIHRvdGFsSGl0cz1mZG9jcy50
b3RhbEhpdHM7CiAgICAgICAgICAgICAgICBpZiAoc3RhcnQ+PWhpdHNQZXJQYWdlKmNhY2hlUGFn
ZXMgJiYgIWFsbENvbGxlY3RlZCkgeyAvL2ZldGNoIEFMTCByZXN1bHRzIG9ubHkgaWYgYWJvdmUg
Y2FjaGVQYWdlcwogICAgICAgICAgICAgICAgIGZkb2NzPXNlYXJjaGVyLnNlYXJjaChxdWVyeSwg
bnVsbCwgdG90YWxIaXRzLCBzb3J0Zik7CiAgICAgICAgICAgICAgICAgYWxsQ29sbGVjdGVkPXRy
dWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBoaXRzID0gZmRvY3Muc2NvcmVE
b2NzOyAKICAgICAgICAgICAgfSBlbHNlIGlmIChCWV9QQVRILmVxdWFscyhzb3J0KSkgewogICAg
ICAgICAgICAgICAgU29ydCBzb3J0ZiA9IG5ldyBTb3J0KFNfQllfUEFUSCk7CiAgICAgICAgICAg
ICAgICBUb3BGaWVsZERvY3MgZmRvY3M9c2VhcmNoZXIuc2VhcmNoKHF1ZXJ5LCBudWxsLGhpdHNQ
ZXJQYWdlKmNhY2hlUGFnZXMsIHNvcnRmKTsKICAgICAgICAgICAgICAgIHRvdGFsSGl0cz1mZG9j
cy50b3RhbEhpdHM7CiAgICAgICAgICAgICAgICBpZiAoc3RhcnQ+PWhpdHNQZXJQYWdlKmNhY2hl
UGFnZXMgJiYgIWFsbENvbGxlY3RlZCkgeyAvL2ZldGNoIEFMTCByZXN1bHRzIG9ubHkgaWYgYWJv
dmUgY2FjaGVQYWdlcwogICAgICAgICAgICAgICAgIGZkb2NzPXNlYXJjaGVyLnNlYXJjaChxdWVy
eSwgbnVsbCx0b3RhbEhpdHMsIHNvcnRmKTsKICAgICAgICAgICAgICAgICBhbGxDb2xsZWN0ZWQ9
dHJ1ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGhpdHMgPSBmZG9jcy5zY29y
ZURvY3M7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBzZWFyY2hlci5zZWFy
Y2gocXVlcnksY29sbGVjdG9yKTsKICAgICAgICAgICAgICAgIHRvdGFsSGl0cz1jb2xsZWN0b3Iu
Z2V0VG90YWxIaXRzKCk7CiAgICAgICAgICAgICAgICBpZiAoc3RhcnQ+PWhpdHNQZXJQYWdlKmNh
Y2hlUGFnZXMgJiYgIWFsbENvbGxlY3RlZCkgeyAvL2ZldGNoIEFMTCByZXN1bHRzIG9ubHkgaWYg
YWJvdmUgY2FjaGVQYWdlcwogICAgICAgICAgICAgICAgIGNvbGxlY3RvciA9IFRvcFNjb3JlRG9j
Q29sbGVjdG9yLmNyZWF0ZSh0b3RhbEhpdHMsZG9jc1Njb3JlZEluT3JkZXIpOwogICAgICAgICAg
ICAgICAgIHNlYXJjaGVyLnNlYXJjaChxdWVyeSxjb2xsZWN0b3IpOwogICAgICAgICAgICAgICAg
IGFsbENvbGxlY3RlZD10cnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaGl0
cz1jb2xsZWN0b3IudG9wRG9jcygpLnNjb3JlRG9jczsKICAgICAgICAgICAgfQoKICAgICAgICAg
ICAgLy9iZWxvdyB3aWxsIGdldCBhbGwgdGhlIGRvY3VtZW50cwovLyAgICAgICAgICAgIGZvciAo
aW50IGkgPSAwOyBpIDwgaGl0cy5sZW5ndGg7IGkrKykgewovLyAgICAgICAgICAgICAgaW50IGRv
Y0lkID0gaGl0c1tpXS5kb2M7Ci8vICAgICAgICAgICAgICBEb2N1bWVudCBkID0gc2VhcmNoZXIu
ZG9jKGRvY0lkKTsKLy8gICAgICAgICAgICAgIGRvY3MuYWRkKGQpOwovLyAgICAgICAgICAgIH0K
CiAgICAgICAgfQogICAgICAgIHRoaXNwYWdlID0gbWF4OwogICAgfSBjYXRjaCAoQm9vbGVhblF1
ZXJ5LlRvb01hbnlDbGF1c2VzIGUpIHsKICAgICAgICBlcnJvck1zZyA9ICI8Yj5FcnJvcjo8L2I+
IFRvbyBtYW55IHJlc3VsdHMgZm9yIHdpbGRjYXJkISI7CiAgICB9IGNhdGNoIChQYXJzZUV4Y2Vw
dGlvbiBlKSB7CiAgICAgICAgZXJyb3JNc2cgPSAiPGI+RXJyb3IgcGFyc2luZyB5b3VyIHF1ZXJ5
PC9iPiIgKwogICAgICAgICAgICAgICAgIjxwLz5Zb3UgbWlnaHQgdHJ5IHRvIGVuY2xvc2UgeW91
ciBzZWFyY2ggdGVybSBpbiBxdW90ZXMsICIgKwogICAgICAgICAgICAgICAgIjxhIGhyZWY9XCJo
ZWxwLmpzcCNlc2NhcGluZ1wiPmVzY2FwZSBzcGVjaWFsIGNoYXJhY3RlcnM8L2E+ICIgKwogICAg
ICAgICAgICAgICAgIndpdGggPGI+XFw8L2I+LCBvciByZWFkIHRoZSA8YSBocmVmPVwiaGVscC5q
c3BcIj5IZWxwPC9hPiAiICsKICAgICAgICAgICAgICAgICJvbiB0aGUgcXVlcnkgbGFuZ3VhZ2Uu
PHAvPiIgKwogICAgICAgICAgICAgICAgIkVycm9yIG1lc3NhZ2UgZnJvbSBwYXJzZXI6PGJyLz4i
ICsgVXRpbC5odG1saXplKGUuZ2V0TWVzc2FnZSgpKTsKICAgIH0gY2F0Y2ggKEZpbGVOb3RGb3Vu
ZEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgZXJyb3JNc2cgPSAiPGI+RXJyb3I6PC9iPiBJbmRleCBk
YXRhYmFzZSBub3QgZm91bmQiOwogICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICBl
cnJvck1zZyA9ICI8Yj5FcnJvcjo8L2I+ICIgKyBVdGlsLmh0bWxpemUoZS5nZXRNZXNzYWdlKCkp
OwogICAgfQoKICAgIC8vIEJ1ZyAjMzkwMDogQ2hlY2sgaWYgdGhpcyBpcyBhIHNlYXJjaCBmb3Ig
YSBzaW5nbGUgdGVybSwgYW5kIHRoYXQgdGVybQogICAgLy8gaXMgYSBkZWZpbml0aW9uLiBJZiB0
aGF0J3MgdGhlIGNhc2UsIGFuZCB3ZSBvbmx5IGhhdmUgb25lIG1hdGNoLCB3ZSdsbAogICAgLy8g
Z2VuZXJhdGUgYSBkaXJlY3QgbGluayBpbnN0ZWFkIG9mIGEgbGlzdGluZy4KICAgIGJvb2xlYW4g
aXNTaW5nbGVEZWZpbml0aW9uU2VhcmNoID0KICAgICAgICAgICAgKHF1ZXJ5IGluc3RhbmNlb2Yg
VGVybVF1ZXJ5KSAmJiAoZGVmcyAhPSBudWxsKTsKCiAgICAvLyBBdHRlbXB0IHRvIGNyZWF0ZSBh
IGRpcmVjdCBsaW5rIHRvIHRoZSBkZWZpbml0aW9uIGlmIHdlIHNlYXJjaCBmb3Igb25lCiAgICAv
LyBzaW5nbGUgZGVmaW5pdGlvbiB0ZXJtIEFORCB3ZSBoYXZlIGV4YWN0bHkgb25lIG1hdGNoIEFO
RCB0aGVyZSBpcyBvbmx5CiAgICAvLyBvbmUgZGVmaW5pdGlvbiBvZiB0aGF0IHN5bWJvbCBpbiB0
aGUgZG9jdW1lbnQgdGhhdCBtYXRjaGVzLgogICAgYm9vbGVhbiB1bmlxdWVEZWZpbml0aW9uID0g
ZmFsc2U7CiAgICBpZiAoaXNTaW5nbGVEZWZpbml0aW9uU2VhcmNoICYmIGhpdHMgIT0gbnVsbCAm
JiBoaXRzLmxlbmd0aCA9PSAxKSB7CiAgICAgICAgRG9jdW1lbnQgZG9jID0gc2VhcmNoZXIuZG9j
KGhpdHNbMF0uZG9jKTsKICAgICAgICBieXRlW10gcmF3VGFncyA9IGRvYy5nZXRGaWVsZGFibGUo
InRhZ3MiKS5nZXRCaW5hcnlWYWx1ZSgpOwogICAgICAgIERlZmluaXRpb25zIHRhZ3MgPSBEZWZp
bml0aW9ucy5kZXNlcmlhbGl6ZShyYXdUYWdzKTsKICAgICAgICBTdHJpbmcgc3ltYm9sID0gKChU
ZXJtUXVlcnkpIHF1ZXJ5KS5nZXRUZXJtKCkudGV4dCgpOwogICAgICAgIGlmICh0YWdzLm9jY3Vy
cmVuY2VzKHN5bWJvbCkgPT0gMSkgewogICAgICAgICAgICB1bmlxdWVEZWZpbml0aW9uID0gdHJ1
ZTsKICAgICAgICB9CiAgICB9CgogICAgLy8gQFRPRE8gZml4IG1lLiBJIHNob3VsZCB0cnkgdG8g
ZmlndXJlIG91dCB3aGVyZSB0aGUgZXhhY3QgaGl0IGlzIGluc3RlYWQKICAgIC8vIG9mIHJldHVy
bmluZyBhIHBhZ2Ugd2l0aCBqdXN0IF9vbmVfIGVudHJ5IGluLi4uLgogICAgaWYgKHVuaXF1ZURl
ZmluaXRpb24gJiYgcmVxdWVzdC5nZXRTZXJ2bGV0UGF0aCgpLmVxdWFscygiL3MiKSkgewogICAg
ICAgIFN0cmluZyBwcmVGcmFnbWVudFBhdGggPSBVdGlsLlVSSUVuY29kZVBhdGgoY29udGV4dCAr
ICIveHJlZiIgKyBzZWFyY2hlci5kb2MoaGl0c1swXS5kb2MpLmdldCgicGF0aCIpKTsKICAgICAg
ICBTdHJpbmcgZnJhZ21lbnQgPSBVdGlsLlVSSUVuY29kZSgoKFRlcm1RdWVyeSlxdWVyeSkuZ2V0
VGVybSgpLnRleHQoKSk7CiAgICAgICAgCiAgICAgICAgU3RyaW5nQnVpbGRlciB1cmwgPSBuZXcg
U3RyaW5nQnVpbGRlcihwcmVGcmFnbWVudFBhdGgpOwogICAgICAgIHVybC5hcHBlbmQoIiMiKTsK
ICAgICAgICB1cmwuYXBwZW5kKGZyYWdtZW50KTsKCiAgICAgICAgcmVzcG9uc2Uuc2VuZFJlZGly
ZWN0KHVybC50b1N0cmluZygpKTsKICAgIH0gZWxzZSB7CiAgICAgICAgIFN0cmluZyBwYWdlVGl0
bGUgPSAiU2VhcmNoIjsKICAgICAgICAgUnVudGltZUVudmlyb25tZW50IGVudmlyb25tZW50ID0g
UnVudGltZUVudmlyb25tZW50LmdldEluc3RhbmNlKCk7CiAgICAgICAgIGVudmlyb25tZW50LnJl
Z2lzdGVyKCk7CgkgICAgJT48JUAgaW5jbHVkZSBmaWxlPSJodHRwaGVhZGVyLmpzcGYiICU+Cjxi
b2R5Pgo8ZGl2IGlkPSJwYWdlIj4KICAgIDxkaXYgaWQ9ImhlYWRlciI+PCVAIGluY2x1ZGUgZmls
ZT0icGFnZWhlYWRlci5qc3BmIiAlPjwvZGl2Pgo8ZGl2IGlkPSJNYXN0aGVhZCI+PC9kaXY+Cjxk
aXYgaWQ9ImJhciI+CiAgICA8dGFibGUgYm9yZGVyPSIwIiB3aWR0aD0iMTAwJSI+PHRyPjx0ZD48
YSBocmVmPSI8JT1jb250ZXh0JT4iIGlkPSJob21lIj5Ib21lPC9hPjwvdGQ+PHRkIGFsaWduPSJy
aWdodCI+PCUKICAgICB7CiAgICAgICAgU3RyaW5nIHVybCA9ICJzZWFyY2g/IjsKICAgICAgICAg
ICAgICAgIHVybCA9IHVybCArIChxID09IG51bGwgPyAiIiA6ICImYW1wO3E9IiArIFV0aWwuVVJJ
RW5jb2RlKHEpKSArCiAgICAgICAgICAgICAgICAgKGRlZnMgPT0gbnVsbCA/ICIiIDogIiZhbXA7
ZGVmcz0iICsgVXRpbC5VUklFbmNvZGUoZGVmcykpICsKICAgICAgICAgICAgICAgICAocmVmcyA9
PSBudWxsID8gIiIgOiAiJmFtcDtyZWZzPSIgKyBVdGlsLlVSSUVuY29kZShyZWZzKSkgKwogICAg
ICAgICAgICAgICAgIChwYXRoID09IG51bGwgPyAiIiA6ICImYW1wO3BhdGg9IiArIFV0aWwuVVJJ
RW5jb2RlKHBhdGgpKSArCiAgICAgICAgICAgICAgICAgKGhpc3QgPT0gbnVsbCA/ICIiIDogIiZh
bXA7aGlzdD0iICsgVXRpbC5VUklFbmNvZGUoaGlzdCkpOwogICAgICAgICBpZiAoaGFzUHJvamVj
dHMpIHsKICAgICAgICAgICAgIGlmIChwcm9qZWN0IT1udWxsKSB7CiAgICAgICAgICAgICAgdXJs
ID0gdXJsICsgIiZhbXA7cHJvamVjdD0iOwogICAgICAgICAgICAgIGZvciAoSXRlcmF0b3IgaXQg
PSBwcm9qZWN0Lml0ZXJhdG9yKCk7IGl0Lmhhc05leHQoKTspIHsKICAgICAgICAgICAgICAgICAg
dXJsID0gdXJsICsgKHByb2plY3QgPT0gbnVsbCA/ICIiIDogVXRpbC5VUklFbmNvZGUoKFN0cmlu
ZykgaXQubmV4dCgpKSArICIsIik7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgfQogICAg
ICAgIH0KICAgICAgICAgCiAgICAgICAgJT5Tb3J0IGJ5OiA8JSAgICAgICAgCiAgICAgICAgdXJs
PXVybCsoIiZhbXA7c29ydD0iKTsKICAgICAgICAKICAgICAgICBpZiAoc29ydCA9PSBudWxsIHx8
IFJFTEVWQU5DWS5lcXVhbHMoc29ydCkpIHsKICAgICAgICAlPjxiPnJlbGV2YW5jZTwvYj4gfCA8
YSBocmVmPSI8JT11cmwrTEFTVE1PRFRJTUUlPiI+bGFzdCBtb2RpZmllZCB0aW1lPC9hPiB8IDxh
IGhyZWY9IjwlPXVybCtCWV9QQVRIJT4iPnBhdGg8L2E+PCUKICAgICAgICB9IGVsc2UgaWYgKExB
U1RNT0RUSU1FLmVxdWFscyhzb3J0KSkgewogICAgICAgICAgICU+PGEgaHJlZj0iPCU9dXJsK1JF
TEVWQU5DWSU+Ij5yZWxldmFuY2U8L2E+IHwgPGI+bGFzdCBtb2RpZmllZCB0aW1lPC9iPiB8IDxh
IGhyZWY9IjwlPXVybCtCWV9QQVRIJT4iPnBhdGg8L2E+PCUKICAgICAgICB9IGVsc2UgaWYgKEJZ
X1BBVEguZXF1YWxzKHNvcnQpKSB7CiAgICAgICAgICAgJT48YSBocmVmPSI8JT11cmwrUkVMRVZB
TkNZJT4iPnJlbGV2YW5jZTwvYT4gfCA8YSBocmVmPSI8JT11cmwrTEFTVE1PRFRJTUUlPiI+bGFz
dCBtb2RpZmllZCB0aW1lPC9hPiB8IDxiPnBhdGg8L2I+PCUKICAgICAgICB9IGVsc2UgewogICAg
ICAgICAgICU+PGEgaHJlZj0iPCU9dXJsK1JFTEVWQU5DWSU+Ij5yZWxldmFuY2U8L2E+IHwgPGEg
aHJlZj0iPCU9dXJsK0xBU1RNT0RUSU1FJT4iPmxhc3QgbW9kaWZpZWQgdGltZTwvYT4gfCA8YSBo
cmVmPSI8JT11cmwrQllfUEFUSCU+Ij5wYXRoPC9hPjwlCiAgICAgICAgfQogICAgICB9ICU+PC90
ZD48L3RyPjwvdGFibGU+CjwvZGl2Pgo8ZGl2IGlkPSJtZW51Ij4KICAgPCVAIGluY2x1ZGUgZmls
ZT0ibWVudS5qc3BmIiU+CjwvZGl2Pgo8ZGl2IGlkPSJyZXN1bHRzIj4KPCUKLy9UT0RPIHNwZWxs
Y2hlY2tpbmcgY3ljbGUgYmVsb3cgaXMgbm90IHRoYXQgZ3JlYXQgYW5kIHdlIG9ubHkgY3JlYXRl
IHN1Z2dlc3QgbGlua3MgZm9yIGV2ZXJ5IHRva2VuIGluIHF1ZXJ5LCBub3QgZm9yIGEgcXVlcnkg
YXMgd2hvbGUKaWYoIGhpdHMgPT0gbnVsbCB8fCBlcnJvck1zZyAhPSBudWxsKSB7CgkgICAgCSU+
PCU9ZXJyb3JNc2clPjwlCiAgICAgICAgICAgIH0gZWxzZSBpZiAoaGl0cy5sZW5ndGggPT0gMCkg
ewogICAgICAgICAgICAgICAgRmlsZSBzcGVsbEluZGV4ID0gbmV3IEZpbGUoZW52LmdldERhdGFS
b290UGF0aCgpLCAic3BlbGxJbmRleCIpOwogICAgICAgICAgICAgICAgRmlsZVtdIHNwZWxsSW5k
ZXhlcz1udWxsOwoKICAgICAgICAgICAgICAgIGlmIChSdW50aW1lRW52aXJvbm1lbnQuZ2V0SW5z
dGFuY2UoKS5oYXNQcm9qZWN0cygpKSB7CiAgICAgICAgICAgICAgICAgaWYgKHByb2plY3Quc2l6
ZSgpID4gMSkgeyAvL21vcmUgcHJvamVjdHMKICAgICAgICAgICAgICAgICAgICBzcGVsbEluZGV4
ZXMgPSBuZXcgRmlsZVtwcm9qZWN0LnNpemUoKV07ICAgICAgICAgICAgICAgICAgICAKICAgICAg
ICAgICAgICAgICAgICBpbnQgaWkgPSAwOwogICAgICAgICAgICAgICAgICAgIC8vVE9ETyBtaWdo
dCBuZWVkIHRvIHJld3JpdGUgdG8gUHJvamVjdCBpbnN0ZWFkIG9mIFN0cmluZyAsIG5lZWQgY2hh
bmdlcyBpbiBwcm9qZWN0cy5qc3BmIHRvbwogICAgICAgICAgICAgICAgICAgIGZvciAoU3RyaW5n
IHByb2ogOiBwcm9qZWN0KSB7ICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAg
ICAgICAgICAgIHNwZWxsSW5kZXhlc1tpaSsrXSA9IG5ldyBGaWxlKHNwZWxsSW5kZXgscHJvaik7
CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgIH0gZWxzZSB7IC8vIGp1c3Qg
MSBwcm9qZWN0IHNlbGVjdGVkCiAgICAgICAgICAgICAgICAgICAgc3BlbGxJbmRleCA9IG5ldyBG
aWxlKHNwZWxsSW5kZXgsIHByb2plY3QuZ2V0KDApKTsgICAgICAgICAgICAgICAgICAgIAogICAg
ICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpbnQgY291
bnQ9MTsKICAgICAgICAgICAgICAgIGlmIChzcGVsbEluZGV4ZXMhPW51bGwpIHtjb3VudD1zcGVs
bEluZGV4ZXMubGVuZ3RoO30gICAgICAgICAgICAgICAgCgogICAgICAgICAgICAgICAgZm9yIChp
bnQgaWR4ID0gMDsgaWR4IDwgY291bnQ7IGlkeCsrKSB7CiAgIAogICAgICAgICAgICAgICAgaWYg
KHNwZWxsSW5kZXhlcyE9bnVsbCkgc3BlbGxJbmRleCA9IHNwZWxsSW5kZXhlc1tpZHhdOwogICAg
ICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgaWYgKHNwZWxsSW5kZXguZXhpc3RzKCkpIHsK
ICAgICAgICAgICAgICAgICAgICBGU0RpcmVjdG9yeSBzcGVsbERpcmVjdG9yeSA9IG51bGw7CiAg
ICAgICAgICAgICAgICAgICAgU3BlbGxDaGVja2VyIGNoZWNrZXIgPSBudWxsOwoKICAgICAgICAg
ICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgc3BlbGxEaXJlY3RvcnkgPSBG
U0RpcmVjdG9yeS5vcGVuKHNwZWxsSW5kZXgpOwogICAgICAgICAgICAgICAgICAgICAgY2hlY2tl
ciA9IG5ldyBTcGVsbENoZWNrZXIoc3BlbGxEaXJlY3RvcnkpOwogICAgICAgICAgICAgICAgICAg
ICAgRGF0ZSBzc3RhcnQgPSBuZXcgRGF0ZSgpOwogICAgICAgICAgICAgICAgICAgICAgYm9vbGVh
biBwcmludEhlYWRlciA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgU3RyaW5nW10g
dG9rczsKICAgICAgICAgICAgICAgICAgICAgICAgICBpZihxICE9IG51bGwpIHsKICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgdG9rcyA9IHEuc3BsaXQoIltcdCBdKyIpOwogICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICBpZih0b2tzICE9IG51bGwpewogICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgZm9yKGludCBqPTA7IGo8dG9rcy5sZW5ndGg7IGorKykgewogICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKHRva3Nbal0ubGVuZ3RoKCkgPiAzKSB7
CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFN0cmluZ1tdIHJldCA9
IGNoZWNrZXIuc3VnZ2VzdFNpbWlsYXIodG9rc1tqXS50b0xvd2VyQ2FzZSgpLCA1KTsKICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yKGludCBpID0gMDtpIDwgcmV0
Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICBpZiAocHJpbnRIZWFkZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAlPjxwPjxmb250IGNvbG9yPSIjY2MwMDAwIj5EaWQgeW91IG1lYW4o
Zm9yIDwlPXNwZWxsSW5kZXguZ2V0TmFtZSgpJT4pPC9mb250Pjo8JQogICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50SGVhZGVyID0gZmFsc2U7CiAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAlPiA8YSBocmVmPXNlYXJjaD9xPTwl
PXJldFtpXSU+PjwlPXJldFtpXSU+PC9hPiAmbmJzcDsgPCUKICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg
ICAgICAgICAgICAgICBpZihyZWZzICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgdG9rcyA9IHJlZnMuc3BsaXQoIltcdCBdKyIpOwogICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBpZih0b2tzICE9IG51bGwpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgZm9yKGludCBqPTA7IGo8dG9rcy5sZW5ndGg7IGorKykgewogICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIGlmKHRva3Nbal0ubGVuZ3RoKCkgPiAzKSB7CiAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFN0cmluZ1tdIHJldCA9IGNoZWNrZXIuc3Vn
Z2VzdFNpbWlsYXIodG9rc1tqXS50b0xvd2VyQ2FzZSgpLCA1KTsKICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgZm9yKGludCBpID0gMDtpIDwgcmV0Lmxlbmd0aDsgaSsr
KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocHJp
bnRIZWFkZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAlPjxwPjxmb250IGNvbG9yPSIjY2MwMDAwIj5EaWQgeW91IG1lYW4oZm9yIDwlPXNwZWxs
SW5kZXguZ2V0TmFtZSgpJT4pPC9mb250Pjo8JQogICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIHByaW50SGVhZGVyID0gZmFsc2U7CiAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICU+IDxhIGhyZWY9c2VhcmNoP3JlZnM9PCU9cmV0W2ldJT4+PCU9
cmV0W2ldJT48L2E+ICZuYnNwOyAgPCUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAg
ICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAg
ICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAvL1RPRE8gaXQgc2VlbXMgdGhlIG9u
bHkgdHJ1ZSBzcGVsbGNoZWNrZXIgaXMgZm9yIGJlbG93IGZpZWxkLCBzZWUgSW5kZXhEYXRhYmFz
ZSBjcmVhdGVzcGVsbGluZ3N1Z2dlc3Rpb25zIC4uLgogICAgICAgICAgICAgICAgICAgICAgICAg
IGlmKGRlZnMgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tzID0g
ZGVmcy5zcGxpdCgiW1x0IF0rIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKHRv
a3MgIT0gbnVsbCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IoaW50IGo9
MDsgajx0b2tzLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgaWYodG9rc1tqXS5sZW5ndGgoKSA+IDMpIHsKICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgU3RyaW5nW10gcmV0ID0gY2hlY2tlci5zdWdnZXN0U2ltaWxhcih0
b2tzW2pdLnRvTG93ZXJDYXNlKCksIDUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICBmb3IoaW50IGkgPSAwO2kgPCByZXQubGVuZ3RoOyBpKyspIHsKICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwcmludEhlYWRlcikgewog
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICU+PHA+PGZv
bnQgY29sb3I9IiNjYzAwMDAiPkRpZCB5b3UgbWVhbihmb3IgPCU9c3BlbGxJbmRleC5nZXROYW1l
KCklPik8L2ZvbnQ+OjwlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgcHJpbnRIZWFkZXIgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgJT4gPGEgaHJlZj1zZWFyY2g/ZGVmcz08JT1yZXRbaV0lPj48JT1yZXRbaV0lPjwvYT4g
Jm5ic3A7ICA8JQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAg
ICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwcmludEhl
YWRlcikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAlPjwvcD48JSAgICAgICAgICAg
ICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg
ICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBmaW5hbGx5IHsKICAgICAgICAgICAgICAgICAg
ICAgIGlmIChjaGVja2VyICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY2hlY2tl
ci5jbG9zZSgpOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAg
aWYgKHNwZWxsRGlyZWN0b3J5ICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgc3Bl
bGxEaXJlY3RvcnkuY2xvc2UoKTsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg
ICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAg
ICAgICAgIAoJCSU+PHA+IFlvdXIgc2VhcmNoICA8Yj48JT1xdWVyeS50b1N0cmluZygpJT48L2I+
IGRpZCBub3QgbWF0Y2ggYW55IGZpbGVzLgogICAgICAgICAgICAgICAgICAgIDxiciAvPgogICAg
ICAgICAgICAgICAgICAgIFN1Z2dlc3Rpb25zOjxici8+PGJsb2NrcXVvdGU+LSBNYWtlIHN1cmUg
YWxsIHRlcm1zIGFyZSBzcGVsbGVkIGNvcnJlY3RseS48YnIvPgogICAgICAgICAgICAgICAgICAg
ICAgICAtIFRyeSBkaWZmZXJlbnQga2V5d29yZHMuPGJyLz4KICAgICAgICAgICAgICAgICAgICAg
ICAgLSBUcnkgbW9yZSBnZW5lcmFsIGtleXdvcmRzLjxici8+CiAgICAgICAgICAgICAgICAgICAg
ICAgIC0gVXNlICd3aWwqJyBjYXJkcyBpZiB5b3UgYXJlIGxvb2tpbmcgZm9yIHBhcnRpYWwgbWF0
Y2guCiAgICAgICAgICAgICAgICAgICAgPC9ibG9ja3F1b3RlPgoJCTwvcD48JQogICAgICAgICAg
ICB9IGVsc2UgeyAvLyBXZSBoYXZlIGEgbG90cyBvZiByZXN1bHRzIHRvIHNob3cKICAgICAgICAg
ICAgICAgIFN0cmluZ0J1aWxkZXIgc2xpZGVyID0gbnVsbDsKICAgICAgICAgICAgICAgIGlmICgg
bWF4IDwgdG90YWxIaXRzKSB7CiAgICAgICAgICAgICAgICAgICAgaWYoKHN0YXJ0ICsgbWF4KSA8
IHRvdGFsSGl0cykgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzcGFnZSA9IG1heDsKICAg
ICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzcGFn
ZSA9IHRvdGFsSGl0cyAtIHN0YXJ0OwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg
ICAgICAgICBTdHJpbmcgdXJscCA9IChxID09IG51bGwgPyAiIiA6ICImYW1wO3E9IiArIFV0aWwu
VVJJRW5jb2RlKHEpKSArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoZGVmcyA9PSBudWxs
ID8gIiIgOiAiJmFtcDtkZWZzPSIgKyBVdGlsLlVSSUVuY29kZShkZWZzKSkgKwogICAgICAgICAg
ICAgICAgICAgICAgICAgICAgKHJlZnMgPT0gbnVsbCA/ICIiIDogIiZhbXA7cmVmcz0iICsgVXRp
bC5VUklFbmNvZGUocmVmcykpICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIChwYXRoID09
IG51bGwgPyAiIiA6ICImYW1wO3BhdGg9IiArIFV0aWwuVVJJRW5jb2RlKHBhdGgpKSArCiAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAoaGlzdCA9PSBudWxsID8gIiIgOiAiJmFtcDtoaXN0PSIg
KyBVdGlsLlVSSUVuY29kZShoaXN0KSkgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgKHNv
cnQgPT0gbnVsbCA/ICIiIDogIiZhbXA7c29ydD0iICsgVXRpbC5VUklFbmNvZGUoc29ydCkpOwog
ICAgICAgICAgICAgICAgICAgIGlmIChoYXNQcm9qZWN0cykgewogICAgICAgICAgICAgICAgICAg
ICAgICB1cmxwID0gdXJscCArICImYW1wO3Byb2plY3Q9IjsKICAgICAgICAgICAgICAgICAgICAg
ICAgZm9yIChJdGVyYXRvciBpdCA9IHByb2plY3QuaXRlcmF0b3IoKTsgaXQuaGFzTmV4dCgpOykg
ewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJscCA9IHVybHAgKyAocHJvamVjdCA9PSBu
dWxsID8gIiIgOiBVdGlsLlVSSUVuY29kZSgoU3RyaW5nKSBpdC5uZXh0KCkpICsgIiwiKTsKICAg
ICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg
ICAgICAgICBzbGlkZXIgPSBuZXcgU3RyaW5nQnVpbGRlcigpOwogICAgICAgICAgICAgICAgICAg
IGludCBsYWJlbFN0YXJ0ID0xOwogICAgICAgICAgICAgICAgICAgIGludCBzc3RhcnQgPSBzdGFy
dCAtIG1heCogKHN0YXJ0IC8gbWF4ICUgMTAgKyAxKSA7CiAgICAgICAgICAgICAgICAgICAgaWYo
c3N0YXJ0IDwgMCkgewogICAgICAgICAgICAgICAgICAgICAgICBzc3RhcnQgPSAwOwogICAgICAg
ICAgICAgICAgICAgICAgICBsYWJlbFN0YXJ0ID0gMTsKICAgICAgICAgICAgICAgICAgICB9IGVs
c2UgewogICAgICAgICAgICAgICAgICAgICAgICBsYWJlbFN0YXJ0ID0gc3N0YXJ0L21heCArIDE7
CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGludCBsYWJlbCA9IGxh
YmVsU3RhcnQ7CiAgICAgICAgICAgICAgICAgICAgaW50IGxhYmVsRW5kID0gbGFiZWwgKyAxMTsK
ICAgICAgICAgICAgICAgICAgICBTdHJpbmcgYXJyOwogICAgICAgICAgICAgICAgICAgIGZvcihp
bnQgaT1zc3RhcnQ7IGk8dG90YWxIaXRzICYmIGxhYmVsIDw9IGxhYmVsRW5kOyBpKz0gbWF4KSB7
CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpIDw9IHN0YXJ0ICYmIHN0YXJ0IDwgaSsgbWF4
KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzbGlkZXIuYXBwZW5kKCI8c3BhbiBjbGFz
cz1cInNlbFwiPiIgKyBsYWJlbCArICI8L3NwYW4+Iik7CiAgICAgICAgICAgICAgICAgICAgICAg
IH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihsYWJlbCA9PSBsYWJlbFN0
YXJ0ICYmIGxhYmVsICE9IDEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcnIg
PSAiJmx0OyZsdCI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYobGFiZWwg
PT0gbGFiZWxFbmQgJiYgaSA8IHRvdGFsSGl0cykgewogICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIGFyciA9ICImZ3Q7Jmd0OyI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVs
c2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyciA9IGxhYmVsIDwgMTAgPyAi
ICIgKyBsYWJlbCA6IFN0cmluZy52YWx1ZU9mKGxhYmVsKTsKICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNsaWRlci5hcHBlbmQoIjxhIGNs
YXNzPVwibW9yZVwiIGhyZWY9XCJzP249IiArIG1heCArICImYW1wO3N0YXJ0PSIgKyBpICsgdXJs
cCArICJcIj4iKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcnIgKyAiPC9h
PiIpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGxh
YmVsKys7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAg
ICAgICAgICAgICAgICAgICB0aGlzcGFnZSA9IHRvdGFsSGl0cyAtIHN0YXJ0OyAgICAgIC8vIHNl
dCB0aGUgbWF4IGluZGV4IHRvIG1heCBvciBsYXN0CiAgICAgICAgICAgICAgICB9CgkJJT4mbmJz
cDsgJm5ic3A7IFNlYXJjaGVkIDxiPjwlPXF1ZXJ5LnRvU3RyaW5nKCklPjwvYj4gKFJlc3VsdHMg
PGI+PCU9c3RhcnQrMSU+IC0KCQk8JT10aGlzcGFnZStzdGFydCU+PC9iPiBvZiA8Yj48JT10b3Rh
bEhpdHMlPjwvYj4pIHNvcnRlZCBieSA8JT1zb3J0JT4gPHA+PCU9c2xpZGVyICE9IG51bGwgPwog
ICAgICAgICAgICAgICAgICAgIHNsaWRlci50b1N0cmluZygpOiAiIiU+PC9wPgoJCTx0YWJsZSB3
aWR0aD0iMTAwJSIgY2VsbHBhZGRpbmc9IjMiIGNlbGxzcGFjaW5nPSIwIiBib3JkZXI9IjAiPjwl
CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIENvbnRleHQgc291cmNlQ29udGV4dCA9
IG51bGw7CiAgICAgICAgICAgICAgICBTdW1tYXJpemVyIHN1bW1lciA9IG51bGw7CiAgICAgICAg
ICAgICAgICBpZiAocXVlcnkgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgIHRyeXsKICAg
ICAgICAgICAgICAgICAgICAgICAgc291cmNlQ29udGV4dCA9CiAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgbmV3IENvbnRleHQocXVlcnksIHF1ZXJ5QnVpbGRlci5nZXRRdWVyaWVzKCkp
OwogICAgICAgICAgICAgICAgICAgICAgICBpZihzb3VyY2VDb250ZXh0ICE9IG51bGwpCiAgICAg
ICAgICAgICAgICAgICAgICAgICAgICBzdW1tZXIgPSBuZXcgU3VtbWFyaXplcihxdWVyeSwKICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBDb21w
YXRpYmxlQW5hbHlzZXIoKSk7CiAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9u
IGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgfQogICAg
ICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBIaXN0b3J5Q29u
dGV4dCBoaXN0b3J5Q29udGV4dCA9IG51bGw7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAg
ICAgICAgICAgICAgIGhpc3RvcnlDb250ZXh0ID0gbmV3IEhpc3RvcnlDb250ZXh0KHF1ZXJ5KTsK
ICAgICAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICB9
CiAgICAgICAgICAgICAgICBFZnRhckZpbGVSZWFkZXIgZWYgPSBudWxsOwogICAgICAgICAgICAg
ICAgdHJ5ewogICAgICAgICAgICAgICAgICAgIGVmID0gbmV3IEVmdGFyRmlsZVJlYWRlcihlbnYu
Z2V0RGF0YVJvb3RQYXRoKCkgKyAiL2luZGV4L2R0YWdzLmVmdGFyIik7CiAgICAgICAgICAgICAg
ICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg
ICAgLy9UT0RPIGFsc28gZml4IHRoZSB3YXkgd2hhdCBhbmQgaG93IGl0IGlzIHBhc3NlZCB0byBw
cmV0dHlwcmludCwgY2FuIGltcHJvdmUgcGVyZm9ybWFuY2UhIFNlYXJjaEVuZ2luZSBpbnRlZ3Jh
dGlvbiBpcyByZWFsbHkgbmVlZGVkIGhlcmUuCiAgICAgICAgICAgICAgICBSZXN1bHRzLnByZXR0
eVByaW50SFRNTChzZWFyY2hlcixoaXRzLCBzdGFydCwgc3RhcnQrdGhpc3BhZ2UsCiAgICAgICAg
ICAgICAgICAgICAgICAgIG91dCwKICAgICAgICAgICAgICAgICAgICAgICAgc291cmNlQ29udGV4
dCwgaGlzdG9yeUNvbnRleHQsIHN1bW1lciwKICAgICAgICAgICAgICAgICAgICAgICAgY29udGV4
dCArICIveHJlZiIsCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRleHQgKyAiL21vcmUiLAog
ICAgICAgICAgICAgICAgICAgICAgICBlbnYuZ2V0U291cmNlUm9vdFBhdGgoKSwKICAgICAgICAg
ICAgICAgICAgICAgICAgZW52LmdldERhdGFSb290UGF0aCgpLAogICAgICAgICAgICAgICAgICAg
ICAgICBlZik7CiAgICAgICAgICAgICAgICBpZihlZiAhPSBudWxsKSB7CiAgICAgICAgICAgICAg
ICAgICAgdHJ5ewogICAgICAgICAgICAgICAgICAgIGVmLmNsb3NlKCk7CiAgICAgICAgICAgICAg
ICAgICAgfSBjYXRjaCAoSU9FeGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAgICAgIH0KICAg
ICAgICAgICAgICAgIH0KCQklPjwvdGFibGU+PGJyLz4KCQk8Yj4gQ29tcGxldGVkIGluIDwlPShu
ZXcgRGF0ZSgpKS5nZXRUaW1lKCkgLSBzdGFydHRpbWUuZ2V0VGltZSgpJT4gbWlsbGlzZWNvbmRz
IDwvYj4gPGJyLz4KCQk8JT1zbGlkZXIgIT0gbnVsbCA/ICI8cD4iICsgc2xpZGVyICsgIjwvcD4i
IDogIiIlPgoJCTwlCiAgICAgICAgICAgIH0KCSAgICAlPjxici8+PC9kaXY+PCVAaW5jbHVkZSBm
aWxlPSJmb290LmpzcGYiJT48JQogICAgfQogICAgaWYgKGlyZWFkZXIgIT0gbnVsbCkKICAgICAg
ICBpcmVhZGVyLmNsb3NlKCk7Cn0gZWxzZSB7IC8vIEVudHJ5IHBhZ2Ugc2hvdyB0aGUgbWFwCiAg
ICByZXNwb25zZS5zZW5kUmVkaXJlY3QoY29udGV4dCArICIvaW5kZXguanNwIik7Cn0KJT4K
</data>

          </attachment>
      

    </bug>

</bugzilla>