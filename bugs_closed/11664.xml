<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "http://defect.opensolaris.org/bz/bugzilla.dtd">

<bugzilla version="3.6.5"
          urlbase="http://defect.opensolaris.org/bz/"
          
          maintainer="website-admin@opensolaris.org"
>

    <bug>
          <bug_id>11664</bug_id>
          
          <creation_ts>2009-10-01 09:55:00 +0000</creation_ts>
          <short_desc>StringIndexOutOfBoundsException in MercurialHistoryParser</short_desc>
          <delta_ts>2010-05-24 23:19:34 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Development</classification>
          <product>opengrok</product>
          <component>scm</component>
          <version>unspecified</version>
          <rep_platform>ANY/Generic</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>FIXED</resolution>
          
          
          
          
          
          <priority>P4</priority>
          <bug_severity>minor</bug_severity>
          <target_milestone>0.8</target_milestone>
          
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Knut Anders Hatlen">knut.hatlen</reporter>
          <assigned_to name="Knut Anders Hatlen">knut.hatlen</assigned_to>
          <cc>patrick.allen.higgins</cc>
          

      

      

      

          <long_desc isprivate="0">
            <commentid>51296</commentid>
            <who name="Knut Anders Hatlen">knut.hatlen</who>
            <bug_when>2009-10-01 09:55:45 +0000</bug_when>
            <thetext>Seen when indexing the repository at http://src.opensolaris.org/source/xref/lld/lld-proto/:

java.lang.StringIndexOutOfBoundsException: String index out of range: -6
        at java.lang.String.substring(String.java:1938)
        at java.lang.String.substring(String.java:1905)
        at org.opensolaris.opengrok.history.MercurialHistoryParser.processStream(MercurialHistoryParser.java:131)
        at org.opensolaris.opengrok.util.Executor.exec(Executor.java:139)
        at org.opensolaris.opengrok.history.MercurialHistoryParser.parse(MercurialHistoryParser.java:74)
        at org.opensolaris.opengrok.history.MercurialRepository.getHistory(MercurialRepository.java:308)
        at org.opensolaris.opengrok.history.Repository.createCache(Repository.java:174)
        at org.opensolaris.opengrok.history.HistoryGuru.createCache(HistoryGuru.java:383)
        at org.opensolaris.opengrok.history.HistoryGuru.access$000(HistoryGuru.java:48)
        at org.opensolaris.opengrok.history.HistoryGuru$1.run(HistoryGuru.java:414)
        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:441)
        at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303)
        at java.util.concurrent.FutureTask.run(FutureTask.java:138)
        at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)
        at java.lang.Thread.run(Thread.java:619)</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <commentid>51337</commentid>
            <who name="Knut Anders Hatlen">knut.hatlen</who>
            <bug_when>2009-10-01 20:23:36 +0000</bug_when>
            <thetext>The repository contains a file libuutil.so which is a symlink to /lib/libuutil.so.1. The code in MercurialHistoryParser attempts to strip away the source root from the canonical name of the file, but since it&apos;s not located under the source root, the arguments to substring() are wrong and it raises an exception.</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <commentid>51338</commentid>
            <who name="Knut Anders Hatlen">knut.hatlen</who>
            <bug_when>2009-10-01 20:41:23 +0000</bug_when>
            <thetext>Fixed in changeset 855:d1a962beaf98 by ignoring files not under the source root.</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <commentid>73428</commentid>
              <attachid>4043</attachid>
            <who name="Patrick Higgins">patrick.allen.higgins</who>
            <bug_when>2010-05-24 23:19:01 +0000</bug_when>
            <thetext>Created attachment 4043
Patch for allowing symlinks only

Here&apos;s a patch that separates out the symlinks functionality. I&apos;ve extended it to cover all the cases I could find in non-clearcase code.

I&apos;ve run pmd, checkstyle, findbugs, and junit tests and all appears good, though I had to use // NOPMD on some cases where I had empty catch blocks. Let me know if you don&apos;t like that. :-)

I have not added back the code to allow within-directory symlinks, though.</thetext>
          </long_desc>
          <long_desc isprivate="0">
            <commentid>73429</commentid>
            <who name="Patrick Higgins">patrick.allen.higgins</who>
            <bug_when>2010-05-24 23:19:34 +0000</bug_when>
            <thetext>(In reply to comment #3)

Oops, sorry. This was intended for a different defect.</thetext>
          </long_desc>
      
          <attachment
              isobsolete="0"
              ispatch="1"
              isprivate="0"
              isurl="0"
          >
            <attachid>4043</attachid>
            <date>2010-05-24 23:19:00 +0000</date>
            <delta_ts>2010-05-24 23:19:01 +0000</delta_ts>
            <desc>Patch for allowing symlinks only</desc>
            <filename>allow-symlinks</filename>
            <type>text/plain</type>
            <size>37782</size>
            <attacher>patrick.allen.higgins</attacher>
            
              <data encoding="base64">IyBIRyBjaGFuZ2VzZXQgcGF0Y2gKIyBQYXJlbnQgZGZhMTg1ODc1MTdlYWQxMzFkOTdhODZjNzQ0
OGRmZTM4OTI0MDI1YQoKZGlmZiAtciBkZmExODU4NzUxN2Ugc3JjL29yZy9vcGVuc29sYXJpcy9v
cGVuZ3Jvay9jb25maWd1cmF0aW9uL0NvbmZpZ3VyYXRpb24uamF2YQotLS0gYS9zcmMvb3JnL29w
ZW5zb2xhcmlzL29wZW5ncm9rL2NvbmZpZ3VyYXRpb24vQ29uZmlndXJhdGlvbi5qYXZhCUZyaSBN
YXkgMjEgMTc6MDQ6MDQgMjAxMCAtMDYwMAorKysgYi9zcmMvb3JnL29wZW5zb2xhcmlzL29wZW5n
cm9rL2NvbmZpZ3VyYXRpb24vQ29uZmlndXJhdGlvbi5qYXZhCU1vbiBNYXkgMjQgMTM6MzY6Mjkg
MjAxMCAtMDYwMApAQCAtMzcsNyArMzcsOSBAQAogaW1wb3J0IGphdmEuaW8uT3V0cHV0U3RyZWFt
OwogaW1wb3J0IGphdmEudXRpbC5BcnJheUxpc3Q7CiBpbXBvcnQgamF2YS51dGlsLkRhdGU7Citp
bXBvcnQgamF2YS51dGlsLkhhc2hTZXQ7CiBpbXBvcnQgamF2YS51dGlsLkxpc3Q7CitpbXBvcnQg
amF2YS51dGlsLlNldDsKIGltcG9ydCBvcmcub3BlbnNvbGFyaXMub3Blbmdyb2suaGlzdG9yeS5S
ZXBvc2l0b3J5SW5mbzsKIGltcG9ydCBvcmcub3BlbnNvbGFyaXMub3Blbmdyb2suaW5kZXguSWdu
b3JlZE5hbWVzOwogCkBAIC04OSw2ICs5MSw3IEBACiAgICAgcHJpdmF0ZSBTdHJpbmcgZGF0YWJh
c2VEcml2ZXI7CiAgICAgcHJpdmF0ZSBTdHJpbmcgZGF0YWJhc2VVcmw7CiAgICAgcHJpdmF0ZSBJ
bnRlZ2VyIHNjYW5uaW5nRGVwdGg7CisgICAgcHJpdmF0ZSBTZXQ8U3RyaW5nPiBhbGxvd2VkU3lt
bGlua3M7CiAKICAgICBwdWJsaWMgSW50ZWdlciBnZXRTY2FubmluZ0RlcHRoKCkgewogICAgICAg
ICByZXR1cm4gc2Nhbm5pbmdEZXB0aDsKQEAgLTEyOSw2ICsxMzIsNyBAQAogICAgICAgICBzZXRI
aXRzUGVyUGFnZSgyNSk7CiAgICAgICAgIHNldENhY2hlUGFnZXMoNSk7CiAgICAgICAgIHNldFNj
YW5uaW5nRGVwdGgoMyk7IC8vIGRlZmF1bHQgZGVwdGggb2Ygc2Nhbm5pbmcgZm9yIHJlcG9zaXRv
cmllcworICAgICAgICBzZXRBbGxvd2VkU3ltbGlua3MobmV3IEhhc2hTZXQ8U3RyaW5nPigpKTsK
ICAgICB9CiAKICAgICBwdWJsaWMgU3RyaW5nIGdldEN0YWdzKCkgewpAQCAtNDI0LDYgKzQyOCwx
NCBAQAogICAgICAgICB0aGlzLmRhdGFiYXNlVXJsID0gZGF0YWJhc2VVcmw7CiAgICAgfQogCisg
ICAgcHVibGljIFNldDxTdHJpbmc+IGdldEFsbG93ZWRTeW1saW5rcygpIHsKKyAgICAgICAgcmV0
dXJuIGFsbG93ZWRTeW1saW5rczsKKyAgICB9CisKKyAgICBwdWJsaWMgdm9pZCBzZXRBbGxvd2Vk
U3ltbGlua3MoU2V0PFN0cmluZz4gYWxsb3dlZFN5bWxpbmtzKSB7CisgICAgICAgIHRoaXMuYWxs
b3dlZFN5bWxpbmtzID0gYWxsb3dlZFN5bWxpbmtzOworICAgIH0KKwogICAgIC8qKgogICAgICAq
IFdyaXRlIHRoZSBjdXJyZW50IGNvbmZpZ3VyYXRpb24gdG8gYSBmaWxlCiAgICAgICogQHBhcmFt
IGZpbGUgdGhlIGZpbGUgdG8gd3JpdGUgdGhlIGNvbmZpZ3VyYXRpb24gaW50bwpkaWZmIC1yIGRm
YTE4NTg3NTE3ZSBzcmMvb3JnL29wZW5zb2xhcmlzL29wZW5ncm9rL2NvbmZpZ3VyYXRpb24vUHJv
amVjdC5qYXZhCi0tLSBhL3NyYy9vcmcvb3BlbnNvbGFyaXMvb3Blbmdyb2svY29uZmlndXJhdGlv
bi9Qcm9qZWN0LmphdmEJRnJpIE1heSAyMSAxNzowNDowNCAyMDEwIC0wNjAwCisrKyBiL3NyYy9v
cmcvb3BlbnNvbGFyaXMvb3Blbmdyb2svY29uZmlndXJhdGlvbi9Qcm9qZWN0LmphdmEJTW9uIE1h
eSAyNCAxMzozNjoyOSAyMDEwIC0wNjAwCkBAIC0yNCw2ICsyNCw4IEBACiBwYWNrYWdlIG9yZy5v
cGVuc29sYXJpcy5vcGVuZ3Jvay5jb25maWd1cmF0aW9uOwogCiBpbXBvcnQgamF2YS5pby5GaWxl
OworaW1wb3J0IGphdmEuaW8uRmlsZU5vdEZvdW5kRXhjZXB0aW9uOworaW1wb3J0IGphdmEuaW8u
SU9FeGNlcHRpb247CiAKIC8qKgogICogUGxhY2Vob2xkZXIgZm9yIHRoZSBpbmZvcm1hdGlvbiB0
aGF0IGJ1aWxkcyB1cCBhIHByb2plY3QKQEAgLTE0MCwxMCArMTQyLDEyIEBACiAgICAgICovCiAg
ICAgcHVibGljIHN0YXRpYyBQcm9qZWN0IGdldFByb2plY3QoRmlsZSBmaWxlKSB7CiAgICAgICAg
IFByb2plY3QgcmV0ID0gbnVsbDsKLSAgICAgICAgU3RyaW5nIHJvb3QgPSBSdW50aW1lRW52aXJv
bm1lbnQuZ2V0SW5zdGFuY2UoKS5nZXRTb3VyY2VSb290RmlsZSgpLmdldEFic29sdXRlUGF0aCgp
OwotICAgICAgICBTdHJpbmcgbWUgPSBmaWxlLmdldEFic29sdXRlUGF0aCgpOwotICAgICAgICBp
ZiAobWUuc3RhcnRzV2l0aChyb290KSkgewotICAgICAgICAgICAgcmV0ID0gZ2V0UHJvamVjdCht
ZS5zdWJzdHJpbmcocm9vdC5sZW5ndGgoKSkpOworICAgICAgICB0cnkgeworICAgICAgICAgICAg
cmV0ID0gZ2V0UHJvamVjdChSdW50aW1lRW52aXJvbm1lbnQuZ2V0SW5zdGFuY2UoKS5nZXRQYXRo
UmVsYXRpdmVUb1NvdXJjZVJvb3QoZmlsZSwgMCkpOworICAgICAgICB9IGNhdGNoIChGaWxlTm90
Rm91bmRFeGNlcHRpb24gZSkgeyAvLyBOT1BNRAorICAgICAgICAgICAgLy8gaWdub3JlIGlmIG5v
dCB1bmRlciBzb3VyY2Ugcm9vdAorICAgICAgICB9IGNhdGNoIChJT0V4Y2VwdGlvbiBlKSB7IC8v
IE5PUE1ECisgICAgICAgICAgICAvLyBwcm9ibGVtIGhhcyBhbHJlYWR5IGJlZW4gbG9nZ2VkLCBq
dXN0IHJldHVybiBudWxsCiAgICAgICAgIH0KICAgICAgICAgcmV0dXJuIHJldDsKICAgICB9CmRp
ZmYgLXIgZGZhMTg1ODc1MTdlIHNyYy9vcmcvb3BlbnNvbGFyaXMvb3Blbmdyb2svY29uZmlndXJh
dGlvbi9SdW50aW1lRW52aXJvbm1lbnQuamF2YQotLS0gYS9zcmMvb3JnL29wZW5zb2xhcmlzL29w
ZW5ncm9rL2NvbmZpZ3VyYXRpb24vUnVudGltZUVudmlyb25tZW50LmphdmEJRnJpIE1heSAyMSAx
NzowNDowNCAyMDEwIC0wNjAwCisrKyBiL3NyYy9vcmcvb3BlbnNvbGFyaXMvb3Blbmdyb2svY29u
ZmlndXJhdGlvbi9SdW50aW1lRW52aXJvbm1lbnQuamF2YQlNb24gTWF5IDI0IDEzOjM2OjI5IDIw
MTAgLTA2MDAKQEAgLTI3LDYgKzI3LDcgQEAKIGltcG9ydCBqYXZhLmJlYW5zLlhNTEVuY29kZXI7
CiBpbXBvcnQgamF2YS5pby5CdWZmZXJlZElucHV0U3RyZWFtOwogaW1wb3J0IGphdmEuaW8uRmls
ZTsKK2ltcG9ydCBqYXZhLmlvLkZpbGVOb3RGb3VuZEV4Y2VwdGlvbjsKIGltcG9ydCBqYXZhLmlv
LklPRXhjZXB0aW9uOwogaW1wb3J0IGphdmEubmV0LkluZXRBZGRyZXNzOwogaW1wb3J0IGphdmEu
bmV0LlNlcnZlclNvY2tldDsKQEAgLTM1LDYgKzM2LDcgQEAKIGltcG9ydCBqYXZhLm5ldC5Vbmtu
b3duSG9zdEV4Y2VwdGlvbjsKIGltcG9ydCBqYXZhLnV0aWwuRGF0ZTsKIGltcG9ydCBqYXZhLnV0
aWwuTGlzdDsKK2ltcG9ydCBqYXZhLnV0aWwuU2V0OwogaW1wb3J0IGphdmEudXRpbC5sb2dnaW5n
LkxldmVsOwogaW1wb3J0IGphdmEudXRpbC5sb2dnaW5nLkxvZ2dlcjsKIGltcG9ydCBvcmcub3Bl
bnNvbGFyaXMub3Blbmdyb2suT3Blbkdyb2tMb2dnZXI7CkBAIC0xNjEsNiArMTYzLDM2IEBACiAg
ICAgcHVibGljIHZvaWQgc2V0U291cmNlUm9vdChTdHJpbmcgc291cmNlUm9vdCkgewogICAgICAg
ICB0aHJlYWRDb25maWcuZ2V0KCkuc2V0U291cmNlUm9vdChnZXRDYW5vbmljYWxQYXRoKHNvdXJj
ZVJvb3QpKTsKICAgICB9CisKKyAgICAvKioKKyAgICAgKiBSZXR1cm5zIGEgcGF0aCByZWxhdGl2
ZSB0byBzb3VyY2Ugcm9vdC4gVGhpcyB3b3VsZCBqdXN0IGJlIGEgc2ltcGxlCisgICAgICogc3Vi
c3RyaW5nIG9wZXJhdGlvbiwgZXhjZXB0IHdlIG5lZWQgdG8gc3VwcG9ydCBzeW1saW5rcyBvdXRz
aWRlIHRoZQorICAgICAqIHNvdXJjZSByb290LgorICAgICAqIEBwYXJhbSBmaWxlIEEgZmlsZSB0
byByZXNvbHZlCisgICAgICogQHBhcmFtIHN0cmlwQ291bnQgTnVtYmVyIG9mIGNoYXJhY3RlcnMg
cGFzdCBzb3VyY2Ugcm9vdCB0byBzdHJpcAorICAgICAqIEB0aHJvd3MgSU9FeGNlcHRpb24gSWYg
YW4gSU8gZXJyb3Igb2NjdXJzCisgICAgICogQHRocm93cyBGaWxlTm90Rm91bmRFeGNlcHRpb24g
SWYgdGhlIGZpbGUgaXMgbm90IHJlbGF0aXZlIHRvIHNvdXJjZSByb290CisgICAgICogQHJldHVy
biBQYXRoIHJlbGF0aXZlIHRvIHNvdXJjZSByb290CisgICAgICovCisgICAgcHVibGljIFN0cmlu
ZyBnZXRQYXRoUmVsYXRpdmVUb1NvdXJjZVJvb3QoRmlsZSBmaWxlLCBpbnQgc3RyaXBDb3VudCkg
dGhyb3dzIElPRXhjZXB0aW9uIHsKKyAgICAgICAgdHJ5IHsKKyAgICAgICAgICAgIFN0cmluZyBj
YW5vbmljYWxQYXRoID0gZmlsZS5nZXRDYW5vbmljYWxQYXRoKCk7CisgICAgICAgICAgICBTdHJp
bmcgc291cmNlUm9vdCA9IGdldFNvdXJjZVJvb3RQYXRoKCk7CisgICAgICAgICAgICBpZiAoY2Fu
b25pY2FsUGF0aC5zdGFydHNXaXRoKHNvdXJjZVJvb3QpKSB7CisgICAgICAgICAgICAgICAgcmV0
dXJuIGNhbm9uaWNhbFBhdGguc3Vic3RyaW5nKHNvdXJjZVJvb3QubGVuZ3RoKCkgKyBzdHJpcENv
dW50KTsKKyAgICAgICAgICAgIH0gCisgICAgICAgICAgICBmb3IgKFN0cmluZyBhbGxvd2VkU3lt
bGluayA6IGdldEFsbG93ZWRTeW1saW5rcygpKSB7CisgICAgICAgICAgICAgICAgU3RyaW5nIGFs
bG93ZWRUYXJnZXQgPSBuZXcgRmlsZShhbGxvd2VkU3ltbGluaykuZ2V0Q2Fub25pY2FsUGF0aCgp
OworICAgICAgICAgICAgICAgIGlmIChjYW5vbmljYWxQYXRoLnN0YXJ0c1dpdGgoYWxsb3dlZFRh
cmdldCkpIHsKKyAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNhbm9uaWNhbFBhdGguc3Vic3Ry
aW5nKGFsbG93ZWRUYXJnZXQubGVuZ3RoKCkgKyBzdHJpcENvdW50KTsKKyAgICAgICAgICAgICAg
ICB9CisgICAgICAgICAgICB9CisgICAgICAgICAgICB0aHJvdyBuZXcgRmlsZU5vdEZvdW5kRXhj
ZXB0aW9uKCJGYWlsZWQgdG8gcmVzb2x2ZSBbIitjYW5vbmljYWxQYXRoKyJdIHJlbGF0aXZlIHRv
IHNvdXJjZSByb290IFsiK3NvdXJjZVJvb3QrIl0iKTsKKyAgICAgICAgfSBjYXRjaCAoSU9FeGNl
cHRpb24gZSkgeworICAgICAgICAgICAgT3Blbkdyb2tMb2dnZXIuZ2V0TG9nZ2VyKCkubG9nKExl
dmVsLlNFVkVSRSwgIkZhaWxlZCB0byBnZXQgY2Fub25pY2FsIHBhdGgiLCBlKTsKKyAgICAgICAg
ICAgIHRocm93IGU7CisgICAgICAgIH0KKyAgICB9CiAgICAgCiAgICAgLyoqCiAgICAgICogRG8g
d2UgaGF2ZSBwcm9qZWN0cz8KQEAgLTU5NSw2ICs2MjcsMTQgQEAKICAgICAgICAgdGhyZWFkQ29u
ZmlnLmdldCgpLnNldERhdGFiYXNlVXJsKGRhdGFiYXNlVXJsKTsKICAgICB9CiAKKyAgICBwdWJs
aWMgU2V0PFN0cmluZz4gZ2V0QWxsb3dlZFN5bWxpbmtzKCkgeworICAgICAgICByZXR1cm4gdGhy
ZWFkQ29uZmlnLmdldCgpLmdldEFsbG93ZWRTeW1saW5rcygpOworICAgIH0KKworICAgIHB1Ymxp
YyB2b2lkIHNldEFsbG93ZWRTeW1saW5rcyhTZXQ8U3RyaW5nPiBhbGxvd2VkU3ltbGlua3MpIHsK
KyAgICAgICAgdGhyZWFkQ29uZmlnLmdldCgpLnNldEFsbG93ZWRTeW1saW5rcyhhbGxvd2VkU3lt
bGlua3MpOworICAgIH0KKyAgICAKICAgICAvKioKICAgICAgKiBSZWFkIGFuIGNvbmZpZ3VyYXRp
b24gZmlsZSBhbmQgc2V0IGl0IGFzIHRoZSBjdXJyZW50IGNvbmZpZ3VyYXRpb24uCiAgICAgICog
QHBhcmFtIGZpbGUgdGhlIGZpbGUgdG8gcmVhZApkaWZmIC1yIGRmYTE4NTg3NTE3ZSBzcmMvb3Jn
L29wZW5zb2xhcmlzL29wZW5ncm9rL2hpc3RvcnkvQmF6YWFySGlzdG9yeVBhcnNlci5qYXZhCi0t
LSBhL3NyYy9vcmcvb3BlbnNvbGFyaXMvb3Blbmdyb2svaGlzdG9yeS9CYXphYXJIaXN0b3J5UGFy
c2VyLmphdmEJRnJpIE1heSAyMSAxNzowNDowNCAyMDEwIC0wNjAwCisrKyBiL3NyYy9vcmcvb3Bl
bnNvbGFyaXMvb3Blbmdyb2svaGlzdG9yeS9CYXphYXJIaXN0b3J5UGFyc2VyLmphdmEJTW9uIE1h
eSAyNCAxMzozNjoyOSAyMDEwIC0wNjAwCkBAIC00NSwyNCArNDUsMjYgQEAKIGNsYXNzIEJhemFh
ckhpc3RvcnlQYXJzZXIgaW1wbGVtZW50cyBFeGVjdXRvci5TdHJlYW1IYW5kbGVyIHsKIAogICAg
IHByaXZhdGUgU3RyaW5nIG15RGlyOwotICAgIHByaXZhdGUgaW50IHJvb3RMZW5ndGg7CiAgICAg
cHJpdmF0ZSBMaXN0PEhpc3RvcnlFbnRyeT4gZW50cmllcyA9IG5ldyBBcnJheUxpc3Q8SGlzdG9y
eUVudHJ5PigpOyAvL05PUE1ECiAgICAgcHJpdmF0ZSBCYXphYXJSZXBvc2l0b3J5IHJlcG9zaXRv
cnk9bmV3IEJhemFhclJlcG9zaXRvcnkoKTsgLy9OT1BNRAogCiAgICAgQmF6YWFySGlzdG9yeVBh
cnNlcihCYXphYXJSZXBvc2l0b3J5IHJlcG9zaXRvcnkpIHsKICAgICAgICAgdGhpcy5yZXBvc2l0
b3J5ID0gcmVwb3NpdG9yeTsKICAgICAgICAgbXlEaXIgPSByZXBvc2l0b3J5LmdldERpcmVjdG9y
eU5hbWUoKSArIEZpbGUuc2VwYXJhdG9yOwotICAgICAgICByb290TGVuZ3RoID0KLSAgICAgICAg
ICAgICAgICBSdW50aW1lRW52aXJvbm1lbnQuZ2V0SW5zdGFuY2UoKS5nZXRTb3VyY2VSb290UGF0
aCgpLmxlbmd0aCgpOwogICAgIH0KIAogICAgIEhpc3RvcnkgcGFyc2UoRmlsZSBmaWxlLCBTdHJp
bmcgc2luY2VSZXZpc2lvbikgdGhyb3dzIEhpc3RvcnlFeGNlcHRpb24gewotICAgICAgICBFeGVj
dXRvciBleGVjdXRvciA9IHJlcG9zaXRvcnkuZ2V0SGlzdG9yeUxvZ0V4ZWN1dG9yKGZpbGUsIHNp
bmNlUmV2aXNpb24pOwotICAgICAgICBpbnQgc3RhdHVzID0gZXhlY3V0b3IuZXhlYyh0cnVlLCB0
aGlzKTsKKyAgICAgICAgdHJ5IHsKKyAgICAgICAgICAgIEV4ZWN1dG9yIGV4ZWN1dG9yID0gcmVw
b3NpdG9yeS5nZXRIaXN0b3J5TG9nRXhlY3V0b3IoZmlsZSwgc2luY2VSZXZpc2lvbik7CisgICAg
ICAgICAgICBpbnQgc3RhdHVzID0gZXhlY3V0b3IuZXhlYyh0cnVlLCB0aGlzKTsKIAotICAgICAg
ICBpZiAoc3RhdHVzICE9IDApIHsKKyAgICAgICAgICAgIGlmIChzdGF0dXMgIT0gMCkgeworICAg
ICAgICAgICAgICAgIHRocm93IG5ldyBIaXN0b3J5RXhjZXB0aW9uKCJGYWlsZWQgdG8gZ2V0IGhp
c3RvcnkgZm9yOiBcIiIgKworICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIGZpbGUuZ2V0QWJzb2x1dGVQYXRoKCkgKyAiXCIgRXhpdCBjb2RlOiAiICsgc3RhdHVzKTsK
KyAgICAgICAgICAgIH0KKyAgICAgICAgfSBjYXRjaCAoSU9FeGNlcHRpb24gZSkgewogICAgICAg
ICAgICAgdGhyb3cgbmV3IEhpc3RvcnlFeGNlcHRpb24oIkZhaWxlZCB0byBnZXQgaGlzdG9yeSBm
b3I6IFwiIiArCi0gICAgICAgICAgICAgICAgICAgIGZpbGUuZ2V0QWJzb2x1dGVQYXRoKCkgKyAi
XCIgRXhpdCBjb2RlOiAiICsgc3RhdHVzKTsKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIGZpbGUuZ2V0QWJzb2x1dGVQYXRoKCkgKyAiXCIiLCBlKTsKICAgICAgICAgfQog
CiAgICAgICAgIC8vIElmIGEgY2hhbmdlc2V0IHRvIHN0YXJ0IGZyb20gaXMgc3BlY2lmaWVkLCBy
ZW1vdmUgdGhhdCBjaGFuZ2VzZXQKQEAgLTg2LDYgKzg4LDcgQEAKICAgICBAT3ZlcnJpZGUKICAg
ICBwdWJsaWMgdm9pZCBwcm9jZXNzU3RyZWFtKElucHV0U3RyZWFtIGlucHV0KSB0aHJvd3MgSU9F
eGNlcHRpb24gewogICAgICAgICBEYXRlRm9ybWF0IGRmID0gcmVwb3NpdG9yeS5nZXREYXRlRm9y
bWF0KCk7CisgICAgICAgIFJ1bnRpbWVFbnZpcm9ubWVudCBlbnYgPSBSdW50aW1lRW52aXJvbm1l
bnQuZ2V0SW5zdGFuY2UoKTsKIAogICAgICAgICBCdWZmZXJlZFJlYWRlciBpbiA9IG5ldyBCdWZm
ZXJlZFJlYWRlcihuZXcgSW5wdXRTdHJlYW1SZWFkZXIoaW5wdXQpKTsKICAgICAgICAgU3RyaW5n
IHM7CkBAIC0xNTUsNyArMTU4LDcgQEAKICAgICAgICAgICAgICAgICAgICAgICAgIH0KIAogICAg
ICAgICAgICAgICAgICAgICAgICAgRmlsZSBmID0gbmV3IEZpbGUobXlEaXIsIHMpOwotICAgICAg
ICAgICAgICAgICAgICAgICAgU3RyaW5nIG5hbWUgPSBmLmdldENhbm9uaWNhbFBhdGgoKS5zdWJz
dHJpbmcocm9vdExlbmd0aCk7CisgICAgICAgICAgICAgICAgICAgICAgICBTdHJpbmcgbmFtZSA9
IGVudi5nZXRQYXRoUmVsYXRpdmVUb1NvdXJjZVJvb3QoZiwgMCk7CiAgICAgICAgICAgICAgICAg
ICAgICAgICBlbnRyeS5hZGRGaWxlKG5hbWUpOwogICAgICAgICAgICAgICAgICAgICB9CiAgICAg
ICAgICAgICAgICAgICAgIGJyZWFrOwpAQCAtMTc5LDcgKzE4Miw2IEBACiAgICAgICovCiAgICAg
SGlzdG9yeSBwYXJzZShTdHJpbmcgYnVmZmVyKSB0aHJvd3MgSU9FeGNlcHRpb24gewogICAgICAg
ICBteURpciA9IEZpbGUuc2VwYXJhdG9yOwotICAgICAgICByb290TGVuZ3RoID0gMDsKICAgICAg
ICAgcHJvY2Vzc1N0cmVhbShuZXcgQnl0ZUFycmF5SW5wdXRTdHJlYW0oYnVmZmVyLmdldEJ5dGVz
KCJVVEYtOCIpKSk7CiAgICAgICAgIHJldHVybiBuZXcgSGlzdG9yeShlbnRyaWVzKTsKICAgICB9
CmRpZmYgLXIgZGZhMTg1ODc1MTdlIHNyYy9vcmcvb3BlbnNvbGFyaXMvb3Blbmdyb2svaGlzdG9y
eS9CYXphYXJSZXBvc2l0b3J5LmphdmEKLS0tIGEvc3JjL29yZy9vcGVuc29sYXJpcy9vcGVuZ3Jv
ay9oaXN0b3J5L0JhemFhclJlcG9zaXRvcnkuamF2YQlGcmkgTWF5IDIxIDE3OjA0OjA0IDIwMTAg
LTA2MDAKKysrIGIvc3JjL29yZy9vcGVuc29sYXJpcy9vcGVuZ3Jvay9oaXN0b3J5L0JhemFhclJl
cG9zaXRvcnkuamF2YQlNb24gTWF5IDI0IDEzOjM2OjI5IDIwMTAgLTA2MDAKQEAgLTcwLDggKzcw
LDggQEAKICAgICAgKiBAcGFyYW0gZmlsZSBUaGUgZmlsZSB0byByZXRyaWV2ZSBoaXN0b3J5IGZv
cgogICAgICAqIEByZXR1cm4gQW4gRXhlY3V0b3IgcmVhZHkgdG8gYmUgc3RhcnRlZAogICAgICAq
LwotICAgIEV4ZWN1dG9yIGdldEhpc3RvcnlMb2dFeGVjdXRvcihmaW5hbCBGaWxlIGZpbGUsIGZp
bmFsIFN0cmluZyBzaW5jZVJldmlzaW9uKSB7Ci0gICAgICAgIFN0cmluZyBhYnMgPSBmaWxlLmdl
dEFic29sdXRlUGF0aCgpOworICAgIEV4ZWN1dG9yIGdldEhpc3RvcnlMb2dFeGVjdXRvcihmaW5h
bCBGaWxlIGZpbGUsIGZpbmFsIFN0cmluZyBzaW5jZVJldmlzaW9uKSB0aHJvd3MgSU9FeGNlcHRp
b24geworICAgICAgICBTdHJpbmcgYWJzID0gZmlsZS5nZXRDYW5vbmljYWxQYXRoKCk7CiAgICAg
ICAgIFN0cmluZyBmaWxlbmFtZSA9ICIiOwogICAgICAgICBpZiAoYWJzLmxlbmd0aCgpID4gZGly
ZWN0b3J5TmFtZS5sZW5ndGgoKSkgewogICAgICAgICAgICAgZmlsZW5hbWUgPSBhYnMuc3Vic3Ry
aW5nKGRpcmVjdG9yeU5hbWUubGVuZ3RoKCkgKyAxKTsKQEAgLTEwMCw5ICsxMDAsOSBAQAogCiAg
ICAgICAgIEZpbGUgZGlyZWN0b3J5ID0gbmV3IEZpbGUoZGlyZWN0b3J5TmFtZSk7CiAKLSAgICAg
ICAgU3RyaW5nIGZpbGVuYW1lID0gIChuZXcgRmlsZShwYXJlbnQsIGJhc2VuYW1lKSkuZ2V0QWJz
b2x1dGVQYXRoKCkuc3Vic3RyaW5nKGRpcmVjdG9yeU5hbWUubGVuZ3RoKCkgKyAxKTsKICAgICAg
ICAgUHJvY2VzcyBwcm9jZXNzID0gbnVsbDsKICAgICAgICAgdHJ5IHsKKyAgICAgICAgICAgIFN0
cmluZyBmaWxlbmFtZSA9ICAobmV3IEZpbGUocGFyZW50LCBiYXNlbmFtZSkpLmdldENhbm9uaWNh
bFBhdGgoKS5zdWJzdHJpbmcoZGlyZWN0b3J5TmFtZS5sZW5ndGgoKSArIDEpOwogICAgICAgICAg
ICAgU3RyaW5nIGFyZ3ZbXSA9IHtnZXRDb21tYW5kKCksICJjYXQiLCAiLXIiLCByZXYsIGZpbGVu
YW1lfTsKICAgICAgICAgICAgIHByb2Nlc3MgPSBSdW50aW1lLmdldFJ1bnRpbWUoKS5leGVjKGFy
Z3YsIG51bGwsIGRpcmVjdG9yeSk7CiAKZGlmZiAtciBkZmExODU4NzUxN2Ugc3JjL29yZy9vcGVu
c29sYXJpcy9vcGVuZ3Jvay9oaXN0b3J5L0NWU0hpc3RvcnlQYXJzZXIuamF2YQotLS0gYS9zcmMv
b3JnL29wZW5zb2xhcmlzL29wZW5ncm9rL2hpc3RvcnkvQ1ZTSGlzdG9yeVBhcnNlci5qYXZhCUZy
aSBNYXkgMjEgMTc6MDQ6MDQgMjAxMCAtMDYwMAorKysgYi9zcmMvb3JnL29wZW5zb2xhcmlzL29w
ZW5ncm9rL2hpc3RvcnkvQ1ZTSGlzdG9yeVBhcnNlci5qYXZhCU1vbiBNYXkgMjQgMTM6MzY6Mjkg
MjAxMCAtMDYwMApAQCAtMTI3LDEyICsxMjcsMTcgQEAKICAgICAgKi8KICAgICBIaXN0b3J5IHBh
cnNlKEZpbGUgZmlsZSwgUmVwb3NpdG9yeSByZXBvcykgdGhyb3dzIEhpc3RvcnlFeGNlcHRpb24g
ewogICAgICAgICByZXBvc2l0b3J5ID0gKENWU1JlcG9zaXRvcnkpIHJlcG9zOwotICAgICAgICBF
eGVjdXRvciBleGVjdXRvciA9IHJlcG9zaXRvcnkuZ2V0SGlzdG9yeUxvZ0V4ZWN1dG9yKGZpbGUp
OwotICAgICAgICBpbnQgc3RhdHVzID0gZXhlY3V0b3IuZXhlYyh0cnVlLCB0aGlzKTsKKyAgICAg
ICAgdHJ5IHsKKyAgICAgICAgICAgIEV4ZWN1dG9yIGV4ZWN1dG9yID0gcmVwb3NpdG9yeS5nZXRI
aXN0b3J5TG9nRXhlY3V0b3IoZmlsZSk7CisgICAgICAgICAgICBpbnQgc3RhdHVzID0gZXhlY3V0
b3IuZXhlYyh0cnVlLCB0aGlzKTsKIAotICAgICAgICBpZiAoc3RhdHVzICE9IDApIHsKKyAgICAg
ICAgICAgIGlmIChzdGF0dXMgIT0gMCkgeworICAgICAgICAgICAgICAgIHRocm93IG5ldyBIaXN0
b3J5RXhjZXB0aW9uKCJGYWlsZWQgdG8gZ2V0IGhpc3RvcnkgZm9yOiBcIiIgKworICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGUuZ2V0QWJzb2x1dGVQYXRoKCkg
KyAiXCIgRXhpdCBjb2RlOiAiICsgc3RhdHVzKTsKKyAgICAgICAgICAgIH0KKyAgICAgICAgfSBj
YXRjaCAoSU9FeGNlcHRpb24gZSkgewogICAgICAgICAgICAgdGhyb3cgbmV3IEhpc3RvcnlFeGNl
cHRpb24oIkZhaWxlZCB0byBnZXQgaGlzdG9yeSBmb3I6IFwiIiArCi0gICAgICAgICAgICAgICAg
ICAgIGZpbGUuZ2V0QWJzb2x1dGVQYXRoKCkgKyAiXCIgRXhpdCBjb2RlOiAiICsgc3RhdHVzKTsK
KyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGUuZ2V0QWJzb2x1dGVQ
YXRoKCkgKyAiXCIiLCBlKTsKICAgICAgICAgfQogCiAgICAgICAgIHJldHVybiBoaXN0b3J5Owpk
aWZmIC1yIGRmYTE4NTg3NTE3ZSBzcmMvb3JnL29wZW5zb2xhcmlzL29wZW5ncm9rL2hpc3Rvcnkv
Q1ZTUmVwb3NpdG9yeS5qYXZhCi0tLSBhL3NyYy9vcmcvb3BlbnNvbGFyaXMvb3Blbmdyb2svaGlz
dG9yeS9DVlNSZXBvc2l0b3J5LmphdmEJRnJpIE1heSAyMSAxNzowNDowNCAyMDEwIC0wNjAwCisr
KyBiL3NyYy9vcmcvb3BlbnNvbGFyaXMvb3Blbmdyb2svaGlzdG9yeS9DVlNSZXBvc2l0b3J5Lmph
dmEJTW9uIE1heSAyNCAxMzozNjoyOSAyMDEwIC0wNjAwCkBAIC0xMTIsOCArMTEyLDggQEAKICAg
ICAgKiBAcGFyYW0gZmlsZSBUaGUgZmlsZSB0byByZXRyaWV2ZSBoaXN0b3J5IGZvcgogICAgICAq
IEByZXR1cm4gQW4gRXhlY3V0b3IgcmVhZHkgdG8gYmUgc3RhcnRlZAogICAgICAqLwotICAgIEV4
ZWN1dG9yIGdldEhpc3RvcnlMb2dFeGVjdXRvcihmaW5hbCBGaWxlIGZpbGUpIHsKLSAgICAgICAg
U3RyaW5nIGFicyA9IGZpbGUuZ2V0QWJzb2x1dGVQYXRoKCk7CisgICAgRXhlY3V0b3IgZ2V0SGlz
dG9yeUxvZ0V4ZWN1dG9yKGZpbmFsIEZpbGUgZmlsZSkgdGhyb3dzIElPRXhjZXB0aW9uIHsKKyAg
ICAgICAgU3RyaW5nIGFicyA9IGZpbGUuZ2V0Q2Fub25pY2FsUGF0aCgpOwogICAgICAgICBTdHJp
bmcgZmlsZW5hbWUgPSAiIjsKICAgICAgICAgaWYgKGFicy5sZW5ndGgoKSA+IGRpcmVjdG9yeU5h
bWUubGVuZ3RoKCkpIHsKICAgICAgICAgICAgIGZpbGVuYW1lID0gYWJzLnN1YnN0cmluZyhkaXJl
Y3RvcnlOYW1lLmxlbmd0aCgpICsgMSk7CmRpZmYgLXIgZGZhMTg1ODc1MTdlIHNyYy9vcmcvb3Bl
bnNvbGFyaXMvb3Blbmdyb2svaGlzdG9yeS9DbGVhckNhc2VIaXN0b3J5UGFyc2VyLmphdmEKLS0t
IGEvc3JjL29yZy9vcGVuc29sYXJpcy9vcGVuZ3Jvay9oaXN0b3J5L0NsZWFyQ2FzZUhpc3RvcnlQ
YXJzZXIuamF2YQlGcmkgTWF5IDIxIDE3OjA0OjA0IDIwMTAgLTA2MDAKKysrIGIvc3JjL29yZy9v
cGVuc29sYXJpcy9vcGVuZ3Jvay9oaXN0b3J5L0NsZWFyQ2FzZUhpc3RvcnlQYXJzZXIuamF2YQlN
b24gTWF5IDI0IDEzOjM2OjI5IDIwMTAgLTA2MDAKQEAgLTQzLDE1ICs0MywyMCBAQAogCiAgICAg
SGlzdG9yeSBwYXJzZShGaWxlIGZpbGUsIFJlcG9zaXRvcnkgcmVwb3MpIHRocm93cyBIaXN0b3J5
RXhjZXB0aW9uIHsKICAgICAgICAgcmVwb3NpdG9yeSA9IChDbGVhckNhc2VSZXBvc2l0b3J5KXJl
cG9zOwotICAgICAgICBFeGVjdXRvciBleGVjdXRvciA9IHJlcG9zaXRvcnkuZ2V0SGlzdG9yeUxv
Z0V4ZWN1dG9yKGZpbGUpOwotICAgICAgICBpbnQgc3RhdHVzID0gZXhlY3V0b3IuZXhlYyh0cnVl
LCB0aGlzKTsKKyAgICAgICAgdHJ5IHsKKyAgICAgICAgICAgIEV4ZWN1dG9yIGV4ZWN1dG9yID0g
cmVwb3NpdG9yeS5nZXRIaXN0b3J5TG9nRXhlY3V0b3IoZmlsZSk7CisgICAgICAgICAgICBpbnQg
c3RhdHVzID0gZXhlY3V0b3IuZXhlYyh0cnVlLCB0aGlzKTsKIAotICAgICAgICBpZiAoc3RhdHVz
ICE9IDApIHsKKyAgICAgICAgICAgIGlmIChzdGF0dXMgIT0gMCkgeworICAgICAgICAgICAgICAg
IHRocm93IG5ldyBIaXN0b3J5RXhjZXB0aW9uKCJGYWlsZWQgdG8gZ2V0IGhpc3RvcnkgZm9yOiBc
IiIgKworICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGUuZ2V0
QWJzb2x1dGVQYXRoKCkgKyAiXCIgRXhpdCBjb2RlOiAiICsgc3RhdHVzKTsKKyAgICAgICAgICAg
IH0KKyAgICAgICAgICAgIAorICAgICAgICAgICAgcmV0dXJuIGhpc3Rvcnk7CisgICAgICAgIH0g
Y2F0Y2ggKElPRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgIHRocm93IG5ldyBIaXN0b3J5RXhj
ZXB0aW9uKCJGYWlsZWQgdG8gZ2V0IGhpc3RvcnkgZm9yOiBcIiIgKwotICAgICAgICAgICAgICAg
ICAgICBmaWxlLmdldEFic29sdXRlUGF0aCgpICsgIlwiIEV4aXQgY29kZTogIiArIHN0YXR1cyk7
CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlLmdldEFic29sdXRl
UGF0aCgpICsgIlwiIiwgZSk7CiAgICAgICAgIH0KLQotICAgICAgICByZXR1cm4gaGlzdG9yeTsK
ICAgICB9CiAKICAgIC8qKgpkaWZmIC1yIGRmYTE4NTg3NTE3ZSBzcmMvb3JnL29wZW5zb2xhcmlz
L29wZW5ncm9rL2hpc3RvcnkvQ2xlYXJDYXNlUmVwb3NpdG9yeS5qYXZhCi0tLSBhL3NyYy9vcmcv
b3BlbnNvbGFyaXMvb3Blbmdyb2svaGlzdG9yeS9DbGVhckNhc2VSZXBvc2l0b3J5LmphdmEJRnJp
IE1heSAyMSAxNzowNDowNCAyMDEwIC0wNjAwCisrKyBiL3NyYy9vcmcvb3BlbnNvbGFyaXMvb3Bl
bmdyb2svaGlzdG9yeS9DbGVhckNhc2VSZXBvc2l0b3J5LmphdmEJTW9uIE1heSAyNCAxMzozNjoy
OSAyMDEwIC0wNjAwCkBAIC03OCw4ICs3OCw4IEBACiAgICAgICogQHBhcmFtIGZpbGUgVGhlIGZp
bGUgdG8gcmV0cmlldmUgaGlzdG9yeSBmb3IKICAgICAgKiBAcmV0dXJuIEFuIEV4ZWN1dG9yIHJl
YWR5IHRvIGJlIHN0YXJ0ZWQKICAgICAgKi8KLSAgICBFeGVjdXRvciBnZXRIaXN0b3J5TG9nRXhl
Y3V0b3IoZmluYWwgRmlsZSBmaWxlKSB7Ci0gICAgICAgIFN0cmluZyBhYnMgPSBmaWxlLmdldEFi
c29sdXRlUGF0aCgpOworICAgIEV4ZWN1dG9yIGdldEhpc3RvcnlMb2dFeGVjdXRvcihmaW5hbCBG
aWxlIGZpbGUpIHRocm93cyBJT0V4Y2VwdGlvbiB7CisgICAgICAgIFN0cmluZyBhYnMgPSBmaWxl
LmdldENhbm9uaWNhbFBhdGgoKTsKICAgICAgICAgU3RyaW5nIGZpbGVuYW1lID0gIiI7CiAgICAg
ICAgIGlmIChhYnMubGVuZ3RoKCkgPiBkaXJlY3RvcnlOYW1lLmxlbmd0aCgpKSB7CiAgICAgICAg
ICAgICBmaWxlbmFtZSA9IGFicy5zdWJzdHJpbmcoZGlyZWN0b3J5TmFtZS5sZW5ndGgoKSArIDEp
OwpAQCAtMTA0LDExICsxMDQsMTEgQEAKIAogICAgICAgICBGaWxlIGRpcmVjdG9yeSA9IG5ldyBG
aWxlKGRpcmVjdG9yeU5hbWUpOwogCi0gICAgICAgIFN0cmluZyBmaWxlbmFtZSA9IChuZXcgRmls
ZShwYXJlbnQsIGJhc2VuYW1lKSkuZ2V0QWJzb2x1dGVQYXRoKCkuc3Vic3RyaW5nKGRpcmVjdG9y
eU5hbWUubGVuZ3RoKCkgKyAxKTsKICAgICAgICAgUHJvY2VzcyBwcm9jZXNzID0gbnVsbDsKICAg
ICAgICAgdHJ5IHsKKyAgICAgICAgICAgIFN0cmluZyBmaWxlbmFtZSA9IChuZXcgRmlsZShwYXJl
bnQsIGJhc2VuYW1lKSkuZ2V0Q2Fub25pY2FsUGF0aCgpLnN1YnN0cmluZyhkaXJlY3RvcnlOYW1l
Lmxlbmd0aCgpICsgMSk7CiAgICAgICAgICAgICBmaW5hbCBGaWxlIHRtcCA9IEZpbGUuY3JlYXRl
VGVtcEZpbGUoIm9wZW5ncm9rIiwgInRtcCIpOwotICAgICAgICAgICAgU3RyaW5nIHRtcE5hbWUg
PSB0bXAuZ2V0QWJzb2x1dGVQYXRoKCk7CisgICAgICAgICAgICBTdHJpbmcgdG1wTmFtZSA9IHRt
cC5nZXRDYW5vbmljYWxQYXRoKCk7CiAKICAgICAgICAgICAgIC8vIGNsZWFydG9vbCBjYW4ndCBn
ZXQgdG8gYSBwcmV2aW91c2x5IGV4aXN0aW5nIGZpbGUKICAgICAgICAgICAgIGlmICh0bXAuZXhp
c3RzKCkgJiYgIXRtcC5kZWxldGUoKSkgewpkaWZmIC1yIGRmYTE4NTg3NTE3ZSBzcmMvb3JnL29w
ZW5zb2xhcmlzL29wZW5ncm9rL2hpc3RvcnkvRmlsZUhpc3RvcnlDYWNoZS5qYXZhCi0tLSBhL3Ny
Yy9vcmcvb3BlbnNvbGFyaXMvb3Blbmdyb2svaGlzdG9yeS9GaWxlSGlzdG9yeUNhY2hlLmphdmEJ
RnJpIE1heSAyMSAxNzowNDowNCAyMDEwIC0wNjAwCisrKyBiL3NyYy9vcmcvb3BlbnNvbGFyaXMv
b3Blbmdyb2svaGlzdG9yeS9GaWxlSGlzdG9yeUNhY2hlLmphdmEJTW9uIE1heSAyNCAxMzozNjoy
OSAyMDEwIC0wNjAwCkBAIC04NSwyNyArODUsMTcgQEAKICAgICAgICAgc2IuYXBwZW5kKGVudi5n
ZXREYXRhUm9vdFBhdGgoKSk7CiAgICAgICAgIHNiLmFwcGVuZChGaWxlLnNlcGFyYXRvckNoYXIp
OwogICAgICAgICBzYi5hcHBlbmQoImhpc3RvcnljYWNoZSIpOwotICAgICAgICAKLSAgICAgICAg
U3RyaW5nIHNvdXJjZVJvb3QgPSBlbnYuZ2V0U291cmNlUm9vdFBhdGgoKTsKLSAgICAgICAgaWYg
KHNvdXJjZVJvb3QgPT0gbnVsbCkgewotICAgICAgICAgICAgcmV0dXJuIG51bGw7CisKKyAgICAg
ICAgdHJ5IHsKKyAgICAgICAgICAgIFN0cmluZyBhZGQgPSBlbnYuZ2V0UGF0aFJlbGF0aXZlVG9T
b3VyY2VSb290KGZpbGUsIDApOworICAgICAgICAgICAgaWYgKGFkZC5sZW5ndGgoKSA9PSAwKSB7
CisgICAgICAgICAgICAgICAgYWRkID0gRmlsZS5zZXBhcmF0b3I7CisgICAgICAgICAgICB9Cisg
ICAgICAgICAgICBzYi5hcHBlbmQoYWRkKTsKKyAgICAgICAgICAgIHNiLmFwcGVuZCgiLmd6Iik7
CisgICAgICAgIH0gY2F0Y2ggKElPRXhjZXB0aW9uIGUpIHsKKyAgICAgICAgICAgIHRocm93IG5l
dyBIaXN0b3J5RXhjZXB0aW9uKCJGYWlsZWQgdG8gZ2V0IHBhdGggcmVsYXRpdmUgdG8gc291cmNl
IHJvb3QgZm9yICIgKyBmaWxlLCBlKTsKICAgICAgICAgfQotCi0gICAgICAgIFN0cmluZyBhZGQ7
Ci0gICAgICAgIHRyeSB7Ci0gICAgICAgICAgICB0cnkgewotICAgICAgICAgICAgICAgIGFkZCA9
IGZpbGUuZ2V0Q2Fub25pY2FsUGF0aCgpLnN1YnN0cmluZyhzb3VyY2VSb290Lmxlbmd0aCgpKTsK
LSAgICAgICAgICAgIH0gY2F0Y2ggKFN0cmluZ0luZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24gZXhw
KSB7Ci0gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEhpc3RvcnlFeGNlcHRpb24oIkZhaWxlZCB0
byBnZXQgcGF0aCBmb3I6IDwiICsgZmlsZSArICI+IFsiICsgZmlsZS5nZXRDYW5vbmljYWxQYXRo
KCkgKyAiXSBbIiArIHNvdXJjZVJvb3QgKyAiXSIsIGV4cCk7Ci0gICAgICAgICAgICB9Ci0gICAg
ICAgIH0gY2F0Y2ggKElPRXhjZXB0aW9uIGlvZSkgewotICAgICAgICAgICAgdGhyb3cgbmV3IEhp
c3RvcnlFeGNlcHRpb24oIkZhaWxlZCB0byBnZXQgcGF0aCBmb3I6ICIgKyBmaWxlLCBpb2UpOwot
ICAgICAgICB9Ci0gICAgICAgIGlmIChhZGQubGVuZ3RoKCkgPT0gMCkgewotICAgICAgICAgICAg
YWRkID0gRmlsZS5zZXBhcmF0b3I7Ci0gICAgICAgIH0KLSAgICAgICAgc2IuYXBwZW5kKGFkZCk7
Ci0gICAgICAgIHNiLmFwcGVuZCgiLmd6Iik7CiAgICAgICAgIAogICAgICAgICByZXR1cm4gbmV3
IEZpbGUoc2IudG9TdHJpbmcoKSk7CiAgICAgfQpAQCAtMjgxLDkgKzI3MSwxNCBAQAogICAgICAg
ICBpZiAocmVwb3MgPT0gbnVsbCkgewogICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAg
IH0KLSAgICAgICAgRmlsZSBkaXIgPSBSdW50aW1lRW52aXJvbm1lbnQuZ2V0SW5zdGFuY2UoKS5n
ZXREYXRhUm9vdEZpbGUoKTsKKyAgICAgICAgUnVudGltZUVudmlyb25tZW50IGVudiA9IFJ1bnRp
bWVFbnZpcm9ubWVudC5nZXRJbnN0YW5jZSgpOworICAgICAgICBGaWxlIGRpciA9IGVudi5nZXRE
YXRhUm9vdEZpbGUoKTsKICAgICAgICAgZGlyID0gbmV3IEZpbGUoZGlyLCAiaGlzdG9yeWNhY2hl
Iik7Ci0gICAgICAgIGRpciA9IG5ldyBGaWxlKGRpciwgcmVwb3MuZ2V0RGlyZWN0b3J5TmFtZSgp
LnN1YnN0cmluZyhSdW50aW1lRW52aXJvbm1lbnQuZ2V0SW5zdGFuY2UoKS5nZXRTb3VyY2VSb290
UGF0aCgpLmxlbmd0aCgpKSk7CisgICAgICAgIHRyeSB7CisgICAgICAgICAgICBkaXIgPSBuZXcg
RmlsZShkaXIsIGVudi5nZXRQYXRoUmVsYXRpdmVUb1NvdXJjZVJvb3QobmV3IEZpbGUocmVwb3Mu
Z2V0RGlyZWN0b3J5TmFtZSgpKSwgMCkpOworICAgICAgICB9IGNhdGNoIChJT0V4Y2VwdGlvbiBl
KSB7CisgICAgICAgICAgICB0aHJvdyBuZXcgSGlzdG9yeUV4Y2VwdGlvbigiQ291bGQgbm90IHJl
c29sdmUgIityZXBvcy5nZXREaXJlY3RvcnlOYW1lKCkrIiByZWxhdGl2ZSB0byBzb3VyY2Ugcm9v
dCIsIGUpOworICAgICAgICB9CiAgICAgICAgIHJldHVybiBkaXIuZXhpc3RzKCk7CiAgICAgfQog
CmRpZmYgLXIgZGZhMTg1ODc1MTdlIHNyYy9vcmcvb3BlbnNvbGFyaXMvb3Blbmdyb2svaGlzdG9y
eS9HaXRIaXN0b3J5UGFyc2VyLmphdmEKLS0tIGEvc3JjL29yZy9vcGVuc29sYXJpcy9vcGVuZ3Jv
ay9oaXN0b3J5L0dpdEhpc3RvcnlQYXJzZXIuamF2YQlGcmkgTWF5IDIxIDE3OjA0OjA0IDIwMTAg
LTA2MDAKKysrIGIvc3JjL29yZy9vcGVuc29sYXJpcy9vcGVuZ3Jvay9oaXN0b3J5L0dpdEhpc3Rv
cnlQYXJzZXIuamF2YQlNb24gTWF5IDI0IDEzOjM2OjI5IDIwMTAgLTA2MDAKQEAgLTI2LDYgKzI2
LDcgQEAKIGltcG9ydCBqYXZhLmlvLkJ1ZmZlcmVkUmVhZGVyOwogaW1wb3J0IGphdmEuaW8uQnl0
ZUFycmF5SW5wdXRTdHJlYW07CiBpbXBvcnQgamF2YS5pby5GaWxlOworaW1wb3J0IGphdmEuaW8u
RmlsZU5vdEZvdW5kRXhjZXB0aW9uOwogaW1wb3J0IGphdmEuaW8uSU9FeGNlcHRpb247CiBpbXBv
cnQgamF2YS5pby5JbnB1dFN0cmVhbTsKIGltcG9ydCBqYXZhLmlvLklucHV0U3RyZWFtUmVhZGVy
OwpAQCAtNDgsNyArNDksNiBAQAogICAgIH07ICAgICAgCiAKICAgICBwcml2YXRlIFN0cmluZyBt
eURpcjsKLSAgICBwcml2YXRlIGludCByb290TGVuZ3RoOwogICAgIHByaXZhdGUgSGlzdG9yeSBo
aXN0b3J5OwogICAgIHByaXZhdGUgR2l0UmVwb3NpdG9yeSByZXBvc2l0b3J5PW5ldyBHaXRSZXBv
c2l0b3J5KCk7CiAgICAgCkBAIC0xMTcsOCArMTE3LDE0IEBACiAgICAgICAgICAgICAgICAgfSBl
bHNlIHsKICAgICAgICAgICAgICAgICAgICAgaWYgKGVudHJ5ICE9IG51bGwpIHsKICAgICAgICAg
ICAgICAgICAgICAgICAgIEZpbGUgZiA9IG5ldyBGaWxlKG15RGlyLCBzKTsKLSAgICAgICAgICAg
ICAgICAgICAgICAgIFN0cmluZyBuYW1lID0gZi5nZXRDYW5vbmljYWxQYXRoKCkuc3Vic3RyaW5n
KHJvb3RMZW5ndGgpOwotICAgICAgICAgICAgICAgICAgICAgICAgZW50cnkuYWRkRmlsZShuYW1l
KTsKKyAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7CisgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgU3RyaW5nIG5hbWUgPSBSdW50aW1lRW52aXJvbm1lbnQuZ2V0SW5zdGFuY2UoKS5nZXRQ
YXRoUmVsYXRpdmVUb1NvdXJjZVJvb3QoZiwgMCk7CisgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgZW50cnkuYWRkRmlsZShuYW1lKTsKKyAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2gg
KEZpbGVOb3RGb3VuZEV4Y2VwdGlvbiBlKSB7CisgICAgICAgICAgICAgICAgICAgICAgICAgICAg
Ly8gVE9ETzogdGhpcyB3YXMgYWRkZWQgdG8gbWFrZSB0aGUganVuaXQgdGVzdHMgcGFzcywKKyAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBidXQgSSB0aGluayB0aGUgdGVzdHMgYXJlIGJy
b2tlbgorICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVudHJ5LmFkZEZpbGUoZi5nZXRBYnNv
bHV0ZVBhdGgoKSk7IC8vIGFkZCBldmVuIGlmIG5vdCB1bmRlciBzb3VyY2Ugcm9vdAorICAgICAg
ICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg
ICAgfQogICAgICAgICAgICAgfQpAQCAtMTQxLDE0ICsxNDcsMTggQEAKICAgICAgKi8KICAgICBI
aXN0b3J5IHBhcnNlKEZpbGUgZmlsZSwgUmVwb3NpdG9yeSByZXBvcykgdGhyb3dzIEhpc3RvcnlF
eGNlcHRpb24gewogICAgICAgICBteURpciA9IHJlcG9zLmdldERpcmVjdG9yeU5hbWUoKSsgRmls
ZS5zZXBhcmF0b3I7Ci0gICAgICAgIHJvb3RMZW5ndGggPSBSdW50aW1lRW52aXJvbm1lbnQuZ2V0
SW5zdGFuY2UoKS5nZXRTb3VyY2VSb290UGF0aCgpLmxlbmd0aCgpOwogICAgICAgICByZXBvc2l0
b3J5ID0gKEdpdFJlcG9zaXRvcnkpIHJlcG9zOwotICAgICAgICBFeGVjdXRvciBleGVjdXRvciA9
IHJlcG9zaXRvcnkuZ2V0SGlzdG9yeUxvZ0V4ZWN1dG9yKGZpbGUpOwotICAgICAgICBpbnQgc3Rh
dHVzID0gZXhlY3V0b3IuZXhlYyh0cnVlLCB0aGlzKTsKLQotICAgICAgICBpZiAoc3RhdHVzICE9
IDApIHsKKyAgICAgICAgdHJ5IHsKKyAgICAgICAgICAgIEV4ZWN1dG9yIGV4ZWN1dG9yID0gcmVw
b3NpdG9yeS5nZXRIaXN0b3J5TG9nRXhlY3V0b3IoZmlsZSk7CisgICAgICAgICAgICBpbnQgc3Rh
dHVzID0gZXhlY3V0b3IuZXhlYyh0cnVlLCB0aGlzKTsKKyAgICAgICAgICAgIAorICAgICAgICAg
ICAgaWYgKHN0YXR1cyAhPSAwKSB7CisgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEhpc3RvcnlF
eGNlcHRpb24oIkZhaWxlZCB0byBnZXQgaGlzdG9yeSBmb3I6IFwiIiArCisgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZS5nZXRBYnNvbHV0ZVBhdGgoKSArICJc
IiBFeGl0IGNvZGU6ICIgKyBzdGF0dXMpOworICAgICAgICAgICAgfQorICAgICAgICB9IGNhdGNo
IChJT0V4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICB0aHJvdyBuZXcgSGlzdG9yeUV4Y2VwdGlv
bigiRmFpbGVkIHRvIGdldCBoaXN0b3J5IGZvcjogXCIiICsKLSAgICAgICAgICAgICAgICAgICAg
ZmlsZS5nZXRBYnNvbHV0ZVBhdGgoKSArICJcIiBFeGl0IGNvZGU6ICIgKyBzdGF0dXMpOworICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZS5nZXRBYnNvbHV0ZVBhdGgo
KSArICJcIiIsIGUpOwogICAgICAgICB9CiAKICAgICAgICAgcmV0dXJuIGhpc3Rvcnk7CkBAIC0x
NjMsNyArMTczLDYgQEAKICAgICAgKi8KICAgICBIaXN0b3J5IHBhcnNlKFN0cmluZyBidWZmZXIp
IHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgIG15RGlyID0gRmlsZS5zZXBhcmF0b3I7Ci0g
ICAgICAgIHJvb3RMZW5ndGggPSAwOwogICAgICAgICBwcm9jZXNzU3RyZWFtKG5ldyBCeXRlQXJy
YXlJbnB1dFN0cmVhbShidWZmZXIuZ2V0Qnl0ZXMoIlVURi04IikpKTsKICAgICAgICAgcmV0dXJu
IGhpc3Rvcnk7CiAgICAgfQpkaWZmIC1yIGRmYTE4NTg3NTE3ZSBzcmMvb3JnL29wZW5zb2xhcmlz
L29wZW5ncm9rL2hpc3RvcnkvR2l0UmVwb3NpdG9yeS5qYXZhCi0tLSBhL3NyYy9vcmcvb3BlbnNv
bGFyaXMvb3Blbmdyb2svaGlzdG9yeS9HaXRSZXBvc2l0b3J5LmphdmEJRnJpIE1heSAyMSAxNzow
NDowNCAyMDEwIC0wNjAwCisrKyBiL3NyYy9vcmcvb3BlbnNvbGFyaXMvb3Blbmdyb2svaGlzdG9y
eS9HaXRSZXBvc2l0b3J5LmphdmEJTW9uIE1heSAyNCAxMzozNjoyOSAyMDEwIC0wNjAwCkBAIC02
MSw4ICs2MSw4IEBACiAgICAgICogQHBhcmFtIGZpbGUgVGhlIGZpbGUgdG8gcmV0cmlldmUgaGlz
dG9yeSBmb3IKICAgICAgKiBAcmV0dXJuIEFuIEV4ZWN1dG9yIHJlYWR5IHRvIGJlIHN0YXJ0ZWQK
ICAgICAgKi8KLSAgICBFeGVjdXRvciBnZXRIaXN0b3J5TG9nRXhlY3V0b3IoZmluYWwgRmlsZSBm
aWxlKSB7Ci0gICAgICAgIFN0cmluZyBhYnMgPSBmaWxlLmdldEFic29sdXRlUGF0aCgpOworICAg
IEV4ZWN1dG9yIGdldEhpc3RvcnlMb2dFeGVjdXRvcihmaW5hbCBGaWxlIGZpbGUpIHRocm93cyBJ
T0V4Y2VwdGlvbiB7CisgICAgICAgIFN0cmluZyBhYnMgPSBmaWxlLmdldENhbm9uaWNhbFBhdGgo
KTsKICAgICAgICAgU3RyaW5nIGZpbGVuYW1lID0gIiI7CiAgICAgICAgIGlmIChhYnMubGVuZ3Ro
KCkgPiBkaXJlY3RvcnlOYW1lLmxlbmd0aCgpKSB7CiAgICAgICAgICAgICBmaWxlbmFtZSA9IGFi
cy5zdWJzdHJpbmcoZGlyZWN0b3J5TmFtZS5sZW5ndGgoKSArIDEpOwpAQCAtOTcsOSArOTcsOSBA
QAogICAgICAgICBCeXRlQXJyYXlPdXRwdXRTdHJlYW0gb3V0cHV0ID0gbmV3IEJ5dGVBcnJheU91
dHB1dFN0cmVhbSgpOwogICAgICAgICBieXRlW10gYnVmZmVyID0gbmV3IGJ5dGVbODE5Ml07CiAg
ICAgICAgIAotICAgICAgICBTdHJpbmcgZmlsZW5hbWUgPSAgKG5ldyBGaWxlKHBhcmVudCwgYmFz
ZW5hbWUpKS5nZXRBYnNvbHV0ZVBhdGgoKS5zdWJzdHJpbmcoZGlyZWN0b3J5TmFtZS5sZW5ndGgo
KSArIDEpOwogICAgICAgICBQcm9jZXNzIHByb2Nlc3MgPSBudWxsOwogICAgICAgICB0cnkgewor
ICAgICAgICAgICAgU3RyaW5nIGZpbGVuYW1lID0gIChuZXcgRmlsZShwYXJlbnQsIGJhc2VuYW1l
KSkuZ2V0Q2Fub25pY2FsUGF0aCgpLnN1YnN0cmluZyhkaXJlY3RvcnlOYW1lLmxlbmd0aCgpICsg
MSk7CiAgICAgICAgICAgICBTdHJpbmcgYXJndltdID0ge2dldENvbW1hbmQoKSwgInNob3ciLCBy
ZXYgKyAiOiIgKyBmaWxlbmFtZX07CiAgICAgICAgICAgICBwcm9jZXNzID0gUnVudGltZS5nZXRS
dW50aW1lKCkuZXhlYyhhcmd2LCBudWxsLCBkaXJlY3RvcnkpOwogICAgICAgICAgICAgCmRpZmYg
LXIgZGZhMTg1ODc1MTdlIHNyYy9vcmcvb3BlbnNvbGFyaXMvb3Blbmdyb2svaGlzdG9yeS9NZXJj
dXJpYWxIaXN0b3J5UGFyc2VyLmphdmEKLS0tIGEvc3JjL29yZy9vcGVuc29sYXJpcy9vcGVuZ3Jv
ay9oaXN0b3J5L01lcmN1cmlhbEhpc3RvcnlQYXJzZXIuamF2YQlGcmkgTWF5IDIxIDE3OjA0OjA0
IDIwMTAgLTA2MDAKKysrIGIvc3JjL29yZy9vcGVuc29sYXJpcy9vcGVuZ3Jvay9oaXN0b3J5L01l
cmN1cmlhbEhpc3RvcnlQYXJzZXIuamF2YQlNb24gTWF5IDI0IDEzOjM2OjI5IDIwMTAgLTA2MDAK
QEAgLTI1LDYgKzI1LDcgQEAKIAogaW1wb3J0IGphdmEuaW8uQnVmZmVyZWRSZWFkZXI7CiBpbXBv
cnQgamF2YS5pby5GaWxlOworaW1wb3J0IGphdmEuaW8uRmlsZU5vdEZvdW5kRXhjZXB0aW9uOwog
aW1wb3J0IGphdmEuaW8uSU9FeGNlcHRpb247CiBpbXBvcnQgamF2YS5pby5JbnB1dFN0cmVhbTsK
IGltcG9ydCBqYXZhLmlvLklucHV0U3RyZWFtUmVhZGVyOwpAQCAtNDksMTIgKzUwLDEwIEBACiAg
ICAgcHJpdmF0ZSBMaXN0PEhpc3RvcnlFbnRyeT4gZW50cmllcyA9IG5ldyBBcnJheUxpc3Q8SGlz
dG9yeUVudHJ5PigpOwogICAgIHByaXZhdGUgZmluYWwgTWVyY3VyaWFsUmVwb3NpdG9yeSByZXBv
c2l0b3J5OwogICAgIHByaXZhdGUgZmluYWwgU3RyaW5nIG15ZGlyOwotICAgIHByaXZhdGUgZmlu
YWwgU3RyaW5nIHJvb3RQYXRoOwogCiAgICAgTWVyY3VyaWFsSGlzdG9yeVBhcnNlcihNZXJjdXJp
YWxSZXBvc2l0b3J5IHJlcG9zaXRvcnkpIHsKICAgICAgICAgdGhpcy5yZXBvc2l0b3J5ID0gcmVw
b3NpdG9yeTsKICAgICAgICAgbXlkaXIgPSByZXBvc2l0b3J5LmdldERpcmVjdG9yeU5hbWUoKSAr
IEZpbGUuc2VwYXJhdG9yOwotICAgICAgICByb290UGF0aCA9IFJ1bnRpbWVFbnZpcm9ubWVudC5n
ZXRJbnN0YW5jZSgpLmdldFNvdXJjZVJvb3RQYXRoKCk7CiAgICAgfQogCiAgICAgLyoqCkBAIC02
OSwxMiArNjgsMTcgQEAKICAgICAgKiBAdGhyb3dzIEhpc3RvcnlFeGNlcHRpb24gaWYgYW4gZXJy
b3IgaGFwcGVucyB3aGVuIHBhcnNpbmcgdGhlIGhpc3RvcnkKICAgICAgKi8KICAgICBIaXN0b3J5
IHBhcnNlKEZpbGUgZmlsZSwgU3RyaW5nIGNoYW5nZXNldCkgdGhyb3dzIEhpc3RvcnlFeGNlcHRp
b24gewotICAgICAgICBFeGVjdXRvciBleGVjdXRvciA9IHJlcG9zaXRvcnkuZ2V0SGlzdG9yeUxv
Z0V4ZWN1dG9yKGZpbGUsIGNoYW5nZXNldCk7Ci0gICAgICAgIGludCBzdGF0dXMgPSBleGVjdXRv
ci5leGVjKHRydWUsIHRoaXMpOwotICAgICAgICAKLSAgICAgICAgaWYgKHN0YXR1cyAhPSAwKSB7
CisgICAgICAgIHRyeSB7CisgICAgICAgICAgICBFeGVjdXRvciBleGVjdXRvciA9IHJlcG9zaXRv
cnkuZ2V0SGlzdG9yeUxvZ0V4ZWN1dG9yKGZpbGUsIGNoYW5nZXNldCk7CisgICAgICAgICAgICBp
bnQgc3RhdHVzID0gZXhlY3V0b3IuZXhlYyh0cnVlLCB0aGlzKTsKKyAgICAgICAgICAgIAorICAg
ICAgICAgICAgaWYgKHN0YXR1cyAhPSAwKSB7CisgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEhp
c3RvcnlFeGNlcHRpb24oIkZhaWxlZCB0byBnZXQgaGlzdG9yeSBmb3I6IFwiIiArCisgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZS5nZXRBYnNvbHV0ZVBhdGgo
KSArICJcIiBFeGl0IGNvZGU6ICIgKyBzdGF0dXMpOworICAgICAgICAgICAgfQorICAgICAgICB9
IGNhdGNoIChJT0V4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICB0aHJvdyBuZXcgSGlzdG9yeUV4
Y2VwdGlvbigiRmFpbGVkIHRvIGdldCBoaXN0b3J5IGZvcjogXCIiICsKLSAgICAgICAgICAgICAg
ICAgICAgZmlsZS5nZXRBYnNvbHV0ZVBhdGgoKSArICJcIiBFeGl0IGNvZGU6ICIgKyBzdGF0dXMp
OworICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZS5nZXRBYnNvbHV0
ZVBhdGgoKSArICJcIiIsIGUpOwogICAgICAgICB9CiAKICAgICAgICAgLy8gSWYgYSBjaGFuZ2Vz
ZXQgdG8gc3RhcnQgZnJvbSBpcyBzcGVjaWZpZWQsIHJlbW92ZSB0aGF0IGNoYW5nZXNldApAQCAt
OTcsNiArMTAxLDcgQEAKICAgICAgKi8KICAgICBAT3ZlcnJpZGUKICAgICBwdWJsaWMgdm9pZCBw
cm9jZXNzU3RyZWFtKElucHV0U3RyZWFtIGlucHV0KSB0aHJvd3MgSU9FeGNlcHRpb24geworICAg
ICAgICBSdW50aW1lRW52aXJvbm1lbnQgZW52ID0gUnVudGltZUVudmlyb25tZW50LmdldEluc3Rh
bmNlKCk7CiAgICAgICAgIERhdGVGb3JtYXQgZGYgPSByZXBvc2l0b3J5LmdldERhdGVGb3JtYXQo
KTsKICAgICAgICAgQnVmZmVyZWRSZWFkZXIgaW4gPSBuZXcgQnVmZmVyZWRSZWFkZXIobmV3IElu
cHV0U3RyZWFtUmVhZGVyKGlucHV0KSk7CiAgICAgICAgIGVudHJpZXMgPSBuZXcgQXJyYXlMaXN0
PEhpc3RvcnlFbnRyeT4oKTsKQEAgLTEyMywxMiArMTI4LDExIEBACiAgICAgICAgICAgICAgICAg
Zm9yIChpbnQgaWkgPSAxOyBpaSA8IHN0cmluZ3MubGVuZ3RoOyArK2lpKSB7CiAgICAgICAgICAg
ICAgICAgICAgIGlmIChzdHJpbmdzW2lpXS5sZW5ndGgoKSA+IDApIHsKICAgICAgICAgICAgICAg
ICAgICAgICAgIEZpbGUgZiA9IG5ldyBGaWxlKG15ZGlyLCBzdHJpbmdzW2lpXSk7Ci0gICAgICAg
ICAgICAgICAgICAgICAgICBTdHJpbmcgbmFtZSA9IGYuZ2V0Q2Fub25pY2FsUGF0aCgpOwotICAg
ICAgICAgICAgICAgICAgICAgICAgLy8gU3RyaXAgYXdheSB0aGUgZGlyZWN0b3JpZXMgdXAgdG8g
dGhlIHNvdXJjZSByb290LgotICAgICAgICAgICAgICAgICAgICAgICAgLy8gSWYgdGhlIGZpbGUg
aXMgbm90IGxvY2F0ZWQgdW5kZXIgdGhlIHNvdXJjZSByb290LAotICAgICAgICAgICAgICAgICAg
ICAgICAgLy8gaWdub3JlIGl0IChidWcgIzExNjY0KS4KLSAgICAgICAgICAgICAgICAgICAgICAg
IGlmIChuYW1lLnN0YXJ0c1dpdGgocm9vdFBhdGgpKSB7Ci0gICAgICAgICAgICAgICAgICAgICAg
ICAgICAgZW50cnkuYWRkRmlsZShuYW1lLnN1YnN0cmluZyhyb290UGF0aC5sZW5ndGgoKSkpOwor
ICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHsKKyAgICAgICAgICAgICAgICAgICAgICAgICAg
ICBlbnRyeS5hZGRGaWxlKGVudi5nZXRQYXRoUmVsYXRpdmVUb1NvdXJjZVJvb3QoZiwgMCkpOwor
ICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoRmlsZU5vdEZvdW5kRXhjZXB0aW9uIGUp
IHsgLy8gTk9QTUQKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBJZiB0aGUgZmlsZSBp
cyBub3QgbG9jYXRlZCB1bmRlciB0aGUgc291cmNlIHJvb3QsCisgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgLy8gaWdub3JlIGl0IChidWcgIzExNjY0KS4KICAgICAgICAgICAgICAgICAgICAg
ICAgIH0KICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgIH0KZGlmZiAtciBk
ZmExODU4NzUxN2Ugc3JjL29yZy9vcGVuc29sYXJpcy9vcGVuZ3Jvay9oaXN0b3J5L01lcmN1cmlh
bFJlcG9zaXRvcnkuamF2YQotLS0gYS9zcmMvb3JnL29wZW5zb2xhcmlzL29wZW5ncm9rL2hpc3Rv
cnkvTWVyY3VyaWFsUmVwb3NpdG9yeS5qYXZhCUZyaSBNYXkgMjEgMTc6MDQ6MDQgMjAxMCAtMDYw
MAorKysgYi9zcmMvb3JnL29wZW5zb2xhcmlzL29wZW5ncm9rL2hpc3RvcnkvTWVyY3VyaWFsUmVw
b3NpdG9yeS5qYXZhCU1vbiBNYXkgMjQgMTM6MzY6MjkgMjAxMCAtMDYwMApAQCAtNzksOSArNzks
OSBAQAogICAgICAqIEByZXR1cm4gQW4gRXhlY3V0b3IgcmVhZHkgdG8gYmUgc3RhcnRlZAogICAg
ICAqLwogICAgIEV4ZWN1dG9yIGdldEhpc3RvcnlMb2dFeGVjdXRvcihGaWxlIGZpbGUsIFN0cmlu
ZyBjaGFuZ2VzZXQpCi0gICAgICAgICAgICB0aHJvd3MgSGlzdG9yeUV4Y2VwdGlvbgorICAgICAg
ICAgICAgIHRocm93cyBIaXN0b3J5RXhjZXB0aW9uLCBJT0V4Y2VwdGlvbgogICAgIHsKLSAgICAg
ICAgU3RyaW5nIGFicyA9IGZpbGUuZ2V0QWJzb2x1dGVQYXRoKCk7CisgICAgICAgIFN0cmluZyBh
YnMgPSBmaWxlLmdldENhbm9uaWNhbFBhdGgoKTsKICAgICAgICAgU3RyaW5nIGZpbGVuYW1lID0g
IiI7CiAgICAgICAgIGlmIChhYnMubGVuZ3RoKCkgPiBkaXJlY3RvcnlOYW1lLmxlbmd0aCgpKSB7
CiAgICAgICAgICAgICBmaWxlbmFtZSA9IGFicy5zdWJzdHJpbmcoZGlyZWN0b3J5TmFtZS5sZW5n
dGgoKSArIDEpOwpAQCAtMTE3LDcgKzExNyw2IEBACiAKICAgICAgICAgRmlsZSBkaXJlY3Rvcnkg
PSBuZXcgRmlsZShkaXJlY3RvcnlOYW1lKTsKIAotICAgICAgICBTdHJpbmcgZmlsZW5hbWUgPSAg
KG5ldyBGaWxlKHBhcmVudCwgYmFzZW5hbWUpKS5nZXRBYnNvbHV0ZVBhdGgoKS5zdWJzdHJpbmco
ZGlyZWN0b3J5TmFtZS5sZW5ndGgoKSArIDEpOwogICAgICAgICBQcm9jZXNzIHByb2Nlc3MgPSBu
dWxsOwogICAgICAgICBJbnB1dFN0cmVhbSBpbiA9IG51bGw7CiAgICAgICAgIFN0cmluZyByZXZp
c2lvbiA9IHJldjsKQEAgLTEyNiw2ICsxMjUsNyBAQAogICAgICAgICAgICAgcmV2aXNpb24gPSBy
ZXYuc3Vic3RyaW5nKDAsIHJldi5pbmRleE9mKCc6JykpOwogICAgICAgICB9CiAgICAgICAgIHRy
eSB7CisgICAgICAgICAgICBTdHJpbmcgZmlsZW5hbWUgPSAgKG5ldyBGaWxlKHBhcmVudCwgYmFz
ZW5hbWUpKS5nZXRDYW5vbmljYWxQYXRoKCkuc3Vic3RyaW5nKGRpcmVjdG9yeU5hbWUubGVuZ3Ro
KCkgKyAxKTsKICAgICAgICAgICAgIFN0cmluZyBhcmd2W10gPSB7Z2V0Q29tbWFuZCgpLCAiY2F0
IiwgIi1yIiwgcmV2aXNpb24sIGZpbGVuYW1lfTsKICAgICAgICAgICAgIHByb2Nlc3MgPSBSdW50
aW1lLmdldFJ1bnRpbWUoKS5leGVjKGFyZ3YsIG51bGwsIGRpcmVjdG9yeSk7CiAgICAgICAgICAg
ICAKZGlmZiAtciBkZmExODU4NzUxN2Ugc3JjL29yZy9vcGVuc29sYXJpcy9vcGVuZ3Jvay9oaXN0
b3J5L01vbm90b25lSGlzdG9yeVBhcnNlci5qYXZhCi0tLSBhL3NyYy9vcmcvb3BlbnNvbGFyaXMv
b3Blbmdyb2svaGlzdG9yeS9Nb25vdG9uZUhpc3RvcnlQYXJzZXIuamF2YQlGcmkgTWF5IDIxIDE3
OjA0OjA0IDIwMTAgLTA2MDAKKysrIGIvc3JjL29yZy9vcGVuc29sYXJpcy9vcGVuZ3Jvay9oaXN0
b3J5L01vbm90b25lSGlzdG9yeVBhcnNlci5qYXZhCU1vbiBNYXkgMjQgMTM6MzY6MjkgMjAxMCAt
MDYwMApAQCAtMjUsNiArMjUsNyBAQAogCiBpbXBvcnQgamF2YS5pby5CdWZmZXJlZFJlYWRlcjsK
IGltcG9ydCBqYXZhLmlvLkZpbGU7CitpbXBvcnQgamF2YS5pby5GaWxlTm90Rm91bmRFeGNlcHRp
b247CiBpbXBvcnQgamF2YS5pby5JT0V4Y2VwdGlvbjsKIGltcG9ydCBqYXZhLmlvLklucHV0U3Ry
ZWFtOwogaW1wb3J0IGphdmEuaW8uSW5wdXRTdHJlYW1SZWFkZXI7CkBAIC00OCwxMyArNDksMTAg
QEAKICAgICBwcml2YXRlIExpc3Q8SGlzdG9yeUVudHJ5PiBlbnRyaWVzID0gbmV3IEFycmF5TGlz
dDxIaXN0b3J5RW50cnk+KCk7IC8vTk9QTUQKICAgICBwcml2YXRlIGZpbmFsIE1vbm90b25lUmVw
b3NpdG9yeSByZXBvc2l0b3J5OwogICAgIHByaXZhdGUgZmluYWwgU3RyaW5nIG15ZGlyOwotICAg
IHByaXZhdGUgZmluYWwgaW50IHJvb3RMZW5ndGg7CiAKICAgICBNb25vdG9uZUhpc3RvcnlQYXJz
ZXIoTW9ub3RvbmVSZXBvc2l0b3J5IHJlcG9zaXRvcnkpIHsKICAgICAgICAgdGhpcy5yZXBvc2l0
b3J5ID0gcmVwb3NpdG9yeTsKICAgICAgICAgbXlkaXIgPSByZXBvc2l0b3J5LmdldERpcmVjdG9y
eU5hbWUoKSArIEZpbGUuc2VwYXJhdG9yOwotICAgICAgICByb290TGVuZ3RoID0KLSAgICAgICAg
ICAgICAgICBSdW50aW1lRW52aXJvbm1lbnQuZ2V0SW5zdGFuY2UoKS5nZXRTb3VyY2VSb290UGF0
aCgpLmxlbmd0aCgpOwogICAgIH0KIAogICAgIC8qKgpAQCAtNjksMTIgKzY3LDE3IEBACiAgICAg
ICogQHRocm93cyBIaXN0b3J5RXhjZXB0aW9uIGlmIGFuIGVycm9yIGhhcHBlbnMgd2hlbiBwYXJz
aW5nIHRoZSBoaXN0b3J5CiAgICAgICovCiAgICAgSGlzdG9yeSBwYXJzZShGaWxlIGZpbGUsIFN0
cmluZyBjaGFuZ2VzZXQpIHRocm93cyBIaXN0b3J5RXhjZXB0aW9uIHsKLSAgICAgICAgRXhlY3V0
b3IgZXhlY3V0b3IgPSByZXBvc2l0b3J5LmdldEhpc3RvcnlMb2dFeGVjdXRvcihmaWxlLCBjaGFu
Z2VzZXQpOwotICAgICAgICBpbnQgc3RhdHVzID0gZXhlY3V0b3IuZXhlYyh0cnVlLCB0aGlzKTsK
LQotICAgICAgICBpZiAoc3RhdHVzICE9IDApIHsKKyAgICAgICAgdHJ5IHsKKyAgICAgICAgICAg
IEV4ZWN1dG9yIGV4ZWN1dG9yID0gcmVwb3NpdG9yeS5nZXRIaXN0b3J5TG9nRXhlY3V0b3IoZmls
ZSwgY2hhbmdlc2V0KTsKKyAgICAgICAgICAgIGludCBzdGF0dXMgPSBleGVjdXRvci5leGVjKHRy
dWUsIHRoaXMpOworICAgICAgICAgICAgCisgICAgICAgICAgICBpZiAoc3RhdHVzICE9IDApIHsK
KyAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSGlzdG9yeUV4Y2VwdGlvbigiRmFpbGVkIHRvIGdl
dCBoaXN0b3J5IGZvcjogXCIiICsKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBmaWxlLmdldEFic29sdXRlUGF0aCgpICsgIlwiIEV4aXQgY29kZTogIiArIHN0YXR1
cyk7CisgICAgICAgICAgICB9CisgICAgICAgIH0gY2F0Y2ggKElPRXhjZXB0aW9uIGUpIHsKICAg
ICAgICAgICAgIHRocm93IG5ldyBIaXN0b3J5RXhjZXB0aW9uKCJGYWlsZWQgdG8gZ2V0IGhpc3Rv
cnkgZm9yOiBcIiIgKwotICAgICAgICAgICAgICAgICAgICBmaWxlLmdldEFic29sdXRlUGF0aCgp
ICsgIlwiIEV4aXQgY29kZTogIiArIHN0YXR1cyk7CisgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICBmaWxlLmdldEFic29sdXRlUGF0aCgpICsgIlwiIiwgZSk7CiAgICAgICAg
IH0KIAogICAgICAgICByZXR1cm4gbmV3IEhpc3RvcnkoZW50cmllcyk7CkBAIC04OSw2ICs5Miw3
IEBACiAgICAgICovCiAgICAgQE92ZXJyaWRlCiAgICAgcHVibGljIHZvaWQgcHJvY2Vzc1N0cmVh
bShJbnB1dFN0cmVhbSBpbnB1dCkgdGhyb3dzIElPRXhjZXB0aW9uIHsKKyAgICAgICAgUnVudGlt
ZUVudmlyb25tZW50IGVudiA9IFJ1bnRpbWVFbnZpcm9ubWVudC5nZXRJbnN0YW5jZSgpOwogICAg
ICAgICBEYXRlRm9ybWF0IGRmID0gcmVwb3NpdG9yeS5nZXREYXRlRm9ybWF0KCk7CiAgICAgICAg
IEJ1ZmZlcmVkUmVhZGVyIGluID0gbmV3IEJ1ZmZlcmVkUmVhZGVyKG5ldyBJbnB1dFN0cmVhbVJl
YWRlcihpbnB1dCkpOwogICAgICAgICBTdHJpbmcgczsKQEAgLTE1MCw4ICsxNTQsMTEgQEAKICAg
ICAgICAgICAgICAgICAgICAgICAgIFN0cmluZyBmaWxlc1tdID0gcy5zcGxpdCgiICIpOwogICAg
ICAgICAgICAgICAgICAgICAgICAgZm9yIChTdHJpbmcgZiA6IGZpbGVzKSB7CiAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgRmlsZSBmaWxlID0gbmV3IEZpbGUobXlkaXIsIGYpOwotICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIFN0cmluZyBuYW1lID0gZmlsZS5nZXRDYW5vbmljYWxQYXRo
KCkuc3Vic3RyaW5nKHJvb3RMZW5ndGgpOwotICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVu
dHJ5LmFkZEZpbGUobmFtZSk7CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHsKKyAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW50cnkuYWRkRmlsZShlbnYuZ2V0UGF0aFJl
bGF0aXZlVG9Tb3VyY2VSb290KGZpbGUsIDApKTsKKyAgICAgICAgICAgICAgICAgICAgICAgICAg
ICB9IGNhdGNoIChGaWxlTm90Rm91bmRFeGNlcHRpb24gZSkgeyAvLyBOT1BNRAorICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAvLyBJZiB0aGUgZmlsZSBpcyBub3QgbG9jYXRlZCB1bmRl
ciB0aGUgc291cmNlIHJvb3QsIGlnbm9yZSBpdAorICAgICAgICAgICAgICAgICAgICAgICAgICAg
IH0KICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgfQogICAg
ICAgICAgICAgICAgICAgICBicmVhazsKZGlmZiAtciBkZmExODU4NzUxN2Ugc3JjL29yZy9vcGVu
c29sYXJpcy9vcGVuZ3Jvay9oaXN0b3J5L01vbm90b25lUmVwb3NpdG9yeS5qYXZhCi0tLSBhL3Ny
Yy9vcmcvb3BlbnNvbGFyaXMvb3Blbmdyb2svaGlzdG9yeS9Nb25vdG9uZVJlcG9zaXRvcnkuamF2
YQlGcmkgTWF5IDIxIDE3OjA0OjA0IDIwMTAgLTA2MDAKKysrIGIvc3JjL29yZy9vcGVuc29sYXJp
cy9vcGVuZ3Jvay9oaXN0b3J5L01vbm90b25lUmVwb3NpdG9yeS5qYXZhCU1vbiBNYXkgMjQgMTM6
MzY6MjkgMjAxMCAtMDYwMApAQCAtNjksMTIgKzY5LDEyIEBACiAKICAgICAgICAgRmlsZSBkaXJl
Y3RvcnkgPSBuZXcgRmlsZShkaXJlY3RvcnlOYW1lKTsKIAotICAgICAgICBTdHJpbmcgZmlsZW5h
bWUgPSAobmV3IEZpbGUocGFyZW50LCBiYXNlbmFtZSkpLmdldEFic29sdXRlUGF0aCgpLnN1YnN0
cmluZyhkaXJlY3RvcnlOYW1lLmxlbmd0aCgpICsgMSk7CiAgICAgICAgIFByb2Nlc3MgcHJvY2Vz
cyA9IG51bGw7CiAgICAgICAgIElucHV0U3RyZWFtIGluID0gbnVsbDsKICAgICAgICAgU3RyaW5n
IHJldmlzaW9uID0gcmV2OwogCiAgICAgICAgIHRyeSB7CisgICAgICAgICAgICBTdHJpbmcgZmls
ZW5hbWUgPSAobmV3IEZpbGUocGFyZW50LCBiYXNlbmFtZSkpLmdldENhbm9uaWNhbFBhdGgoKS5z
dWJzdHJpbmcoZGlyZWN0b3J5TmFtZS5sZW5ndGgoKSArIDEpOwogICAgICAgICAgICAgU3RyaW5n
IGFyZ3ZbXSA9IHtnZXRDb21tYW5kKCksICJjYXQiLCAiLXIiLCByZXZpc2lvbiwgZmlsZW5hbWV9
OwogICAgICAgICAgICAgcHJvY2VzcyA9IFJ1bnRpbWUuZ2V0UnVudGltZSgpLmV4ZWMoYXJndiwg
bnVsbCwgZGlyZWN0b3J5KTsKIApAQCAtMTE1LDggKzExNSw4IEBACiAgICAgfQogCiAgICAgRXhl
Y3V0b3IgZ2V0SGlzdG9yeUxvZ0V4ZWN1dG9yKEZpbGUgZmlsZSwgU3RyaW5nIGNoYW5nZXNldCkK
LSAgICAgICAgICAgIHRocm93cyBIaXN0b3J5RXhjZXB0aW9uIHsKLSAgICAgICAgU3RyaW5nIGFi
cyA9IGZpbGUuZ2V0QWJzb2x1dGVQYXRoKCk7CisgICAgICAgIHRocm93cyBIaXN0b3J5RXhjZXB0
aW9uLCBJT0V4Y2VwdGlvbiB7CisgICAgICAgIFN0cmluZyBhYnMgPSBmaWxlLmdldENhbm9uaWNh
bFBhdGgoKTsKICAgICAgICAgU3RyaW5nIGZpbGVuYW1lID0gIiI7CiAgICAgICAgIGlmIChhYnMu
bGVuZ3RoKCkgPiBkaXJlY3RvcnlOYW1lLmxlbmd0aCgpKSB7CiAgICAgICAgICAgICBmaWxlbmFt
ZSA9IGFicy5zdWJzdHJpbmcoZGlyZWN0b3J5TmFtZS5sZW5ndGgoKSArIDEpOwpkaWZmIC1yIGRm
YTE4NTg3NTE3ZSBzcmMvb3JnL29wZW5zb2xhcmlzL29wZW5ncm9rL2luZGV4L0NvbW1hbmRMaW5l
T3B0aW9ucy5qYXZhCi0tLSBhL3NyYy9vcmcvb3BlbnNvbGFyaXMvb3Blbmdyb2svaW5kZXgvQ29t
bWFuZExpbmVPcHRpb25zLmphdmEJRnJpIE1heSAyMSAxNzowNDowNCAyMDEwIC0wNjAwCisrKyBi
L3NyYy9vcmcvb3BlbnNvbGFyaXMvb3Blbmdyb2svaW5kZXgvQ29tbWFuZExpbmVPcHRpb25zLmph
dmEJTW9uIE1heSAyNCAxMzozNjoyOSAyMDEwIC0wNjAwCkBAIC03OCw2ICs3OCw3IEBACiAgICAg
ICAgIG9wdGlvbnMuYWRkKG5ldyBPcHRpb24oJ1AnLCBudWxsLCAiR2VuZXJhdGUgYSBwcm9qZWN0
IGZvciBlYWNoIG9mIHRoZSB0b3AtbGV2ZWwgZGlyZWN0b3JpZXMgaW4gc291cmNlIHJvb3QiKSk7
CiAgICAgICAgIG9wdGlvbnMuYWRkKG5ldyBPcHRpb24oJ3AnLCAiL3BhdGgvdG8vZGVmYXVsdC9w
cm9qZWN0IiwgIlRoaXMgaXMgdGhlIHBhdGggdG8gdGhlIHByb2plY3QgdGhhdCBzaG91bGQgYmUg
c2VsZWN0ZWQgYnkgZGVmYXVsdCBpbiB0aGUgd2ViIGFwcGxpY2F0aW9uKHdoZW4gbm8gb3RoZXIg
cHJvamVjdCBzZXQgZWl0aGVyIGluIGNvb2tpZSBvciBpbiBwYXJhbWV0ZXIpLiBZb3Ugc2hvdWxk
IHN0cmlwIG9mZiB0aGUgc291cmNlIHJvb3QuIikpOwogICAgICAgICBvcHRpb25zLmFkZChuZXcg
T3B0aW9uKCdRJywgT05fT0ZGLCAiVHVybiBvbi9vZmYgcXVpY2sgY29udGV4dCBzY2FuLiBCeSBk
ZWZhdWx0IG9ubHkgdGhlIGZpcnN0IDMyayBvZiBhIGZpbGUgaXMgc2Nhbm5lZCwgYW5kIGEgJ1su
LmFsbC4uXScgbGluayBpcyBpbnNlcnRlZCBpZiB0aGUgZmlsZSBpcyBiaWdnZXIuIEFjdGl2YXRp
bmcgdGhpcyBtYXkgc2xvdyB0aGUgc2VydmVyIGRvd24gKE5vdGU6IHRoaXMgaXMgc2V0dGluZyBv
bmx5IGFmZmVjdHMgdGhlIHdlYiBhcHBsaWNhdGlvbikiKSk7CisgICAgICAgIG9wdGlvbnMuYWRk
KG5ldyBPcHRpb24oJ04nLCAiL3BhdGgvdG8vc3ltbGluayIsICJBbGxvdyB0aGlzIHN5bWxpbmsg
dG8gYmUgZm9sbG93ZWQuIE9wdGlvbiBtYXkgYmUgcmVwZWF0ZWQuIikpOwogICAgICAgICBvcHRp
b25zLmFkZChuZXcgT3B0aW9uKCduJywgbnVsbCwgIkRvIG5vdCBnZW5lcmF0ZSBpbmRleGVzLCBi
dXQgcHJvY2VzcyBhbGwgb3RoZXIgY29tbWFuZCBsaW5lIG9wdGlvbnMiKSk7CiAgICAgICAgIG9w
dGlvbnMuYWRkKG5ldyBPcHRpb24oJ0gnLCBudWxsLCAiR2VuZXJhdGUgaGlzdG9yeSBjYWNoZSBm
b3IgYWxsIGV4dGVybmFsIHJlcG9zaXRvcmllcyIpKTsKICAgICAgICAgb3B0aW9ucy5hZGQobmV3
IE9wdGlvbignaCcsICIvcGF0aC90by9yZXBvc2l0b3J5IiwgIkdlbmVyYXRlIGhpc3RvcnkgY2Fj
aGUgZm9yIHRoZSBzcGVjaWZpZWQgcmVwb3MgKGFic29sdXRlIHBhdGggZnJvbSBzb3VyY2Ugcm9v
dCkiKSk7CmRpZmYgLXIgZGZhMTg1ODc1MTdlIHNyYy9vcmcvb3BlbnNvbGFyaXMvb3Blbmdyb2sv
aW5kZXgvSW5kZXhEYXRhYmFzZS5qYXZhCi0tLSBhL3NyYy9vcmcvb3BlbnNvbGFyaXMvb3Blbmdy
b2svaW5kZXgvSW5kZXhEYXRhYmFzZS5qYXZhCUZyaSBNYXkgMjEgMTc6MDQ6MDQgMjAxMCAtMDYw
MAorKysgYi9zcmMvb3JnL29wZW5zb2xhcmlzL29wZW5ncm9rL2luZGV4L0luZGV4RGF0YWJhc2Uu
amF2YQlNb24gTWF5IDI0IDEzOjM2OjI5IDIwMTAgLTA2MDAKQEAgLTYwOCwzMCArNjA4LDI3IEBA
CiAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgIH0KIAorICAgICAgICBTdHJpbmcg
YWJzb2x1dGVQYXRoID0gZmlsZS5nZXRBYnNvbHV0ZVBhdGgoKTsKKwogICAgICAgICBpZiAoIWZp
bGUuY2FuUmVhZCgpKSB7Ci0gICAgICAgICAgICBsb2cud2FybmluZygiV2FybmluZzogY291bGQg
bm90IHJlYWQgIiArIGZpbGUuZ2V0QWJzb2x1dGVQYXRoKCkpOworICAgICAgICAgICAgbG9nLndh
cm5pbmcoIldhcm5pbmc6IGNvdWxkIG5vdCByZWFkICIgKyBhYnNvbHV0ZVBhdGgpOwogICAgICAg
ICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICB9CiAKICAgICAgICAgdHJ5IHsKLSAgICAgICAg
ICAgIGlmICghZmlsZS5nZXRBYnNvbHV0ZVBhdGgoKS5lcXVhbHMoZmlsZS5nZXRDYW5vbmljYWxQ
YXRoKCkpKSB7Ci0gICAgICAgICAgICAgICAgaWYgKGZpbGUuZ2V0UGFyZW50RmlsZSgpLmVxdWFs
cyhmaWxlLmdldENhbm9uaWNhbEZpbGUoKS5nZXRQYXJlbnRGaWxlKCkpKSB7Ci0gICAgICAgICAg
ICAgICAgICAgIC8vIExldHMgc3VwcG9ydCBzeW1saW5rcyB3aXRoaW4gdGhlIHNhbWUgZGlyZWN0
b3J5LCB0aGlzCi0gICAgICAgICAgICAgICAgICAgIC8vIHNob3VsZCBwcm9iYWJseSBiZSBleHRl
bmRlZCB0byB3aXRoaW4gdGhlIHNhbWUgcmVwb3NpdG9yeQotICAgICAgICAgICAgICAgICAgICBy
ZXR1cm4gdHJ1ZTsKLSAgICAgICAgICAgICAgICB9IGVsc2UgewotICAgICAgICAgICAgICAgICAg
ICBsb2cud2FybmluZygiV2FybmluZzogaWdub3JlZCBub24tbG9jYWwgc3ltbGluayAiICsgZmls
ZS5nZXRBYnNvbHV0ZVBhdGgoKSArCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgIiAtPiAi
ICsgZmlsZS5nZXRDYW5vbmljYWxQYXRoKCkpOwotICAgICAgICAgICAgICAgICAgICByZXR1cm4g
ZmFsc2U7Ci0gICAgICAgICAgICAgICAgfQorICAgICAgICAgICAgU3RyaW5nIGNhbm9uaWNhbFBh
dGggPSBmaWxlLmdldENhbm9uaWNhbFBhdGgoKTsKKyAgICAgICAgICAgIGlmICghYWJzb2x1dGVQ
YXRoLmVxdWFscyhjYW5vbmljYWxQYXRoKSAmJiAhYWNjZXB0U3ltbGluayhhYnNvbHV0ZVBhdGgs
IGNhbm9uaWNhbFBhdGgpKSB7CisgICAgICAgICAgICAgICAgbG9nLmZpbmUoIlNraXBwZWQgc3lt
bGluayAnIiArIGFic29sdXRlUGF0aCArCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgIicg
LT4gJyIgKyBjYW5vbmljYWxQYXRoICsgIiciKTsKKyAgICAgICAgICAgICAgICByZXR1cm4gZmFs
c2U7CiAgICAgICAgICAgICB9CiAgICAgICAgICAgICAvL2JlbG93IHdpbGwgb25seSBsZXQgZ28g
ZmlsZXMgYW5kIGRpcmVjdG9yaWVzLCBhbnl0aGluZyBlbHNlIGlzIGNvbnNpZGVyZWQgc3BlY2lh
bCBhbmQgaXMgbm90IGFkZGVkCiAgICAgICAgICAgICBpZiAoIWZpbGUuaXNGaWxlKCkgJiYgIWZp
bGUuaXNEaXJlY3RvcnkoKSkgewotICAgICAgICAgICAgICAgIGxvZy53YXJuaW5nKCJXYXJuaW5n
OiBpZ25vcmVkIHNwZWNpYWwgZmlsZSAiICsgZmlsZS5nZXRBYnNvbHV0ZVBhdGgoKSk7CisgICAg
ICAgICAgICAgICAgbG9nLndhcm5pbmcoIldhcm5pbmc6IGlnbm9yZWQgc3BlY2lhbCBmaWxlICIg
KyBhYnNvbHV0ZVBhdGgpOwogICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAg
ICAgICAgICB9CiAgICAgICAgIH0gY2F0Y2ggKElPRXhjZXB0aW9uIGV4cCkgewotICAgICAgICAg
ICAgbG9nLndhcm5pbmcoIldhcm5pbmc6IEZhaWxlZCB0byByZXNvbHZlIG5hbWU6ICIgKyBmaWxl
LmdldEFic29sdXRlUGF0aCgpKTsKKyAgICAgICAgICAgIGxvZy53YXJuaW5nKCJXYXJuaW5nOiBG
YWlsZWQgdG8gcmVzb2x2ZSBuYW1lOiAiICsgYWJzb2x1dGVQYXRoKTsKICAgICAgICAgICAgIGxv
Zy5sb2coTGV2ZWwuRklORSwiU3RhY2sgVHJhY2U6ICIsZXhwKTsgICAgICAgCiAgICAgICAgIH0K
IApAQCAtNjUwLDYgKzY0NywyNSBAQAogICAgIH0KIAogICAgIC8qKgorICAgICAqIENoZWNrIGlm
IEkgc2hvdWxkIGFjY2VwdCB0aGUgcGF0aCBjb250YWluaW5nIGEgc3ltbGluaworICAgICAqIEBw
YXJhbSBhYnNvbHV0ZVBhdGggdGhlIHBhdGggd2l0aCBhIHN5bWxpbmsgdG8gY2hlY2sKKyAgICAg
KiBAcGFyYW0gY2Fub25pY2FsUGF0aCB0aGUgY2Fub25pY2FsIHBhdGggdG8gdGhlIGZpbGUKKyAg
ICAgKiBAcmV0dXJuIHRydWUgaWYgdGhlIGZpbGUgc2hvdWxkIGJlIGFjY2VwdGVkLCBmYWxzZSBv
dGhlcndpc2UKKyAgICAgKi8KKyAgICBwcml2YXRlIGJvb2xlYW4gYWNjZXB0U3ltbGluayhTdHJp
bmcgYWJzb2x1dGVQYXRoLCBTdHJpbmcgY2Fub25pY2FsUGF0aCkgdGhyb3dzIElPRXhjZXB0aW9u
IHsKKyAgICAgICAgZm9yIChTdHJpbmcgYWxsb3dlZFN5bWxpbmsgOiBSdW50aW1lRW52aXJvbm1l
bnQuZ2V0SW5zdGFuY2UoKS5nZXRBbGxvd2VkU3ltbGlua3MoKSkgeworICAgICAgICAgICAgaWYg
KGFic29sdXRlUGF0aC5zdGFydHNXaXRoKGFsbG93ZWRTeW1saW5rKSkgeworICAgICAgICAgICAg
ICAgIFN0cmluZyBhbGxvd2VkVGFyZ2V0ID0gbmV3IEZpbGUoYWxsb3dlZFN5bWxpbmspLmdldENh
bm9uaWNhbFBhdGgoKTsKKyAgICAgICAgICAgICAgICBpZiAoY2Fub25pY2FsUGF0aC5zdGFydHNX
aXRoKGFsbG93ZWRUYXJnZXQpICYmCisgICAgICAgICAgICAgICAgICAgIGFic29sdXRlUGF0aC5z
dWJzdHJpbmcoYWxsb3dlZFN5bWxpbmsubGVuZ3RoKCkpLmVxdWFscyhjYW5vbmljYWxQYXRoLnN1
YnN0cmluZyhhbGxvd2VkVGFyZ2V0Lmxlbmd0aCgpKSkpIHsKKyAgICAgICAgICAgICAgICAgICAg
cmV0dXJuIHRydWU7CisgICAgICAgICAgICAgICAgfQorICAgICAgICAgICAgfQorICAgICAgICB9
CisgICAgICAgIHJldHVybiBmYWxzZTsKKyAgICB9CisKKyAgICAvKioKICAgICAgKiBHZW5lcmF0
ZSBpbmRleGVzIHJlY3Vyc2l2ZWx5CiAgICAgICogQHBhcmFtIGRpciB0aGUgcm9vdCBpbmRleERp
cmVjdG9yeSB0byBnZW5lcmF0ZSBpbmRleGVzIGZvcgogICAgICAqIEBwYXJhbSBwYXRoIHRoZSBw
YXRoCmRpZmYgLXIgZGZhMTg1ODc1MTdlIHNyYy9vcmcvb3BlbnNvbGFyaXMvb3Blbmdyb2svaW5k
ZXgvSW5kZXhlci5qYXZhCi0tLSBhL3NyYy9vcmcvb3BlbnNvbGFyaXMvb3Blbmdyb2svaW5kZXgv
SW5kZXhlci5qYXZhCUZyaSBNYXkgMjEgMTc6MDQ6MDQgMjAxMCAtMDYwMAorKysgYi9zcmMvb3Jn
L29wZW5zb2xhcmlzL29wZW5ncm9rL2luZGV4L0luZGV4ZXIuamF2YQlNb24gTWF5IDI0IDEzOjM2
OjI5IDIwMTAgLTA2MDAKQEAgLTMwLDYgKzMwLDcgQEAKIGltcG9ydCBqYXZhLnV0aWwuQXJyYXlM
aXN0OwogaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uczsKIGltcG9ydCBqYXZhLnV0aWwuQ29t
cGFyYXRvcjsKK2ltcG9ydCBqYXZhLnV0aWwuSGFzaFNldDsKIGltcG9ydCBqYXZhLnV0aWwuTGlz
dDsKIGltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5FeGVjdXRvclNlcnZpY2U7CiBpbXBvcnQg
amF2YS51dGlsLmNvbmN1cnJlbnQuRXhlY3V0b3JzOwpAQCAtODYsNiArODcsNyBAQAogICAgICAg
ICAgICAgYm9vbGVhbiBzZWFyY2hSZXBvc2l0b3JpZXMgPSBmYWxzZTsKICAgICAgICAgICAgIEFy
cmF5TGlzdDxTdHJpbmc+IHN1YkZpbGVzID0gbmV3IEFycmF5TGlzdDxTdHJpbmc+KCk7CiAgICAg
ICAgICAgICBBcnJheUxpc3Q8U3RyaW5nPiByZXBvc2l0b3JpZXMgPSBuZXcgQXJyYXlMaXN0PFN0
cmluZz4oKTsKKyAgICAgICAgICAgIEhhc2hTZXQ8U3RyaW5nPiBhbGxvd2VkU3ltbGlua3MgPSBu
ZXcgSGFzaFNldDxTdHJpbmc+KCk7CiAgICAgICAgICAgICBTdHJpbmcgY29uZmlnRmlsZW5hbWUg
PSBudWxsOwogICAgICAgICAgICAgU3RyaW5nIGNvbmZpZ0hvc3QgPSBudWxsOwogICAgICAgICAg
ICAgYm9vbGVhbiBhZGRQcm9qZWN0cyA9IGZhbHNlOwpAQCAtMTY3LDYgKzE2OSw5IEBACiAgICAg
ICAgICAgICAgICAgICAgICAgICBjYXNlICdSJzoKICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAvLyBhbHJlYWR5IGhhbmRsZWQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsK
KyAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ04nOgorICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIGFsbG93ZWRTeW1saW5rcy5hZGQoZ2V0b3B0LmdldE9wdGFyZygpKTsKKyAgICAgICAg
ICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2Ug
J24nOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJ1bkluZGV4ID0gZmFsc2U7CiAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CkBAIC0zOTcsNiArNDAyLDkgQEAKICAgICAg
ICAgICAgICAgICBlbnYuc2V0RGF0YWJhc2VEcml2ZXIoZGF0YWJhc2VEcml2ZXIpOwogICAgICAg
ICAgICAgICAgIGVudi5zZXREYXRhYmFzZVVybChkYXRhYmFzZVVSTCk7CiAKKyAgICAgICAgICAg
ICAgICBhbGxvd2VkU3ltbGlua3MuYWRkQWxsKGVudi5nZXRBbGxvd2VkU3ltbGlua3MoKSk7Cisg
ICAgICAgICAgICAgICAgZW52LnNldEFsbG93ZWRTeW1saW5rcyhhbGxvd2VkU3ltbGlua3MpOwor
CiAgICAgICAgICAgICAgICAgZ2V0SW5zdGFuY2UoKS5wcmVwYXJlSW5kZXhlcihlbnYsIHNlYXJj
aFJlcG9zaXRvcmllcywgYWRkUHJvamVjdHMsCiAgICAgICAgICAgICAgICAgICAgICAgICBkZWZh
dWx0UHJvamVjdCwgY29uZmlnRmlsZW5hbWUsIHJlZnJlc2hIaXN0b3J5LAogICAgICAgICAgICAg
ICAgICAgICAgICAgbGlzdEZpbGVzLCBjcmVhdGVEaWN0LCBzdWJGaWxlcywgcmVwb3NpdG9yaWVz
KTsKZGlmZiAtciBkZmExODU4NzUxN2UgdGVzdC9vcmcvb3BlbnNvbGFyaXMvb3Blbmdyb2svaGlz
dG9yeS9HaXRIaXN0b3J5UGFyc2VyVGVzdC5qYXZhCi0tLSBhL3Rlc3Qvb3JnL29wZW5zb2xhcmlz
L29wZW5ncm9rL2hpc3RvcnkvR2l0SGlzdG9yeVBhcnNlclRlc3QuamF2YQlGcmkgTWF5IDIxIDE3
OjA0OjA0IDIwMTAgLTA2MDAKKysrIGIvdGVzdC9vcmcvb3BlbnNvbGFyaXMvb3Blbmdyb2svaGlz
dG9yeS9HaXRIaXN0b3J5UGFyc2VyVGVzdC5qYXZhCU1vbiBNYXkgMjQgMTM6MzY6MjkgMjAxMCAt
MDYwMApAQCAtMjksNiArMjksNyBAQAogaW1wb3J0IG9yZy5qdW5pdC5CZWZvcmVDbGFzczsKIGlt
cG9ydCBvcmcuanVuaXQuVGVzdDsKIGltcG9ydCBzdGF0aWMgb3JnLmp1bml0LkFzc2VydC4qOwor
aW1wb3J0IG9yZy5vcGVuc29sYXJpcy5vcGVuZ3Jvay51dGlsLlRlc3RSZXBvc2l0b3J5OwogCiAv
KioKICAqCkBAIC0zNywxMiArMzgsMTUgQEAKIHB1YmxpYyBjbGFzcyBHaXRIaXN0b3J5UGFyc2Vy
VGVzdCB7CiAKICAgICBHaXRIaXN0b3J5UGFyc2VyIGluc3RhbmNlOworICAgIHByaXZhdGUgc3Rh
dGljIFRlc3RSZXBvc2l0b3J5IHJlcG9zaXRvcnkgPSBuZXcgVGVzdFJlcG9zaXRvcnkoKTsKIAog
ICAgIHB1YmxpYyBHaXRIaXN0b3J5UGFyc2VyVGVzdCgpIHsKICAgICB9CiAKICAgICBAQmVmb3Jl
Q2xhc3MKICAgICBwdWJsaWMgc3RhdGljIHZvaWQgc2V0VXBDbGFzcygpIHRocm93cyBFeGNlcHRp
b24geworICAgICAgICByZXBvc2l0b3J5ID0gbmV3IFRlc3RSZXBvc2l0b3J5KCk7CisgICAgICAg
IHJlcG9zaXRvcnkuY3JlYXRlKEhpc3RvcnlHdXJ1LmNsYXNzLmdldFJlc291cmNlQXNTdHJlYW0o
InJlcG9zaXRvcmllcy56aXAiKSk7CiAgICAgfQogCiAgICAgQEFmdGVyQ2xhc3MK
</data>

          </attachment>
      

    </bug>

</bugzilla>